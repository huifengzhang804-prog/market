(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/apis/http"),require("@/components/PageManage.vue"),require("element-plus"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","@/apis/http","@/components/PageManage.vue","element-plus","vue-router"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopApplyDiscount=h(e.ShopApplyDiscountContext.Vue,e.ShopApplyDiscountContext.VueUse,e.ShopApplyDiscountContext.SchemaForms,e.ShopApplyDiscountContext.Request,e.ShopApplyDiscountContext.PageManageTwo,e.ShopApplyDiscountContext.ElementPlus,e.ShopApplyDiscountContext.VueRouter))})(this,function(e,h,R,g,A,c,B){"use strict";var b=document.createElement("style");b.textContent=`@charset "UTF-8";.col-last[data-v-8bf2d47d]{display:flex;justify-content:flex-end}.m-l-20[data-v-8bf2d47d]{margin-left:20px}.container[data-v-12a387bc]{overflow-y:scroll}.reason[data-v-12a387bc]{padding:10px 10px 20px}.status[data-v-12a387bc]{color:#f54319}.grey[data-v-12a387bc]{color:#999}[data-v-12a387bc] .el-button.is-link{padding:0}[data-v-12a387bc] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(b);const H=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(a,{emit:y}){const i=a,f=[{label:"活动名称",prop:"name",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"IN_PROGRESS",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"OFF_SHELF",label:"已下架"},{value:"VIOLATION_OFF_SHELF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],l=y,S=h.useVModel(i,"modelValue",l),d=_=>{_&&Object.keys(_).forEach(p=>{S.value[p]=_[p]})},E=()=>{Object.keys(i.modelValue).forEach(_=>{S.value[_]=""}),l("search")};return(_,p)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{"v-model":e.unref(S),columns:f,onSearchHandle:p[0]||(p[0]=N=>l("search")),onChangeFormItem:d,onHandleReset:E},null,8,["v-model"]),p[1]||(p[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}}),Z="",F=(a,y)=>{const i=a.__vccOpts||a;for(const[f,l]of y)i[f]=l;return i},L=F(H,[["__scopeId","data-v-8bf2d47d"]]),x="addon-full-reduction/full/reduction",w=a=>g.post({url:`${x}/page`,data:a}),M=a=>g.post({url:`${x}/shelf`,data:a}),O=a=>g.del({url:`${x}/batch/delete`,data:a});var m=(a=>(a.NOT_STARTED="NOT_STARTED",a.IN_PROGRESS="IN_PROGRESS",a.FINISHED="FINISHED",a.OFF_SHELF="OFF_SHELF",a.VIOLATION_OFF_SHELF="VIOLATION_OFF_SHELF",a))(m||{});const D={NOT_STARTED:{value:"NOT_STARTED",label:"未开始",style:"nots"},IN_PROGRESS:{value:"IN_PROGRESS",label:"进行中",style:"ongoing"},FINISHED:{value:"FINISHED",label:"已结束",style:"hasEnded"},OFF_SHELF:{value:"OFF_SHELF",label:"已下架",style:"off"},VIOLATION_OFF_SHELF:{value:"VIOLATION_OFF_SHELF",label:"违规下架",style:"off"}};var I=(a=>(a[""]="未选择满减条件",a.FULL_REDUCTION="满减",a.FULL_DISCOUNT="满折",a))(I||{});const P={class:"q_plugin_container pt15"},$={class:"search_container"},q={class:"handle_container"},z={class:"table_container"},G={class:"reason"},j=e.defineComponent({__name:"ShopApplyDiscount",setup(a){const y=B.useRouter(),i=e.ref([]),f=e.ref({name:"",status:""}),l=e.reactive({size:10,current:1,total:0}),S=e.ref();d();async function d(){console.log(f.value,"searchParam");const n={...l,...f.value},{code:o,data:r}=await w(n);if(o!==200)return c.ElMessage.error("获取活动列表失败");i.value=r.records,l.current=r.current,l.size=r.size,l.total=r.total}const E=async n=>{try{if(!await c.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{code:r}=await O([n]);if(r!==200){c.ElMessage.error("删除失败");return}c.ElMessage.success("删除成功"),i.value=i.value.filter(s=>s.id!==n),l.total--}catch(o){console.error("isValidate",o)}},_=n=>{l.size=n,d()},p=n=>{l.current=n,d()},N=e.ref([]),V=e.ref(!1),T=e.ref("违规原因"),U=n=>{T.value=n,V.value=!0},J=async n=>{if(!await c.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{msg:r,code:s}=await M({id:n});if(s!==200)return c.ElMessage.error(r??"下架失败！");c.ElMessage.success("下架成功！"),d()},k=(n,o)=>{y.push({name:"applyDiscountBaseinfo",query:{id:n,isLookUp:o}})},K=()=>{c.ElMessageBox.confirm("确定删除选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async n=>{if(n==="cancel")return;const o=N.value.filter(s=>s.status!==m.IN_PROGRESS).map(s=>s.id),{code:r}=await O(o);if(r!==200){c.ElMessage.error("删除失败");return}c.ElMessage.success("删除成功"),d()}})},Q=n=>{N.value=n},W=()=>{T.value="",V.value=!1};return(n,o)=>{const r=e.resolveComponent("el-config-provider"),s=e.resolveComponent("el-button"),u=e.resolveComponent("el-table-column"),X=e.resolveComponent("el-table"),Y=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",P,[e.createElementVNode("div",$,[e.createVNode(r,{"value-on-clear":"","empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(L,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),onSearch:d},null,8,["modelValue"])]),_:1})]),e.createElementVNode("div",q,[e.createVNode(s,{round:"",type:"primary",onClick:o[1]||(o[1]=t=>e.unref(y).push({name:"applyDiscountBaseinfo"}))},{default:e.withCtx(()=>o[3]||(o[3]=[e.createTextVNode(" 新增满减 ")])),_:1}),e.createVNode(s,{disabled:!N.value.length,round:"",onClick:K},{default:e.withCtx(()=>o[4]||(o[4]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",z,[e.createVNode(X,{ref_key:"multipleTableRef",ref:S,data:i.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:Q},{default:e.withCtx(()=>[e.createVNode(u,{selectable:t=>t.status!==e.unref(m).IN_PROGRESS,fixed:"",type:"selection",width:"30"},null,8,["selectable"]),e.createVNode(u,{label:"活动名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.name),1)]),_:1}),e.createVNode(u,{label:"类型",width:"80"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(I)[t.firstRuleType]),1)]),_:1}),e.createVNode(u,{label:"使用规则",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,e.toDisplayString(t.firstRuleDesc),1)]),_:1}),e.createVNode(u,{label:"状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",{class:e.normalizeClass({status:t.status==="VIOLATION_OFF_SHELF",grey:t.status==="OFF_SHELF"||t.status==="FINISHED"})},e.toDisplayString(e.unref(D)[t.status]&&e.unref(D)[t.status].label),3)]),_:1}),e.createVNode(u,{label:"活动时间",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(u,{label:"活动商品"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.productType==="ALL_PRODUCT"?"全部":`${t.product}${t.productType==="SPECIFIED_PRODUCT_NOT_PARTICIPATE"?"(除外)":""}`),1)]),_:1}),e.createVNode(u,{label:"支付单数"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.order||0),1)]),_:1}),e.createVNode(u,{fixed:"right",label:"操作",align:"right"},{default:e.withCtx(({row:t})=>[e.createVNode(s,{link:"",type:"primary",onClick:C=>k(t.id,"true")},{default:e.withCtx(()=>o[5]||(o[5]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),t.status===e.unref(m).IN_PROGRESS?(e.openBlock(),e.createBlock(s,{key:0,link:"",type:"primary",onClick:C=>J(t.id)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode(" 下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status===e.unref(m).NOT_STARTED?(e.openBlock(),e.createBlock(s,{key:1,link:"",type:"primary",onClick:C=>k(t.id,"false")},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode(" 编辑 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status===e.unref(m).VIOLATION_OFF_SHELF?(e.openBlock(),e.createBlock(s,{key:2,link:"",type:"primary",onClick:C=>U(t.violation)},{default:e.withCtx(()=>o[8]||(o[8]=[e.createTextVNode("违规原因 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status!==e.unref(m).IN_PROGRESS?(e.openBlock(),e.createBlock(s,{key:3,link:"",type:"danger",onClick:C=>E(t.id)},{default:e.withCtx(()=>o[9]||(o[9]=[e.createTextVNode(" 删除 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(A,{"load-init":!0,"page-num":l.current,"page-size":l.size,total:l.total,onReload:d,onHandleSizeChange:_,onHandleCurrentChange:p},null,8,["page-num","page-size","total"]),e.createVNode(Y,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=t=>V.value=t),center:"",title:"违规原因",width:"600px",onClose:W},{default:e.withCtx(()=>[e.createElementVNode("div",G,e.toDisplayString(T.value),1)]),_:1},8,["modelValue"])])}}}),v="";return F(j,[["__scopeId","data-v-12a387bc"]])});
