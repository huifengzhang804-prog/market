(function(e,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue"),require("vue-router"),require("@/components/chrome-tab/index.vue"),require("@/components/qszr-core/packages/q-table/QTable"),require("@/components/qszr-core/packages/q-table/q-table-column.vue"),require("@/components/PageManage.vue"),require("element-plus"),require("@/composables/useConvert"),require("@/components/schema-form/index.vue"),require("@vueuse/core"),require("element-china-area-data"),require("@/components/q-address"),require("@/components/q-address/q-address.vue"),require("lodash-es"),require("@/utils/date"),require("vue-clipboard3"),require("@element-plus/icons-vue"),require("@/components/remark/remark-flag.vue"),require("@/components/remark/remark-popup.vue"),require("@/utils/Storage"),require("@/components/q-editor/editor.vue"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","vue-router","@/components/chrome-tab/index.vue","@/components/qszr-core/packages/q-table/QTable","@/components/qszr-core/packages/q-table/q-table-column.vue","@/components/PageManage.vue","element-plus","@/composables/useConvert","@/components/schema-form/index.vue","@vueuse/core","element-china-area-data","@/components/q-address","@/components/q-address/q-address.vue","lodash-es","@/utils/date","vue-clipboard3","@element-plus/icons-vue","@/components/remark/remark-flag.vue","@/components/remark/remark-popup.vue","@/utils/Storage","@/components/q-editor/editor.vue","@/apis/http"],j):(e=typeof globalThis<"u"?globalThis:e||self,e.Integral=j(e.IntegralContext.Vue,e.IntegralContext.VueRouter,e.IntegralContext.ChromeTab,e.IntegralContext.QTable,e.IntegralContext.QTableColumn,e.IntegralContext.PageManageTwo,e.IntegralContext.ElementPlus,e.IntegralContext.UseConvert,e.IntegralContext.SchemaForm,e.IntegralContext.VueUse,e.IntegralContext.ElementChinaAreaData,e.IntegralContext.QAddressIndex,e.IntegralContext.QAddress,e.IntegralContext.Lodash,e.IntegralContext.DateUtil,e.IntegralContext.VueClipboard3,e.IntegralContext.ElementPlusIconsVue,e.IntegralContext.RemarkFlag,e.IntegralContext.RemarkPopup,e.IntegralContext.Storage,e.IntegralContext.EditorTwo,e.IntegralContext.Request))})(this,function(e,j,Ne,de,G,ie,V,ce,pe,me,xe,_e,fe,he,Ce,ke,ue,be,Ee,we,ge,R){"use strict";var Ve=document.createElement("style");Ve.textContent=`@charset "UTF-8";[data-v-39d47dbf]{font-size:14px}.commodity[data-v-39d47dbf]{display:flex;justify-content:center;align-items:center;justify-content:flex-start;align-items:flex-start}.commodity__right[data-v-39d47dbf]{height:68px;margin-left:10px;display:flex;flex-direction:column;justify-content:space-between}.commodity__right--name[data-v-39d47dbf]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.commodity__right--price[data-v-39d47dbf]{width:150px;margin-top:15px;font-size:12px}.del[data-v-39d47dbf]{cursor:pointer;margin:0 10px;color:red}.bj[data-v-39d47dbf]{cursor:pointer;margin:0 10px;color:#409eff}.show[data-v-39d47dbf]{display:none}.input-with-select[data-v-39d47dbf]{width:350px;float:right;position:relative;z-index:9}[data-v-39d47dbf] .body--header{width:14px;height:14px;float:left;border:0;transform:translate(5px,50px)}[data-v-39d47dbf] .m__table--head.padding:after{content:""}[data-v-39d47dbf] .m__table--body:after{content:""}.notShipment__info[data-v-919157d8]{display:flex;justify-content:center;align-items:center;flex-direction:column;color:#838383;align-items:start}.notShipment__show[data-v-919157d8]{font-size:14px;color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.el-table td[data-v-919157d8]{border-bottom:none}.tableStyle[data-v-919157d8]:before{width:0}.el-table[data-v-919157d8]{border-radius:9px;border:1px solid #d5d5d5}.el-table th.is-leaf[data-v-919157d8]{border-bottom:none}.footer[data-v-919157d8]{display:flex;justify-content:flex-end;align-items:center}.demo-tabs>.el-tabs__content[data-v-03b6b323]{padding:32px;color:#6b778c;font-size:32px;font-weight:600}[data-v-8701461e]{font-size:14px}.goods-Infor[data-v-8701461e]{display:flex;justify-content:center;align-items:center;align-items:flex-start}.goods-Infor__name[data-v-8701461e]{height:68px;display:flex;justify-content:center;align-items:center;flex-direction:column;justify-content:space-around;align-items:flex-start;overflow:hidden}.goods-Infor__name--integral[data-v-8701461e]{color:#ff7417}.base-vip-table[data-v-8701461e]{overflow:auto}.base-vip-table-top[data-v-8701461e]{display:flex;justify-content:center;align-items:center;justify-content:space-between;width:100%}.base-vip-table-top__left[data-v-8701461e]{color:#333}.base-vip-table-top__left span[data-v-8701461e]:after{content:"|";padding:0 5px}.base-vip-table-top__left span[data-v-8701461e]:last-child:after{content:""}.ellipsis[data-v-8701461e]{width:250px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;white-space:normal;text-overflow:unset;word-break:break-all}.content[data-v-8701461e]{display:flex;flex-direction:column;height:45px;justify-content:space-around}.fix[data-v-8701461e]{width:100%;cursor:pointer;display:flex;justify-content:center;align-items:center;height:40px;background:#f9f9f9}.fix__arrow[data-v-8701461e]{margin-left:4px}.fix__down[data-v-8701461e]{transform:rotate(180deg)}.warning[data-v-8701461e]{line-height:24px;padding:14px;margin-bottom:10px;background:rgba(233,0,0,.05);color:#e90000;font-size:14px}.warning span[data-v-8701461e]{font-size:18px;font-weight:700;color:#f72020}.item[data-v-8701461e]{height:25px;line-height:25px}.title[data-v-b6a74361]{margin:15px 10px;display:flex;justify-content:center;align-items:center;justify-content:flex-start;font-size:14px;color:#555cfd;font-weight:700}.title[data-v-b6a74361]:before{content:"";display:inline-block;height:14px;width:2.5px;background:#555cfd;margin-right:9px}.use_rules[data-v-b6a74361]{font-size:14px;font-family:sans-serif,sans-serif-Normal;font-weight:400;text-align:LEFT;color:#333;line-height:30px}.use_rules__msg[data-v-b6a74361]{font-size:14px;text-align:LEFT;color:#d3d3d3}.save[data-v-b6a74361]{margin:30px 0;text-align:center}.get_rules[data-v-b6a74361]{text-indent:1em;padding:10px 0}.p20[data-v-b6a74361]{padding:0 0 0 20px}
`,document.head.appendChild(Ve);const Se=e.defineComponent({__name:"Integral",setup(N){const _=e.ref("goods"),f=j.useRoute(),a=[{label:"积分商品",name:"goods"},{label:"积分订单",name:"order"},{label:"积分规则",name:"rules"}],s={goods:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Je)),order:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Ht)),rules:e.defineAsyncComponent(()=>Promise.resolve().then(()=>cl))};e.watchEffect(()=>{f.query.type&&f.query.type==="order"&&(_.value=f.query.type)});const y=p=>{p&&(_.value=p)};return(p,k)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(Ne,{"tab-list":a,value:_.value,onHandleTabs:y},null,8,["value"]),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(s[_.value])))],64))}}),K="addon-integral/integral/",se=K+"product/",te=K+"order/",Te=N=>R.get({url:se+"list",params:N}),ye=(N,_)=>R.put({url:se+`updateStatus/${N}`,data:_}),Ie=N=>R.del({url:se+`delete/${N}`}),Re=N=>R.get({url:te+"list",params:N}),De=()=>R.get({url:K+"rules/info"}),Oe=N=>R.post({url:K+"rules/save",data:N}),Be=N=>R.post({url:K+"rules/update",data:N}),Ge=N=>R.get({url:te+`deliver/single/undeliver/${N}`}),Ae=N=>R.put({url:te+"deliver",data:N}),Le=N=>R.put({url:te+`deliver/complete/${N}`}),Ue=()=>R.get({url:"gruul-mall-freight/fright/list",params:{current:1,size:1e3}}),$e=()=>R.put({url:"addon-integral/integral/order/warning"}),Pe={class:"handle_container"},Me={class:"commodity"},qe={style:{width:"68px",height:"68px"}},ze={class:"commodity__right"},Fe={class:"commodity__right--name"},je={key:1},He={style:{color:"#666"}},Ye={style:{color:"#ecb789"}},We={key:0},Qe={class:"shop-name"},Xe=e.defineComponent({__name:"integral-goods",setup(N){const{divTenThousand:_}=ce(),f=e.reactive({size:20,current:1,total:0}),a=e.ref({status:"",keywords:""}),s=j.useRouter(),y=e.ref([]),p=e.ref([]),k=[{label:"关键词",labelWidth:60,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输关键词"}}];b();async function b(){const{status:c,keywords:i}=a.value,{code:C,data:E,msg:w}=await Te({keyword:i,status:c,...f});if(C!==200){V.ElMessage.error(w||"获取积分商品列表失败");return}y.value=E.records,f.total=E.total}const T=c=>{c&&Object.keys(c).forEach(i=>a.value[i]=c[i])},x=()=>{Object.keys(a.value).forEach(c=>a.value[c]=""),b()},$=async()=>{if(!p.value.length){V.ElMessage.error("请选择商品");return}try{if(!await V.ElMessageBox.confirm("确定进行删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const i=p.value.map(C=>C.id);await P(i),p.value=[]}catch{return}},P=async c=>{const{code:i,data:C,msg:E}=await Ie(c);if(i!==200){V.ElMessage.error(E||"删除失败");return}V.ElMessage.success(E||"删除成功"),b()},M=async c=>{if(!p.value.length){V.ElMessage.error("请选择商品");return}try{if(!await V.ElMessageBox.confirm(`确定进行${c==="SELL_OFF"?"下":"上"}架?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const C=p.value.map(E=>E.id);await H(c,C),p.value=[]}catch{return!1}};async function H(c,i){const{code:C,data:E,msg:w}=await ye(c,i);if(C!==200)return V.ElMessage.error(w||"操作失败"),!1;V.ElMessage.success("操作成功"),b()}const A=()=>{s.push({name:"addIntegralMallGoods"})},S=c=>{s.push({name:"addIntegralMallGoods",query:{id:c.id}})},n=async(c,i)=>{switch(c){case"DELETE":try{if(!await V.ElMessageBox.confirm("确定进行删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;P([i.id])}catch(C){console.log(C)}break}},t=c=>{f.size=c,b()},m=c=>{f.current=c,b()},d=async c=>{const{code:i,data:C,msg:E}=await ye(c.status==="SELL_OFF"?"SELL_ON":"SELL_OFF",[c.id]);if(i!==200)return V.ElMessage.error(E||"操作失败"),!1;b()},g=()=>{p.value=[],b()},h={REAL_PRODUCT:"实物商品",VIRTUAL_PRODUCT:"虚拟商品"};return(c,i)=>{const C=e.resolveComponent("el-tab-pane"),E=e.resolveComponent("el-tabs"),w=e.resolveComponent("el-button"),L=e.resolveComponent("el-image"),O=e.resolveComponent("el-tooltip"),D=e.resolveComponent("el-switch");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(pe,{"v-model":a.value,columns:k,onChangeFormItem:T,onSearchHandle:b,onHandleReset:x},null,8,["v-model"]),e.createVNode(E,{modelValue:a.value.status,"onUpdate:modelValue":i[0]||(i[0]=u=>a.value.status=u),class:"demo-tabs tab_container",onTabChange:g},{default:e.withCtx(()=>[e.createVNode(C,{label:"全部",name:""}),e.createVNode(C,{label:"已上架",name:"SELL_ON"}),e.createVNode(C,{label:"已下架",name:"SELL_OFF"})]),_:1},8,["modelValue"]),e.createElementVNode("div",Pe,[e.createVNode(w,{type:"primary",onClick:A},{default:e.withCtx(()=>i[4]||(i[4]=[e.createTextVNode("新增积分商品")])),_:1}),e.createVNode(w,{disabled:p.value.length===0,onClick:i[1]||(i[1]=u=>M("SELL_ON"))},{default:e.withCtx(()=>i[5]||(i[5]=[e.createTextVNode("批量上架")])),_:1},8,["disabled"]),e.createVNode(w,{disabled:p.value.length===0,onClick:i[2]||(i[2]=u=>M("SELL_OFF"))},{default:e.withCtx(()=>i[6]||(i[6]=[e.createTextVNode("批量下架")])),_:1},8,["disabled"]),e.createVNode(w,{disabled:p.value.length===0,onClick:$},{default:e.withCtx(()=>i[7]||(i[7]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createVNode(e.unref(de),{ref:"multipleTableRef","checked-item":p.value,"onUpdate:checkedItem":i[3]||(i[3]=u=>p.value=u),data:y.value,selection:!0,style:{overflow:"auto"},"no-border":""},{default:e.withCtx(()=>[e.createVNode(G,{label:"商品",prop:"goodInfo",align:"left",width:"280"},{default:e.withCtx(({row:u})=>[e.createElementVNode("div",Me,[e.createElementVNode("div",qe,[e.createVNode(L,{style:{width:"68px",height:"68px"},src:u.pic,fit:"fill"},null,8,["src"])]),e.createElementVNode("div",ze,[e.createElementVNode("div",Fe,[u.name.length>=30?(e.openBlock(),e.createBlock(O,{key:0,effect:"dark",content:u.name,placement:"top-start"},{default:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(u==null?void 0:u.name),1)]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("span",je,e.toDisplayString(u==null?void 0:u.name),1))]),e.createElementVNode("div",He,e.toDisplayString(h[u==null?void 0:u.productType]),1)])])]),_:1}),e.createVNode(G,{label:"积分",prop:"productType",align:"left",width:"180"},{default:e.withCtx(({row:u})=>[e.createElementVNode("div",Ye,[e.createElementVNode("span",null,e.toDisplayString(u.integralPrice),1),i[10]||(i[10]=e.createElementVNode("span",null,"积分",-1)),u.salePrice!=="0"?(e.openBlock(),e.createElementBlock("span",We,[i[8]||(i[8]=e.createTextVNode("+")),i[9]||(i[9]=e.createElementVNode("span",null,"￥",-1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(_)(u.salePrice)),1)])):e.createCommentVNode("",!0)])]),_:1}),e.createVNode(G,{label:"商品库存",prop:"stock",align:"left",width:"120"}),e.createVNode(G,{label:"商品状态",width:"120",align:"left"},{default:e.withCtx(({row:u})=>[e.createElementVNode("span",Qe,[e.createVNode(D,{"model-value":u.status==="SELL_ON",class:"ml-2","inline-prompt":"","active-text":"上架","inactive-text":"下架",onChange:U=>d(u)},null,8,["model-value","onChange"])])]),_:1}),e.createVNode(G,{label:"操作",align:"right",width:"120",fixed:"right"},{default:e.withCtx(({row:u})=>[e.createVNode(w,{type:"primary",link:"",onClick:U=>S(u)},{default:e.withCtx(()=>i[11]||(i[11]=[e.createTextVNode("编辑")])),_:2},1032,["onClick"]),u.status==="SELL_OFF"?(e.openBlock(),e.createBlock(w,{key:0,type:"danger",link:"",onClick:U=>n("DELETE",u)},{default:e.withCtx(()=>i[12]||(i[12]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["checked-item","data"]),e.createVNode(ie,{class:"pagination","page-size":f.size,"page-num":f.current,total:f.total,onHandleSizeChange:t,onHandleCurrentChange:m},null,8,["page-size","page-num","total"])],64)}}}),pl="",Z=(N,_)=>{const f=N.__vccOpts||N;for(const[a,s]of _)f[a]=s;return f},Je=Object.freeze(Object.defineProperty({__proto__:null,default:Z(Xe,[["__scopeId","data-v-39d47dbf"]])},Symbol.toStringTag,{value:"Module"})),Ke={style:{display:"flex","justify-content":"space-between","border-bottom":"1px dashed #ccc",height:"90px"}},Ze={style:{display:"flex","justify-content":"space-around","flex-direction":"column"}},ve={style:{"font-weight":"bold"}},et={key:0},tt={key:1},lt={style:{display:"flex","justify-content":"space-around","flex-direction":"column"}},ot={key:0},at={style:{margin:"5px 0",display:"flex","justify-content":"space-between",height:"30px"}},nt={class:"send"},rt={key:0,class:"send",style:{"font-weight":"bold"}},st={key:1,class:"send",style:{"font-weight":"bold"}},dt={class:"send"},it={style:{display:"flex"}},ct={class:"notShipment__info",style:{width:"200px","padding-left":"10px"}},pt={class:"notShipment__show"},mt={style:{"text-align":"center"}},ft={style:{color:"#ecb751"}},ut={key:0,style:{color:"#f20404"}},gt={style:{"font-size":"12px"}},Vt={class:"footer"},yt=e.defineComponent({__name:"notShipment",props:{currentNo:{type:String,required:!0},isShow:{type:Boolean,required:!0}},emits:["update:isShow","upload-list"],setup(N,{emit:_}){const f=N,a=e.ref([]),s=_,y=me.useVModel(f,"isShow",s),p=e.ref({sellerRemark:"",buyerRemark:"",payTime:"",deliveryTime:"",accomplishTime:"",buyerId:"",buyerNickname:"",createTime:"",freightPrice:0,image:"",salePrice:"",integralOrderReceiver:{address:"",areaCode:[],createTime:"",id:"",mobile:"",name:"",orderNo:"",updateTime:""},no:"",num:1,price:"",productName:"",status:"PAID",productType:"REAL_PRODUCT"}),k=e.ref(),b=e.ref(),T=e.reactive({address:[],company:[{required:!0,message:"请选择物流公司",trigger:"change"}],expressNo:[{required:!0,message:"请填写物流单号",trigger:"blur"},{min:8,max:20,message:"请填写正确的物流单号",trigger:"blur"}]}),x=e.reactive({deliverType:"EXPRESS",receiver:{name:"",mobile:"",address:""},expressCompany:"",expressCode:"",addressaddress:"",expressNo:"",expressName:""});$(),P();async function $(){if(!f.currentNo){V.ElMessage.error("获取订单号失败"),y.value=!1;return}const{code:n,data:t,msg:m}=await Ge(f.currentNo);if(n!==200){V.ElMessage.error(m||"获取订单详情失败"),y.value=!1;return}p.value=t,k.value.toggleRowSelection(p.value,!0)}async function P(){const{data:n}=await Ue();a.value=n==null?void 0:n.records}const M=async()=>{var n;try{if(await((n=b.value)==null?void 0:n.validate())){const m=A(x.deliverType);console.log(m);const{code:d,msg:g,data:h}=await Ae([m]);if(d!==200){V.ElMessage.error(g||"发货失败");return}V.ElMessage.success("发货成功"),y.value=!1,s("upload-list")}}catch{}},H=n=>{var t,m,d;x.expressName=((d=(m=(t=a.value)==null?void 0:t.filter(g=>g.logisticsCompanyCode===n))==null?void 0:m.pop())==null?void 0:d.logisticsCompanyName)||""},A=n=>{var h,c;const{deliverType:t,expressCode:m,expressNo:d,expressName:g}=x;return n==="EXPRESS"?{integralOrderNo:f.currentNo,integralOrderDeliverType:((h=p.value)==null?void 0:h.productType)==="REAL_PRODUCT"?"EXPRESS":"WITHOUT",expressCompanyName:m,expressNo:d,expressName:g}:{integralOrderNo:f.currentNo,integralOrderDeliverType:((c=p.value)==null?void 0:c.productType)==="REAL_PRODUCT"?"EXPRESS":"WITHOUT"}},S=()=>{y.value=!1};return(n,t)=>{const m=e.resolveComponent("el-option"),d=e.resolveComponent("el-select"),g=e.resolveComponent("el-col"),h=e.resolveComponent("el-row"),c=e.resolveComponent("el-form-item"),i=e.resolveComponent("el-input"),C=e.resolveComponent("el-avatar"),E=e.resolveComponent("el-table-column"),w=e.resolveComponent("el-table"),L=e.resolveComponent("el-form"),O=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(L,{ref_key:"ruleFormRef",ref:b,model:x,class:"notShipment",rules:T},{default:e.withCtx(()=>{var D,u,U,F,Y,W;return[e.createElementVNode("div",Ke,[e.createElementVNode("div",Ze,[e.createElementVNode("div",ve,e.toDisplayString((u=(D=p.value)==null?void 0:D.integralOrderReceiver)==null?void 0:u.name),1),e.createElementVNode("div",null,e.toDisplayString((F=(U=p.value)==null?void 0:U.integralOrderReceiver)==null?void 0:F.mobile),1),p.value.integralOrderReceiver.address?(e.openBlock(),e.createElementBlock("div",et,[e.createVNode(fe,{address:p.value.integralOrderReceiver.areaCode},null,8,["address"]),e.createTextVNode(e.toDisplayString(p.value.integralOrderReceiver.address),1)])):(e.openBlock(),e.createElementBlock("div",tt,"暂无地址信息"))]),e.createElementVNode("div",lt,[((Y=p.value)==null?void 0:Y.productType)==="REAL_PRODUCT"?(e.openBlock(),e.createElementBlock("div",ot,[x.deliverType!=="WITHOUT"?(e.openBlock(),e.createBlock(c,{key:0,"label-width":"120px",prop:""},{label:e.withCtx(()=>t[3]||(t[3]=[e.createElementVNode("div",{class:"send"},"物流公司",-1)])),default:e.withCtx(()=>[e.createVNode(h,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(g,{span:20},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:x.expressCode,"onUpdate:modelValue":t[0]||(t[0]=o=>x.expressCode=o),placeholder:"请选择物流公司",class:"m-2",style:{width:"100%",height:"30px"},onChange:H},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,o=>(e.openBlock(),e.createBlock(m,{key:o.logisticsCompanyName,label:o.logisticsCompanyName,value:o.logisticsCompanyCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0),x.deliverType==="EXPRESS"?(e.openBlock(),e.createBlock(c,{key:1,"label-width":"120px",prop:"expressNo"},{label:e.withCtx(()=>t[4]||(t[4]=[e.createElementVNode("div",null,"物流单号",-1)])),default:e.withCtx(()=>[e.createVNode(h,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(g,{span:20},{default:e.withCtx(()=>[e.createVNode(i,{modelValue:x.expressNo,"onUpdate:modelValue":t[1]||(t[1]=o=>x.expressNo=o),placeholder:"",style:{width:"100%",height:"30px"},maxlength:"40"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0)])):((W=p.value)==null?void 0:W.productType)==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createBlock(c,{key:1,"label-width":"90px"},{default:e.withCtx(()=>t[5]||(t[5]=[e.createElementVNode("div",{style:{color:"#f20404"}},"您可通过网络形式(如:聊天工具将商品发给用户)发货",-1)])),_:1})):e.createCommentVNode("",!0)])]),e.createElementVNode("div",at,[e.createVNode(c,{"label-width":"70px",left:""},{label:e.withCtx(()=>t[6]||(t[6]=[e.createElementVNode("div",{class:"send"},"订单号：",-1)])),default:e.withCtx(()=>[e.createElementVNode("div",nt,e.toDisplayString(f.currentNo),1)]),_:1}),e.createVNode(c,{"label-width":"90px"},{label:e.withCtx(()=>t[7]||(t[7]=[e.createElementVNode("div",{class:"send"},"配送方式：",-1)])),default:e.withCtx(()=>{var o;return[((o=p.value)==null?void 0:o.productType)==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("div",rt,"无需物流")):(e.openBlock(),e.createElementBlock("div",st,"快递配送"))]}),_:1}),e.createVNode(c,{"label-width":"90px"},{label:e.withCtx(()=>t[8]||(t[8]=[e.createElementVNode("div",{class:"send"},"下单时间：",-1)])),default:e.withCtx(()=>[e.createElementVNode("div",dt,e.toDisplayString(p.value.createTime),1)]),_:1})]),e.createVNode(w,{ref_key:"tableRef",ref:k,"empty-text":"暂无数据~",data:[p.value],"max-height":"250",style:{width:"100%","margin-bottom":"20px"},"header-row-style":()=>({fontSize:"14px",color:"#333333",fontWeight:"bold"})},{default:e.withCtx(()=>[e.createVNode(E,{label:"商品",align:"center"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",it,[e.createVNode(C,{style:{width:"68px",height:"68px","flex-shrink":"0"},shape:"square",size:"large",src:o.image},null,8,["src"]),e.createElementVNode("div",ct,[e.createElementVNode("div",pt,e.toDisplayString(o.productName),1)])])]),_:1}),e.createVNode(E,{label:"数量",width:"200",align:"center"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",mt,[e.createElementVNode("div",null,[e.createElementVNode("span",ft,[e.createTextVNode(e.toDisplayString(o.price)+" ",1),t[9]||(t[9]=e.createElementVNode("span",{style:{"font-size":"10px"}},"分",-1))]),+o.salePrice==0?(e.openBlock(),e.createElementBlock("span",ut,[t[10]||(t[10]=e.createTextVNode(" + ")),t[11]||(t[11]=e.createElementVNode("span",{style:{"font-size":"10px"}},"￥",-1)),e.createTextVNode(e.toDisplayString(o.salePrice),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",gt,e.toDisplayString(o.num)+" 件",1)])]),_:1})]),_:1},8,["data"]),x.deliverType==="PRINT_EXPRESS"?(e.openBlock(),e.createBlock(c,{key:0,"label-width":"90px",prop:""},{label:e.withCtx(()=>t[12]||(t[12]=[e.createElementVNode("div",null,"发货地址",-1)])),default:e.withCtx(()=>[e.createVNode(h,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(g,{span:20},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:x.addressaddress,"onUpdate:modelValue":t[2]||(t[2]=o=>x.addressaddress=o),placeholder:"选择发货地址",style:{width:"100%",height:"30px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.deliveryAddressData,o=>(e.openBlock(),e.createBlock(m,{key:o.id,value:o.id,label:`${e.unref(_e.AddressFn)(e.unref(xe.regionData),[o.provinceCode,o.cityCode,o.regionCode])}${o.address}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0)]}),_:1},8,["model","rules"]),e.createElementVNode("footer",Vt,[e.createVNode(O,{onClick:S},{default:e.withCtx(()=>t[13]||(t[13]=[e.createTextVNode("取消")])),_:1}),t[15]||(t[15]=e.createTextVNode()),e.createVNode(O,{type:"primary",onClick:M},{default:e.withCtx(()=>t[14]||(t[14]=[e.createTextVNode("确认")])),_:1})])],64)}}}),fl="",Nt=Z(yt,[["__scopeId","data-v-919157d8"]]),xt={class:"my-header"},_t=["id"],ht=e.defineComponent({__name:"order-shipment",props:{isShow:{type:Boolean,default:!1},currentNo:{type:String,default:""}},emits:["update:isShow","upload-list"],setup(N,{emit:_}){const f=N,a=_,s=me.useVModel(f,"isShow",a),y=()=>{s.value=!1};return(p,k)=>{const b=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(b,{modelValue:e.unref(s),"onUpdate:modelValue":k[2]||(k[2]=T=>e.isRef(s)?s.value=T:null),width:"700","before-close":y,"destroy-on-close":""},{header:e.withCtx(({titleId:T,titleClass:x})=>[e.createElementVNode("div",xt,[e.createElementVNode("h4",{id:T,class:e.normalizeClass(x)},"商品发货",10,_t)])]),default:e.withCtx(()=>[e.createVNode(Nt,{"is-show":e.unref(s),"onUpdate:isShow":k[0]||(k[0]=T=>e.isRef(s)?s.value=T:null),"current-no":f.currentNo,onUploadList:k[1]||(k[1]=T=>a("upload-list"))},null,8,["is-show","current-no"])]),_:1},8,["modelValue"])}}}),ul="",Ct=Z(ht,[["__scopeId","data-v-03b6b323"]]),kt={UNPAID:"未支付",PAID:"待发货",ON_DELIVERY:"已发货",ACCOMPLISH:"已完成",SYSTEM_CLOSED:"已关闭"},bt={key:0,class:"warning"},Et={class:"handle_container"},wt={class:"base-vip-table-top"},St={class:"base-vip-table-top__left"},Tt={class:"goods-Infor"},It={class:"goods-Infor__name"},Rt={class:"ellipsis"},Dt={key:1},Ot={class:"goods-Infor__name--integral"},Bt={class:"commodity__right--price"},Gt={key:0},At={class:"content"},Lt={style:{width:"200px"}},Ut={style:{width:"100px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},$t={style:{width:"200px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Pt={style:{display:"inline",color:"#ecb789"}},Mt={class:"commodity__right--price content"},qt={key:0},zt={class:"money_text",style:{"margin-bottom":"5px"}},Ft={class:"operation"},jt=e.defineComponent({__name:"integral-order",emits:["search-data","changeShow"],setup(N,{emit:_}){ke();const f=e.reactive({size:20,current:1,total:0}),a=e.ref({no:"",consignee:"",productName:"",date:[],status:"",affiliationPlatform:""}),{divTenThousand:s}=ce(),y=e.ref(!1),p=e.ref([]),k=e.ref(""),b=j.useRouter(),T=e.ref([]),x=e.ref([]),$=e.ref(!1),P=e.ref(""),M=e.ref("calc(100vh - 310px)"),H=[{label:"订单号",labelWidth:60,prop:"no",valueType:"copy",fieldProps:{placeholder:"请输入订单号",maxlength:20}},{label:"收货人姓名",prop:"consignee",labelWidth:90,valueType:"copy",fieldProps:{placeholder:"请输入收货人姓名",maxlength:30}},{label:"商品名称",prop:"productName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称",maxlength:30}},{label:"下单时间",prop:"date",valueType:"date-picker",fieldProps:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",valueFormat:"YYYY-MM-DD"}},{label:"所属渠道",prop:"affiliationPlatform",valueType:"select",options:[{label:"小程序",value:"WECHAT_MINI_APP"},{label:"公众号",value:"WECHAT_MP"},{label:"PC商城",value:"PC"},{label:"H5商城",value:"H5"},{label:"IOS",value:"IOS"},{label:"安卓",value:"ANDROID"},{label:"鸿蒙",value:"HARMONY"}],fieldProps:{placeholder:"请选择"}}];S();const A=e.ref("0");async function S(){var Q,X;const o=he.cloneDeep(a.value);Array.isArray(o.date)&&(o.startTime=(Q=o.date)==null?void 0:Q[0],o.endTime=(X=o.date)==null?void 0:X[1]),delete o.date;const{code:r,data:I,msg:q}=await Re({...f,...o});if(r!==200){V.ElMessage.error(q||"获取订单失败");return}T.value=I.records,f.total=I.total,A.value=I.waitDeliveryNum}const n=o=>{o&&Object.keys(o).forEach(r=>a.value[r]=o[r])},t=()=>{Object.keys(a.value).forEach(o=>a.value[o]=""),S()},m=o=>{P.value=o.no,$.value=!0},d=o=>{p.value=[o.no],o.sellerRemark&&(k.value=o.sellerRemark),y.value=!0},g=o=>{f.size=o,S()},h=o=>{f.current=o,S()},c=()=>{x.value=[],S()},i=o=>{b.push({name:"integralMallOrderDetail",query:{no:o}})},C=async o=>{try{await V.ElMessageBox.confirm("确认关闭订单?","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warning"});const{code:r,msg:I,data:q}=await Le(o.no);if(r!==200){V.ElMessage.error(I||"关闭订单失败");return}V.ElMessage.success("关闭订单成功"),o.status="SYSTEM_CLOSED"}catch{}},E=e.ref(!1);e.watch(()=>E.value,o=>{M.value=o?"calc(100vh - 450px)":"calc(100vh - 310px)"});const w=e.ref("0"),L=new Ce,O=e.ref(" "),D=e.ref("全部订单"),u=async o=>{if(a.value.status=o,S(),o==="PAID"){const{code:r,data:I,msg:q}=await $e();if(r!==200)return V.ElMessage.error(q||"获取待发货订单总数失败");w.value=I}},U=o=>{if(O.value=" ",D.value=o,D.value==="近一个月订单"){const r=L.getLastMonth(new Date);F(r)}else if(D.value==="近三个月订单"){const r=L.getLastThreeMonth(new Date);F(r)}else a.value.date=[],S()},F=async o=>{const r=L.getYMDs(new Date);a.value.date=[o,r],S()},Y={WECHAT_MINI_APP:"小程序",WECHAT_MP:"公众号",PC:"PC商城",H5:"H5商城",IOS:"IOS",ANDROID:"安卓",HARMONY:"鸿蒙"},W=()=>{if(console.log(x.value),!x.value.length)return V.ElMessage.error("请选择商品");const o=x.value.filter(r=>r.status==="PAID");if(!o.length)return V.ElMessage.error("暂无待发货订单");new we().setItem("integralOrderSendGoods",o,60*60*24),b.push({name:"integralMallOrderDelivery"})};return(o,r)=>{const I=e.resolveComponent("el-icon"),q=e.resolveComponent("el-dropdown-item"),Q=e.resolveComponent("el-dropdown-menu"),X=e.resolveComponent("el-dropdown"),z=e.resolveComponent("el-tab-pane"),le=e.resolveComponent("el-badge"),oe=e.resolveComponent("el-tabs"),ae=e.resolveComponent("el-button"),ne=e.resolveComponent("el-image"),re=e.resolveComponent("el-tooltip"),v=e.resolveComponent("el-row"),J=e.resolveComponent("el-link");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(pe,{"v-model":a.value,columns:H,"has-unfold":"",onChangeFormItem:n,onSearchHandle:S,onHandleReset:t},null,8,["v-model"]),e.createVNode(oe,{modelValue:O.value,"onUpdate:modelValue":r[0]||(r[0]=l=>O.value=l),class:"demo-tabs tab_container",onTabChange:u},{default:e.withCtx(()=>[a.value.status==="PAID"&&+A.value>=1?(e.openBlock(),e.createElementBlock("div",bt,[e.createVNode(I,{color:"#f72020",style:{transform:"translateY(2px)"}},{default:e.withCtx(()=>[e.createVNode(e.unref(ue.WarningFilled))]),_:1}),r[6]||(r[6]=e.createTextVNode(" 您共有 ")),e.createElementVNode("span",null,e.toDisplayString(A.value),1),r[7]||(r[7]=e.createTextVNode(" 笔待发货的订单，其中小程序端订单有 ")),e.createElementVNode("span",null,e.toDisplayString(w.value),1),r[8]||(r[8]=e.createTextVNode(" 笔，超过 48 小时未发货，将触发支付风险提示，直至暂停小程序交易 ！！！ "))])):e.createCommentVNode("",!0),e.createVNode(z,{name:" "},{label:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(D.value),1),e.createVNode(X,{placement:"bottom-end",trigger:"click",onCommand:U},{dropdown:e.withCtx(()=>[e.createVNode(Q,null,{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(["近一个月订单","近三个月订单","全部订单"],l=>e.createVNode(q,{key:l,command:l},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(l),1)]),_:2},1032,["command"])),64))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",{class:"el-dropdown-link",style:{height:"40px"},onClick:e.withModifiers(()=>{},["stop"])},[e.createVNode(I,{class:"el-icon--right",style:{position:"relative",top:"12px"}},{default:e.withCtx(()=>[e.createVNode(e.unref(ue.ArrowDown))]),_:1})])]),_:1})]),_:1}),e.createVNode(z,{label:"待付款",name:"UNPAID"}),e.createVNode(z,{name:"PAID"},{label:e.withCtx(()=>[e.createVNode(le,{value:A.value,class:"item"},{default:e.withCtx(()=>r[9]||(r[9]=[e.createElementVNode("span",null,"待发货",-1)])),_:1},8,["value"])]),_:1}),e.createVNode(z,{label:"待收货",name:"ON_DELIVERY"}),e.createVNode(z,{label:"已完成",name:"ACCOMPLISH"}),e.createVNode(z,{label:"已关闭",name:"SYSTEM_CLOSED"})]),_:1},8,["modelValue"]),e.createElementVNode("div",Et,[e.createVNode(ae,{onClick:W},{default:e.withCtx(()=>r[10]||(r[10]=[e.createTextVNode("批量发货")])),_:1})]),e.createVNode(e.unref(de),{"checked-item":x.value,"onUpdate:checkedItem":r[1]||(r[1]=l=>x.value=l),data:T.value,class:"base-vip-table",style:e.normalizeStyle({height:M.value}),"header-selection":"","no-border":""},{header:e.withCtx(({row:l})=>[e.createElementVNode("div",wt,[e.createElementVNode("div",St,[e.createElementVNode("span",null,"订单号 : "+e.toDisplayString(l.no),1),e.createElementVNode("span",null,"创建时间 : "+e.toDisplayString(l.createTime),1),e.createElementVNode("span",null,e.toDisplayString(Y[l.affiliationPlatform]),1)]),e.createVNode(be,{content:l.sellerRemark,onSeeRemark:ee=>d(l)},null,8,["content","onSeeRemark"])])]),default:e.withCtx(()=>[e.createVNode(G,{label:"商品",width:"390",align:"left"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",Tt,[e.createVNode(ne,{class:"customer-Infor__img",fit:"cover",style:{width:"68px",height:"68px","margin-right":"10px"},src:l.image},null,8,["src"]),e.createElementVNode("div",It,[e.createElementVNode("div",Rt,[l.productName.length>=30?(e.openBlock(),e.createBlock(re,{key:0,effect:"dark",content:l.productName,placement:"top-start"},{default:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(l.productName),1)]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("span",Dt,e.toDisplayString(l.productName),1))]),e.createElementVNode("div",Ot,[e.createElementVNode("div",Bt,[e.createElementVNode("span",null,e.toDisplayString(l.price),1),r[13]||(r[13]=e.createElementVNode("span",null,"积分",-1)),l.salePrice!=="0"?(e.openBlock(),e.createElementBlock("span",Gt,[r[11]||(r[11]=e.createTextVNode("+")),r[12]||(r[12]=e.createElementVNode("span",null,"￥",-1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(s)(l.salePrice)),1)])):e.createCommentVNode("",!0)])])])])]),_:1}),e.createVNode(G,{label:"客户信息",align:"left",width:"250"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",At,[e.createElementVNode("div",Lt,[e.createElementVNode("span",Ut,e.toDisplayString(l.integralOrderReceiverVO.name),1),e.createElementVNode("span",null,"("+e.toDisplayString(l.integralOrderReceiverVO.mobile)+")",1)]),e.createElementVNode("div",$t,[e.createVNode(fe,{address:l.integralOrderReceiverVO.areaCode},null,8,["address"]),e.createTextVNode(e.toDisplayString(l.integralOrderReceiverVO.address),1)])])]),_:1}),e.createVNode(G,{prop:"sex",label:"交易信息",align:"left",width:"230",class:"rate_size"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",Pt,[e.createElementVNode("div",Mt,[e.createElementVNode("div",null,[e.createTextVNode(e.toDisplayString(l.price)+"积分 ",1),l.salePrice!=="0"?(e.openBlock(),e.createElementBlock("span",qt,[r[14]||(r[14]=e.createTextVNode("+")),r[15]||(r[15]=e.createElementVNode("span",null,"￥",-1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(s)(l.salePrice)),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"(运费"+e.toDisplayString(l.freightPrice&&e.unref(s)(l.freightPrice).toFixed(2))+"元)",1)])])]),_:1}),e.createVNode(G,{label:"订单状态",width:"120",align:"left"},{default:e.withCtx(({row:l})=>[e.createVNode(v,{justify:"space-between",align:"middle"},{default:e.withCtx(()=>[e.createVNode(v,{justify:"space-between",align:"middle",style:{"flex-direction":"column"}},{default:e.withCtx(()=>[e.createElementVNode("div",zt,e.toDisplayString(e.unref(kt)[l.status]),1)]),_:2},1024)]),_:2},1024)]),_:1}),e.createVNode(G,{label:"操作",align:"right",fixed:"right",width:"110"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",Ft,[e.createVNode(J,{underline:!1,style:{"margin-left":"15px"},type:"primary",onClick:ee=>i(l.no)},{default:e.withCtx(()=>r[16]||(r[16]=[e.createTextVNode("查看详情")])),_:2},1032,["onClick"]),["UNPAID"].includes(l.status)?(e.openBlock(),e.createBlock(J,{key:0,underline:!1,style:{"margin-left":"15px"},type:"danger",onClick:ee=>C(l)},{default:e.withCtx(()=>r[17]||(r[17]=[e.createTextVNode(" 关闭订单 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),["PAID"].includes(l.status)?(e.openBlock(),e.createBlock(J,{key:1,underline:!1,style:{"margin-left":"15px"},type:"danger",onClick:ee=>m(l)},{default:e.withCtx(()=>r[18]||(r[18]=[e.createTextVNode(" 发货 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)])]),_:1})]),_:1},8,["checked-item","data","style"]),e.createVNode(ie,{"page-size":f.size,"page-num":f.current,total:f.total,onHandleSizeChange:g,onHandleCurrentChange:h},null,8,["page-size","page-num","total"]),e.createVNode(Ee,{isShow:y.value,"onUpdate:isShow":r[2]||(r[2]=l=>y.value=l),ids:p.value,"onUpdate:ids":r[3]||(r[3]=l=>p.value=l),remark:k.value,"onUpdate:remark":r[4]||(r[4]=l=>k.value=l),"remark-type":"INTEGRAL",onSuccess:c},null,8,["isShow","ids","remark"]),e.createVNode(Ct,{isShow:$.value,"onUpdate:isShow":r[5]||(r[5]=l=>$.value=l),"current-no":P.value,onUploadList:S},null,8,["isShow","current-no"])],64)}}}),gl="",Ht=Object.freeze(Object.defineProperty({__proto__:null,default:Z(jt,[["__scopeId","data-v-8701461e"]])},Symbol.toStringTag,{value:"Module"})),Yt={style:{padding:"16px",overflow:"auto"}},Wt={class:"use_rules p20"},Qt={key:0,style:{border:"1px solid #ccc"}},Xt={key:1},Jt={class:"use_rules p20"},Kt={key:1},Zt={class:"use_rules p20"},vt={key:0,style:{border:"1px solid #ccc"}},el={key:1},tl={class:"use_rules p20"},ll={class:"get_rules"},ol={class:"get_rules"},al={class:"get_rules"},nl={class:"save"},rl={key:0},sl={key:0},dl={key:1},il=e.defineComponent({__name:"IntegralRules",setup(N){const _=e.ref(!1),f=e.ref(!1),a=e.ref({indate:0,useRule:"<div>（1）积分使用过程中不找零、不兑现、不开发票，不可转移至其他账户。</div><div>（2）使用积分进行兑换，兑换申请一经提交, 一律不能退货</div><div>（3）如因积分商品缺货等原因导致的退货退款，积分会原路返还</div><div>（4）兑换礼品涉及运费和配送费由用户自行承担。</div><div>（5）启山智软保留最终解释权。</div>",ruleInfo:"<div>月度滚动过期制。 每个自然月的第1天00：00分自动清零 已满一年的积分。 举例：2022年8月1日开始清除2023年7月31日</div>",integralGainRule:[{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SHARE",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"LOGIN",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SING_IN",open:!1},{rulesParameter:{consumeJson:[{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]},gainRuleType:"CONSUME",open:!1}]}),s=e.ref({LOGIN:[{key:0,value:0},{key:0,value:0}],SING_IN:[{key:0,value:0},{key:0,value:0}],CONSUME:[{key:0,value:0},{key:0,value:0}]});k();const y=e.ref([{consumeGrowthValueType:"ORDER_QUANTITY",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"ORDER_AMOUNT",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]),p=e.ref("ORDER_QUANTITY");async function k(){var d;const{code:n,data:t,msg:m}=await De();if(n!==200){V.ElMessage.error(m||"积分规则获取失败");return}if(t&&t.useRule){$(t),a.value=t,y.value=t.integralGainRule[3].rulesParameter.consumeJson,((d=t.integralGainRule[3].rulesParameter.consumeJson[0])==null?void 0:d.isSelected)===!0?p.value="ORDER_QUANTITY":p.value="ORDER_AMOUNT";return}f.value=!0}const b=(n=!1)=>{_.value=!_.value,n&&k()},T=async()=>{if(!M())return;const n=P();if(n==="COMPLETE"){x();const{code:t,msg:m}=await(f.value?Oe(a.value):Be(a.value));if(t!==200){V.ElMessage.error(m||`${f.value?"保存":"修改"}积分规则失败`);return}V.ElMessage.success(`${f.value?"保存":"修改"}积分规则成功`),k(),A()}else V.ElMessage.info(`连续${n==="LOGIN"?"登录":"签到"}天数输入重复，请修改`)};function x(){a.value.integralGainRule.forEach(n=>{let t={};const m=s.value[n.gainRuleType];if(m){for(let d=0;d<m.length;d++){const g=m[d].key,h=m[d].value;t[g]=h}n.rulesParameter.extendValue=t}n.gainRuleType==="CONSUME"&&(n.open?y.value.forEach(d=>{d.isSelected=d.consumeGrowthValueType===p.value}):y.value.forEach(d=>{d.isSelected=!1}),n.rulesParameter.consumeJson=y.value)})}function $(n){n.integralGainRule.forEach(t=>{let m=[];if(s.value[t.gainRuleType]){for(const g in t.rulesParameter.extendValue)m.push({key:g,value:t.rulesParameter.extendValue[g]});s.value[t.gainRuleType]=m}})}function P(){const n=new Map;if(s.value.LOGIN.filter(d=>!n.has(d.key)&&n.set(d.key,d.value)).length!==s.value.LOGIN.length)return"LOGIN";n.clear();const m=s.value.SING_IN.filter(d=>!n.has(d.key)&&n.set(d.key,d.value)).length;return m!==s.value.SING_IN.length?(console.log("singInLen",m),"SING_IN"):"COMPLETE"}function M(){const{indate:n,useRule:t,ruleInfo:m,integralGainRule:d}=a.value;if(!n)return V.ElMessage.info("请输入积分有效期"),!1;if(!t.trim().length||t==="<p><br></p>")return V.ElMessage.info("请输入积分规则"),!1;if(!m.trim().length||m==="<p><br></p>")return V.ElMessage.info("请输入积分值信息"),!1;if(d.every(c=>!!c.rulesParameter.basicsValue))return V.ElMessage.info("请输入首次赠送积分值信息"),!1;const h=H();return console.log(h),h?(V.ElMessage.info(h),!1):!0}function H(){let n="";const t=s.value.LOGIN,m=s.value.SING_IN,d=s.value.SING_IN;if(t.forEach(g=>{if(!g.key)return n="请输入连续登录天数",n;if(!g.value)return n="请输入连续登录赠送积分值",n}),n||(m.forEach(g=>{if(!g.key)return n="请输入连续签到天数",n;if(!g.value)return n="请输入连续登签到赠送积分值",n}),n)||(d.forEach(g=>{if(!g.key)return n;if(!g.value)return n="请输入赠送的积分值",n}),n))return n}function A(){_.value=!1,f.value=!1}const S=n=>{console.log(n),n==="ORDER_QUANTITY"&&(y.value[0].isSelected=!0,y.value[1].isSelected=!1),n==="ORDER_AMOUNT"&&(y.value[1].isSelected=!0,y.value[0].isSelected=!1)};return(n,t)=>{var w,L,O,D,u,U,F,Y,W,o,r,I,q,Q,X,z,le,oe,ae,ne,re,v,J;const m=e.resolveComponent("el-button"),d=e.resolveComponent("el-input-number"),g=e.resolveComponent("el-checkbox"),h=e.resolveComponent("el-input"),c=e.resolveComponent("el-radio"),i=e.resolveComponent("el-form-item"),C=e.resolveComponent("el-radio-group"),E=e.resolveDirective("dompurify-html");return e.openBlock(),e.createElementBlock("div",Yt,[e.withDirectives(e.createVNode(m,{round:"",type:"primary",onClick:t[0]||(t[0]=l=>b(!1))},{default:e.withCtx(()=>t[21]||(t[21]=[e.createTextVNode("编辑积分规则")])),_:1},512),[[e.vShow,!_.value]]),t[54]||(t[54]=e.createElementVNode("div",{class:"title"},"积分使用规则",-1)),e.createElementVNode("div",Wt,[_.value?(e.openBlock(),e.createElementBlock("div",Qt,[e.createVNode(ge,{modelValue:a.value.useRule,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.useRule=l),height:200},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",Xt,null,512)),[[E,a.value.useRule]])]),t[55]||(t[55]=e.createElementVNode("div",{class:"title"},"积分有效期",-1)),e.createElementVNode("div",Jt,[e.createElementVNode("div",null,[t[22]||(t[22]=e.createTextVNode(" 积分有效期为 ")),_.value?(e.openBlock(),e.createBlock(d,{key:0,modelValue:a.value.indate,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.indate=l),controls:!1,min:1,max:12,style:{width:"50px"}},null,8,["modelValue"])):(e.openBlock(),e.createElementBlock("span",Kt,e.toDisplayString(a.value.indate),1)),t[23]||(t[23]=e.createTextVNode(" 个月 "))])]),t[56]||(t[56]=e.createElementVNode("div",{class:"title"},"积分值规则",-1)),e.createElementVNode("div",Zt,[_.value?(e.openBlock(),e.createElementBlock("div",vt,[e.createVNode(ge,{modelValue:a.value.ruleInfo,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.ruleInfo=l)},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",el,null,512)),[[E,a.value.ruleInfo]])]),t[57]||(t[57]=e.createElementVNode("div",{class:"title"},"积分获取规则",-1)),e.createElementVNode("div",tl,[_.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(g,{modelValue:a.value.integralGainRule[0].open,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.integralGainRule[0].open=l)},{default:e.withCtx(()=>t[24]||(t[24]=[e.createTextVNode("分享")])),_:1},8,["modelValue"]),t[50]||(t[50]=e.createElementVNode("span",{class:"use_rules__msg"},"（限制用户首次分享才可获得积分）",-1)),e.createElementVNode("div",ll,[t[25]||(t[25]=e.createTextVNode(" 每日首次分享获得 ")),e.createVNode(d,{modelValue:a.value.integralGainRule[0].rulesParameter.basicsValue,"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.integralGainRule[0].rulesParameter.basicsValue=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[26]||(t[26]=e.createTextVNode(" 点积分 "))]),e.createVNode(g,{modelValue:a.value.integralGainRule[1].open,"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.integralGainRule[1].open=l)},{default:e.withCtx(()=>t[27]||(t[27]=[e.createTextVNode("登录")])),_:1},8,["modelValue"]),t[51]||(t[51]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日首次登录获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",ol,[t[28]||(t[28]=e.createTextVNode(" 每日首次登录获得 ")),e.createVNode(d,{modelValue:a.value.integralGainRule[1].rulesParameter.basicsValue,"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.integralGainRule[1].rulesParameter.basicsValue=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[29]||(t[29]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(d,{modelValue:s.value.LOGIN[0].key,"onUpdate:modelValue":t[8]||(t[8]=l=>s.value.LOGIN[0].key=l),controls:!1,min:1,max:6,style:{width:"100px"}},null,8,["modelValue"]),t[30]||(t[30]=e.createTextVNode(" 天连续登录将额外获赠 ")),e.createVNode(d,{modelValue:s.value.LOGIN[0].value,"onUpdate:modelValue":t[9]||(t[9]=l=>s.value.LOGIN[0].value=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[31]||(t[31]=e.createTextVNode(" 点积分； 第 ")),e.createVNode(d,{modelValue:s.value.LOGIN[1].key,"onUpdate:modelValue":t[10]||(t[10]=l=>s.value.LOGIN[1].key=l),controls:!1,min:1,max:7,style:{width:"100px"}},null,8,["modelValue"]),t[32]||(t[32]=e.createTextVNode(" 天连续登录将额外获得 ")),e.createVNode(d,{modelValue:s.value.LOGIN[1].value,"onUpdate:modelValue":t[11]||(t[11]=l=>s.value.LOGIN[1].value=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[33]||(t[33]=e.createTextVNode(" 点积分。 "))]),e.createVNode(g,{modelValue:a.value.integralGainRule[2].open,"onUpdate:modelValue":t[12]||(t[12]=l=>a.value.integralGainRule[2].open=l),style:{"margin-right":"30px"}},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("签到")])),_:1},8,["modelValue"]),t[52]||(t[52]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日签到获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",al,[t[35]||(t[35]=e.createTextVNode(" 每日首次签到获得 ")),e.createVNode(d,{modelValue:a.value.integralGainRule[2].rulesParameter.basicsValue,"onUpdate:modelValue":t[13]||(t[13]=l=>a.value.integralGainRule[2].rulesParameter.basicsValue=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[36]||(t[36]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(d,{modelValue:s.value.SING_IN[0].key,"onUpdate:modelValue":t[14]||(t[14]=l=>s.value.SING_IN[0].key=l),max:6,controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[37]||(t[37]=e.createTextVNode(" 天连续签到将额外获赠 ")),e.createVNode(d,{modelValue:s.value.SING_IN[0].value,"onUpdate:modelValue":t[15]||(t[15]=l=>s.value.SING_IN[0].value=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[38]||(t[38]=e.createTextVNode("点积分； 第 ")),e.createVNode(d,{modelValue:s.value.SING_IN[1].key,"onUpdate:modelValue":t[16]||(t[16]=l=>s.value.SING_IN[1].key=l),controls:!1,min:1,style:{width:"100px"},max:7},null,8,["modelValue"]),t[39]||(t[39]=e.createTextVNode(" 天连续签到将额外获得 ")),e.createVNode(d,{modelValue:s.value.SING_IN[1].value,"onUpdate:modelValue":t[17]||(t[17]=l=>s.value.SING_IN[1].value=l),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[40]||(t[40]=e.createTextVNode(" 点积分。 "))]),e.createVNode(g,{modelValue:a.value.integralGainRule[3].open,"onUpdate:modelValue":t[18]||(t[18]=l=>a.value.integralGainRule[3].open=l),style:{"margin-right":"30px"}},{default:e.withCtx(()=>t[41]||(t[41]=[e.createTextVNode("消费获得")])),_:1},8,["modelValue"]),t[53]||(t[53]=e.createElementVNode("span",{class:"use_rules__msg"},"（成功交易笔数及实付金额只统计订单状态为【已完成】的数值，且将【已结算订单、积分订单、储值充值】剔除）",-1)),e.createVNode(C,{modelValue:p.value,"onUpdate:modelValue":t[19]||(t[19]=l=>p.value=l),class:"ml-4",style:{"margin-top":"5px",display:"flex","flex-direction":"column","align-items":"start","margin-left":"20px"},onChange:S},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,(l,ee)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:ee},[l.consumeGrowthValueType==="ORDER_QUANTITY"?(e.openBlock(),e.createBlock(i,{key:0},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:l.isSelected,"onUpdate:modelValue":B=>l.isSelected=B,label:"ORDER_QUANTITY"},{default:e.withCtx(()=>[t[42]||(t[42]=e.createTextVNode(" 每成功交易(已完成) ")),e.createVNode(h,{modelValue:l.orderQuantityAndAmount,"onUpdate:modelValue":B=>l.orderQuantityAndAmount=B,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[43]||(t[43]=e.createTextVNode(" 笔订单，奖励 ")),e.createVNode(h,{modelValue:l.presentedGrowthValue,"onUpdate:modelValue":B=>l.presentedGrowthValue=B,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[44]||(t[44]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):l.consumeGrowthValueType==="ORDER_AMOUNT"?(e.openBlock(),e.createBlock(i,{key:1},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:l.isSelected,"onUpdate:modelValue":B=>l.isSelected=B,label:"ORDER_AMOUNT"},{default:e.withCtx(()=>[t[45]||(t[45]=e.createTextVNode(" 实付金额(不含运费)，每满 ")),e.createVNode(h,{modelValue:l.orderQuantityAndAmount,"onUpdate:modelValue":B=>l.orderQuantityAndAmount=B,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[46]||(t[46]=e.createTextVNode(" 元，奖励 ")),e.createVNode(h,{modelValue:l.presentedGrowthValue,"onUpdate:modelValue":B=>l.presentedGrowthValue=B,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[47]||(t[47]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):e.createCommentVNode("",!0)],64))),128))]),_:1},8,["modelValue"]),e.createElementVNode("div",nl,[e.createVNode(m,{round:"",onClick:t[20]||(t[20]=l=>b(!0))},{default:e.withCtx(()=>t[48]||(t[48]=[e.createTextVNode("返回")])),_:1}),e.createVNode(m,{round:"",type:"primary",onClick:T},{default:e.withCtx(()=>t[49]||(t[49]=[e.createTextVNode("保存")])),_:1})])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(w=a.value.integralGainRule)!=null&&w[0].open?(e.openBlock(),e.createElementBlock("div",rl," 每日首次分享获得 "+e.toDisplayString(a.value.integralGainRule[0].rulesParameter.basicsValue)+" 点积分 ",1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",null," 每日首次登录获得 "+e.toDisplayString((L=a.value.integralGainRule)==null?void 0:L[1].rulesParameter.basicsValue)+" 点积分, 第 "+e.toDisplayString((O=s.value.LOGIN)==null?void 0:O[0].key)+" 天连续登录将额外获赠 "+e.toDisplayString((D=s.value.LOGIN)==null?void 0:D[0].value)+" 点积分； 第 "+e.toDisplayString((u=s.value.LOGIN)==null?void 0:u[1].key)+" 天连续登录将额外获得 "+e.toDisplayString((U=s.value.LOGIN)==null?void 0:U[1].value)+" 点积分。 ",513),[[e.vShow,(F=a.value.integralGainRule)==null?void 0:F[1].open]]),e.withDirectives(e.createElementVNode("div",null," 每日首次签到获得 "+e.toDisplayString((Y=a.value.integralGainRule)==null?void 0:Y[2].rulesParameter.basicsValue)+" 点积分, 第 "+e.toDisplayString((W=s.value.SING_IN)==null?void 0:W[0].key)+" 天连续签到将额外获赠 "+e.toDisplayString((o=s.value.SING_IN)==null?void 0:o[0].value)+" 点积分； 第 "+e.toDisplayString((r=s.value.SING_IN)==null?void 0:r[1].key)+" 天连续签到将额外获得 "+e.toDisplayString((I=s.value.SING_IN)==null?void 0:I[1].value)+" 点积分。 ",513),[[e.vShow,(q=a.value.integralGainRule)==null?void 0:q[2].open]]),e.withDirectives(e.createElementVNode("div",null,[(Q=y.value)!=null&&Q[0].isSelected?(e.openBlock(),e.createElementBlock("p",sl," 每成功交易（已完成），"+e.toDisplayString((X=y.value)==null?void 0:X[0].orderQuantityAndAmount)+" 笔订单，奖励 "+e.toDisplayString((z=y.value)==null?void 0:z[0].presentedGrowthValue)+" 点积分 ",1)):(oe=(le=y.value)==null?void 0:le[1])!=null&&oe.isSelected?(e.openBlock(),e.createElementBlock("p",dl," 实付金额（不含运费），每满 "+e.toDisplayString((ne=(ae=y.value)==null?void 0:ae[1])==null?void 0:ne.orderQuantityAndAmount)+" 元，奖励 "+e.toDisplayString((v=(re=y.value)==null?void 0:re[1])==null?void 0:v.presentedGrowthValue)+" 点积分 ",1)):e.createCommentVNode("",!0)],512),[[e.vShow,(J=a.value.integralGainRule)==null?void 0:J[3].open]])],64))])])}}}),yl="",cl=Object.freeze(Object.defineProperty({__proto__:null,default:Z(il,[["__scopeId","data-v-b6a74361"]])},Symbol.toStringTag,{value:"Module"}));return Se});
