(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("@vueuse/core"),require("@element-plus/icons-vue"),require("vue-router"),require("@/components/PageManage.vue"),require("element-plus"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@element-plus/icons-vue","vue-router","@/components/PageManage.vue","element-plus","@/apis/http"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformSetMeal=h(e.PlatformSetMealContext.Vue,e.PlatformSetMealContext.VueUse,e.PlatformSetMealContext.ElementPlusIconsVue,e.PlatformSetMealContext.VueRouter,e.PlatformSetMealContext.PageManageTwo,e.PlatformSetMealContext.ElementPlus,e.PlatformSetMealContext.Request))})(this,function(e,h,B,L,z,_,M){"use strict";var k=document.createElement("style");k.textContent=`.origin[data-v-c20339f4]{display:flex;justify-content:start;align-items:center}.origin--name[data-v-c20339f4]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}
`,document.head.appendChild(k);var w=(o=>(o.NOT_STARTED="未开始",o.PROCESSING="进行中",o.OVER="已结束",o.ILLEGAL_SELL_OFF="违规下架",o))(w||{});const D={style:{"margin-bottom":"15px",display:"flex","justify-content":"space-between"}},P=e.defineComponent({__name:"head-operation-p",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0}},emits:["update:modelValue","del","search"],setup(o,{emit:r}){const a=o,s=h.useVModel(a,"modelValue",r),f=()=>{s.value.forceUpdate=!s.value.forceUpdate,r("search")};return(x,t)=>{const i=e.resolveComponent("el-button"),c=e.resolveComponent("el-space"),C=e.resolveComponent("el-option"),b=e.resolveComponent("el-select"),N=e.resolveComponent("el-input");return e.openBlock(),e.createElementBlock("div",D,[e.createElementVNode("div",null,[e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(i,{round:"",disabled:x.$props.batchDisabled,onClick:t[0]||(t[0]=m=>r("del"))},{default:e.withCtx(()=>[e.createTextVNode("批量删除")]),_:1},8,["disabled"])]),_:1})]),e.createElementVNode("div",null,[e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(b,{modelValue:e.unref(s).setMealStatus,"onUpdate:modelValue":t[1]||(t[1]=m=>e.unref(s).setMealStatus=m),placeholder:"",style:{width:"200px"},onChange:t[2]||(t[2]=m=>r("search"))},{default:e.withCtx(()=>[e.createVNode(C,{label:"全部",value:""}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(w),(m,g)=>(e.openBlock(),e.createBlock(C,{key:g,label:m,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(N,{modelValue:e.unref(s).keyword,"onUpdate:modelValue":t[3]||(t[3]=m=>e.unref(s).keyword=m),placeholder:"活动名称"},{append:e.withCtx(()=>[e.createVNode(i,{icon:e.unref(B.Search),onClick:f},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})])])}}}),S="addon-matching-treasure/setMeal/",I=o=>M.get({url:S,params:o}),E=o=>M.del({url:S,data:o}),O={class:"origin"},R={class:"origin--name",style:{width:"180px","margin-left":"10px"}},j=e.defineComponent({__name:"set-meal-list",props:{search:{type:Object,default:()=>({})}},setup(o,{expose:r}){const a=o,s=L.useRouter(),f=e.ref([]),x=e.ref(),t=e.reactive({size:10,current:1,total:0}),i=e.ref([]);e.watch(()=>a.search,n=>{c()},{deep:!0});async function c(){const{setMealStatus:n,keyword:d}=a.search,V={...t,...{setMealStatus:n,keyword:d}},{code:y,data:u}=await I(V);if(y!==200)return _.ElMessage.error("获取套餐列表失败");f.value=u.records,t.current=u.current,t.size=u.size,t.total=u.total}const C=n=>{s.push({name:"bundlePriceBaseinfo",query:{setMealId:n.id,shopId:n.shopId}})},b=async(n,d)=>{try{if(!await _.ElMessageBox.confirm("确定删除该套餐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{code:V}=await E([{setMealId:n,shopId:d}]);if(V!==200){_.ElMessage.error("删除失败");return}_.ElMessage.success("删除成功"),c()}catch{return}},N=async n=>{const{code:d}=await E(n);if(d!==200){_.ElMessage.error("删除失败");return}_.ElMessage.success("删除成功"),c()},m=n=>{t.size=n,c()},g=n=>{t.current=n,c()};return e.onBeforeMount(()=>{c()}),r({chooseList:i,handleDelBatch:N}),(n,d)=>{const p=e.resolveComponent("el-table-column"),V=e.resolveComponent("el-image"),y=e.resolveComponent("el-button"),u=e.resolveComponent("el-col"),T=e.resolveComponent("el-row"),U=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(U,{ref_key:"multipleTableRef",ref:x,data:f.value,stripe:"",style:e.normalizeStyle({height:"calc(100vh - 280px)"}),"header-row-style":{fontSize:"12px",color:"#909399"},"header-cell-style":{background:"#f6f8fa"},"cell-style":{fontSize:"12px",color:"#333333"},onSelectionChange:d[0]||(d[0]=l=>i.value=l)},{default:e.withCtx(()=>[e.createVNode(p,{type:"selection",width:"55"}),e.createVNode(p,{label:"套餐信息",width:"250px"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",O,[e.createVNode(V,{style:{width:"40px",height:"40px"},src:l.setMealMainPicture},null,8,["src"]),e.createElementVNode("div",R,e.toDisplayString(l.setMealName),1)])]),_:1}),e.createVNode(p,{label:"套餐类型"},{default:e.withCtx(({row:l})=>[e.createTextVNode(e.toDisplayString(l.setMealType==="OPTIONAL_PRODUCT"?"自由搭配":"固定搭配"),1)]),_:1}),e.createVNode(p,{label:"开始时间",width:"180px",align:"center",prop:"startTime"}),e.createVNode(p,{label:"结束时间",width:"180px",align:"center",prop:"endTime"}),e.createVNode(p,{label:"状态",fixed:"right",align:"center"},{default:e.withCtx(({row:l})=>[e.createElementVNode("span",null,e.toDisplayString(e.unref(w)[l.setMealStatus]),1)]),_:1}),e.createVNode(p,{label:"操作",fixed:"right",align:"center"},{default:e.withCtx(({row:l})=>[e.createVNode(T,{justify:"space-between",align:"middle"},{default:e.withCtx(()=>[e.createVNode(u,{span:10},{default:e.withCtx(()=>[e.createVNode(y,{link:"",type:"primary",size:"small",onClick:$=>C(l)},{default:e.withCtx(()=>[e.createTextVNode("查看")]),_:2},1032,["onClick"])]),_:2},1024),e.createVNode(u,{span:10},{default:e.withCtx(()=>[e.createVNode(y,{link:"",type:"primary",size:"small",onClick:$=>b(l.id,l.shopId)},{default:e.withCtx(()=>[e.createTextVNode("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data","style"]),e.createVNode(T,{justify:"end",align:"middle"},{default:e.withCtx(()=>[e.createVNode(z,{modelValue:t,"onUpdate:modelValue":d[1]||(d[1]=l=>t=l),"load-init":!0,"page-size":t.size,total:t.total,onReload:c,onHandleSizeChange:m,onHandleCurrentChange:g},null,8,["modelValue","page-size","total"])]),_:1})],64)}}}),F="",q=((o,r)=>{const a=o.__vccOpts||o;for(const[s,f]of r)a[s]=f;return a})(j,[["__scopeId","data-v-c20339f4"]]);return e.defineComponent({__name:"PlatformSetMeal",setup(o){const r=e.reactive({setMealStatus:"",keyword:""}),a=e.ref(),s=e.computed(()=>a.value?!a.value.chooseList.length:!0),f=async()=>{if(!await _.ElMessageBox.confirm("确定批量删除套餐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const t=a.value.chooseList.map(i=>({shopId:i.shopId,setMealId:i.id}));a.value.handleDelBatch(t)};return(x,t)=>(e.openBlock(),e.createElementBlock("div",null,[e.createVNode(P,{modelValue:r,"onUpdate:modelValue":t[0]||(t[0]=i=>r=i),"batch-disabled":s.value,onDel:f},null,8,["modelValue","batch-disabled"]),e.createVNode(q,{ref_key:"mealListRef",ref:a,search:r},null,8,["search"])]))}})});
