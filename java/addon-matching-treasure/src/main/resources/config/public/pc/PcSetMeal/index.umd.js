(function(e,M){typeof exports=="object"&&typeof module<"u"?module.exports=M(require("vue"),require("@/apis/http"),require("@/composables/useConvert"),require("vue-router"),require("element-plus"),require("decimal.js"),require("lodash-es"),require("@/libs/storage")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","@/composables/useConvert","vue-router","element-plus","decimal.js","lodash-es","@/libs/storage"],M):(e=typeof globalThis<"u"?globalThis:e||self,e.PcSetMeal=M(e.PcSetMealContext.Vue,e.PcSetMealContext.Request,e.PcSetMealContext.UseConvert,e.PcSetMealContext.VueRouter,e.PcSetMealContext.ElementPlus,e.PcSetMealContext.Decimal,e.PcSetMealContext.Lodash,e.PcSetMealContext.storage))})(this,function(e,M,G,ue,R,pe,fe,Ie){"use strict";var wt=Object.defineProperty;var Pt=(e,M,G)=>M in e?wt(e,M,{enumerable:!0,configurable:!0,writable:!0,value:G}):e[M]=G;var H=(e,M,G)=>(Pt(e,typeof M!="symbol"?M+"":M,G),G);var he=document.createElement("style");he.textContent=`@charset "UTF-8";.active[data-v-96cb10c2]{border:2px solid red}.disable[data-v-96cb10c2]{color:#ccc;border:none;background:#f6f6f6}.title[data-v-96cb10c2]{padding:0 8px;white-space:nowrap;display:inline-block;margin-top:15px}.confirmBtn[data-v-96cb10c2]{padding-top:25px;width:100%;text-align:right}.el-button[data-v-96cb10c2]{background-color:#555cfd;color:#fff}.box[data-v-96cb10c2]{padding:20px}img[data-v-dde277bd]{width:100%;height:100%}.colorRed[data-v-dde277bd]{color:#fa3534}.textFw[data-v-dde277bd]{font-weight:700}.boxBorder[data-v-dde277bd]{border:2px solid #fa3534!important}.con[data-v-dde277bd]{width:1190px;margin:0 auto}.title[data-v-dde277bd]{width:200px;height:50px;line-height:50px;text-align:center;background-color:#fa3534;font-size:16px;color:#fff;margin-bottom:10px}.content[data-v-dde277bd]{position:relative;display:flex;padding:10px 10px 0}.content__box[data-v-dde277bd]{position:relative;width:130px;height:220px;border-radius:4px;text-align:left;background-color:#f9f9f9;border:2px solid transparent}.content__box--img[data-v-dde277bd]{width:126px;height:126px;overflow:hidden;border-radius:4px}.content__box--tilText[data-v-dde277bd]{width:120px;height:40px;padding:8px 5px;margin-bottom:3px;word-break:break-all;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.content__box--price[data-v-dde277bd]{padding:0 6px;font-size:16px}.content__box--select[data-v-dde277bd]{position:relative;height:20px;cursor:pointer}.content__box--sel[data-v-dde277bd]{height:20px;margin:3px 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.content__box--specification[data-v-dde277bd]{position:absolute;top:35px;left:0;max-width:550px;background-color:#fff;z-index:99;box-shadow:2px 2px 5px 1px #999}.content__box--til[data-v-dde277bd]{margin:10px}.content__box--body[data-v-dde277bd]{padding:2px 6px;margin:5px;display:inline-block;border:2px solid transparent;background-color:#e6e6e6;cursor:pointer}.content__plusSign[data-v-dde277bd]{width:40px;height:40px;margin:80px 40px 0}.content__rightBox[data-v-dde277bd]{position:absolute;right:0;display:flex;justify-content:center;flex-direction:column;width:220px;height:218px;font-size:20px}.content__rightBox--price[data-v-dde277bd]{margin:10px 0}.content__rightBox--btn[data-v-dde277bd]{width:180px;height:45px;line-height:45px;color:#fff;background-color:#e31436;margin:10px auto;cursor:pointer}.content__rightBox--over[data-v-dde277bd]{margin-right:20px;text-align:right;font-size:12px;color:#999}.contentBox[data-v-dde277bd]{border:1px solid #ccc;margin-bottom:15px}.confirmBtn[data-v-dde277bd]{width:100%;text-align:right;padding:10px 30px 30px 0}.el-button[data-v-dde277bd]{background-color:#555cfd;color:#fff}
`,document.head.appendChild(he);const Me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAD1BMVEVHcEyXl5eZmZmbm5uZmZlUvXOTAAAABHRSTlMAQIG/uk/sTQAAAI9JREFUeAHtlVEKBSEIRVPb/5qfvZ8b1aQODBh0/2boZAl2SvqQmWG9VE8YBFdnwOiHsJl2EkIRdl1XdwZCrhYB0Yq+rmLhWYgIBRFaddFE+CJZEAy6DoRMU79CngaY4sjuLv3BeHqPjmryRd4jhWX+l+K1/AKJKqkT2ja9IP+yDem1lYlK3Gn+0ThkpmTPDyGFCHHqqr+4AAAAAElFTkSuQmCC",me="addon-matching-treasure/consumer/",Ee=(I,b)=>M.get({url:me+`setMealBasicInfo/${I}/${b}`}),Ce=(I,b)=>M.get({url:me+`setMealDetail/${I}/${b}`}),Ne=(I,b)=>M.get({url:`gruul-mall-storage/storage/shop/${I}/product/${b}`}),Ve=(I,b)=>M.get({url:`gruul-mall-goods/api/product/get/${I}`,headers:{"Shop-Id":b}}),Ae=I=>M.get({url:`gruul-mall-shop/shop/info/base/${I}`}),De=I=>M.post({url:"gruul-mall-goods/api/product/productDelivery",data:I});class we{constructor(b){H(this,"vertex",[]);H(this,"quantity",0);H(this,"vertexRange",[]);this.vertex=b,this.quantity=b.length,this.init()}init(){this.vertexRange=Array.from({length:this.quantity*this.quantity})}setVertexRange(b,d){const f=this.vertex.indexOf(b);d.forEach(i=>{const k=this.vertex.indexOf(i);this.vertexRange[f*this.quantity+k]=1})}getVertexColumn(b){const d=this.vertex.indexOf(b),f=[];return this.vertex.forEach((i,k)=>{f.push(this.vertexRange[d+this.quantity*k])}),f}getColumnTotal(b){const d=b.map(i=>this.getVertexColumn(i)),f=[];return this.vertex.forEach((i,k)=>{const q=d.map(S=>S[k]).reduce((S,$)=>(S+=$||0,S),0);f.push(q)}),f}getIntersection(b){return this.getColumnTotal(b).map((f,i)=>f>=b.length&&this.vertex[i]).filter(Boolean)}getUnion(b){return this.getColumnTotal(b).map((f,i)=>f&&this.vertex[i]).filter(Boolean)}}class ge extends we{constructor(d,f){super(d.reduce((i,k)=>[...i,...k.list],[]));H(this,"commoditySpecs",[]);H(this,"normGroup",[]);this.commoditySpecs=d,this.normGroup=f,this.initMatrix(),this.initSimilarVertex()}initMatrix(){this.normGroup.forEach(d=>{this.applyCommodity(d.specs)})}initSimilarVertex(){const d=this.getUnion(this.vertex);this.commoditySpecs.forEach(f=>{const i=[];f.list.forEach(k=>{d.indexOf(k)>-1&&i.push(k)}),this.applyCommodity(i)})}querySpecsOptions(d){return d!=null&&d.some(Boolean)?d=this.getIntersection(d.filter(Boolean)):d=this.getUnion(this.vertex),d}applyCommodity(d){d.forEach(f=>{this.setVertexRange(f,d)})}}const Pe={class:"box"},Te={flex:"","c-mt-13":""},Oe={"e-tj":"","c-mr-23":"","c-mt-11":"",class:"title"},Ge={flex:"","items-center":"","flex-wrap":"","c-w-630":""},Re=["onClick"],qe={"e-c-3":"","c-lh-42":"",style:{"min-width":"30px","text-align":"center"}},$e={flex:"","c-mt-13":""},Fe={"e-tj":"","c-mr-23":"","c-mt-11":"",class:"title"},je={flex:"","items-center":"","flex-wrap":"","c-w-630":""},Le=["onClick"],Ue={"e-c-3":"","c-lh-42":"",style:{"min-width":"30px","text-align":"center"}},Xe=e.defineComponent({__name:"good-spec",props:{skuGroup:{type:Object,default(){return{}}},currentChoose:{type:Array,default(){return[]}},imgBoolean:{type:Boolean,default:!0},disableSpec:{type:Array,default(){return[]}},params:{type:Object,default(){return{}}}},emits:["chooseSpec","closeGoodSoec"],setup(I,{expose:b,emit:d}){var L;const{divTenThousand:f}=G(),i=I,k=e.shallowReactive({commoditySpecs:[],optionSpec:[],chooseSpec:[],normClass:new ge([],[])});let q;const S=e.ref({}),$=e.ref((L=i.params.productAttributes)==null?void 0:L.map(_=>({..._,featureValues:S.value[_.id]||[]}))),p=d,Z=()=>{var r;const _=i.params.productAttributes,x=((r=i.skuGroup.specGroups)==null?void 0:r.length)===0?$.value:k.chooseSpec.length;_&&x?(_.forEach(u=>{var v;const h=(v=i.currentSpecs)==null?void 0:v.find(C=>C.id===u.id);h?S.value[u.id]=[...h.featureValues]:S.value[u.id]=[]}),$.value=_.map(u=>({...u,featureValues:S.value[u.id]})),q=Y(),p("chooseSpec",q,!1)):setTimeout(()=>{Z()},500)};e.onMounted(()=>{Z()}),e.watch(i.skuGroup,_=>{if(_){const x=JSON.parse(JSON.stringify(_));let r=[],u=[];i.skuGroup.specGroups&&i.skuGroup.specGroups.length>0&&(r=y(x.specGroups),u=D(x.skus,i.disableSpec)),k.commoditySpecs=r;const h=new ge(r,u);k.commoditySpecs=r,k.normClass=h,!i.currentChoose.length&&x.skus.length>0?k.chooseSpec=x.skus[0].specs:i.currentChoose.length&&x.skus.length>0?k.chooseSpec=JSON.parse(JSON.stringify(i.currentChoose)):k.chooseSpec=Array.from({length:r.length}),k.optionSpec=h.querySpecsOptions(k.chooseSpec)}},{immediate:!0});const oe=fe.debounce((_,x,r)=>{const{commoditySpecs:u,chooseSpec:h,normClass:v,optionSpec:C}=e.toRefs(k);h.value[r]===x||!_||(h.value[r]=h.value[r]===x?"":x,h.value=h.value.slice(),C.value=v.value.querySpecsOptions(h.value.slice()),h.value.filter(Boolean).length===u.value.length&&p("chooseSpec",Y()))},300,{leading:!0,trailing:!1});function Y(){var v;const _=e.toRaw(i.skuGroup.skus),x=((v=i.skuGroup.specGroups)==null?void 0:v.length)===0?_:_.filter(C=>Q(C.specs,k.chooseSpec)),r=fe.cloneDeep(x);let u=0,h;for(h in S.value)u+=S.value[h].reduce((C,P)=>C+Number(P.secondValue),0);return r[0]&&(r[0].salePrice=String((+r[0].salePrice||0)+u)),r}function Q(_,x){if(_.length!==x.length)return!1;for(let r=0;r<_.length;r++)if(_[r]!==x[r])return!1;return!0}function y(_){return _?_.map(x=>({title:x.name,list:x.children.map(r=>r.name)})):[]}function D(_,x){const r=[];return _.forEach(u=>{var v;x.includes((v=u.specs)==null?void 0:v.join(","))||r.push({id:u.id,specs:u.specs})}),r}const w=(_,x,r,u)=>{_?u?S.value[r]=[...S.value[r],x]:S.value[r]=[x]:S.value[r]=S.value[r].filter(v=>v.featureValueId!==x.featureValueId);let h=new pe(0);for(const v in S.value)h=S.value[v].reduce((C,P)=>C.add(f(P.secondValue).toNumber()),h);$.value=i.params.productAttributes?i.params.productAttributes.map(v=>({...v,featureValues:S.value[v.id]})):[],p("chooseSpec",Y(),!1)};return b({productAttributes:$}),(_,x)=>(e.openBlock(),e.createElementBlock("div",Pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(k).commoditySpecs,(r,u)=>(e.openBlock(),e.createElementBlock("div",{key:u,class:"norm"},[e.createElementVNode("div",Te,[e.createElementVNode("div",Oe,e.toDisplayString(r.title),1),e.createElementVNode("div",Ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.list,(h,v)=>(e.openBlock(),e.createElementBlock("div",{key:v,"c-lh-34":"","b-2":"","c-bc-e0e0e0":"","c-mr-7":"","c-mt-5":"","e-c-3":"","c-pl-15":"","c-pr-15":"",class:e.normalizeClass({active:e.unref(k).chooseSpec.indexOf(h)!==-1,disable:e.unref(k).optionSpec.indexOf(h)===-1}),onClick:C=>e.unref(oe)(e.unref(k).optionSpec.indexOf(h)>-1,h,u)},[e.createElementVNode("div",qe,e.toDisplayString(h),1)],10,Re))),128))])])]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.params.productAttributes,r=>(e.openBlock(),e.createElementBlock("div",{key:r.id,class:"norm"},[e.createElementVNode("div",$e,[e.createElementVNode("div",Fe,e.toDisplayString(r.featureName)+"("+e.toDisplayString(r.isRequired?"必选":"非必选")+")("+e.toDisplayString(r.isMultiSelect?"多选":"单选")+") ",1),e.createElementVNode("div",je,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.featureValues,u=>{var h;return e.openBlock(),e.createElementBlock("div",{key:u.featureValueId,class:e.normalizeClass({active:((h=S.value[r.id])==null?void 0:h.find(v=>v.featureValueId===u.featureValueId))!==void 0}),"c-lh-34":"","b-2":"","c-bc-e0e0e0":"","c-mr-7":"","c-mt-5":"","e-c-3":"","c-pl-15":"","c-pr-15":"",onClick:v=>{var C;return w(((C=S.value[r.id])==null?void 0:C.find(P=>P.featureValueId===u.featureValueId))===void 0,u,r.id,r.isMultiSelect)}},[e.createElementVNode("div",Ue,e.toDisplayString(`${u.firstValue}${u.secondValue&&new(e.unref(pe))(u.secondValue).lte(0)?"":"+"}${e.unref(f)(u.secondValue)}`)+"元 ",1)],10,Le)}),128))])])]))),128))]))}}),Tt="",ke=(I,b)=>{const d=I.__vccOpts||I;for(const[f,i]of b)d[f]=i;return d},_e=ke(Xe,[["__scopeId","data-v-96cb10c2"]]),He={key:0,class:"con"},Ke={class:"contentBox"},ze={key:0,class:"content__box boxBorder"},Je={class:"content__box--img"},Ze=["src"],Ye={class:"content__box--tilText"},Qe={class:"content__box--price colorRed textFw"},We={key:0,class:"content__box--select"},et=["onClick"],tt={key:0,class:"content__box--specification"},ot={style:{display:"flex",width:"720px","flex-wrap":"wrap"}},st=["onClick"],rt=["src"],lt=["onClick"],ct=["onClick"],at={key:0,class:"content__box--select"},nt=["onClick"],it={key:0,class:"content__box--specification"},dt={class:"confirmBtn"},ut={class:"content__rightBox"},pt={class:"colorRed"},ft={class:"content__rightBox--price"},ht={class:"colorRed"},mt={class:"colorRed textFw"},gt=["onClick"],kt={class:"content__rightBox--over"},_t=e.defineComponent({__name:"PcSetMeal",props:{properties:{type:Object,default:()=>{}}},setup(I){const b=ue.useRouter(),{divTenThousand:d}=G(),f=ue.useRoute(),i=e.ref(!1),k=e.ref([]),q=e.ref([]),S=e.ref(""),$=async()=>{var a,n;const{code:s,data:t}=await Ee(f.query.shopId,f.query.productId);S.value=(a=t==null?void 0:t[0])==null?void 0:a.setMealId,s===200&&(k.value=t);for(let m=0;m<t.length;m++)q.value.push((n=k.value[m])==null?void 0:n.setMealId);if(k.value.length!==y.value.length)for(let m=0;m<k.value.length-1;m++)y.value.push([{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!0,skuId:"",price:0,name:""}])},p=e.ref([]),Z=e.ref(""),oe=e.ref("EXPRESS");(async()=>{var s;await $();for(let t=0;t<q.value.length;t++){const{code:a,data:n}=await Ce(f.query.shopId,q.value[t]);if(a!==200)return;oe.value=n==null?void 0:n.distributionMode,p.value.push(n),Z.value=n==null?void 0:n.setMealType;const m={};n.setMealProductDetails.forEach(o=>{var B;if(o.setMealProductSkuDetails.length===1){const g=o.setMealProductSkuDetails[0],N={...g.storageSku,salePrice:g.matchingPrice,stock:g.matchingStock,id:g.skuId,specs:g.skuName,stockType:g.stockType,saveAtLeast:g.saveAtLeast,productName:o.productName,productAttributes:o.productAttributes};(o.productAttributes==="MAIN_PRODUCT"||((B=p.value[0])==null?void 0:B.setMealType)==="FIXED_COMBINATION")&&ve(o.productId,N),m[o.productId]=N}}),ye(m);for(let o=0;o<p.value.length;o++){let B=y.value[o];for(let g=0;g<p.value[o].setMealProductDetails.length;g++){let N=p.value[o].setMealProductDetails[g].setMealProductSkuDetails;if(N.length===1&&(p.value[o].setMealProductDetails[g].productAttributes==="MAIN_PRODUCT"?(B[4].price=+N[0].matchingPrice,B[4].skuId=N[0].skuId,B[4].name=p.value[o].setMealProductDetails[g].productName):(B[g].skuId=N[0].skuId,B[g].price=+((s=N[0])==null?void 0:s.matchingPrice),B[g].name=p.value[o].setMealProductDetails[g].productName)),p.value[o].setMealType==="FIXED_COMBINATION")for(let c=0;c<B.length;c++)B[c].checkBox=!0}}}})();const Q=async s=>{const{data:t,code:a}=await Ne(f.query.shopId,s);return a!==200?[]:t},y=e.ref([[{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!1,skuId:"",price:0,name:""},{checkBox:!0,skuId:"",price:0,name:""}]]),D=e.ref(4),w=e.ref(0),L=async(s,t,a,n)=>{a!=="FIXED_COMBINATION"&&(y.value[n][t].checkBox===!1?y.value[n][t].price===0?R.ElMessage.error("请先选规格再选商品"):(y.value[n][t].checkBox=!0,K.value=K.value+1,y.value[n][t].name=s.productName):y.value[n][t].checkBox&&(y.value[n][t].checkBox=!1,K.value=K.value-1))},_=e.ref(),x=e.ref(),r=e.ref(0),u=e.ref(0);let h=e.ref(0);const v=e.ref(0),C=async(s,t,a)=>{v.value=t,w.value=t,D.value=4,y.value[w.value][D.value].name=s.productName,i.value=!i.value,i.value&&h.value===0&&(h.value++,_.value=await Q(s==null?void 0:s.productId),r.value=Date.now())},P=e.ref(!1),se=e.ref("");let re;const xe=e.ref(),xt=async(s,t,a,n)=>{const{productId:m,productName:l,productAttributes:o,setMealProductSkuDetails:B}=t,g=[];re=m,B.forEach(E=>{E.matchingStock!=="0"&&(g[g.length]={...E.storageSku,salePrice:E.matchingPrice,stock:E.matchingStock,id:E.skuId,specs:E.skuName,stockType:E.stockType,productName:l,productAttributes:o})}),D.value=s,w.value=a,i.value=!1,P.value=!P.value,se.value=m;const N=await Ve(m,f.query.shopId);xe.value=N.data.extra;const c=await Q(t==null?void 0:t.productId),{specGroups:V}=c;x.value={specGroups:V,skus:g},F.value=g[0],y.value[w.value][D.value].name=t.productName,y.value[w.value][D.value].specs=g[0].specs.join(","),u.value=Date.now()},K=e.ref(1),U=e.ref([]),F=e.ref(),be=s=>{var t,a;F.value=s[0],U.value[D.value]=s[0],y.value[w.value][D.value].price=+s[0].salePrice||+bt((t=s[0])==null?void 0:t.id),y.value[w.value][D.value].skuId=(a=s[0])==null?void 0:a.id},le=s=>{i.value=s,P.value=s},bt=s=>{const t=e.ref("");return p.value.forEach(a=>{for(let n=0;n<a.setMealProductDetails.length;n++)a.setMealProductDetails[n].setMealProductSkuDetails.forEach(m=>{m.skuId===s&&(t.value=m.matchingPrice)})}),t.value},yt=s=>{const t=e.ref(0);return s.forEach(a=>{a.checkBox&&(t.value+=a.price)}),d(t.value)},ce=e.ref(!1),W=e.ref(!1),ae=e.ref(!1),vt=(s,t)=>{var n,m;if(F.value&&((n=F.value)==null?void 0:n.limitType)!=="UNLIMITED"&&+((m=F.value)==null?void 0:m.stock)==0)return R.ElMessage.error("该规格商品库存不足");let a=0;if(y.value[t].forEach(l=>{if(l.skuId!=="")for(let o=0;o<p.value[t].setMealProductDetails.length;o++)p.value[t].setMealProductDetails[o].setMealProductSkuDetails.forEach(B=>{l.checkBox&&B.skuId===l.skuId?U.value[o]={...B,productAttributes:p.value[t].setMealProductDetails[o].productAttributes,stackable:p.value[t].stackable}:!l.checkBox&&B.skuId===l.skuId&&(U.value=U.value.filter(g=>g.skuId!==l.skuId))})}),s.setMealType==="FIXED_COMBINATION"){for(let l=0;l<y.value[t].length;l++)y.value[t][l].price!==0&&a++;return s.setMealProductDetails.length!==a?R.ElMessage.error("请选择商品的规格"):Se(U.value,y.value[t])}for(let l=0;l<p.value[t].setMealProductDetails.length&&(p.value[t].setMealProductDetails[l].productAttributes==="MATCHING_PRODUCTS"&&(ce.value=!0),!ce.value);l++);for(let l=0;l<y.value[t].length-1&&(y.value[t][l].checkBox?W.value=!0:W.value=!1,!W.value);l++);if(ce.value&&W.value){for(let l=0;l<p.value[t].setMealProductDetails.length;l++){let o=p.value[t].setMealProductDetails[l];if(o.productAttributes==="MAIN_PRODUCT"&&o.setMealProductSkuDetails.length===1){ae.value=!0;break}else{ae.value=!1;break}}return ae.value?R.ElMessage.error("请选择主商品的规格"):Se(U.value,y.value[t])}else R.ElMessage.error("请选择组合的商品")},ne={},St=async s=>{const{key:t,value:a}=s;ne[t]=a,ve(re,z.value[re])},z=e.ref({}),ye=s=>{z.value={...z.value,...s}},ie=e.ref({}),Bt=s=>{var n,m,l;const a=(((n=ne[s])==null?void 0:n.flatMap(o=>o.featureValues))||[]).map(o=>o.firstValue+o.secondValue+"元");return(l=(m=z.value[s])==null?void 0:m.specs)!=null&&l.length?[...z.value[s].specs,...a].join("， "):"请选择"},ve=(s,t,a=!0)=>{a?ie.value[s]=t:Reflect.deleteProperty(ie.value,s)},de=e.ref(),It=()=>{const s=de.value[0].productAttributes;if(s.length){let a;if(!s.some(m=>!m.isRequired||m.isRequired&&m.featureValues.length?!0:(a=m,!1)))return R.ElMessage.error(`${a.featureName}为必选项`)}const t={[se.value]:F.value};ye(t),St({key:se.value,value:s}),le(!1)},Se=async(s,t)=>{var X;const{code:a,data:n,msg:m}=await Ae(f.query.shopId);if(a!==200||!n)return R.ElMessage.error(`${m||"获取店铺基本信息失败"}`);let l=ie.value;const o=ne,B=await Mt(l);if(!B)return;const{mainProduict:g,deliveryData:N}=B,c=S.value,V=[],E=[];let A;for(A in l){const O=N.find(Dt=>Dt.productId===A),{image:ee,price:J,salePrice:T,productName:te,id:Be,productAttributes:Et,skuStock:Ct,specs:Nt}=l[A],Vt={skuId:Be,image:ee,price:J,id:A,salePrice:T,productId:A,distributionMode:g==null?void 0:g.distributionMode,productName:te,num:1,freightTemplateId:O==null?void 0:O.freightTemplateId,weight:(O==null?void 0:O.weight)??"0",productFeaturesValue:(o==null?void 0:o[A])||null,specs:Nt},At={activityId:c,productAttributes:Et,shopId:f.query.shopId,skuId:Be,skuStock:Ct,productId:A};V.push(Vt),E.push(At)}const j=[{...n,shopLogo:n.logo,shopName:n.name,groupBuying:!0,shopId:n.id,products:V,distributionMode:p.value[0].distributionMode,activityParam:{type:"PACKAGE",activityId:c,extra:{setMealProducts:E},stackable:(X=p.value[0])==null?void 0:X.stackable}}];new Ie().setItem("commodityInfo",j,60*60*2),b.push({path:"/settlement",query:{source:"PRODUCT"}})},Mt=async s=>{const t=Object.keys(s).map(l=>({shopId:f.query.shopId,productId:l,skuId:s[l].id})),a=await De(t);if(a.code!==200||!a.data)return R.ElMessage.error(`${a.msg||"获取店铺基本信息失败"}`);const n=a.data;return{mainProduict:n.find(l=>l.productId===f.query.productId),deliveryData:n}};return(s,t)=>{const a=e.resolveComponent("ArrowDownBold"),n=e.resolveComponent("el-icon"),m=e.resolveComponent("el-button");return p.value.length!==0?(e.openBlock(),e.createElementBlock("div",He,[t[7]||(t[7]=e.createElementVNode("div",{class:"title"},"套餐",-1)),e.createElementVNode("div",Ke,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,(l,o)=>{var B,g,N;return e.openBlock(),e.createElementBlock("div",{key:o,class:"content"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.setMealProductDetails,(c,V)=>{var E,A,j;return e.openBlock(),e.createElementBlock("div",{key:V},[(c==null?void 0:c.productAttributes)==="MAIN_PRODUCT"?(e.openBlock(),e.createElementBlock("div",ze,[e.createElementVNode("div",Je,[e.createElementVNode("img",{src:c==null?void 0:c.productPic,alt:""},null,8,Ze)]),e.createElementVNode("div",Ye,e.toDisplayString(c==null?void 0:c.productName),1),e.createElementVNode("div",Qe,"￥"+e.toDisplayString(e.unref(d)((j=(A=(E=y.value)==null?void 0:E[o])==null?void 0:A[4])==null?void 0:j.price).toFixed(2)),1),(c==null?void 0:c.setMealProductSkuDetails.length)!==1?(e.openBlock(),e.createElementBlock("div",We,[e.createElementVNode("div",{class:"content__box--sel",onClick:X=>C(c,o)},[t[0]||(t[0]=e.createTextVNode(" 规格选择 ")),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(a)]),_:1})],8,et),i.value&&v.value===o?(e.openBlock(),e.createElementBlock("div",tt,[(e.openBlock(),e.createBlock(_e,{ref_for:!0,ref_key:"GoodSpecRef",ref:de,key:r.value,"sku-group":_.value,"img-boolean":!1,onChooseSpec:be,onCloseGoodSoec:le},null,8,["sku-group"]))])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])}),128)),t[6]||(t[6]=e.createElementVNode("div",{class:"content__plusSign"},[e.createElementVNode("div",null,[e.createElementVNode("img",{src:Me,alt:""})])],-1)),e.createElementVNode("div",ot,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.setMealProductDetails,(c,V)=>{var E,A,j,X,O,ee;return e.openBlock(),e.createElementBlock("div",{key:V,style:{display:"flex","justify-content":"space-evenly",margin:"0 10px 10px 0"}},[(c==null?void 0:c.productAttributes)==="MATCHING_PRODUCTS"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(((E=p.value[o])==null?void 0:E.setMealType)==="FIXED_COMBINATION"||(A=y.value[o])!=null&&A[V].checkBox?"content__box content__center boxBorder":"content__box content__center")},[e.createElementVNode("div",{class:"content__box--img",onClick:J=>{var T;return L(c,V,(T=p.value[o])==null?void 0:T.setMealType,o)}},[e.createElementVNode("img",{src:c==null?void 0:c.productPic,alt:""},null,8,rt)],8,st),e.createElementVNode("div",{class:"content__box--tilText",onClick:J=>{var T;return L(c,V,(T=p.value[o])==null?void 0:T.setMealType,o)}},e.toDisplayString(c==null?void 0:c.productName),9,lt),e.createElementVNode("div",{class:"content__box--price colorRed textFw",onClick:J=>{var T,te;return L(c,V,(te=(T=p.value)==null?void 0:T[o])==null?void 0:te.setMealType,o)}}," ￥"+e.toDisplayString(e.unref(d)((O=(X=(j=y.value)==null?void 0:j[o])==null?void 0:X[V])==null?void 0:O.price).toFixed(2)),9,ct),(c==null?void 0:c.setMealProductSkuDetails.length)!==1?(e.openBlock(),e.createElementBlock("div",at,[e.createElementVNode("div",{class:"content__box--sel",onClick:J=>xt(V,c,o)},[e.createTextVNode(e.toDisplayString(Bt(c==null?void 0:c.productId))+" ",1),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(a)]),_:1})],8,nt),P.value&&D.value===V&&w.value===o&&D.value!==4?(e.openBlock(),e.createElementBlock("div",it,[(e.openBlock(),e.createBlock(_e,{ref_for:!0,ref_key:"GoodSpecRef",ref:de,key:u.value,"sku-group":x.value,"current-choose":(ee=F.value)==null?void 0:ee.specs,params:xe.value,"img-boolean":!1,onChooseSpec:be,onCloseGoodSoec:le},null,8,["sku-group","current-choose","params"])),e.createElementVNode("div",dt,[e.createVNode(m,{onClick:It},{default:e.withCtx(()=>t[1]||(t[1]=[e.createTextVNode("确定")])),_:1})])])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)])}),128))]),e.createElementVNode("div",ut,[e.createElementVNode("p",null,[t[2]||(t[2]=e.createTextVNode(" 已选择 ")),e.createElementVNode("span",pt,e.toDisplayString(((B=p.value[o])==null?void 0:B.setMealType)==="FIXED_COMBINATION"?(g=p.value[o])==null?void 0:g.setMealProductDetails.length:K.value),1),t[3]||(t[3]=e.createTextVNode(" 件商品 "))]),e.createElementVNode("p",ft,[t[4]||(t[4]=e.createTextVNode(" 最多可省：")),e.createElementVNode("span",ht,"￥"+e.toDisplayString(e.unref(d)(l==null?void 0:l.saveAtLeast)),1)]),e.createElementVNode("p",null,[t[5]||(t[5]=e.createTextVNode(" 组合价：")),e.createElementVNode("span",mt,"￥"+e.toDisplayString(yt(y.value[o])),1)]),e.createElementVNode("p",{class:"content__rightBox--btn",onClick:c=>vt(l,o)},"立即购买",8,gt),e.createElementVNode("p",kt,e.toDisplayString((N=p.value[o])==null?void 0:N.endTime)+" 结束",1)])])}),128))])])):e.createCommentVNode("",!0)}}}),Ot="";return ke(_t,[["__scopeId","data-v-dde277bd"]])});
