<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.medusa.gruul.service.uaa.service.mp.mapper.RoleMenuMapper">

    <resultMap id="getMenusByRoleIdMap" type="com.medusa.gruul.service.uaa.service.mp.entity.Menu">
        <id column="id" property="id"/>
        <result column="parentId" property="parentId"/>
        <result column="name" property="name"/>
        <result column="path" property="path"/>
        <result column="type" property="type"/>
        <result column="perms" property="perms" typeHandler="com.baomidou.mybatisplus.extension.handlers.Fastjson2TypeHandler"/>
        <result column="order" property="order"/>
        <result column="createTime" property="createTime"/>
        <result column="updateTime" property="updateTime"/>
        <result column="version" property="version"/>
    </resultMap>
    <select id="getMenusByRoleId" resultMap="getMenusByRoleIdMap">
        SELECT menu.id          as id,
               menu.parent_id   AS parentId,
               menu.`name`      AS `name`,
               menu.path        AS path,
               menu.type        AS type,
               menu.perms       AS perms,
               menu.`order`     AS `order`,
               menu.create_time AS createTime,
               menu.update_time AS updateTime,
               menu.version     AS version
        FROM t_role_menu AS roleMenu
                 INNER JOIN t_menu AS menu ON menu.id = roleMenu.menu_id
            AND menu.deleted = 0
        WHERE roleMenu.role_id = #{roleId}
          AND roleMenu.deleted = 0
          AND menu.perms is not null
    </select>
</mapper>
