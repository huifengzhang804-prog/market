<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.medusa.gruul.service.uaa.service.mp.mapper.SalesSectionMapper">




    <select id="getProductInfoList" parameterType="com.medusa.gruul.service.uaa.service.model.dto.SalesSectionPageDTO" resultType="com.medusa.gruul.service.uaa.service.model.vo.ProductInfoVO">
        select
            tp.id productId,
            tp.name productName,
            tp.pic picUrl,
            tp.sale_price ,
            tp.shop_id ,
            t2.name section_name,
            t2.id platform_category_id ,
            t3.id sectionId
        from
            `pro-goods`.t_product tp
                left join `pro-addon-platform`.t_platform_category t2
                          on
                              tp.platform_category_id = t2.id
                left join `pro-security`.auc_sales_section t3
                          on
                              t3.name = t2.name
        where
            t3.id = #{salesSectionId}
    </select>



    <select id="getPurchaseMethodResultList" parameterType="com.medusa.gruul.service.uaa.service.model.dto.SalesSectionPageDTO" resultType="com.medusa.gruul.service.uaa.service.model.vo.PurchaseMethodResultVO">
        select
            t1.salesSectionId ,
            t1.groupId,
            t1.pointsId ,
            t2.name,
            t1.priceRatio ,
            t1.`type`
        from
            `pro-security`.auc_sales_section_purchase t1
                left join `pro-security`.auc_points t2
                          on
                              t1.pointsId = t2.id
        where
            salesSectionId = #{salesSectionId}
    </select>


    <select id="getGiveAwayResultList" parameterType="com.medusa.gruul.service.uaa.service.model.dto.SalesSectionPageDTO" resultType="com.medusa.gruul.service.uaa.service.model.vo.GiveAwayResultVO">
        select
            t1.salesSectionId ,
            t1.pointsId ,
            t2.name,
            t1.priceRatio ,
            t1.`type`
        from
            `pro-security`.auc_sales_section_giveaway t1
                left join `pro-security`.auc_points t2
                          on
                              t1.pointsId = t2.id
        where
            salesSectionId = #{salesSectionId}
    </select>


    <select id="getSectionNameBySectionId" parameterType="com.medusa.gruul.service.uaa.service.model.dto.SalesSectionPageDTO" resultType="String">
        select
            name as sectionName
        from
            `pro-security`.auc_sales_section ass
        where
            ass.id = #{salesSectionId}
    </select>



    <select id="getUserPointsInfo" parameterType="Long" resultType="com.medusa.gruul.service.uaa.service.model.vo.UserPointVO">
        select
            ap.id pointsId,
            ap.name pointsName,
            IFNULL(upi.points_num, 0) pointsNum,
            upi.user_id userId
        from
            `pro-security`.auc_points ap
                left join `pro-security`.user_point_info upi
                          on
                              upi.points_id = ap.id
                                  and upi.user_id =#{userId}
    </select>
</mapper>
