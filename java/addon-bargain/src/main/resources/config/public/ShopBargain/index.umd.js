(function(e,S){typeof exports=="object"&&typeof module<"u"?module.exports=S(require("vue"),require("@/components/ChromeTab.vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/components/PageManage.vue"),require("element-plus"),require("@/store/modules/shopInfo"),require("vue-router"),require("@/composables/useConvert"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@/components/ChromeTab.vue","@vueuse/core","@/components/SchemaForm.vue","@/components/PageManage.vue","element-plus","@/store/modules/shopInfo","vue-router","@/composables/useConvert","@/apis/http"],S):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopBargain=S(e.ShopBargainContext.Vue,e.ShopBargainContext.ChromeTabs,e.ShopBargainContext.VueUse,e.ShopBargainContext.SchemaForms,e.ShopBargainContext.PageManageTwo,e.ShopBargainContext.ElementPlus,e.ShopBargainContext.ShopInfoStore,e.ShopBargainContext.VueRouter,e.ShopBargainContext.UseConvert,e.ShopBargainContext.Request))})(this,function(e,S,$,R,D,_,q,F,H,E){"use strict";var z=document.createElement("style");z.textContent=`@charset "UTF-8";.container[data-v-a92748de]{overflow-y:scroll}[data-v-a92748de] .el-button.is-link{padding:0}[data-v-a92748de] .el-button+.el-button{margin-left:10px}.bargain_origin[data-v-9646c793]{display:flex;justify-content:center;align-items:center}.bargain_origin--name[data-v-9646c793]{width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.bargain_origin--shop_name[data-v-9646c793]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}
`,document.head.appendChild(z);const j={class:"q_plugin_container"},U={class:"fdc1 overh"},W=e.defineComponent({__name:"ShopBargain",setup(o){const u=e.reactive({activeName:"bargainList",tabsList:[{label:"砍价列表",name:"bargainList"},{label:"砍价订单",name:"bargainOrder"}]}),{activeName:c,tabsList:h}=e.toRefs(u),g={bargainList:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ae)),bargainOrder:e.defineAsyncComponent(()=>Promise.resolve().then(()=>de))},l=i=>{c.value=i};return(i,y)=>(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(S,{"tab-list":e.unref(h),value:e.unref(c),onHandleTabs:l},null,8,["tab-list","value"]),e.createElementVNode("div",U,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(g[e.unref(c)])))])]))}}),J=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(o,{emit:u}){const c=o,g=[{label:"活动名称",prop:"keyword",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"PROCESSING",label:"进行中"},{value:"OVER",label:"已结束"},{value:"SHOP_SELL_OFF",label:"已下架"},{value:"ILLEGAL_SELL_OFF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],l=u,i=$.useVModel(c,"modelValue",l),y=r=>{r&&Object.keys(r).forEach(C=>c.modelValue[C]=r[C])},x=()=>{Object.keys(c.modelValue).forEach(r=>c.modelValue[r]=""),l("search")};return(r,C)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{"v-model":e.unref(i),columns:g,onSearchHandle:C[0]||(C[0]=V=>l("search")),onChangeFormItem:y,onHandleReset:x},null,8,["v-model"]),C[1]||(C[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}}),B="addon-bargain/bargain",K="addon-bargain/bargainOrder",Q=o=>E.put({url:B+"/shop/sellOf",data:o}),X=o=>E.get({url:B+"/illegal/reason/"+o}),Y=o=>E.get({url:B,params:o}),A=o=>E.del({url:B,data:o}),Z=o=>E.get({url:K,params:o}),v={BARGAINING:"砍价中",FAILED_TO_BARGAIN:"砍价失败",SUCCESSFUL_BARGAIN:"砍价成功"};var G=(o=>(o.NOT_STARTED="未开始",o.PROCESSING="进行中",o.OVER="已结束",o.ILLEGAL_SELL_OFF="违规下架",o.SHOP_SELL_OFF="已下架",o))(G||{});const ee={class:"handle_container",style:{"padding-top":"16px"}},te={class:"table_container f1"},ne=e.defineComponent({__name:"BargainList",setup(o){const u=e.reactive({keyword:"",status:""}),c=F.useRouter(),h=e.computed(()=>t=>Number(t)===0?"全部":t+""),g=e.ref([]),l=e.reactive({size:10,current:1,total:0}),i=e.ref(!1),y=e.ref(),x=e.ref("");r();async function r(){const{status:t,keyword:n}=u,f={...l,keyword:n,shopId:q.useShopInfoStore().shopInfo.id,status:t},{code:s,data:m}=await Y(f);if(s!==200)return _.ElMessage.error("获取活动列表失败");g.value=m.records,l.current=m.current,l.size=m.size,l.total=m.total}const C=async t=>{try{if(!await _.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{shopId:f,id:s}=t,{code:m,data:P,msg:T}=await A([{activityId:s,shopId:f}]);if(m!==200){_.ElMessage.error(T||"删除失败");return}_.ElMessage.success("删除成功"),g.value=g.value.filter(a=>a.id!==t.id),l.total--}catch{}},V=e.ref([]),w=t=>{V.value=t},k=t=>{l.size=t,r()},d=t=>{l.current=t,r()},p=()=>{c.push({name:"bargainBaseinfo"})},N=()=>{_.ElMessageBox.confirm("确定删除选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async t=>{if(console.log("action",t),t==="cancel")return;const n=V.value.filter(s=>s.status!=="PROCESSING").map(s=>({shopId:s.shopId,activityId:s.id})),{code:f}=await A(n);if(f!==200){_.ElMessage.error("删除失败");return}_.ElMessage.success("删除成功"),r()}})},b=(t,n)=>{const{id:f,shopId:s}=t;c.push({name:"bargainBaseinfo",query:{activityId:f,shopId:s,isLookUp:n}})},O=t=>{_.ElMessageBox.confirm("确定下架选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async n=>{if(n==="cancel")return;const{code:f}=await Q(t);if(f!==200){_.ElMessage.error("下架失败");return}_.ElMessage.success("下架成功"),r()}})},L=async t=>{const{code:n,data:f}=await X(t);n!==200&&_.ElMessage.error("违规原因获取失败"),x.value=f,i.value=!0};return(t,n)=>{const f=e.resolveComponent("el-config-provider"),s=e.resolveComponent("el-button"),m=e.resolveComponent("el-table-column"),P=e.resolveComponent("el-table"),T=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(f,{"value-on-clear":"","empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(J,{modelValue:u,"onUpdate:modelValue":n[0]||(n[0]=a=>u=a),onSearch:r},null,8,["modelValue"])]),_:1}),e.createElementVNode("div",ee,[e.createVNode(s,{round:"",type:"primary",onClick:p},{default:e.withCtx(()=>n[2]||(n[2]=[e.createTextVNode("新增砍价")])),_:1}),e.createVNode(s,{round:"",disabled:!V.value.length,onClick:N},{default:e.withCtx(()=>n[3]||(n[3]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",te,[e.createVNode(P,{ref_key:"multipleTableRef",ref:y,data:g.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:w},{default:e.withCtx(()=>[e.createVNode(m,{type:"selection",width:"30",fixed:"",selectable:a=>a.status!=="PROCESSING"},null,8,["selectable"]),e.createVNode(m,{label:"活动名称"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(a.name),1)]),_:1}),e.createVNode(m,{label:"状态",width:"180"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",{style:e.normalizeStyle(`color: ${a.status==="ILLEGAL_SELL_OFF"?"#f12f22":"inherit"}`)},e.toDisplayString(e.unref(G)[a.status]),5)]),_:1}),e.createVNode(m,{label:"活动时间"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(a.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(a.endTime),1)]),_:1}),e.createVNode(m,{label:"活动商品",width:"150"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(h.value(a.productNum)),1)]),_:1}),e.createVNode(m,{label:"支付单数",width:"150"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",null,e.toDisplayString(a.payOrder||0),1)]),_:1}),e.createVNode(m,{label:"操作",fixed:"right",align:"right",width:"200"},{default:e.withCtx(({row:a})=>[e.createVNode(s,{type:"primary",link:"",onClick:I=>b(a,!0)},{default:e.withCtx(()=>n[4]||(n[4]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),a.status==="PROCESSING"?(e.openBlock(),e.createBlock(s,{key:0,type:"primary",link:"",onClick:I=>O({bargainId:a.id,shopId:a.shopId})},{default:e.withCtx(()=>n[5]||(n[5]=[e.createTextVNode("下架")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.status==="ILLEGAL_SELL_OFF"?(e.openBlock(),e.createBlock(s,{key:1,type:"primary",link:"",onClick:I=>L(a.id)},{default:e.withCtx(()=>n[6]||(n[6]=[e.createTextVNode("违规原因")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.status!=="PROCESSING"?(e.openBlock(),e.createBlock(s,{key:2,type:"danger",link:"",onClick:I=>C(a)},{default:e.withCtx(()=>n[7]||(n[7]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(D,{"page-size":l.size,"page-num":l.current,total:l.total,onHandleCurrentChange:d,onHandleSizeChange:k},null,8,["page-size","page-num","total"]),e.createVNode(T,{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=a=>i.value=a),title:"违规原因",width:"500",center:""},{default:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(x.value),1)]),_:1},8,["modelValue"])],64)}}}),pe="",M=(o,u)=>{const c=o.__vccOpts||o;for(const[h,g]of u)c[h]=g;return c},ae=Object.freeze(Object.defineProperty({__proto__:null,default:M(ne,[["__scopeId","data-v-a92748de"]])},Symbol.toStringTag,{value:"Module"})),oe={class:"table_container"},re={class:"bargain_origin"},le={class:"bargain_origin--name",style:{width:"170px","margin-left":"5px"}},ie={class:"bargain_origin"},se={class:"bargain_origin--shop_name",style:{width:"205px","margin-left":"5px"}},ce=e.defineComponent({__name:"BargainOrder",setup(o){const u=e.reactive({form:{keyword:""},bargainOrderList:[],chooseList:[]}),c=F.useRouter(),{form:h,bargainOrderList:g,chooseList:l}=e.toRefs(u),i=e.reactive({size:10,current:1,total:0}),{divTenThousand:y}=H(),x=[{label:"发起人",prop:"keyword",valueType:"copy",labelWidth:55,fieldProps:{placeholder:"请输入活动发起人"}}];r();async function r(){const{code:d,data:p,msg:N}=await Z({...i,keyword:h.value.keyword});if(d!==200){_.ElMessage.error(N||"获取砍价活动详情");return}g.value=p.records,i.size=p.size,i.total=p.total,i.current=p.current}const C=d=>{d&&Object.keys(d).forEach(p=>h.value[p]=d[p])},V=()=>{Object.keys(h.value).forEach(d=>h.value[d]=""),r()},w=d=>{i.size=d,r()},k=d=>{i.current=d,r()};return(d,p)=>{const N=e.resolveComponent("el-image"),b=e.resolveComponent("el-table-column"),O=e.resolveComponent("el-button"),L=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{"v-model":e.unref(h),columns:x,onSearchHandle:r,onChangeFormItem:C,onHandleReset:V},null,8,["v-model"]),e.createElementVNode("div",oe,[e.createVNode(L,{ref:"multipleTableRef",data:e.unref(g),stripe:"","header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:p[0]||(p[0]=t=>l.value=t)},{default:e.withCtx(()=>[e.createVNode(b,{label:"发起人",width:"240px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",re,[e.createVNode(N,{style:{width:"30px",height:"30px","border-radius":"3px"},fit:"",src:t.userHeadPortrait},null,8,["src"]),e.createElementVNode("div",le,e.toDisplayString(t.userNickname),1)])]),_:1}),e.createVNode(b,{label:"商品信息",width:"280px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",ie,[e.createVNode(N,{style:{width:"36px",height:"36px"},fit:"",src:t.productPic},null,8,["src"]),e.createElementVNode("div",se,e.toDisplayString(t.productName),1)])]),_:1}),e.createVNode(b,{label:"销售价(元)",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.salePrice&&e.unref(y)(t.salePrice)),1)]),_:1}),e.createVNode(b,{label:"底价(元)",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.floorPrice&&e.unref(y)(t.floorPrice)),1)]),_:1}),e.createVNode(b,{label:"砍价人数",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.bargainingPeople),1)]),_:1}),e.createVNode(b,{label:"砍价开始时间",width:"200px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.createTime),1)]),_:1}),e.createVNode(b,{label:"砍价结束时间",width:"200px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(b,{label:"状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:t.bargainStatus==="SUCCESSFUL_BARGAIN"?"#00BB2C":""})},e.toDisplayString(e.unref(v)[t.bargainStatus]),5)]),_:1}),e.createVNode(b,{label:"操作",fixed:"right",width:"130",align:"right"},{default:e.withCtx(({row:t})=>[e.createVNode(O,{link:"",type:"primary",onClick:()=>e.unref(c).push({name:"BargainHelpInfo",query:{id:t.id}})},{default:e.withCtx(()=>p[1]||(p[1]=[e.createTextVNode("帮砍记录")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createVNode(D,{"page-size":i.size,"page-num":i.current,total:i.total,onHandleCurrentChange:k,onHandleSizeChange:w},null,8,["page-size","page-num","total"])],64)}}}),ge="",de=Object.freeze(Object.defineProperty({__proto__:null,default:M(ce,[["__scopeId","data-v-9646c793"]])},Symbol.toStringTag,{value:"Module"}));return W});
