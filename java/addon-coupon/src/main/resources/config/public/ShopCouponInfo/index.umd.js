(function(e,R){typeof exports=="object"&&typeof module<"u"?module.exports=R(require("vue"),require("vue-router"),require("@vueuse/core"),require("@/utils/date"),require("@/composables/useConvert"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/store/modules/shopInfo"),require("element-plus"),require("@/apis/good"),require("@/apis/decoration"),require("@element-plus/icons-vue"),require("@/apis/http"),require("lodash-es")):typeof define=="function"&&define.amd?define(["vue","vue-router","@vueuse/core","@/utils/date","@/composables/useConvert","@/components/BetterPageManage/BetterPageManage.vue","@/store/modules/shopInfo","element-plus","@/apis/good","@/apis/decoration","@element-plus/icons-vue","@/apis/http","lodash-es"],R):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopCouponInfo=R(e.ShopCouponInfoContext.Vue,e.ShopCouponInfoContext.VueRouter,e.ShopCouponInfoContext.VueUse,e.ShopCouponInfoContext.DateUtil,e.ShopCouponInfoContext.UseConvert,e.ShopCouponInfoContext.PageManage,e.ShopCouponInfoContext.ShopInfoStore,e.ShopCouponInfoContext.ElementPlus,e.ShopCouponInfoContext.GoodAPI,e.ShopCouponInfoContext.DecorationAPI,e.ShopCouponInfoContext.ElementPlusIconsVue,e.ShopCouponInfoContext.Request,e.ShopCouponInfoContext.Lodash))})(this,function(e,R,le,Z,$,de,ae,I,re,K,J,G,ie){"use strict";var X=document.createElement("style");X.textContent=`@charset "UTF-8";.title[data-v-594bcf8e]{font-size:15px;font-weight:700;display:flex;margin-bottom:20px;margin-top:-20px}.digGoods[data-v-594bcf8e]{border-top:1px solid #d7d7d7;padding-top:10px}.digGoods__box[data-v-594bcf8e]{background-color:#f2f2f2;padding:10px}.digGoods__box--top[data-v-594bcf8e]{display:flex;justify-content:space-between}.digGoods__box--content[data-v-594bcf8e]{margin-top:10px;background-color:#fff;border-radius:5px;display:flex;flex-wrap:wrap;padding:5px}.digGoods__box--content--good[data-v-594bcf8e]{width:33%;margin-left:2px;margin-bottom:4px;height:80px;border-radius:5px;padding:5px;display:flex}.digGoods__box--content--good--img[data-v-594bcf8e]{width:65px;height:65px;position:relative}.digGoods__box--content--good--imgShadow[data-v-594bcf8e]{width:65px;height:65px;position:absolute;background-color:#0009;display:flex;justify-content:center;align-items:center}.digGoods__box--content--good--shopName[data-v-594bcf8e]{display:flex;justify-content:center;align-items:center;flex-direction:column;justify-content:space-between;align-items:flex-start;margin-left:10px;padding:5px;font-size:12px}.digGoods__box--content--good--shopName--name[data-v-594bcf8e]{width:150px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.bottom[data-v-594bcf8e]{display:flex;justify-content:space-between;align-items:flex-end}.bottom-container[data-v-594bcf8e]{display:flex;justify-content:center;align-items:center;flex-direction:column}[data-v-594bcf8e] .pagination{padding:8px}.coupon-info[data-v-67668d97]{padding:16px;position:relative;height:100%;overflow-y:scroll}.coupon-info__form[data-v-67668d97]{overflow-y:auto}.title[data-v-67668d97]{font-size:14px;color:#606266;font-weight:700;margin-bottom:30px;line-height:25px}.msg[data-v-67668d97]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-67668d97]{display:flex;margin-top:10px;height:70px}.period-validity[data-v-67668d97]{width:300px;display:flex}.text[data-v-67668d97]{font-size:14px;color:#333}.goodsData[data-v-67668d97]{border:1px solid #ccc}.goods-list[data-v-67668d97]{width:90%;margin-top:20px;border:1px solid transparent}.goods-list__info[data-v-67668d97]{display:flex}.goods-list__goods-list__info-name[data-v-67668d97]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-67668d97]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-67668d97]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-67668d97]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-67668d97]{font-size:16px}.ruleform-date[data-v-67668d97]{width:100%;display:flex;align-items:center}.flex[data-v-67668d97]{margin-top:10px;height:70px}.flex-item[data-v-67668d97]{width:40%}.coupon-rules[data-v-67668d97]{height:74px;display:flex;justify-content:center;align-items:center}.commodityForm__tool[data-v-67668d97]{margin-top:auto;align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:9}
`,document.head.appendChild(X);const{divTenThousand:se,mulTenThousand:pe}=$(),ue={NOT_OPEN:"未开始",OPEN:"进行中",CLOSED:"已结束",SHOP_BANED:"已下架",BANED:"违规下架"},ce={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var L=(n=>(n.PERIOD="PERIOD",n.IMMEDIATELY="IMMEDIATELY",n))(L||{});function v(n){return n?pe(n):""}function ee(n){return n?se(n).toString():""}function me(n){const{name:d,days:g,type:m,endDate:x,productIds:C,productType:s,requiredAmount:c,discount:N,amount:b,effectType:E,startDate:o,num:P,limit:M,id:k,shopId:U}=n;return{shopId:U,id:k,name:d,days:g,endDate:x,productType:s,type:m,requiredAmount:ee(c).toString(),discount:N,amount:ee(b),effectType:E,startDate:o,num:P,limit:M,productIds:C}}const fe=n=>{const d=new Z;return n.status!=="OK"?ue[n.status]:n.status==="SHOP_BANED"?"已下架":n.effectType==="PERIOD"&&n.endDate>=d.getYMDs()?n.stock==="0"?"已结束":n.startDate>d.getYMDs()?"未开始":"进行中":n.effectType==="PERIOD"&&n.endDate<d.getYMDs()?"已结束":n.effectType==="IMMEDIATELY"?n.stock!=="0"?"进行中":"已结束":""},ge=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:d}){const g=n,m=d,x=le.useVModel(g,"modelValue",m);return(C,s)=>{const c=e.resolveComponent("el-option"),N=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(N,{modelValue:e.unref(x),"onUpdate:modelValue":s[0]||(s[0]=b=>e.isRef(x)?x.value=b:null),placeholder:g.placeholder,style:{width:"150px"},onChange:s[1]||(s[1]=b=>m("change",b))},{default:e.withCtx(()=>[e.renderSlot(C.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(g.list).length?g.list:e.unref(ce),(b,E)=>(e.openBlock(),e.createBlock(c,{key:E,label:b,value:E},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),xe={class:"digGoods"},_e={class:"digGoods__box"},Ce={class:"digGoods__box--top"},he={key:0,class:"digGoods__box--content"},ye=["onClick"],Ve=["src"],be={key:0,class:"digGoods__box--content--good--imgShadow"},Ee={class:"digGoods__box--content--good--shopName"},Ne={class:"digGoods__box--content--good--shopName--name"},Ie={key:1,class:"digGoods__box--content",style:{display:"flex","justify-content":"center","align-items":"center",height:"250px"}},we={class:"bottom"},De=e.defineComponent({__name:"choose-goods-popup",props:{pointGoodsList:{type:Array,default(){return[]}},goodsVisible:{type:Boolean,default:!1}},setup(n,{expose:d}){const g=n,{divTenThousand:m}=$(),x=e.reactive({size:10,current:1,total:0}),C=e.reactive({size:10,current:1,total:0}),s=e.ref([]),c=e.ref([]),N=e.ref([]),b=e.ref(""),E=e.ref(!1),o=e.shallowReactive({maxPrice:"",minPrice:"",salePrice:"",keyword:"",categoryFirstId:""});e.watch(g,p=>{if(c.value.length!==p.pointGoodsList.length){const a=c.value.filter(_=>{const h=_.id;return p.pointGoodsList.findIndex(u=>u.id===h)===-1});c.value.forEach(_=>{a.forEach(h=>{h.id===_.id&&(_.isCheck=!1)})}),c.value=c.value.filter(_=>_.isCheck)}},{deep:!0}),d({tempGoods:c,search:o,goodsList:s});const P={borderGet:"2px solid #2D8CF0",borderNoGet:"2px solid #f2f2f2"};e.onMounted(()=>{F()});const M=p=>{o.categoryFirstId=p.id,S()},k=()=>{S()},U=p=>{p.isCheck=!p.isCheck;const a=c.value;if(p.isCheck)a.push(p);else{const _=a.findIndex(h=>h.id===p.id);_!==-1&&a.splice(_,1)}},A=()=>{const p=s.value,a=c.value,_=E.value;p.map(h=>(_&&(a.find(u=>u.id===h.id)||a.push(h)),h.isCheck=_)),_||p.forEach(h=>{const u=a.findIndex(l=>l.id===h.id);u!==-1&&a.splice(u,1)})},Y=p=>{x.size=p,S()},z=p=>{x.current=p,E.value=!1,S()};async function F(){const{code:p,data:a}=await re.doGetHighestCategoryLevel({size:1e3});p===200?(N.value=a.records,x.total=a.total):I.ElMessage.error("获取分类列表失败")}async function S(){const p=ae.useShopInfoStore().shopInfo.id;(o.minPrice||o.maxPrice)&&(o.salePrice=`${o.minPrice}_${o.maxPrice}`);const{code:a,data:_}=await K.doGetRetrieveCommodity({...o,...C,searchTotalStockGtZero:!0,shopId:p});if(a===200){let h=!0;_.list.forEach(u=>{const l=j(u.id);u.isCheck=l,h=h&&l}),E.value=h,s.value=_.list,C.total=_.total}else I.ElMessage.error("获取商品失败")}function j(p){return c.value.findIndex(a=>a.id===p)!==-1}function H(p){const a=m(Math.max(...p)).toString(),_=m(Math.min(...p)).toString();return p.length>1?`${_}~${a}`:_}return S(),(p,a)=>{const _=e.resolveComponent("el-option"),h=e.resolveComponent("el-option-group"),u=e.resolveComponent("el-select"),l=e.resolveComponent("el-input"),t=e.resolveComponent("el-button"),y=e.resolveComponent("el-icon"),f=e.resolveComponent("el-checkbox");return e.openBlock(),e.createElementBlock("div",null,[a[9]||(a[9]=e.createElementVNode("div",{class:"title"},"选择商品",-1)),e.createElementVNode("div",xe,[e.createElementVNode("div",_e,[e.createElementVNode("div",Ce,[e.createVNode(u,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=i=>b.value=i),placeholder:"全部分类",style:{width:"120px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.value,i=>(e.openBlock(),e.createBlock(h,{key:i.id},{default:e.withCtx(()=>[e.createVNode(_,{label:i.name,value:i.name,onClick:V=>M(i)},null,8,["label","value","onClick"])]),_:2},1024))),128))]),_:1},8,["modelValue"]),e.createElementVNode("div",null,[a[6]||(a[6]=e.createElementVNode("span",{style:{margin:"0px 10px 0px 25px",color:"#a1a1a1",width:"60px","line-height":"32px"}},"价格",-1)),e.createVNode(l,{modelValue:e.unref(o).minPrice,"onUpdate:modelValue":a[1]||(a[1]=i=>e.unref(o).minPrice=i),maxlength:"20",style:{width:"60px"}},null,8,["modelValue"]),a[7]||(a[7]=e.createElementVNode("span",{style:{margin:"0px 5px","line-height":"32px"}},"-",-1)),e.createVNode(l,{modelValue:e.unref(o).maxPrice,"onUpdate:modelValue":a[2]||(a[2]=i=>e.unref(o).maxPrice=i),maxlength:"20",style:{width:"60px"}},null,8,["modelValue"])]),e.createVNode(l,{modelValue:e.unref(o).keyword,"onUpdate:modelValue":a[3]||(a[3]=i=>e.unref(o).keyword=i),class:"input-with-select",maxlength:"20",placeholder:"请输入关键词",style:{width:"200px","margin-left":"10px"}},{append:e.withCtx(()=>[e.createVNode(t,{icon:e.unref(J.Search),onClick:k},null,8,["icon"])]),_:1},8,["modelValue"])]),s.value.length>0?(e.openBlock(),e.createElementBlock("div",he,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(i,V)=>(e.openBlock(),e.createElementBlock("div",{key:V,style:e.normalizeStyle({border:i.isCheck?P.borderGet:P.borderNoGet}),class:"digGoods__box--content--good",onClick:w=>U(i)},[e.createElementVNode("img",{src:i.pic,class:"digGoods__box--content--good--img"},null,8,Ve),i.isCheck?(e.openBlock(),e.createElementBlock("div",be,[e.createVNode(y,{color:"#fff",size:"40px"},{default:e.withCtx(()=>[e.createVNode(e.unref(J.Check))]),_:1})])):e.createCommentVNode("",!0),e.createElementVNode("div",Ee,[e.createElementVNode("div",Ne,e.toDisplayString(i.productName),1),e.createElementVNode("div",null," ￥"+e.toDisplayString(i.salePrices&&H(i.salePrices)),1)])],12,ye))),128))])):e.createCommentVNode("",!0),s.value.length===0?(e.openBlock(),e.createElementBlock("div",Ie," 暂无相关商品信息，请选择其他分类 ")):e.createCommentVNode("",!0),e.createElementVNode("div",we,[e.createVNode(f,{modelValue:E.value,"onUpdate:modelValue":a[4]||(a[4]=i=>E.value=i),style:{height:"48px","background-color":"#fff","padding-left":"5px"},onChange:A},{default:e.withCtx(()=>a[8]||(a[8]=[e.createTextVNode("全选")])),_:1},8,["modelValue"]),e.createVNode(de,{modelValue:C,"onUpdate:modelValue":a[5]||(a[5]=i=>C=i),"load-init":!0,total:C.total,background:"",onReload:S,onHandleSizeChange:Y,onHandleCurrentChange:z},null,8,["modelValue","total"])])])])])}}}),Je="",te=(n,d)=>{const g=n.__vccOpts||n;for(const[m,x]of d)g[m]=x;return g},ke=te(De,[["__scopeId","data-v-594bcf8e"]]),Se=n=>G.post({url:"addon-coupon/coupon",data:n}),Te=(n,d)=>G.get({url:`addon-coupon/coupon/shop/${n}/${d}`}),qe=(n,d)=>G.put({url:`addon-coupon/coupon/${n}`,data:d}),Re=(n,d)=>G.put({url:`addon-coupon/coupon/${n}/working`,data:d}),Pe=(n,d,g)=>{if(n==="PRICE_REDUCE"){Me(n,d);return}if(n==="PRICE_DISCOUNT"){oe(n,d);return}if(n==="REQUIRED_PRICE_REDUCE"){oe(n,d),Be(n,d,g);return}if(n==="REQUIRED_PRICE_DISCOUNT"){const m=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(C,s,c)=>{Number(s)<=0?c(new Error("金额必须大于0")):c()},trigger:"blur"}],x=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(C,s,c)=>{Number(s)<=0&&Number(s)<100?c(new Error("0.1~99之间")):c()},trigger:"blur"}];d.requiredAmount=m,d.discount=x}},Me=(n,d)=>{d.discount.length&&(d.discount[0].required=!1),d.requiredAmount.length&&(d.discount[0].required=!1);const g=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(m,x,C)=>{Number(x)<=0?C(new Error("金额必须大于0")):C()},trigger:"blur"}];d.amount=g},oe=(n,d)=>{d.requiredAmount.length&&(d.discount[0].required=!1),d.amount.length&&(d.amount[0].required=!1);const g=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(m,x,C)=>{Number(x)<=0&&Number(x)<100?C(new Error("0.1~99之间")):C()},trigger:"blur"}];d.discount=g},Be=(n,d,g)=>{d.discount.length&&(d.discount[0].required=!1);const m=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(C,s,c)=>{Number(s)<=0?c(new Error("金额必须大于0")):c()},trigger:"blur"}],x=[...m,{validator:(C,s,c)=>{Number(g.requiredAmount)-Number(s)<=0?c(new Error(`满减金额必须小于${Number(g.requiredAmount)}`)):c()},trigger:"blur"}];d.amount=x,d.requiredAmount=m},Ue={class:"q_plugin_container overh"},Ge={class:"coupon-info"},Ae={key:0,class:"ruleform-date"},Oe={class:"period-validity text"},$e={class:"coupon-rules"},Le={key:2,class:"flex",style:{width:"100%"}},Ye={key:3,class:"flex"},ze={class:"goods-list__info"},Fe={class:"goods-list__goods-list__info-name"},je={class:"goods-list__goods-list__info-name--name"},He={class:"goods-list__goods-list__info-name--price"},Qe={class:"dialog-footer"},We={class:"commodityForm__tool"},Ze=e.defineComponent({__name:"ShopCouponInfo",setup(n){const d=R.useRouter(),g=R.useRoute(),m=new Z,x=e.ref(!1),C=e.ref(""),s=e.ref([]),c=e.ref(""),N=e.ref(),b=e.ref(!1),E=e.ref(),o=e.ref({name:"",days:1,endDate:"",productType:"SHOP_ALL",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:L.PERIOD,startDate:"",num:1,limit:1,shopId:"",productIds:[],createTime:"",usedCount:""}),P=$(),M={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],effectType:[{required:!0,message:"请选择有效时间",trigger:["blur","change"]}],type:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],discount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],num:[{required:!0,message:"请输入发行量",trigger:"blur"}],limit:[{required:!0,message:"请输入每人发送数量",trigger:"blur"}],requiredAmount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],amount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],productType:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],days:[{required:!0,message:"请输入优惠券有效期",trigger:"blur"},{validator:(l,t,y)=>{Number(t)===0?y("最少1天"):y()},trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:["blur","change"]}],endDate:[{required:!0,message:"请选择结束日期",trigger:["blur","change"]}]},k=e.ref(!1);U(),e.watch(()=>g,async l=>{var f;if(k.value=!!l.query.isLookUp,!l.query.id||!l.query.shopId)return;const{code:t,data:y}=await Te(l.query.shopId.toString(),l.query.id.toString());if(t!==200){I.ElMessage.error("获取优惠券信息失败");return}if(o.value=me(y),C.value=fe(y),c.value=y.endDate,x.value=!0,(f=y.productIds)!=null&&f.length){const{code:i,data:V}=await K.doGetRetrieveCommodity({productId:y.productIds,searchTotalStockGtZero:!0});if(i!==200){I.ElMessage.error("获取商品信息失败");return}s.value=V.list.map(w=>({...w,isCheck:!0}))}},{immediate:!0});function U(){console.log("$route.query.isEdit",g.query.isEdit),g.query.isEdit&&(IsEdit.value=g.query.isEdit==="true")}const A=async()=>{var y,f;if(!N.value)return;const{num:l,limit:t}=o.value;if(!l||!t){I.ElMessage.error("发行量或每人发送数量只能是正整数和数字");return}try{if(!await N.value.validate())return;if(["ASSIGNED","ASSIGNED_NOT"].includes(o.value.productType)&&!s.value.length){s.value.length,I.ElMessage.error("请选择指定商品");return}z();const V=F();o.value.productType==="SHOP_ALL"&&(V.productIds=null),Y(V);const w=o.value.id,{code:B}=await(w?C.value==="进行中"?Re(w,{name:V.name,days:V.days,endDate:V.endDate,productType:V.productType,productIds:V.productIds}):qe(w,V):Se(V));if(B!==200){I.ElMessage.error("保存失败");return}I.ElMessage.success("保存成功"),p(),d.push({name:"coupons"})}catch(i){if((y=i.requiredAmount)!=null&&y.length){I.ElMessage.info(i.requiredAmount[0].message);return}if((f=i.amount)!=null&&f.length){I.ElMessage.info(i.amount[0].message);return}}};function Y(l){l.effectType==="PERIOD"&&(l.days=null),l.effectType==="IMMEDIATELY"&&(l.startDate="",l.endDate=""),l.type==="PRICE_REDUCE"&&(l.requiredAmount=null,l.discount=null),l.type==="PRICE_DISCOUNT"&&(l.amount=null,l.requiredAmount=null),l.type==="REQUIRED_PRICE_REDUCE"&&(l.discount=null),l.type==="REQUIRED_PRICE_DISCOUNT"&&(l.amount=null)}const z=()=>{if(o.value.effectType==="PERIOD"){o.value.days=1;return}o.value.startDate="",o.value.endDate=""};function F(){const{name:l,days:t,endDate:y,productType:f,type:i,requiredAmount:V,discount:w,amount:B,effectType:D,startDate:T,num:O,limit:Q,shopId:q}=o.value;return{name:l,days:t,endDate:y,productType:f,type:i,requiredAmount:v(V).toString(),discount:w,amount:v(B).toString(),effectType:D,startDate:T,num:O,shopId:q,limit:Q,productIds:s.value.length?s.value.map(W=>W.productId):null}}const S=()=>{b.value=!1},j=()=>{s.value=ie.cloneDeep(E.value.tempGoods),b.value=!1},H=async l=>{await I.ElMessageBox.confirm("确定移除该商品?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})&&(s.value=s.value.filter(y=>y.productId!==l))};function p(){N.value&&(N.value.resetFields(),o.value={name:"",days:1,endDate:"",productType:"SHOP_ALL",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:L.PERIOD,startDate:"",num:1,shopId:"",limit:1,productIds:[],createTime:"",usedCount:""},s.value=[])}const a=()=>{Pe(o.value.type,M,o.value),o.value.amount=1,o.value.requiredAmount=1,o.value.discount=1},_=l=>x.value?c.value<m.getYMDs(l):!!o.value.endDate?o.value.endDate<m.getYMDs(l)||m.getYMDs(l)<m.getYMDs(new Date):m.getYMDs(l)<m.getYMDs(new Date),h=l=>x.value?c.value>m.getYMDs(l):!!o.value.startDate?o.value.startDate>m.getYMDs(l)||m.getYMDs(l)<m.getYMDs(new Date):!1,u=l=>k.value?!0:x.value&&!l.includes(C.value);return(l,t)=>{const y=e.resolveComponent("el-input"),f=e.resolveComponent("el-form-item"),i=e.resolveComponent("el-radio"),V=e.resolveComponent("el-radio-group"),w=e.resolveComponent("el-row"),B=e.resolveComponent("el-date-picker"),D=e.resolveComponent("el-input-number"),T=e.resolveComponent("el-table-column"),O=e.resolveComponent("el-table"),Q=e.resolveComponent("el-image"),q=e.resolveComponent("el-button"),ne=e.resolveComponent("el-link"),W=e.resolveComponent("el-form"),Ke=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ue,[e.createElementVNode("div",Ge,[t[38]||(t[38]=e.createElementVNode("h1",{class:"title"},"基本信息",-1)),e.createVNode(W,{ref_key:"ruleFormRef",ref:N,"inline-message":!1,model:o.value,rules:M,"label-width":"auto",class:"coupon-info__form"},{default:e.withCtx(()=>[e.createVNode(f,{label:"优惠券名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),modelModifiers:{trim:!0},disabled:u(["未开始","进行中"]),maxlength:"10",placeholder:"请输入优惠券名称",style:{width:"551px"}},null,8,["modelValue","disabled"]),t[19]||(t[19]=e.createElementVNode("span",{class:"msg"},"优惠券名称不超过10个字",-1))]),_:1}),e.createVNode(f,{label:"有效时间",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(w,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(V,{modelValue:o.value.effectType,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.effectType=r),disabled:u(["未开始"]),class:"ml-4"},{default:e.withCtx(()=>[e.createVNode(i,{value:"PERIOD"},{default:e.withCtx(()=>t[20]||(t[20]=[e.createTextVNode("固定时间")])),_:1}),e.createVNode(i,{value:"IMMEDIATELY"},{default:e.withCtx(()=>t[21]||(t[21]=[e.createTextVNode("领券立即生效")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),e.createVNode(w,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[o.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",Ae,[e.createVNode(f,{"inline-message":!1,prop:"startDate"},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:o.value.startDate,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.startDate=r),disabled:u(["未开始"]),"disabled-date":_,format:"YYYY/MM/DD",placeholder:"请选择开始时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue","disabled"]),t[22]||(t[22]=e.createElementVNode("span",{style:{margin:"0 10px"}},"至",-1))]),_:1}),e.createVNode(f,{"inline-message":!1,prop:"endDate"},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:o.value.endDate,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.endDate=r),disabled:u(["未开始","进行中"]),"disabled-date":h,format:"YYYY/MM/DD",placeholder:"请选择结束时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue","disabled"])]),_:1})])):(e.openBlock(),e.createBlock(f,{key:1,prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",Oe,[t[23]||(t[23]=e.createTextVNode(" 领券当日起 ")),e.createVNode(D,{modelValue:o.value.days,"onUpdate:modelValue":t[4]||(t[4]=r=>o.value.days=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始","进行中"]),max:99999,min:o.value.days?1:0,style:{width:"20%",margin:"0 5px"}},null,8,["modelValue","disabled","min"]),t[24]||(t[24]=e.createTextVNode(" 天内可用 "))])]),_:1}))]),_:1})]),_:1}),e.createVNode(f,{label:"活动规则"},{default:e.withCtx(()=>[e.createVNode(O,{"cell-style":{height:"60px"},data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(T,{label:"选择优惠券类型",width:"170"},{default:e.withCtx(()=>[e.createVNode(f,{prop:"type"},{default:e.withCtx(()=>[e.createVNode(ge,{modelValue:o.value.type,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.type=r),disabled:u(["未开始"]),placeholder:"全部类型",onChange:a},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e.createVNode(T,{label:"优惠券规则",width:"280"},{default:e.withCtx(()=>[e.createElementVNode("div",$e,[o.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(f,{key:0,prop:"discount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.discount,"onUpdate:modelValue":t[6]||(t[6]=r=>o.value.discount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:9.9,min:.1,precision:1,style:{width:"40%"}},null,8,["modelValue","disabled"]),t[25]||(t[25]=e.createElementVNode("span",{style:{"margin-left":"10px"}},"折，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(f,{key:1,prop:"amount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.amount,"onUpdate:modelValue":t[7]||(t[7]=r=>o.value.amount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:999999,min:0,style:{width:"40%"}},null,8,["modelValue","disabled"]),t[26]||(t[26]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",Le,[e.createVNode(f,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[27]||(t[27]=e.createElementVNode("span",null,"满",-1)),e.createVNode(D,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[8]||(t[8]=r=>o.value.requiredAmount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:99999,min:0,style:{width:"60%",margin:"0 5px"}},null,8,["modelValue","disabled"]),t[28]||(t[28]=e.createElementVNode("span",null,"元,打",-1))]),_:1}),e.createVNode(f,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.discount,"onUpdate:modelValue":t[9]||(t[9]=r=>o.value.discount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:9.9,min:.1,precision:1,style:{width:"60%","margin-left":"5px"}},null,8,["modelValue","disabled"]),t[29]||(t[29]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"折",-1))]),_:1})])):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",Ye,[e.createVNode(f,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[30]||(t[30]=e.createElementVNode("span",null,"满",-1)),e.createVNode(D,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[10]||(t[10]=r=>o.value.requiredAmount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:999999,min:0,style:{width:"80%","margin-left":"5px"}},null,8,["modelValue","disabled"])]),_:1}),e.createVNode(f,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[t[31]||(t[31]=e.createElementVNode("span",null,"元,减",-1)),e.createVNode(D,{modelValue:o.value.amount,"onUpdate:modelValue":t[11]||(t[11]=r=>o.value.amount=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:999999,min:0,style:{width:"60%","margin-left":"5px"}},null,8,["modelValue","disabled"]),t[32]||(t[32]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元",-1))]),_:1})])):e.createCommentVNode("",!0)])]),_:1}),e.createVNode(T,{label:"发行量（张）"},{default:e.withCtx(()=>[e.createVNode(f,{prop:"num"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.num,"onUpdate:modelValue":t[12]||(t[12]=r=>o.value.num=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:99999,min:1},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e.createVNode(T,{label:"每人发送（张）"},{default:e.withCtx(()=>[e.createVNode(f,{prop:"limit"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.limit,"onUpdate:modelValue":t[13]||(t[13]=r=>o.value.limit=r),modelModifiers:{number:!0},controls:!1,disabled:u(["未开始"]),max:99999,min:1},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(f,{label:"商品选择",prop:"productType"},{default:e.withCtx(()=>[e.createVNode(V,{modelValue:o.value.productType,"onUpdate:modelValue":t[14]||(t[14]=r=>o.value.productType=r),disabled:u(["未开始","进行中"])},{default:e.withCtx(()=>[e.createVNode(i,{value:"SHOP_ALL"},{default:e.withCtx(()=>t[33]||(t[33]=[e.createTextVNode("全部商品参与")])),_:1}),e.createVNode(i,{value:"ASSIGNED"},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("指定商品参与")])),_:1}),e.createVNode(i,{value:"ASSIGNED_NOT"},{default:e.withCtx(()=>t[35]||(t[35]=[e.createTextVNode("指定商品不参与")])),_:1})]),_:1},8,["modelValue","disabled"]),o.value.productType!=="SHOP_ALL"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([s.value.length&&"goodsData","goods-list"])},[e.createVNode(O,{data:s.value,"header-cell-style":{fontSize:"14px",color:"#606266",background:"#f2f2f2",height:"54px",fontWeight:"normal"},height:"400px",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(T,{label:`商品信息${s.value.length?`(已选择${s.value.length}款商品)`:""}`},{default:e.withCtx(({row:r})=>[e.createElementVNode("div",ze,[e.createVNode(Q,{"preview-src-list":[r.pic],"preview-teleported":!0,src:r.pic,fit:"",style:{width:"60px",height:"60px"}},null,8,["preview-src-list","src"]),e.createElementVNode("div",Fe,[e.createElementVNode("div",je,e.toDisplayString(r.productName),1),e.createElementVNode("div",He,e.toDisplayString(e.unref(P).divTenThousand(r.salePrices[0])),1)])])]),_:1},8,["label"]),e.createVNode(T,{width:"100px"},{header:e.withCtx(()=>[e.createVNode(q,{disabled:u(["未开始","进行中"]),plain:"",round:"",type:"primary",size:"small",onClick:t[15]||(t[15]=r=>b.value=!0)},{default:e.withCtx(()=>t[36]||(t[36]=[e.createTextVNode("添加商品 ")])),_:1},8,["disabled"])]),default:e.withCtx(({row:r})=>[e.createVNode(ne,{disabled:u(["未开始"]),underline:!1,type:"primary",onClick:et=>H(r.productId)},{default:e.withCtx(()=>t[37]||(t[37]=[e.createTextVNode("删除 ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])],2)):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["model"])]),e.createVNode(Ke,{modelValue:b.value,"onUpdate:modelValue":t[17]||(t[17]=r=>b.value=r),"before-close":S,width:"800px"},{footer:e.withCtx(()=>[e.createElementVNode("span",Qe,[e.createVNode(q,{onClick:t[16]||(t[16]=r=>b.value=!1)},{default:e.withCtx(()=>t[39]||(t[39]=[e.createTextVNode("取消")])),_:1}),e.createVNode(q,{type:"primary",onClick:j},{default:e.withCtx(()=>t[40]||(t[40]=[e.createTextVNode(" 确认 ")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(ke,{ref_key:"chooseGoodsPopupRef",ref:E,pointGoodsList:s.value},null,8,["pointGoodsList"])]),_:1},8,["modelValue"])]),e.createElementVNode("div",We,[e.createVNode(q,{plain:"",round:"",onClick:t[18]||(t[18]=r=>e.unref(d).back())},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.value?"返回":"取消"),1)]),_:1}),k.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(q,{key:0,style:{"margin-left":"40px"},disabled:u(["","未开始","进行中"]),round:"",type:"primary",onClick:A},{default:e.withCtx(()=>t[41]||(t[41]=[e.createTextVNode("确定")])),_:1},8,["disabled"]))])],64)}}}),Xe="";return te(Ze,[["__scopeId","data-v-67668d97"]])});
