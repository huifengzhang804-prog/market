(function(e,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("vue"),require("vue-router"),require("element-plus"),require("@vueuse/core"),require("@/utils/date"),require("@/composables/useConvert"),require("@/apis/http"),require("@/apis/good")):typeof define=="function"&&define.amd?define(["vue","vue-router","element-plus","@vueuse/core","@/utils/date","@/composables/useConvert","@/apis/http","@/apis/good"],u):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformCouponInfo=u(e.PlatformCouponInfoContext.Vue,e.PlatformCouponInfoContext.VueRouter,e.PlatformCouponInfoContext.ElementPlus,e.PlatformCouponInfoContext.VueUse,e.PlatformCouponInfoContext.DateUtil,e.PlatformCouponInfoContext.UseConvert,e.PlatformCouponInfoContext.Request,e.PlatformCouponInfoContext.GoodAPI))})(this,function(e,u,g,k,v,b,P,U){"use strict";var w=document.createElement("style");w.textContent=`@charset "UTF-8";.scroll[data-v-acb4af53]{overflow:scroll;padding-left:16px;padding-right:16px;margin-top:30px}.tool[data-v-acb4af53]{margin-top:auto;align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:9}.title[data-v-acb4af53]{font-size:14px;color:#606266;font-weight:700;margin-bottom:30px}.msg[data-v-acb4af53]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-acb4af53]{display:flex;justify-content:space-between}.rules__input[data-v-acb4af53]{width:50%}.period-validity[data-v-acb4af53]{width:300px;display:flex}.text[data-v-acb4af53]{font-size:14px;color:#333}.goodsData[data-v-acb4af53]{border:1px solid #ccc}.goods-list[data-v-acb4af53]{width:90%;margin-top:40px;height:360px;border:1px solid transparent}.goods-list__info[data-v-acb4af53]{display:flex}.goods-list__goods-list__info-name[data-v-acb4af53]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-acb4af53]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-acb4af53]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-acb4af53]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-acb4af53]{font-size:16px}.ruleform-date[data-v-acb4af53]{width:100%;display:flex}.nav-button[data-v-acb4af53]{position:fixed;bottom:50px;left:50%}
`,document.head.appendChild(w);const{divTenThousand:S,mulTenThousand:ee}=b(),E={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var I=(n=>(n.PERIOD="PERIOD",n.IMMEDIATELY="IMMEDIATELY",n))(I||{}),h=(n=>(n.ALL="ALL",n.SHOP_ALL="SHOP_ALL",n.ASSIGNED="ASSIGNED",n.ASSIGNED_NOT="ASSIGNED_NOT",n))(h||{});function D(n){return n?S(n).toString():""}function R(n){const{name:m,days:s,type:p,endDate:i,productIds:o,productType:f,requiredAmount:x,discount:_,amount:d,effectType:t,startDate:r,num:a,limit:c,id:C,shopId:N}=n;return{shopId:N,id:C,name:m,days:s,endDate:i,productType:f,type:p,requiredAmount:D(x).toString(),discount:_,amount:D(d),effectType:t,startDate:r,num:a,limit:c,productIds:o}}const A=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:m}){const s=n,p=m,i=k.useVModel(s,"modelValue",p);return(o,f)=>{const x=e.resolveComponent("el-option"),_=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(_,{modelValue:e.unref(i),"onUpdate:modelValue":f[0]||(f[0]=d=>e.isRef(i)?i.value=d:null),placeholder:s.placeholder,style:{width:"150px"},onChange:f[1]||(f[1]=d=>p("change",d))},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(s.list).length?s.list:e.unref(E),(d,t)=>(e.openBlock(),e.createBlock(x,{key:t,label:d,value:t},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),B=(n,m)=>P.get({url:`addon-coupon/coupon/shop/${n}/${m}`}),q={class:"q_plugin_container"},L={class:"scroll"},M={key:0,class:"ruleform-date"},O={class:"period-validity text"},Y={class:"rules"},z={class:"rules"},G={key:2,class:"rules",style:{"justify-content":"center"}},$={key:3,class:"rules",style:{"justify-content":"center"}},j={class:"goods-list__info"},F={class:"goods-list__goods-list__info-name"},H={class:"goods-list__goods-list__info-name--name"},Q={class:"goods-list__goods-list__info-name--price"},W={class:"tool"},J=e.defineComponent({__name:"PlatformCouponInfo",setup(n){const{divTenThousand:m}=b(),s=u.useRouter(),p=u.useRoute(),i=e.ref([]),o=e.ref({name:"",days:"",endDate:"",productType:h.ALL,type:"PRICE_DISCOUNT",requiredAmount:"",discount:"",amount:"",effectType:I.PERIOD,startDate:"",num:"",limit:"",shopId:"",productIds:[]});f();async function f(){if(p.query.id&&p.query.shopId){const{code:d,data:t}=await B(p.query.shopId.toString(),p.query.id.toString());if(d!==200){g.ElMessage.error("获取优惠券信息失败");return}o.value=R(t),_(t);return}}function x(d){const t=Math.max(...d.map(a=>Number(a))),r=Math.min(...d.map(a=>Number(a)));return`${m(r)}~${m(t)}`}async function _(d){if(d.productIds&&d.productIds.length){const{code:t,data:r}=await U.doGetRetrieveProduct({productId:d.productIds});if(t!==200){g.ElMessage.error("获取商品信息失败");return}i.value=r.list.map(a=>({...a,name:a.productName,salePrice:x(a.salePrices||[]),isCheck:!0})),console.log("goodsData.value",i.value)}}return(d,t)=>{const r=e.resolveComponent("el-input"),a=e.resolveComponent("el-form-item"),c=e.resolveComponent("el-radio"),C=e.resolveComponent("el-radio-group"),N=e.resolveComponent("el-row"),y=e.resolveComponent("el-date-picker"),V=e.resolveComponent("el-table-column"),T=e.resolveComponent("el-table"),K=e.resolveComponent("el-image"),X=e.resolveComponent("el-form"),Z=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("div",L,[t[33]||(t[33]=e.createElementVNode("h1",{class:"title"},"基本信息",-1)),e.createVNode(X,{"inline-message":!1,model:o.value,"validate-on-rule-change":!1,"label-width":"auto"},{default:e.withCtx(()=>[e.createVNode(a,{label:"优惠券名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.name=l),modelModifiers:{trim:!0},disabled:"",maxlength:"5",placeholder:"请输入优惠券名称",style:{width:"551px"}},null,8,["modelValue"]),t[16]||(t[16]=e.createElementVNode("span",{class:"msg"},"优惠券名称不超过5个字",-1))]),_:1}),e.createVNode(a,{label:"有效时间",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(N,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(C,{modelValue:o.value.effectType,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.effectType=l),class:"ml-4",disabled:""},{default:e.withCtx(()=>[e.createVNode(c,{value:"PERIOD"},{default:e.withCtx(()=>t[17]||(t[17]=[e.createTextVNode("固定时间")])),_:1}),e.createVNode(c,{value:"IMMEDIATELY"},{default:e.withCtx(()=>t[18]||(t[18]=[e.createTextVNode("领券立即生效")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(N,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[o.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",M,[e.createVNode(a,{"inline-message":!1,"label-width":"0",prop:"startDate"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:o.value.startDate,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.startDate=l),disabled:"",format:"YYYY/MM/DD",placeholder:"请选择开始时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t[19]||(t[19]=e.createElementVNode("span",{style:{margin:"0 10px"}},"至",-1))]),_:1}),e.createVNode(a,{"inline-message":!1,"label-width":"0",prop:"endDate"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:o.value.endDate,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.endDate=l),disabled:"",format:"YYYY/MM/DD",placeholder:"请选择结束时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})])):(e.openBlock(),e.createBlock(a,{key:1,"label-width":"0",prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",O,[t[20]||(t[20]=e.createTextVNode(" 领券当日起 ")),e.createVNode(r,{modelValue:o.value.days,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.days=l),disabled:"",style:{width:"20%",margin:"0 5px"}},null,8,["modelValue"]),t[21]||(t[21]=e.createTextVNode(" 天内可用 "))])]),_:1}))]),_:1})]),_:1}),e.createVNode(a,{label:"活动规则",prop:"type"},{default:e.withCtx(()=>[e.createVNode(T,{data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(V,{label:"选择优惠券类型"},{default:e.withCtx(()=>[e.createVNode(a,{"label-width":"0",prop:"type"},{default:e.withCtx(()=>[e.createVNode(A,{modelValue:o.value.type,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.type=l),list:e.unref(E),disabled:"",placeholder:"全部类型"},null,8,["modelValue","list"])]),_:1})]),_:1}),e.createVNode(V,{label:"优惠券规则",width:"240"},{default:e.withCtx(()=>[o.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(a,{key:0,"label-width":"0",prop:"discount"},{default:e.withCtx(()=>[e.createElementVNode("div",Y,[e.createVNode(r,{modelValue:o.value.discount,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.discount=l),disabled:"",style:{flex:"1"}},null,8,["modelValue"]),t[22]||(t[22]=e.createElementVNode("span",{style:{"margin-left":"10px"}},"折，无门槛使用",-1))])]),_:1})):e.createCommentVNode("",!0),o.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(a,{key:1,"label-width":"0",prop:"amount"},{default:e.withCtx(()=>[e.createElementVNode("div",z,[e.createVNode(r,{modelValue:o.value.amount,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.amount=l),disabled:"",style:{flex:"1"}},null,8,["modelValue"]),t[23]||(t[23]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元，无门槛使用",-1))])]),_:1})):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",G,[e.createVNode(a,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[24]||(t[24]=e.createElementVNode("span",null,"满",-1)),e.createVNode(r,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.requiredAmount=l),disabled:"",style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(a,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[t[25]||(t[25]=e.createElementVNode("span",null,"元,打",-1)),e.createVNode(r,{modelValue:o.value.discount,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.discount=l),disabled:"",style:{width:"50%","margin-left":"5px"}},null,8,["modelValue"]),t[26]||(t[26]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"折",-1))]),_:1})])):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",$,[e.createVNode(a,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[27]||(t[27]=e.createElementVNode("span",null,"满",-1)),e.createVNode(r,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.requiredAmount=l),disabled:"",style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(a,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[t[28]||(t[28]=e.createElementVNode("span",null,"元,减",-1)),e.createVNode(r,{modelValue:o.value.amount,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.amount=l),disabled:"",style:{width:"50%","margin-left":"5px"}},null,8,["modelValue"]),t[29]||(t[29]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元",-1))]),_:1})])):e.createCommentVNode("",!0)]),_:1}),e.createVNode(V,{label:"发行量（张）"},{default:e.withCtx(()=>[e.createVNode(a,{"label-width":"0",prop:"num"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.num,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.num=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(V,{label:"限领（张）"},{default:e.withCtx(()=>[e.createVNode(a,{"label-width":"0",prop:"num"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.limit,"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.limit=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(a,{label:"商品选择",prop:"productType"},{default:e.withCtx(()=>[e.createVNode(C,{modelValue:o.value.productType,"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.productType=l),disabled:""},{default:e.withCtx(()=>[e.createVNode(c,{value:"SHOP_ALL"},{default:e.withCtx(()=>t[30]||(t[30]=[e.createTextVNode("全部商品参与")])),_:1}),e.createVNode(c,{value:"ASSIGNED"},{default:e.withCtx(()=>t[31]||(t[31]=[e.createTextVNode("指定商品参与")])),_:1}),e.createVNode(c,{value:"ASSIGNED_NOT"},{default:e.withCtx(()=>t[32]||(t[32]=[e.createTextVNode("指定商品不参与")])),_:1})]),_:1},8,["modelValue"]),e.createElementVNode("div",{class:e.normalizeClass([i.value.length&&"goodsData","goods-list"])},[o.value.productType!=="SHOP_ALL"?(e.openBlock(),e.createBlock(T,{key:0,data:i.value,"header-cell-style":{fontSize:"14px",color:"#606266",background:"#f2f2f2",height:"54px",fontWeight:"normal"},height:"360px",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(V,{label:"商品信息"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",j,[e.createVNode(K,{"preview-src-list":[l.pic],"preview-teleported":!0,src:l.pic,fit:"fit",style:{width:"60px",height:"60px"}},null,8,["preview-src-list","src"]),e.createElementVNode("div",F,[e.createElementVNode("div",H,e.toDisplayString(l.name),1),e.createElementVNode("div",Q,e.toDisplayString(l.salePrice),1)])])]),_:1}),e.createVNode(V,{label:"操作",width:"80px"})]),_:1},8,["data"])):e.createCommentVNode("",!0)],2)]),_:1})]),_:1},8,["model"])]),e.createElementVNode("div",W,[e.createVNode(Z,{plain:"",round:"",onClick:t[15]||(t[15]=l=>e.unref(s).back())},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("返回")])),_:1})])])}}}),te="";return((n,m)=>{const s=n.__vccOpts||n;for(const[p,i]of m)s[p]=i;return s})(J,[["__scopeId","data-v-acb4af53"]])});
