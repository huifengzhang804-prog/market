(function(e,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("vue-router"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/utils/date"),require("@/composables/useConvert"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus")):typeof define=="function"&&define.amd?define(["vue","vue-router","@vueuse/core","@/components/SchemaForm.vue","@/utils/date","@/composables/useConvert","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus"],_):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopCouponList=_(e.ShopCouponListContext.Vue,e.ShopCouponListContext.VueRouter,e.ShopCouponListContext.VueUse,e.ShopCouponListContext.SchemaForms,e.ShopCouponListContext.DateUtil,e.ShopCouponListContext.UseConvert,e.ShopCouponListContext.PageManage,e.ShopCouponListContext.Request,e.ShopCouponListContext.ElementPlus))})(this,function(e,_,T,L,U,R,O,x,u){"use strict";var S=document.createElement("style");S.textContent=`.name[data-v-74f8f968]{width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[data-v-74f8f968] .el-button.is-link{padding:0}[data-v-74f8f968] .el-button+.el-button{margin-left:10px}*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.fixed{position:fixed}.hidden{display:none}
`,document.head.appendChild(S);const P=e.defineComponent({__name:"head-operation",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(o,{emit:d}){const c=[{label:"活动名称",prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{label:"全部状态",value:""},{label:"未开始",value:"NOT_OPEN"},{label:"进行中",value:"OPEN"},{label:"已结束",value:"CLOSED"},{label:"已下架",value:"SHOP_BANED"},{label:"违规下架",value:"BANED"}],fieldProps:{placeholder:"请选择"}},{label:"优惠券类型",labelWidth:"90",prop:"type",valueType:"select",options:[{label:"全部优惠劵",value:""},{label:"无门槛折扣券",value:"PRICE_DISCOUNT"},{label:"无门槛现金券",value:"PRICE_REDUCE"},{label:"满折券",value:"REQUIRED_PRICE_DISCOUNT"},{label:"满减券",value:"REQUIRED_PRICE_REDUCE"}],fieldProps:{placeholder:"请选择"}}],f=o,p=d,m=T.useVModel(f,"modelValue",p),C=s=>{s&&Object.keys(s).forEach(r=>f.modelValue[r]=s[r])},g=()=>{Object.keys(f.modelValue).forEach(s=>f.modelValue[s]=""),p("search")};return(s,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(L,{"v-model":e.unref(m),columns:c,"has-unfold":"",onSearchHandle:r[0]||(r[0]=E=>p("search")),onChangeFormItem:C,onHandleReset:g},null,8,["v-model"]),r[1]||(r[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}});R();const w={NOT_OPEN:"未开始",OPEN:"进行中",CLOSED:"已结束",SHOP_BANED:"已下架",BANED:"违规下架"},M={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var b=(o=>(o.PRICE_REDUCE="PRICE_REDUCE",o.PRICE_DISCOUNT="PRICE_DISCOUNT",o.REQUIRED_PRICE_REDUCE="REQUIRED_PRICE_REDUCE",o.REQUIRED_PRICE_DISCOUNT="REQUIRED_PRICE_DISCOUNT",o))(b||{});const z=o=>{const d=new U;return o.status!=="OK"?w[o.status]:o.status==="SHOP_BANED"?"已下架":o.effectType==="PERIOD"&&o.endDate>=d.getYMDs()?o.stock==="0"?"已结束":o.startDate>d.getYMDs()?"未开始":"进行中":o.effectType==="PERIOD"&&o.endDate<d.getYMDs()?"已结束":o.effectType==="IMMEDIATELY"?o.stock!=="0"?"进行中":"已结束":""},A="addon-coupon/coupon/",q=o=>x.get({url:"addon-coupon/coupon",params:o}),I=o=>x.del({url:"addon-coupon/coupon/shop/batch",data:o}),$=o=>x.put({url:"addon-coupon/coupon/shop/offShelf",data:o}),F=o=>x.get({url:`${A}illegal/${o}/reason`}),Q={class:"handle_container",style:{"padding-top":"16px"}},H={class:"table_container"},j={class:"name"},Y={key:0},G={key:1},K={key:2},W={key:3},J={key:0,class:"fdc"},X={key:1},Z=e.defineComponent({__name:"coupon-list",props:{search:{type:Object,default:()=>({})},batchDisabled:{type:Boolean,default:!0}},emits:["addCoupon","delCoupon"],setup(o,{expose:d,emit:c}){const f=_.useRouter(),p=o,{divTenThousand:m}=R(),C=e.ref([]),g=e.ref(),s=e.ref({size:10,current:1,total:0}),r=e.ref([]),E=c;function D(a,n){return Object.keys(a).filter(l=>a[l]!==n[l])}e.watch(()=>({...p.search}),(a,n)=>{D(a,n).includes("keywords")||h()},{deep:!0});async function h(){const{status:a,type:n,keywords:l}=p.search;let i={status:a,type:n,keywords:l};const y={...s.value,...i},{code:k,data:t}=await q(y);if(k!==200)return u.ElMessage.error("获取优惠券列表失败");C.value=t.records,s.value.current=t.current,s.value.size=t.size,s.value.total=t.total}h();const B=(a,n)=>{f.push({path:"/coupons/baseInfo",query:{id:a.id,shopId:a.shopId,isLookUp:n}})},V=e.ref(""),te=async a=>{const{data:n}=await F(a.id);V.value=n},ne=async a=>{if(!await u.ElMessageBox.confirm("确定下架该优惠券?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{shopId:l,id:i}=a,{success:y}=await $({shopId:l,couponId:i});y?(u.ElMessage.success("下架成功"),h()):u.ElMessage.error("下架失败")},oe=async a=>{if(!await u.ElMessageBox.confirm("确定删除该优惠券?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{msg:l,code:i,data:y}=await I([a]);if(i!==200){u.ElMessage.error(l||"删除失败");return}u.ElMessage.success("删除成功"),C.value=C.value.filter(k=>k.id!==a)},ae=a=>{r.value=a},se=async a=>{const{msg:n,code:l,data:i}=await I(a);if(l!==200){u.ElMessage.error(n||"删除失败");return}u.ElMessage.success("删除成功"),h()},le=a=>{s.value.size=a,h()},re=a=>{s.value.current=a,h()};return d({chooseList:r,handleDelBatch:se,initCouponList:h,multipleTableRef:g}),(a,n)=>{const l=e.resolveComponent("el-button"),i=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-popover"),k=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Q,[e.createVNode(l,{round:"",type:"primary",onClick:n[0]||(n[0]=t=>E("addCoupon"))},{default:e.withCtx(()=>n[2]||(n[2]=[e.createTextVNode("新增优惠券")])),_:1}),e.createVNode(l,{disabled:p.batchDisabled,round:"",onClick:n[1]||(n[1]=t=>E("delCoupon"))},{default:e.withCtx(()=>n[3]||(n[3]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",H,[e.createVNode(k,{ref_key:"multipleTableRef",ref:g,"cell-style":{color:"#333333"},data:C.value,"header-cell-style":{background:"#F7F8FA",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:ae},{default:e.withCtx(()=>[e.createVNode(i,{type:"selection",width:"40",fixed:"left",selectable:t=>!["进行中"].includes(t.statusText)},null,8,["selectable"]),e.createVNode(i,{label:"优惠券名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",j,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(i,{label:"优惠券类型",width:"130"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(e.unref(M)[t.type]),1)]),_:1}),e.createVNode(i,{label:"使用规则",width:"170"},{default:e.withCtx(({row:t})=>[t.type===e.unref(b).PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",Y,[e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(m)(t.amount)),1),n[4]||(n[4]=e.createElementVNode("span",null,"元，无门槛使用",-1))])):e.createCommentVNode("",!0),t.type===e.unref(b).PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",G,[e.createElementVNode("span",null,e.toDisplayString(t.discount),1),n[5]||(n[5]=e.createElementVNode("span",null,"折，无门槛使用",-1))])):e.createCommentVNode("",!0),t.type===e.unref(b).REQUIRED_PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",K,[n[6]||(n[6]=e.createElementVNode("span",null,"满",-1)),e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(m)(t.requiredAmount)),1),n[7]||(n[7]=e.createElementVNode("span",null,"元，打",-1)),e.createElementVNode("span",null,e.toDisplayString(t.discount),1),n[8]||(n[8]=e.createElementVNode("span",null,"折",-1))])):e.createCommentVNode("",!0),t.type===e.unref(b).REQUIRED_PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",W,[n[9]||(n[9]=e.createElementVNode("span",null,"满",-1)),e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(m)(t.requiredAmount)),1),n[10]||(n[10]=e.createElementVNode("span",null,"元，减",-1)),e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(m)(t.amount)),1),n[11]||(n[11]=e.createElementVNode("span",null,"元",-1))])):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(t.rules),1)]),_:1}),e.createVNode(i,{label:"状态",prop:"address",width:"90"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",{style:e.normalizeStyle({color:t.status==="BANED"?"#F54319":t.status==="SHOP_BANED"||t.status==="OK"?"#999":""})},e.toDisplayString(t.statusText),5)]),_:1}),e.createVNode(i,{label:"有效期",width:"210"},{default:e.withCtx(({row:t})=>[t.startDate?(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startDate),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endDate),1)])):(e.openBlock(),e.createElementBlock("div",X,[e.createElementVNode("div",null,"领券当日起"+e.toDisplayString(t.days)+"天内可用",1)]))]),_:1}),e.createVNode(i,{label:"已领取",prop:"date"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.num-t.stock),1)]),_:1}),e.createVNode(i,{label:"剩余",prop:"date"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.stock),1)]),_:1}),e.createVNode(i,{label:"已使用",prop:"usedCount"}),e.createVNode(i,{fixed:"right",label:"操作",prop:"address",align:"right",width:"180"},{default:e.withCtx(({row:t})=>[e.createVNode(l,{link:"",type:"primary",onClick:N=>B(t,"true")},{default:e.withCtx(()=>n[12]||(n[12]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),["未开始"].includes(t.statusText)?(e.openBlock(),e.createBlock(l,{key:0,link:"",type:"primary",onClick:N=>B(t,"true")},{default:e.withCtx(()=>n[13]||(n[13]=[e.createTextVNode("编辑 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(y,{placement:"bottom-start",width:V.value.length>32?440:"",trigger:"hover",effect:"dark",content:V.value,onShow:N=>te(t)},{reference:e.withCtx(()=>[t.statusText==="违规下架"?(e.openBlock(),e.createBlock(l,{key:0,link:"",type:"primary"},{default:e.withCtx(()=>n[14]||(n[14]=[e.createTextVNode("违规原因")])),_:1})):e.createCommentVNode("",!0)]),_:2},1032,["width","content","onShow"]),["进行中"].includes(t.statusText)?(e.openBlock(),e.createBlock(l,{key:1,link:"",type:"primary",onClick:N=>ne(t)},{default:e.withCtx(()=>n[15]||(n[15]=[e.createTextVNode("下架 ")])),_:2},1032,["onClick"])):(e.openBlock(),e.createBlock(l,{key:2,link:"",type:"danger",onClick:N=>oe(t.id)},{default:e.withCtx(()=>n[16]||(n[16]=[e.createTextVNode("删除")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),e.createVNode(O,{"page-size":s.value.size,total:s.value.total,"page-num":s.value.current,onHandleSizeChange:le,onHandleCurrentChange:re},null,8,["page-size","total","page-num"])],64)}}}),ie="",v=((o,d)=>{const c=o.__vccOpts||o;for(const[f,p]of d)c[f]=p;return c})(Z,[["__scopeId","data-v-74f8f968"]]),de="",ee={class:"q_plugin_container"};return e.defineComponent({__name:"ShopCouponList",setup(o){const d=e.ref({status:"",type:"",keywords:""}),c=e.ref(),f=_.useRouter(),p=e.computed(()=>c.value?!c.value.chooseList.length:!0),m=()=>{c.value.initCouponList()},C=()=>{if(c.value.chooseList.find(r=>z(r)==="进行中")){u.ElMessage({message:"进行中的优惠券无法删除",type:"warning"});return}u.ElMessageBox.confirm("是否批量删除选中的优惠券",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const r=c.value.chooseList.map(E=>E.id);c.value.handleDelBatch(r)})},g=()=>f.push("/coupons/baseInfo");return(s,r)=>{const E=e.resolveComponent("el-config-provider");return e.openBlock(),e.createElementBlock("div",ee,[e.createVNode(E,{"value-on-clear":"","empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(P,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=D=>d.value=D),onSearch:m},null,8,["modelValue"])]),_:1}),e.createVNode(v,{ref_key:"couponListRef",ref:c,search:d.value,"batch-disabled":p.value,onAddCoupon:g,onDelCoupon:C},null,8,["search","batch-disabled"])])}}})});
