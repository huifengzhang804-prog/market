(function(e,m){typeof exports=="object"&&typeof module<"u"?module.exports=m(require("vue"),require("@/components/q-mapcity/q-mapcity.vue"),require("@/store/modules/shopInfo"),require("element-plus"),require("@/apis/http"),require("@/components/q-input-number/q-input-number.vue")):typeof define=="function"&&define.amd?define(["vue","@/components/q-mapcity/q-mapcity.vue","@/store/modules/shopInfo","element-plus","@/apis/http","@/components/q-input-number/q-input-number.vue"],m):(e=typeof globalThis<"u"?globalThis:e||self,e.CityDistribution=m(e.CityDistributionContext.Vue,e.CityDistributionContext.QMapcity,e.CityDistributionContext.ShopInfoStore,e.CityDistributionContext.ElementPlus,e.CityDistributionContext.Request,e.CityDistributionContext.QInputNumber))})(this,function(e,m,C,n,p,u){"use strict";var x=document.createElement("style");x.textContent=`@charset "UTF-8";.main[data-v-8b58353d]{padding:20px 30px;overflow-y:auto}.save[data-v-8b58353d]{background-color:#fff;height:60px;box-shadow:0 0 2px #00000012;display:flex;justify-content:center;align-items:center}.save__btn[data-v-8b58353d]{width:188px;height:32px;border-radius:16px;font-size:14px;color:#fff}.red-text[data-v-8b58353d]{color:red;font-size:14px;font-weight:700}.form-area[data-v-8b58353d]{width:50px;height:20px;border:1px solid #e2e2e2;border-radius:4px;text-align:center;line-height:20px}.form-control[data-v-8b58353d]{display:flex;align-items:center}.form-count[data-v-8b58353d]{width:20px;height:20px;border:1px solid #e2e2e2;border-radius:4px;text-align:center;line-height:20px;margin:0 5px;cursor:pointer;-webkit-user-select:none;user-select:none}.ruleForm__name[data-v-8b58353d]{width:466px}.ruleForm__desc[data-v-8b58353d]{width:667px}.ruleForm__center[data-v-8b58353d]{width:1007px;height:31px;line-height:31px;background:#fcf8f8;font-size:13px;font-family:-apple-system,-apple-system-Bold;font-weight:700;text-align:LEFT;color:#0c0b0b;margin-bottom:22px}.ruleForm__item[data-v-8b58353d]{width:141px;height:30px;line-height:30px;display:flex;padding-right:0}.ruleForm__item[data-v-8b58353d] .el-input__wrapper{padding-right:0}.ruleForm__item--span[data-v-8b58353d]{display:block;width:38px;line-height:30px;color:#333;background:#f7f7f7;border-radius:0 4px 4px 0}.ruleForm__tip[data-v-8b58353d]{width:390px;height:20px;font-size:14px;color:#d0caca;line-height:20px;margin-left:25px}.rates[data-v-8b58353d]{display:flex;align-items:center;justify-content:start;margin-left:-10px}.rates__span[data-v-8b58353d]{padding:5px}.radio_box[data-v-8b58353d]{flex-direction:column}.radio_box>div[data-v-8b58353d]{display:flex;align-items:center}.explain[data-v-8b58353d]{display:flex;flex-direction:column;padding-left:100px;font-size:13px;color:#bcbbbb;line-height:25px;margin-bottom:20px}.explain__span[data-v-8b58353d]{margin-left:20px}[data-v-8b58353d] .mo-input--number{border:none}[data-v-8b58353d] .ruleForm__rates .el-form-item__content{flex-direction:column;align-items:start}
`,document.head.appendChild(x);const N=a=>p.post({url:"addon-intra-city-distribution/intraCityDistribution/config/add/intraCityDistributionConfig",data:a}),w=()=>p.get({url:"addon-intra-city-distribution/intraCityDistribution/config"}),E=a=>p.put({url:"addon-intra-city-distribution/intraCityDistribution/config/update/intraCityDistributionConfig",data:a}),h=a=>p.get({url:`gruul-mall-shop/shop/info/${a}`}),v={class:"main"},k={class:"form-control"},F={class:"form-area"},D={style:{"margin-left":"10px"}},B={key:0,class:"rates"},I={key:1,class:"rates"},q={key:1,style:{height:"50px"}},T={class:"save"},R=e.defineComponent({__name:"CityDistribution",setup(a){const f=C.useShopInfoStore(),s=e.ref({address:"",location:[]}),o=e.ref({isDefault:!1,id:"",deliveryRange:30,description:"",initialDeliveryCharge:0,deliveryCost:0,rates:"DISTANCE",ratesrule:"按距离收费",billingPrimacy:0,everyBilling:0,deliveryCostBilling:0,isDeliveryRelief:!1,orderMitigateCost:0,createTime:"",deleted:!1,updateTime:"",version:0,shopId:""}),c=e.reactive({deliveryRange:[{required:!0,message:"请输入配送范围",trigger:"change"}],initialDeliveryCharge:[{required:!0,message:"请输入起送金额",trigger:"change"}],deliveryCost:[{required:!0,message:"请输入基础配送费用",trigger:"change"}],rates:[{required:!0}]});e.onMounted(async()=>{await M(),await V()});const M=async()=>{const i=f.shopInfo.shopId,t=await h(i);t.code===200&&(s.value.address=t.data.address,s.value.location=t.data.location.coordinates)},g=i=>{if(o.value.deliveryRange===1&&i==="-"){n.ElMessage.warning("配送范围不能小于1km");return}if(o.value.deliveryRange===50&&i==="+"){n.ElMessage.warning("限50km(含)以内");return}i==="+"?o.value.deliveryRange++:o.value.deliveryRange--},y=e.ref(),S=async i=>{o.value.ratesrule==="按距离收费"?o.value.rates="DISTANCE":o.value.rates="WEIGHT",i&&await i.validate(async(t,r)=>{t?o.value.id===""?(await U(o.value),V()):z(o.value):(console.log("error submit!",r),n.ElMessage.error(r.name[0].message))})},U=async i=>{if((await N(i)).code===200)return n.ElMessage.success("保存成功");n.ElMessage.error(i.msg||"保存失败")},V=async()=>{const i=await w();i.code===200&&(o.value={...i.data},o.value.rates==="DISTANCE"?o.value.ratesrule="按距离收费":o.value.ratesrule="按重量收费")},z=async i=>{const t=await E(i);if(t.code===200)return n.ElMessage.success("编辑成功");n.ElMessage.error(t.msg||"编辑失败")};return(i,t)=>{const r=e.resolveComponent("el-form-item"),d=e.resolveComponent("el-input"),b=e.resolveComponent("el-radio"),G=e.resolveComponent("el-radio-group"),_=e.resolveComponent("el-tooltip"),j=e.resolveComponent("el-switch"),A=e.resolveComponent("el-form"),O=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",v,[e.createVNode(A,{ref_key:"ruleFormRef",ref:y,model:o.value,rules:c,class:"ruleForm","label-position":"right","label-width":"100px",size:"default"},{default:e.withCtx(()=>[e.createVNode(r,{label:"店铺定位地址"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.value.address),1)]),_:1}),e.createVNode(r,{label:"配送范围",prop:"deliveryRange"},{default:e.withCtx(()=>[e.createElementVNode("div",k,[e.createElementVNode("div",{class:"form-count",onClick:t[0]||(t[0]=()=>g("-"))},"-"),e.createElementVNode("div",F,e.toDisplayString(o.value.deliveryRange+"km"),1),e.createElementVNode("div",{class:"form-count",onClick:t[1]||(t[1]=()=>g("+"))},"+"),t[16]||(t[16]=e.createTextVNode(" 【限50km(含)以内】 "))])]),_:1}),e.createVNode(r,null,{default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(m,{zoom:9.5,area:o.value.deliveryRange,coordinates:s.value.location},null,8,["area","coordinates"]),t[17]||(t[17]=e.createElementVNode("span",{style:{color:"#666"}},"以店铺定位地址为中心，设置周围 多少 公里为配送范围内",-1))])]),_:1}),e.createVNode(r,{label:"配送说明",prop:"description"},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:o.value.description,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.description=l),placeholder:"限100字以内",rows:4,class:"ruleForm__desc",maxlength:"100",resize:"none",type:"textarea"},null,8,["modelValue"])]),_:1}),e.createVNode(r,{label:"起送金额",prop:"initialDeliveryCharge"},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:o.value.initialDeliveryCharge,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.initialDeliveryCharge=l),modelModifiers:{number:!0},class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[18]||(t[18]=[e.createElementVNode("span",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"]),t[19]||(t[19]=e.createElementVNode("div",{class:"ruleForm__tip"},"订单实付金额要大于等于该数值才能满足同城配送条件",-1))]),_:1}),e.createVNode(r,{label:"基础配送费",prop:"deliveryCost"},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:o.value.deliveryCost,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.deliveryCost=l),modelModifiers:{number:!0},class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[20]||(t[20]=[e.createElementVNode("span",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"])]),_:1}),e.createVNode(r,{label:"计费方式",prop:"rates",class:"ruleForm__rates"},{default:e.withCtx(()=>[e.createVNode(G,{modelValue:o.value.ratesrule,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.ratesrule=l),onChange:t[6]||(t[6]=()=>{o.value.billingPrimacy=0,o.value.everyBilling=1,o.value.deliveryCostBilling=1})},{default:e.withCtx(()=>[e.createVNode(b,{value:"按距离收费",label:"按距离收费"},null,8,["value"]),e.createVNode(b,{value:"按重量收费",label:"按重量收费"},null,8,["value"])]),_:1},8,["modelValue"]),e.createElementVNode("div",D,[o.value.ratesrule==="按距离收费"?(e.openBlock(),e.createElementBlock("div",B,[e.createVNode(d,{modelValue:o.value.billingPrimacy,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.billingPrimacy=l),class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[21]||(t[21]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"km",-1)])),_:1},8,["modelValue"]),t[26]||(t[26]=e.createElementVNode("span",{class:"rates__span"},"内不额外收费，每超出",-1)),e.createVNode(u,{modelValue:o.value.everyBilling,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.everyBilling=l),controls:!1,min:1,class:"ruleForm__item"},{append:e.withCtx(()=>t[22]||(t[22]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"km",-1)])),_:1},8,["modelValue"]),t[27]||(t[27]=e.createElementVNode("span",{class:"rates__span"},"，增加",-1)),e.createVNode(d,{modelValue:o.value.deliveryCostBilling,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.deliveryCostBilling=l),class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[23]||(t[23]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"]),e.createVNode(_,{class:"box-item",effect:"dark",placement:"top"},{content:e.withCtx(()=>t[24]||(t[24]=[e.createElementVNode("div",{style:{width:"440px","font-size":"14px",padding:"4px"}},[e.createTextVNode(" 1、配送费 = 基础配送费 + 超距收费 （小于配送费减免金额）"),e.createElementVNode("br"),e.createTextVNode(" 2、以店铺定位地址为中心，因考虑实际送货路况，配送费计算按骑行距离，非地图直线距离"),e.createElementVNode("br"),e.createTextVNode(" 3、不足 1 km 按1 km计算 ")],-1)])),default:e.withCtx(()=>[t[25]||(t[25]=e.createElementVNode("i",{class:"iconfont icon-wenhao",style:{color:"#999","font-size":"20px","margin-left":"10px"}},null,-1))]),_:1})])):(e.openBlock(),e.createElementBlock("div",I,[e.createVNode(d,{modelValue:o.value.billingPrimacy,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.billingPrimacy=l),class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[28]||(t[28]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"kg",-1)])),_:1},8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("p",{class:"rates__span"},"内不额外收费，每超出",-1)),e.createVNode(u,{modelValue:o.value.everyBilling,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.everyBilling=l),controls:!1,min:1,class:"ruleForm__item"},{append:e.withCtx(()=>t[29]||(t[29]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"kg",-1)])),_:1},8,["modelValue"]),t[34]||(t[34]=e.createElementVNode("p",{class:"rates__span"},"，增加",-1)),e.createVNode(d,{modelValue:o.value.deliveryCostBilling,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.deliveryCostBilling=l),class:"ruleForm__item",maxlength:"6"},{suffix:e.withCtx(()=>t[30]||(t[30]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"]),e.createVNode(_,{class:"box-item",effect:"dark",placement:"bottom"},{content:e.withCtx(()=>t[31]||(t[31]=[e.createElementVNode("div",{style:{width:"404px","font-size":"14px",padding:"4px"}},[e.createTextVNode(" 1、配送费 = 基础配送费 + 续重收费 （小于配送费减免金额）"),e.createElementVNode("br"),e.createTextVNode(" 2、计重收费需设置商品重量 "),e.createElementVNode("br"),e.createTextVNode(" 3、不足 1 kg 按1 kg计算 ")],-1)])),default:e.withCtx(()=>[t[32]||(t[32]=e.createElementVNode("i",{class:"iconfont icon-wenhao",style:{color:"#999","font-size":"20px","margin-left":"10px"}},null,-1))]),_:1})]))])]),_:1}),e.createVNode(r,{label:"配送费减免",prop:"isDeliveryRelief"},{default:e.withCtx(()=>[e.createVNode(j,{modelValue:o.value.isDeliveryRelief,"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.isDeliveryRelief=l),"inline-prompt":"","active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"])]),_:1}),o.value.isDeliveryRelief?(e.openBlock(),e.createBlock(r,{key:0,prop:"orderMitigateCost"},{default:e.withCtx(()=>[t[36]||(t[36]=e.createElementVNode("span",null,"订单实付金额大于等于",-1)),e.createVNode(u,{modelValue:o.value.orderMitigateCost,"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.orderMitigateCost=l),controls:!1,max:999999,class:"ruleForm__item"},{append:e.withCtx(()=>t[35]||(t[35]=[e.createElementVNode("span",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"]),t[37]||(t[37]=e.createElementVNode("span",null,"时，",-1)),t[38]||(t[38]=e.createElementVNode("span",{class:"red-text"},"减免全部配送费",-1))]),_:1})):(e.openBlock(),e.createElementBlock("div",q))]),_:1},8,["model","rules"])]),e.createElementVNode("div",T,[e.createVNode(O,{class:"save__btn",type:"primary",onClick:t[15]||(t[15]=()=>S(y.value))},{default:e.withCtx(()=>t[39]||(t[39]=[e.createTextVNode("保存")])),_:1})])],64)}}}),H="";return((a,f)=>{const s=a.__vccOpts||a;for(const[o,c]of f)s[o]=c;return s})(R,[["__scopeId","data-v-8b58353d"]])});
