(function(e,D){typeof exports=="object"&&typeof module<"u"?module.exports=D(require("vue"),require("vue-router"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/utils/date"),require("@/composables/useConvert"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus")):typeof define=="function"&&define.amd?define(["vue","vue-router","@vueuse/core","@/components/SchemaForm.vue","@/utils/date","@/composables/useConvert","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus"],D):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopCouponList=D(e.ShopCouponListContext.Vue,e.ShopCouponListContext.VueRouter,e.ShopCouponListContext.VueUse,e.ShopCouponListContext.SchemaForms,e.ShopCouponListContext.DateUtil,e.ShopCouponListContext.UseConvert,e.ShopCouponListContext.PageManage,e.ShopCouponListContext.Request,e.ShopCouponListContext.ElementPlus))})(this,function(e,D,T,L,A,U,O,F,d){"use strict";var V=document.createElement("style");V.textContent=`.name[data-v-74f8f968]{width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[data-v-74f8f968] .el-button.is-link{padding:0}[data-v-74f8f968] .el-button+.el-button{margin-left:10px}*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.fixed{position:fixed}.hidden{display:none}
`,document.head.appendChild(V);const k=n=>n&&typeof n=="object"&&"default"in n?n:{default:n},P=k(L),w=k(A),S=k(U),M=k(O),z=e.createElementVNode("div",{class:"grey_bar"},null,-1),q=e.defineComponent({__name:"head-operation",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(n,{emit:i}){const c=[{label:"\u6D3B\u52A8\u540D\u79F0",prop:"keywords",valueType:"copy",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"}},{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status",valueType:"select",options:[{label:"\u5168\u90E8\u72B6\u6001",value:""},{label:"\u672A\u5F00\u59CB",value:"NOT_OPEN"},{label:"\u8FDB\u884C\u4E2D",value:"OPEN"},{label:"\u5DF2\u7ED3\u675F",value:"CLOSED"},{label:"\u5DF2\u4E0B\u67B6",value:"SHOP_BANED"},{label:"\u8FDD\u89C4\u4E0B\u67B6",value:"BANED"}],fieldProps:{placeholder:"\u8BF7\u9009\u62E9"}},{label:"\u4F18\u60E0\u5238\u7C7B\u578B",labelWidth:"90",prop:"type",valueType:"select",options:[{label:"\u5168\u90E8\u4F18\u60E0\u52B5",value:""},{label:"\u65E0\u95E8\u69DB\u6298\u6263\u5238",value:"PRICE_DISCOUNT"},{label:"\u65E0\u95E8\u69DB\u73B0\u91D1\u5238",value:"PRICE_REDUCE"},{label:"\u6EE1\u6298\u5238",value:"REQUIRED_PRICE_DISCOUNT"},{label:"\u6EE1\u51CF\u5238",value:"REQUIRED_PRICE_REDUCE"}],fieldProps:{placeholder:"\u8BF7\u9009\u62E9"}}],E=n,p=i,f=T.useVModel(E,"modelValue",p),h=u=>{u&&Object.keys(u).forEach(r=>E.modelValue[r]=u[r])},g=()=>{Object.keys(E.modelValue).forEach(u=>E.modelValue[u]=""),p("search")};return(u,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(P.default,{"v-model":e.unref(f),columns:c,"has-unfold":"",onSearchHandle:r[0]||(r[0]=C=>p("search")),onChangeFormItem:h,onHandleReset:g},null,8,["v-model"]),z],64))}});S.default();const $={NOT_OPEN:"\u672A\u5F00\u59CB",OPEN:"\u8FDB\u884C\u4E2D",CLOSED:"\u5DF2\u7ED3\u675F",SHOP_BANED:"\u5DF2\u4E0B\u67B6",BANED:"\u8FDD\u89C4\u4E0B\u67B6"},Q={PRICE_DISCOUNT:"\u65E0\u95E8\u69DB\u6298\u6263\u5238",PRICE_REDUCE:"\u65E0\u95E8\u69DB\u73B0\u91D1\u5238",REQUIRED_PRICE_DISCOUNT:"\u6EE1\u6298\u5238",REQUIRED_PRICE_REDUCE:"\u6EE1\u51CF\u5238"};var y=(n=>(n.PRICE_REDUCE="PRICE_REDUCE",n.PRICE_DISCOUNT="PRICE_DISCOUNT",n.REQUIRED_PRICE_REDUCE="REQUIRED_PRICE_REDUCE",n.REQUIRED_PRICE_DISCOUNT="REQUIRED_PRICE_DISCOUNT",n))(y||{});const j=n=>{const i=new w.default;return n.status!=="OK"?$[n.status]:n.status==="SHOP_BANED"?"\u5DF2\u4E0B\u67B6":n.effectType==="PERIOD"&&n.endDate>=i.getYMDs()?n.stock==="0"?"\u5DF2\u7ED3\u675F":n.startDate>i.getYMDs()?"\u672A\u5F00\u59CB":"\u8FDB\u884C\u4E2D":n.effectType==="PERIOD"&&n.endDate<i.getYMDs()?"\u5DF2\u7ED3\u675F":n.effectType==="IMMEDIATELY"?n.stock!=="0"?"\u8FDB\u884C\u4E2D":"\u5DF2\u7ED3\u675F":""},H="addon-coupon/coupon/",Y=n=>F.get({url:"addon-coupon/coupon",params:n}),R=n=>F.del({url:"addon-coupon/coupon/shop/batch",data:n}),G=n=>F.put({url:"addon-coupon/coupon/shop/offShelf",data:n}),K=n=>F.get({url:`${H}illegal/${n}/reason`}),_=n=>(e.pushScopeId("data-v-74f8f968"),n=n(),e.popScopeId(),n),W={class:"handle_container",style:{"padding-top":"16px"}},J={class:"table_container"},X={class:"name"},Z={key:0},v=_(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),ee={key:1},te=_(()=>e.createElementVNode("span",null,"\u6298\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),ne={key:2},oe=_(()=>e.createElementVNode("span",null,"\u6EE1",-1)),ue=_(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u6253",-1)),ae=_(()=>e.createElementVNode("span",null,"\u6298",-1)),se={key:3},le=_(()=>e.createElementVNode("span",null,"\u6EE1",-1)),re=_(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u51CF",-1)),ce=_(()=>e.createElementVNode("span",null,"\u5143",-1)),ie={key:0,class:"fdc"},de={key:1},pe=e.defineComponent({__name:"coupon-list",props:{search:{type:Object,default:()=>({})},batchDisabled:{type:Boolean,default:!0}},emits:["addCoupon","delCoupon"],setup(n,{expose:i,emit:c}){const E=D.useRouter(),p=n,{divTenThousand:f}=S.default(),h=e.ref([]),g=e.ref(),u=e.ref({size:10,current:1,total:0}),r=e.ref([]),C=c;function fe(o,a){return Object.keys(o).filter(s=>o[s]!==a[s])}e.watch(()=>({...p.search}),(o,a)=>{fe(o,a).includes("keywords")||m()},{deep:!0});async function m(){const{status:o,type:a,keywords:s}=p.search;let l={status:o,type:a,keywords:s};const B={...u.value,...l},{code:b,data:t}=await Y(B);if(b!==200)return d.ElMessage.error("\u83B7\u53D6\u4F18\u60E0\u5238\u5217\u8868\u5931\u8D25");h.value=t.records,u.value.current=t.current,u.value.size=t.size,u.value.total=t.total}m();const I=(o,a)=>{E.push({path:"/coupons/baseInfo",query:{id:o.id,shopId:o.shopId,isLookUp:a}})},N=e.ref(""),he=async o=>{const{data:a}=await K(o.id);N.value=a},Ce=async o=>{if(!await d.ElMessageBox.confirm("\u786E\u5B9A\u4E0B\u67B6\u8BE5\u4F18\u60E0\u5238?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}))return;const{shopId:s,id:l}=o,{success:B}=await G({shopId:s,couponId:l});B?(d.ElMessage.success("\u4E0B\u67B6\u6210\u529F"),m()):d.ElMessage.error("\u4E0B\u67B6\u5931\u8D25")},me=async o=>{if(!await d.ElMessageBox.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u4F18\u60E0\u5238?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}))return;const{msg:s,code:l,data:B}=await R([o]);if(l!==200){d.ElMessage.error(s||"\u5220\u9664\u5931\u8D25");return}d.ElMessage.success("\u5220\u9664\u6210\u529F"),h.value=h.value.filter(b=>b.id!==o)},De=o=>{r.value=o},ge=async o=>{const{msg:a,code:s,data:l}=await R(o);if(s!==200){d.ElMessage.error(a||"\u5220\u9664\u5931\u8D25");return}d.ElMessage.success("\u5220\u9664\u6210\u529F"),m()},Be=o=>{u.value.size=o,m()},ye=o=>{u.value.current=o,m()};return i({chooseList:r,handleDelBatch:ge,initCouponList:m,multipleTableRef:g}),(o,a)=>{const s=e.resolveComponent("el-button"),l=e.resolveComponent("el-table-column"),B=e.resolveComponent("el-popover"),b=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",W,[e.createVNode(s,{round:"",type:"primary",onClick:a[0]||(a[0]=t=>C("addCoupon"))},{default:e.withCtx(()=>[e.createTextVNode("\u65B0\u589E\u4F18\u60E0\u5238")]),_:1}),e.createVNode(s,{disabled:p.batchDisabled,round:"",onClick:a[1]||(a[1]=t=>C("delCoupon"))},{default:e.withCtx(()=>[e.createTextVNode("\u6279\u91CF\u5220\u9664")]),_:1},8,["disabled"])]),e.createElementVNode("div",J,[e.createVNode(b,{ref_key:"multipleTableRef",ref:g,"cell-style":{color:"#333333"},data:h.value,"header-cell-style":{background:"#F7F8FA",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:De},{default:e.withCtx(()=>[e.createVNode(l,{type:"selection",width:"40",fixed:"left",selectable:t=>!["\u8FDB\u884C\u4E2D"].includes(t.statusText)},null,8,["selectable"]),e.createVNode(l,{label:"\u4F18\u60E0\u5238\u540D\u79F0",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",X,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(l,{label:"\u4F18\u60E0\u5238\u7C7B\u578B",width:"130"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(e.unref(Q)[t.type]),1)]),_:1}),e.createVNode(l,{label:"\u4F7F\u7528\u89C4\u5219",width:"170"},{default:e.withCtx(({row:t})=>[t.type===e.unref(y).PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(f)(t.amount)),1),v])):e.createCommentVNode("",!0),t.type===e.unref(y).PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",ee,[e.createElementVNode("span",null,e.toDisplayString(t.discount),1),te])):e.createCommentVNode("",!0),t.type===e.unref(y).REQUIRED_PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",ne,[oe,e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(f)(t.requiredAmount)),1),ue,e.createElementVNode("span",null,e.toDisplayString(t.discount),1),ae])):e.createCommentVNode("",!0),t.type===e.unref(y).REQUIRED_PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",se,[le,e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(f)(t.requiredAmount)),1),re,e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(f)(t.amount)),1),ce])):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(t.rules),1)]),_:1}),e.createVNode(l,{label:"\u72B6\u6001",prop:"address",width:"90"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",{style:e.normalizeStyle({color:t.status==="BANED"?"#F54319":t.status==="SHOP_BANED"||t.status==="OK"?"#999":""})},e.toDisplayString(t.statusText),5)]),_:1}),e.createVNode(l,{label:"\u6709\u6548\u671F",width:"210"},{default:e.withCtx(({row:t})=>[t.startDate?(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("div",null,"\u8D77\uFF1A"+e.toDisplayString(t.startDate),1),e.createElementVNode("div",null,"\u6B62\uFF1A"+e.toDisplayString(t.endDate),1)])):(e.openBlock(),e.createElementBlock("div",de,[e.createElementVNode("div",null,"\u9886\u5238\u5F53\u65E5\u8D77"+e.toDisplayString(t.days)+"\u5929\u5185\u53EF\u7528",1)]))]),_:1}),e.createVNode(l,{label:"\u5DF2\u9886\u53D6",prop:"date"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.num-t.stock),1)]),_:1}),e.createVNode(l,{label:"\u5269\u4F59",prop:"date"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.stock),1)]),_:1}),e.createVNode(l,{label:"\u5DF2\u4F7F\u7528",prop:"usedCount"}),e.createVNode(l,{fixed:"right",label:"\u64CD\u4F5C",prop:"address",align:"right",width:"180"},{default:e.withCtx(({row:t})=>[e.createVNode(s,{link:"",type:"primary",onClick:x=>I(t,"true")},{default:e.withCtx(()=>[e.createTextVNode("\u67E5\u770B")]),_:2},1032,["onClick"]),["\u672A\u5F00\u59CB"].includes(t.statusText)?(e.openBlock(),e.createBlock(s,{key:0,link:"",type:"primary",onClick:x=>I(t,"true")},{default:e.withCtx(()=>[e.createTextVNode("\u7F16\u8F91 ")]),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(B,{placement:"bottom-start",width:N.value.length>32?440:"",trigger:"hover",effect:"dark",content:N.value,onShow:x=>he(t)},{reference:e.withCtx(()=>[t.statusText==="\u8FDD\u89C4\u4E0B\u67B6"?(e.openBlock(),e.createBlock(s,{key:0,link:"",type:"primary"},{default:e.withCtx(()=>[e.createTextVNode("\u8FDD\u89C4\u539F\u56E0")]),_:1})):e.createCommentVNode("",!0)]),_:2},1032,["width","content","onShow"]),["\u8FDB\u884C\u4E2D"].includes(t.statusText)?(e.openBlock(),e.createBlock(s,{key:1,link:"",type:"primary",onClick:x=>Ce(t)},{default:e.withCtx(()=>[e.createTextVNode("\u4E0B\u67B6 ")]),_:2},1032,["onClick"])):(e.openBlock(),e.createBlock(s,{key:2,link:"",type:"danger",onClick:x=>me(t.id)},{default:e.withCtx(()=>[e.createTextVNode("\u5220\u9664")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),e.createVNode(M.default,{"page-size":u.value.size,total:u.value.total,"page-num":u.value.current,onHandleSizeChange:Be,onHandleCurrentChange:ye},null,8,["page-size","total","page-num"])],64)}}}),be="",Ee=((n,i)=>{const c=n.__vccOpts||n;for(const[E,p]of i)c[E]=p;return c})(pe,[["__scopeId","data-v-74f8f968"]]),ke="",_e={class:"q_plugin_container"};return e.defineComponent({__name:"ShopCouponList",setup(n){const i=e.ref({status:"",type:"",keywords:""}),c=e.ref(),E=D.useRouter(),p=e.computed(()=>c.value?!c.value.chooseList.length:!0),f=()=>{c.value.initCouponList()},h=()=>{if(c.value.chooseList.find(r=>j(r)==="\u8FDB\u884C\u4E2D")){d.ElMessage({message:"\u8FDB\u884C\u4E2D\u7684\u4F18\u60E0\u5238\u65E0\u6CD5\u5220\u9664",type:"warning"});return}d.ElMessageBox.confirm("\u662F\u5426\u6279\u91CF\u5220\u9664\u9009\u4E2D\u7684\u4F18\u60E0\u5238",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{const r=c.value.chooseList.map(C=>C.id);c.value.handleDelBatch(r)})},g=()=>E.push("/coupons/baseInfo");return(u,r)=>(e.openBlock(),e.createElementBlock("div",_e,[e.createVNode(q,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=C=>i.value=C),onSearch:f},null,8,["modelValue"]),e.createVNode(Ee,{ref_key:"couponListRef",ref:c,search:i.value,"batch-disabled":p.value,onAddCoupon:g,onDelCoupon:h},null,8,["search","batch-disabled"])]))}})});
