(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("vue-router"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue"),require("@/components/schema-form/index.vue")):typeof define=="function"&&define.amd?define(["vue","vue-router","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue","@/components/schema-form/index.vue"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformAppluDiscount=h(e.PlatformAppluDiscountContext.Vue,e.PlatformAppluDiscountContext.VueRouter,e.PlatformAppluDiscountContext.PageManage,e.PlatformAppluDiscountContext.Request,e.PlatformAppluDiscountContext.ElementPlus,e.PlatformAppluDiscountContext.ElTableEmpty,e.PlatformAppluDiscountContext.SchemaForm))})(this,function(e,h,S,F,g,I,D){"use strict";var T=document.createElement("style");T.textContent=`@charset "UTF-8";.name[data-v-8f3d91b3]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.flex_link_container[data-v-8f3d91b3]{display:flex;align-items:center}[data-v-8f3d91b3].el-link+.el-link{margin-left:10px}[data-v-8f3d91b3] .el-dialog__body{padding-bottom:0!important}
`,document.head.appendChild(T);const O="addon-full-reduction/full/reduction",R=o=>F.post({url:`${O}/page`,data:o}),k=o=>F.post({url:`${O}/shelf`,data:o});var p=(o=>(o.NOT_STARTED="NOT_STARTED",o.IN_PROGRESS="IN_PROGRESS",o.FINISHED="FINISHED",o.OFF_SHELF="OFF_SHELF",o.VIOLATION_OFF_SHELF="VIOLATION_OFF_SHELF",o))(p||{});const L={NOT_STARTED:{value:"NOT_STARTED",label:"未开始",style:"nots"},IN_PROGRESS:{value:"IN_PROGRESS",label:"进行中",style:"ongoing"},FINISHED:{value:"FINISHED",label:"已结束",style:"hasEnded"},OFF_SHELF:{value:"OFF_SHELF",label:"已下架",style:"off"},VIOLATION_OFF_SHELF:{value:"VIOLATION_OFF_SHELF",label:"违规下架",style:"off"}},w={style:{padding:"0 16px"},class:"table_container"},A={class:"name"},P={class:"name"},H={class:"name"},B={key:0},z={key:1},q={class:"name"},M={class:"name"},$={class:"name"},U={class:"pagination"},G={class:"dialog-footer"},j=e.defineComponent({__name:"discountList",props:{search:{type:Object,default:()=>({})}},setup(o,{expose:s}){const m=h.useRouter(),_=o,d=e.ref([]),y=e.ref(),i=e.reactive({size:10,current:1,total:0}),r=e.ref(0),f=e.ref([]),V=e.ref(null),c=e.ref({shopId:null,id:"",violation:null}),N=e.ref(!1);async function C(){const a={...i,..._.search},{code:l,data:n}=await R(a);if(l!==200)return g.ElMessage.error("获取满减列表失败");d.value=n.records,i.current=n.current,i.size=n.size,r.value=n.total}const J=a=>{c.value.shopId=a.shopId,c.value.id=a.id,N.value=!0},K=()=>{V.value.resetFields()},Q=async()=>{if(!await V.value.validate())return;const{code:l,msg:n}=await k(c.value);if(l!==200){g.ElMessage.error(n);return}g.ElMessage.success("下架成功");const u=d.value.find(x=>x.id===c.value.id);u&&(u.status=p.VIOLATION_OFF_SHELF),N.value=!1},X=a=>{m.push({name:"applyDiscountBaseinfo",query:{id:a.id,shopId:a.shopId}})},Y=a=>{i.size=a,C()},Z=a=>{i.current=a,C()};return e.onBeforeMount(()=>{C()}),s({chooseList:f,initDiscountActiveList:C}),(a,l)=>{const n=e.resolveComponent("el-table-column"),u=e.resolveComponent("el-link"),x=e.resolveComponent("el-tooltip"),v=e.resolveComponent("el-table"),ee=e.resolveComponent("el-input"),te=e.resolveComponent("el-form-item"),le=e.resolveComponent("el-form"),b=e.resolveComponent("el-button"),oe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",w,[e.createVNode(v,{ref_key:"multipleTableRef",ref:y,"cell-style":{color:"#333333"},data:d.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#000"},onSelectionChange:l[0]||(l[0]=t=>f.value=t)},{empty:e.withCtx(()=>[e.createVNode(I,{imageIndex:"7"})]),default:e.withCtx(()=>[e.createVNode(n,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",A,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(n,{label:"活动名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",P,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(n,{label:"类型",width:"100"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",H,[t.firstRuleType==="FULL_REDUCTION"?(e.openBlock(),e.createElementBlock("span",B,"满减")):(e.openBlock(),e.createElementBlock("span",z,"满折"))])]),_:1}),e.createVNode(n,{label:"使用规则",width:"210"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",q,e.toDisplayString(t.firstRuleDesc),1)]),_:1}),e.createVNode(n,{label:"状态",prop:"status",width:"120"},{default:e.withCtx(({row:t})=>{var E;return[e.createElementVNode("span",{style:e.normalizeStyle({color:e.unref(p).VIOLATION_OFF_SHELF===t.status?"red":""})},e.toDisplayString((E=e.unref(L)[t.status])==null?void 0:E.label),5)]}),_:1}),e.createVNode(n,{label:"活动时间",width:"250"},{default:e.withCtx(({row:t})=>[e.createElementVNode("p",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("p",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(n,{label:"活动商品",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",M,e.toDisplayString(t.productType==="ALL_PRODUCT"?"全部":`${t.product}${t.productType==="SPECIFIED_PRODUCT_NOT_PARTICIPATE"?"(除外)":""}`),1)]),_:1}),e.createVNode(n,{label:"支付单数",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",$,e.toDisplayString(t.order),1)]),_:1}),e.createVNode(n,{fixed:"right",label:"操作",align:"right",width:"170"},{default:e.withCtx(({row:t})=>[e.unref(p).VIOLATION_OFF_SHELF===t.status?(e.openBlock(),e.createBlock(x,{key:0,class:"box-item",effect:"dark",content:t.violation||"暂无违规原因",placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(u,{underline:!1,size:"small",type:"primary"},{default:e.withCtx(()=>l[4]||(l[4]=[e.createTextVNode(" 违规原因 ")])),_:1})]),_:2},1032,["content"])):e.createCommentVNode("",!0),[e.unref(p).NOT_STARTED,e.unref(p).IN_PROGRESS].includes(t.status)?(e.openBlock(),e.createBlock(u,{key:1,underline:!1,size:"small",type:"danger",onClick:E=>J(t)},{default:e.withCtx(()=>l[5]||(l[5]=[e.createTextVNode(" 违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(u,{underline:!1,size:"small",type:"primary",onClick:E=>X(t)},{default:e.withCtx(()=>l[6]||(l[6]=[e.createTextVNode("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createElementVNode("div",U,[e.createVNode(S,{"load-init":!0,"page-num":i.current,"page-size":i.size,total:r.value,onHandleCurrentChange:Z,onHandleSizeChange:Y},null,8,["page-num","page-size","total"])]),e.createVNode(oe,{modelValue:N.value,"onUpdate:modelValue":l[3]||(l[3]=t=>N.value=t),center:"",title:"违规下架",width:"500",onClose:K},{footer:e.withCtx(()=>[e.createElementVNode("div",G,[e.createVNode(b,{onClick:l[2]||(l[2]=t=>N.value=!1)},{default:e.withCtx(()=>l[7]||(l[7]=[e.createTextVNode("取消")])),_:1}),e.createVNode(b,{type:"primary",onClick:Q},{default:e.withCtx(()=>l[8]||(l[8]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(le,{ref_key:"illegalReasonFormRef",ref:V,model:c.value,rules:{violation:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(te,{label:"",prop:"violation"},{default:e.withCtx(()=>[e.createVNode(ee,{modelValue:c.value.violation,"onUpdate:modelValue":l[1]||(l[1]=t=>c.value.violation=t),maxlength:"50",placeholder:"请输入违规原因，必填",resize:"none","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ne="",W=((o,s)=>{const m=o.__vccOpts||o;for(const[_,d]of s)m[_]=d;return m})(j,[["__scopeId","data-v-8f3d91b3"]]);return e.defineComponent({__name:"PlatformAppluDiscount",setup(o){const s=e.reactive({name:null,status:null}),m=[{label:"活动名称",prop:"name",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",labelWidth:75,prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"IN_PROGRESS",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"OFF_SHELF",label:"已下架"},{value:"VIOLATION_OFF_SHELF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],_=e.ref(),d=()=>{_.value.initDiscountActiveList()},y=r=>{r&&Object.keys(r).forEach(f=>s[f]=r[f])},i=()=>{Object.keys(s).forEach(r=>s[r]=""),d()};return(r,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(D,{"v-model":s,columns:m,onChangeFormItem:y,onSearchHandle:d,onHandleReset:i},null,8,["v-model"]),e.createVNode(W,{ref_key:"listRef",ref:_,search:s},null,8,["search"])],64))}})});
