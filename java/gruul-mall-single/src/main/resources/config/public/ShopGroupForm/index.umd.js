(function(e,D){typeof exports=="object"&&typeof module<"u"?module.exports=D(require("vue"),require("@/components/q-choose-goods-popup/q-choose-goods-popup.vue"),require("element-plus"),require("@/composables/useConvert"),require("@/utils/date"),require("@/utils/http"),require("decimal.js"),require("@/apis/good"),require("vue-router"),require("lodash-es")):typeof define=="function"&&define.amd?define(["vue","@/components/q-choose-goods-popup/q-choose-goods-popup.vue","element-plus","@/composables/useConvert","@/utils/date","@/utils/http","decimal.js","@/apis/good","vue-router","lodash-es"],D):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopGroupForm=D(e.ShopGroupFormContext.Vue,e.ShopGroupFormContext.QChooseGoodsPopup,e.ShopGroupFormContext.ElementPlus,e.ShopGroupFormContext.UseConvert,e.ShopGroupFormContext.DateUtil,e.ShopGroupFormContext.UtilsHttp,e.ShopGroupFormContext.Decimal,e.ShopGroupFormContext.GoodAPI,e.ShopGroupFormContext.VueRouter,e.ShopGroupFormContext.Lodash))})(this,function(e,D,N,v,ee,Q,Ce,te,W,oe){"use strict";var X=document.createElement("style");X.textContent=`@charset "UTF-8";.com[data-v-7f72b499]{display:flex;justify-content:center;align-items:center}.com__pic[data-v-7f72b499]{width:62px;height:62px}.com__name[data-v-7f72b499]{width:113px;font-size:14px;color:#333;margin-left:10px;display:flex;flex-direction:column;align-items:baseline}.com__name--text[data-v-7f72b499]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.flex[data-v-7f72b499]{display:flex;justify-content:space-between;align-items:center}.groupForm[data-v-16539054]{overflow-y:auto;padding:16px}.groupForm__title[data-v-16539054]{font-size:14px;color:#606266;font-weight:700;margin-bottom:30px}.groupForm__stairs[data-v-16539054]{margin-bottom:16px}.groupForm__stairs--title[data-v-16539054]{font-size:12px;color:#333;font-weight:700}.groupForm__stairs--input[data-v-16539054]{margin:0 7px}.groupForm__btn[data-v-16539054]{height:60px;display:flex;justify-content:center;align-items:center}.tips[data-v-16539054]{font-size:12px;color:#c4c4c4}.btns[data-v-16539054]{margin-top:auto;width:100%;padding:15px 0;box-shadow:0 0 10px #d5d5d5;background-color:#fff}
`,document.head.appendChild(X);const le={class:"com"},re={class:"com__name"},ae={class:"com__name--text",style:{"margin-top":"5px"}},se={class:"flex"},ne={key:0},de={class:"dialog-footer"},ie=e.defineComponent({__name:"select-good-table",props:{mode:{type:String,default:"COMMON"},users:{type:Array,default(){return[]}},productList:{type:Array,default(){return[]}},isEdit:{type:Boolean,default:!1},flatGoodList:{type:Array,default(){return[]}}},setup(_,{expose:r}){const n=_,{divTenThousand:x,mulTenThousand:b}=v(),h=e.ref([]);e.watch(()=>n.productList,l=>{const a=q(l);if((a==null?void 0:a.length)===0)return N.ElMessage.error("请至少选择一个存在库存的商品");h.value=B(a)},{deep:!0}),e.watch(()=>n.flatGoodList,l=>{h.value=B(l)});function T(l){return l.skuItem.stockType==="LIMITED"?Number(l.skuItem.skuStock):1e5}function V(l){return x(l.skuItem.skuPrice).toNumber()}function q(l,a){if(!l.length)return[];const u=[];return l.forEach(d=>{d.skuIds.forEach((m,s)=>{(d.stocks[s]>0&&d.stockTypes[s]==="LIMITED"||d.stockTypes[s]==="UNLIMITED")&&u.push({productId:d.productId,productName:d.productName,productPic:d.pic,skuItem:{productId:d.productId,skuId:m,skuName:d.specs[s]?d.specs[s]:"",skuPrice:d.salePrices[s],skuStock:d.stocks[s]?d.stocks[s]:"",stockType:d.stockTypes[s]},rowTag:0,stock:+d.stocks[s],prices:[d.salePrices[s]],isJoin:d.stocks[s]>0})})}),u}function B(l,a){let u=0,d=l.length;for(let m=0;m<d;m++){const s=l[m];m===0&&(s.rowTag=1,u=0),m!==0&&(s.productId===l[m-1].productId?(s.rowTag=0,l[u].rowTag=l[u].rowTag+1):(s.rowTag=1,u=m)),s.prices=s.prices.map(y=>+y),s.stock=+s.stock}return l}const A=({row:l,column:a,rowIndex:u,columnIndex:d})=>{if(d===0)return{rowspan:l.rowTag,colspan:l.rowTag?1:0}};function O(l){return l.stockType==="UNLIMITED"?"无限库存":`${"库存"+l.skuStock||0}`}function M(){const l=e.toRaw(h.value),a=[],u=new Map;if(l.length)for(let d=0;d<l.length;d++){if(!l[d].isJoin)continue;const m=l[d],s=m.productId,y={skuId:m.skuItem.skuId,stock:+m.stock,prices:m.prices.map(E=>b(E).toNumber())};if(!u.has(s))u.set(s,a.length),a.push({productId:s,skus:[y]});else{const E=u.get(s);a[E].skus.push(y)}}return a}function j(){let l=!0;const a=h.value;if(!a.length)N.ElMessage.warning("请选择商品"),l=!1;else for(let u=0;u<a.length;u++)if(a[u].isJoin){if(!a[u].stock){N.ElMessage.warning("商品库存必须大于零"),l=!1;break}if(a[u].prices.length!==n.users.length||a[u].prices.some(d=>d===null)){N.ElMessage.warning("拼团价格填写完整"),l=!1;break}}return l}const k=e.ref({stock:1,price:[.01]}),w=e.ref(!1),P=e.ref("0"),z=l=>{P.value=l.productId,k.value.stock=l.skuItem.skuStock,w.value=!0},J=()=>{k.value={stock:1,price:[.01]},w.value=!1},R=()=>{n.mode==="COMMON"?h.value.forEach(l=>{l.productId===P.value&&(l.stock=k.value.stock>T(l)?T(l):k.value.stock,l.prices[0]=k.value.price[0]>V(l)?V(l):k.value.price[0])}):h.value.forEach(l=>{if(l.productId===P.value){l.stock=k.value.stock>T(l)?T(l):k.value.stock;for(let a=0;a<n.users.length;a++)n.users.length[a],l.prices[a]=k.value.price[a]>V(l)?V(l):k.value.price[a]}}),w.value=!1},Y=(l,a)=>typeof l=="string"?l:l.length===1?l[0]:l[a];return r({getProduct:M,validateProduct:j}),(l,a)=>{const u=e.resolveComponent("el-image"),d=e.resolveComponent("el-button"),m=e.resolveComponent("el-table-column"),s=e.resolveComponent("el-input-number"),y=e.resolveComponent("el-input"),E=e.resolveComponent("el-switch"),H=e.resolveComponent("el-table"),K=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(H,{data:h.value,"span-method":A},{default:e.withCtx(()=>[e.createVNode(m,{label:"商品信息",width:"215"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",le,[e.createVNode(u,{src:t.productPic,class:"com__pic"},null,8,["src"]),e.createElementVNode("div",re,[n.isEdit?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(d,{key:0,class:"com__batch",type:"primary",link:"",onClick:o=>z(t)},{default:e.withCtx(()=>[e.createTextVNode(" 批量设置 ")]),_:2},1032,["onClick"])),e.createElementVNode("span",ae,e.toDisplayString(t.productName),1)])])]),_:1}),e.createVNode(m,{label:"规格"},{default:e.withCtx(({row:t,column:o,$index:c})=>[e.createTextVNode(e.toDisplayString(Y(t.skuItem.skuName,c)),1)]),_:1}),e.createVNode(m,{label:"库存"},{default:e.withCtx(({row:t,column:o,$index:c})=>[e.createElementVNode("div",null,[e.createVNode(s,{modelValue:t.stock,"onUpdate:modelValue":p=>t.stock=p,min:0,style:{width:"80px"},max:T(t),disabled:n.isEdit,precision:0,controls:!1},null,8,["modelValue","onUpdate:modelValue","max","disabled"])]),e.createElementVNode("div",null,e.toDisplayString(O(t.skuItem)),1)]),_:1}),n.mode==="COMMON"?(e.openBlock(),e.createBlock(m,{key:0,label:"拼团价"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,[n.isEdit?(e.openBlock(),e.createBlock(y,{key:0,style:{width:"80px"},disabled:"",placeholder:e.unref(x)(t.prices[0]).toString()},null,8,["placeholder"])):(e.openBlock(),e.createBlock(s,{key:1,modelValue:t.prices[0],"onUpdate:modelValue":o=>t.prices[0]=o,min:.01,style:{width:"80px"},disabled:n.isEdit,precision:2,max:V(t),controls:!1},null,8,["modelValue","onUpdate:modelValue","disabled","max"]))]),e.createElementVNode("div",null,"销售价"+e.toDisplayString(e.unref(x)(t.skuItem.skuPrice)),1)]),_:1})):e.createCommentVNode("",!0),n.mode==="STAIRS"&&n.users.length>0?(e.openBlock(),e.createBlock(m,{key:1,label:"第一阶段拼团"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,[n.isEdit?(e.openBlock(),e.createBlock(y,{key:0,style:{width:"80px"},disabled:"",placeholder:e.unref(x)(t.prices[0]).toString()},null,8,["placeholder"])):(e.openBlock(),e.createBlock(s,{key:1,modelValue:t.prices[0],"onUpdate:modelValue":o=>t.prices[0]=o,min:.01,style:{width:"80px"},disabled:n.isEdit,precision:2,max:V(t),controls:!1},null,8,["modelValue","onUpdate:modelValue","disabled","max"]))]),e.createElementVNode("div",null,"销售价"+e.toDisplayString(e.unref(x)(t.skuItem.skuPrice)),1)]),_:1})):e.createCommentVNode("",!0),n.mode==="STAIRS"&&n.users.length>1?(e.openBlock(),e.createBlock(m,{key:2,label:"第二阶段拼团"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,[n.isEdit?(e.openBlock(),e.createBlock(y,{key:0,style:{width:"80px"},disabled:"",placeholder:e.unref(x)(t.prices[1]).toString()},null,8,["placeholder"])):(e.openBlock(),e.createBlock(s,{key:1,modelValue:t.prices[1],"onUpdate:modelValue":o=>t.prices[1]=o,disabled:n.isEdit,min:.01,style:{width:"80px"},max:V(t),precision:2,controls:!1},null,8,["modelValue","onUpdate:modelValue","disabled","max"]))]),e.createElementVNode("div",null,"销售价"+e.toDisplayString(V(t)),1)]),_:1})):e.createCommentVNode("",!0),n.mode==="STAIRS"&&n.users.length>2?(e.openBlock(),e.createBlock(m,{key:3,label:"第三阶段拼团"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,[n.isEdit?(e.openBlock(),e.createBlock(y,{key:0,style:{width:"80px"},disabled:"",placeholder:e.unref(x)(t.prices[2]).toString()},null,8,["placeholder"])):(e.openBlock(),e.createBlock(s,{key:1,modelValue:t.prices[2],"onUpdate:modelValue":o=>t.prices[2]=o,disabled:n.isEdit,min:.01,style:{width:"80px"},precision:2,max:V(t),controls:!1},null,8,["modelValue","onUpdate:modelValue","disabled","max"]))]),e.createElementVNode("div",null,"销售价"+e.toDisplayString(V(t)),1)]),_:1})):e.createCommentVNode("",!0),e.createVNode(m,{label:"是否参与"},{default:e.withCtx(({row:t})=>[e.createVNode(E,{modelValue:t.isJoin,"onUpdate:modelValue":o=>t.isJoin=o,size:"large",disabled:n.isEdit},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"]),e.createVNode(K,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=t=>w.value=t),title:"批量设置","destroy-on-close":"",center:"",width:n.mode==="COMMON"?500:"50%",top:"30vh",onClose:J},{footer:e.withCtx(()=>[e.createElementVNode("div",de,[e.createVNode(d,{onClick:a[2]||(a[2]=t=>w.value=!1)},{default:e.withCtx(()=>[e.createTextVNode("取消")]),_:1}),e.createVNode(d,{type:"primary",onClick:R},{default:e.withCtx(()=>[e.createTextVNode(" 确定 ")]),_:1})])]),default:e.withCtx(()=>[e.createElementVNode("div",se,[e.createElementVNode("div",null,[e.createTextVNode(" 库存 "),e.createVNode(s,{modelValue:k.value.stock,"onUpdate:modelValue":a[0]||(a[0]=t=>k.value.stock=t),controls:!1,style:e.normalizeStyle({width:n.mode==="COMMON"?"150px":"80px"}),min:0,precision:0},null,8,["modelValue","style"])]),n.mode==="COMMON"?(e.openBlock(),e.createElementBlock("div",ne,[e.createTextVNode(" 拼团价 "),e.createVNode(s,{modelValue:k.value.price[0],"onUpdate:modelValue":a[1]||(a[1]=t=>k.value.price[0]=t),precision:2,controls:!1,min:.01},null,8,["modelValue"])])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(n.users,(t,o)=>(e.openBlock(),e.createElementBlock("div",{key:o},[e.createTextVNode(" 第"+e.toDisplayString(o+1)+"阶段拼团 ",1),e.createVNode(s,{modelValue:k.value.price[o],"onUpdate:modelValue":c=>k.value.price[o]=c,style:{width:"80px"},precision:2,controls:!1,min:.01},null,8,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1},8,["modelValue","width"])],64)}}}),be="",Z=(_,r)=>{const n=_.__vccOpts||_;for(const[x,b]of r)n[x]=b;return n},ce=Z(ie,[["__scopeId","data-v-7f72b499"]]),pe=_=>Q.http.post({url:"addon-team/team/activity",data:_}),me=_=>Q.http.get({url:`addon-team/team/activity/${_}`}),G=_=>(e.pushScopeId("data-v-16539054"),_=_(),e.popScopeId(),_),ue={class:"groupForm"},fe=G(()=>e.createElementVNode("div",{class:"groupForm__title"},"基本信息",-1)),ke=G(()=>e.createElementVNode("p",{class:"tips"},"用户发起拼团后开始计时，需在设置时间内邀请到规定好友人数参团，超过时效时间，则系统判定拼团失败，自动发起退款",-1)),he={key:1},Ve={class:"groupForm__stairs--title"},_e=G(()=>e.createElementVNode("span",{class:"tips",style:{"margin-left":"8px"}},"商品按下单减库存，请设置未付款订单自动取消时间及时释放库存，可输入3-360分钟",-1)),ge=G(()=>e.createElementVNode("div",{class:"tips"},"开启后拼团有效时间内人数未满，系统将以“虚拟用户”凑满人数提高成团率。",-1)),xe=G(()=>e.createElementVNode("span",{class:"tips",style:{"margin-left":"8px"}},[e.createTextVNode(" 优惠叠加可能导致实付金额为 "),e.createElementVNode("i",{style:{color:"red","font-weight":"700","font-style":"unset"}},"0"),e.createTextVNode(" (实付金额= 活动价 - 会员优惠 - 优惠券优惠 - 满减优惠) ")],-1)),ye={class:"groupForm__btn btns"},Ne=e.defineComponent({__name:"ShopGroupForm",setup(_){const r=e.ref({name:"",startTime:"",endTime:"",effectTimeout:0,mode:"COMMON",users:[],payTimeout:0,simulate:!1,huddle:!0,stackable:{vip:!1,coupon:!1,full:!1},products:[]}),n=W.useRoute(),x=W.useRouter(),b=!!n.query.id&&!!n.query.isLookUp,h=new ee,T=e.ref(),V=e.ref([]),q=e.ref(!1),B=e.ref([]),A=e.ref([]),O=e.ref(),M=e.reactive({maxPrice:"",minPrice:"",activity:{endTime:"",startTime:""},keyword:"",categoryFirstId:""}),j=e.reactive({name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:1,max:10,message:"活动名称字数为1-10",trigger:"blur"}],startTime:[{required:!0,message:"请选择日期"},{trigger:"blur",validator:s}],endTime:[{required:!0,message:"请选择日期"},{trigger:"blur",validator:s}],effectTimeout:[{validator:u,trigger:"blur"}],mode:[{required:!0,message:"请选择拼团模式",trigger:"blur"}],users:[{validator:a,trigger:"blur"}],payTimeout:[{validator:d,trigger:"blur"}],simulate:[{required:!0,message:"请选择是否模拟成团",trigger:"blur"}],huddle:[{required:!0,message:"请选择是否凑团",trigger:"blur"}],preheat:[{required:!0,message:"请选择是否预热",trigger:"blur"}]});y();const k=()=>{r.value.users.length<3?r.value.users.push(0):N.ElMessage.warning("最多添加三个梯队")},w=()=>{r.value.users.pop()},P=t=>{B.value=oe.cloneDeep(t.tempGoods)},z=()=>{var t;(t=T.value)==null||t.validate(async o=>{if(o&&O.value.validateProduct()){r.value.products=O.value.getProduct();const{code:c,msg:p}=await pe(r.value);c===200?(N.ElMessage.success("创建成功"),R()):N.ElMessage.error(p||"创建失败")}})},J=t=>{t[0].getTime()>=t[1].getTime()&&N.ElMessage.warning("结束时间大于开始时间"),r.value.startTime=h.getYMDHMSs(t[0]),r.value.endTime=h.getYMDHMSs(t[1]),M.activity.startTime=h.getYMDHMSs(t[0]),M.activity.endTime=h.getYMDHMSs(t[1])},R=()=>{x.push({name:"marketingAppGroup",query:{flag:!0}})},Y=t=>{t==="COMMON"&&(r.value.users=[r.value.users[0]])},l=()=>{if(!r.value.endTime||!r.value.startTime){N.ElMessage.warning("请先选择时间段");return}q.value=!0};function a(t,o,c){r.value.mode==="COMMON"&&(r.value.users.length&&r.value.users[0]>=2?c():c(new Error("参团人数应大于等于两人"))),r.value.mode==="STAIRS"&&(r.value.users.length?(r.value.users.find(F=>F<2)&&c(new Error("阶梯团人数最低为2人")),m(r.value.users)||c(new Error("阶梯团人数应为递增人数")),c()):c(new Error("请至少添加一项阶梯团人数")))}function u(t,o,c){o>=15?c():c(new Error("拼团有效时间必须大于等于15分钟"))}function d(t,o,c){o>=3&&o<=369?c():c(new Error("订单关闭时间3-360分钟"))}function m(t){for(let o=1;o<t.length;o++)if(t[o]<=t[o-1])return!1;return!0}function s(t,o,c){new Date(r.value.startTime).getTime()>=new Date(r.value.endTime).getTime()?c(new Error("开始时间应小于结束时间")):c()}async function y(){const t=n.query.id;if(t){const{data:o}=await me(t);r.value=o,r.value.payTimeout=+o.payTimeout,V.value=[o.startTime,o.endTime],E(o)}}async function E(t){const o=t.products.map(f=>f.productId),{code:c,data:p}=await te.doGetRetrieveProduct({productId:o});if(c!==200)return N.ElMessage.error("获取活动商品信息失败");const F=[];if(p.list.length)for(let f=0;f<t.products.length;f++){const I=p.list.findIndex(g=>g.productId===t.products[f].productId);for(let g=0;g<t.products[I].skus.length;g++){let C={productName:p.list[f].productName,productPic:p.list[f].pic,productId:p.list[f].productId,skuItem:{productId:p.list[f].productId,skuId:"",skuName:"",skuPrice:"",skuStock:0,stockType:"LIMITED"},rowTag:0,stock:0,prices:[],isJoin:!0};const $=t.products[I].skus[g].skuId,S=p.list[f].skuIds.findIndex(i=>i===$);C.skuItem.skuId=p.list[f].skuIds[S],C.skuItem.skuName=p.list[f].specs[S],C.skuItem.skuPrice=p.list[f].salePrices[S],C.skuItem.skuStock=p.list[f].stocks[S],C.skuItem.stockType=p.list[f].stockTypes[S],C.stock=t.products[I].skus[g].stock,C.prices=t.products[I].skus[g].prices,F.push(C)}}A.value=F}function H(t){const o=h.getYMD(new Date),c=h.getYMD(t);return o===c?!1:new Date().getTime()>t.getTime()}const K=t=>{const o=Number(`${t}`.replace(/[^\d]/g,""));return o<1440?o:1440};return(t,o)=>{const c=e.resolveComponent("el-input"),p=e.resolveComponent("el-form-item"),F=e.resolveComponent("el-date-picker"),f=e.resolveComponent("el-radio"),I=e.resolveComponent("el-radio-group"),g=e.resolveComponent("el-button"),C=e.resolveComponent("el-input-number"),$=e.resolveComponent("el-checkbox"),S=e.resolveComponent("el-form");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ue,[fe,e.createVNode(S,{ref_key:"ruleFormRef",ref:T,model:r.value,"label-width":"110","label-position":"right",rules:j,disabled:e.unref(b)},{default:e.withCtx(()=>[e.createVNode(p,{label:"活动名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:r.value.name,"onUpdate:modelValue":o[0]||(o[0]=i=>r.value.name=i),placeholder:"限10字",style:{width:"550px"},maxlength:"10"},null,8,["modelValue"])]),_:1}),e.createVNode(p,{label:"活动时间",prop:"startTime"},{default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(F,{modelValue:V.value,"onUpdate:modelValue":o[1]||(o[1]=i=>V.value=i),style:{width:"550px"},type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间","disabled-date":H,onChange:J},null,8,["modelValue"])])]),_:1}),e.createVNode(p,{label:"拼团有效期",prop:"effectTimeout",required:""},{default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(c,{modelValue:r.value.effectTimeout,"onUpdate:modelValue":o[2]||(o[2]=i=>r.value.effectTimeout=i),formatter:i=>K(i),style:{width:"550px"}},{append:e.withCtx(()=>[e.createTextVNode(" 分钟 ")]),_:1},8,["modelValue","formatter"]),ke])]),_:1}),e.createVNode(p,{label:"拼团模式",prop:"mode"},{default:e.withCtx(()=>[e.createVNode(I,{modelValue:r.value.mode,"onUpdate:modelValue":o[3]||(o[3]=i=>r.value.mode=i),onChange:Y},{default:e.withCtx(()=>[e.createVNode(f,{value:"COMMON"},{default:e.withCtx(()=>[e.createTextVNode("普通拼团")]),_:1}),e.createVNode(f,{value:"STAIRS"},{default:e.withCtx(()=>[e.createTextVNode("阶梯拼团")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(p,{label:"参团人数",prop:"users",required:""},{default:e.withCtx(()=>[r.value.mode==="COMMON"?(e.openBlock(),e.createBlock(c,{key:0,modelValue:r.value.users[0],"onUpdate:modelValue":o[4]||(o[4]=i=>r.value.users[0]=i),formatter:i=>Number(`${i}`.replace(/[^\d]/g,"")),parser:i=>`${Number(i)>=100?100:i}`,style:{width:"550px"},max:100},{append:e.withCtx(()=>[e.createTextVNode(" 人 ")]),_:1},8,["modelValue","formatter","parser"])):(e.openBlock(),e.createElementBlock("div",he,[e.createVNode(g,{link:"",type:"primary",onClick:k},{default:e.withCtx(()=>[e.createTextVNode("添加拼团阶梯")]),_:1}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.users,(i,L)=>(e.openBlock(),e.createElementBlock("div",{key:L,class:"groupForm__stairs"},[e.createElementVNode("span",Ve,"第"+e.toDisplayString(L+1)+"阶段人数",1),e.createVNode(c,{modelValue:r.value.users[L],"onUpdate:modelValue":U=>r.value.users[L]=U,class:"groupForm__stairs--input",style:{width:"450px"},formatter:U=>Number(`${U}`.replace(/[^\d]/g,"")),parser:U=>`${Number(U)>=100?100:U}`,max:100},{append:e.withCtx(()=>[e.createTextVNode(" 人 ")]),_:2},1032,["modelValue","onUpdate:modelValue","formatter","parser"]),L>0?(e.openBlock(),e.createBlock(g,{key:0,type:"primary",link:"",onClick:w},{default:e.withCtx(()=>[e.createTextVNode("删除")]),_:1})):e.createCommentVNode("",!0)]))),128))]))]),_:1}),e.createVNode(p,{label:"订单关闭时间",prop:"payTimeout"},{default:e.withCtx(()=>[e.createVNode(C,{modelValue:r.value.payTimeout,"onUpdate:modelValue":o[5]||(o[5]=i=>r.value.payTimeout=i),controls:!1,max:360,min:3},null,8,["modelValue"]),_e]),_:1}),e.createVNode(p,{label:"自动成团",prop:"simulate"},{default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(I,{modelValue:r.value.simulate,"onUpdate:modelValue":o[6]||(o[6]=i=>r.value.simulate=i)},{default:e.withCtx(()=>[e.createVNode(f,{value:!1},{default:e.withCtx(()=>[e.createTextVNode("关闭")]),_:1}),e.createVNode(f,{value:!0},{default:e.withCtx(()=>[e.createTextVNode("开启")]),_:1})]),_:1},8,["modelValue"]),ge])]),_:1}),e.createVNode(p,{label:"优惠叠加"},{default:e.withCtx(()=>[e.createVNode($,{modelValue:r.value.stackable.vip,"onUpdate:modelValue":o[7]||(o[7]=i=>r.value.stackable.vip=i),label:"会员价"},null,8,["modelValue"]),e.createVNode($,{modelValue:r.value.stackable.coupon,"onUpdate:modelValue":o[8]||(o[8]=i=>r.value.stackable.coupon=i),label:"优惠券"},null,8,["modelValue"]),e.createVNode($,{modelValue:r.value.stackable.full,"onUpdate:modelValue":o[9]||(o[9]=i=>r.value.stackable.full=i),label:"满减"},null,8,["modelValue"]),xe]),_:1}),e.createVNode(p,{label:"适用商品"},{default:e.withCtx(()=>[e.createVNode(g,{type:"primary",link:"",onClick:l},{default:e.withCtx(()=>[e.createTextVNode("选择商品")]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"]),e.createVNode(D,{modelValue:q.value,"onUpdate:modelValue":o[10]||(o[10]=i=>q.value=i),searchParam:M,"onUpdate:searchParam":o[11]||(o[11]=i=>M=i),searchConsignmentProduct:!0,pointGoodsList:B.value,onOnConfirm:P},null,8,["modelValue","searchParam","pointGoodsList"]),e.createVNode(ce,{ref_key:"selectGoodsTableRef",ref:O,mode:r.value.mode,users:r.value.users,productList:B.value,isEdit:e.unref(b),flatGoodList:A.value},null,8,["mode","users","productList","isEdit","flatGoodList"])]),e.createElementVNode("div",ye,[e.createVNode(g,{round:"",onClick:R},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(b)?"返回":"取消"),1)]),_:1}),e.unref(b)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(g,{key:0,type:"primary",round:"",onClick:z},{default:e.withCtx(()=>[e.createTextVNode("确定")]),_:1}))])],64)}}}),Te="";return Z(Ne,[["__scopeId","data-v-16539054"]])});
