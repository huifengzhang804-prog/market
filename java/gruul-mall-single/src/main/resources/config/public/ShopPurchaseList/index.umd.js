(function(e,de){typeof exports=="object"&&typeof module<"u"?module.exports=de(require("vue"),require("@/components/ChromeTab.vue"),require("vue-router"),require("lodash-es"),require("@/components/SchemaForm.vue"),require("@/components/PageManage.vue"),require("decimal.js"),require("element-plus"),require("@/composables/useConvert"),require("@/store/modules/shopInfo"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue"),require("@/components/q-icon/q-icon.vue"),require("@/components/q-upload/q-upload.vue"),require("@vueuse/core"),require("@/utils/date"),require("vue-clipboard3"),require("@element-plus/icons-vue"),require("@/assets/images/icon/paymentVoucher.png"),require("@/components/qszr-core/packages/q-table/QTable"),require("@/components/qszr-core/packages/q-table/q-table-column.vue"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@/components/ChromeTab.vue","vue-router","lodash-es","@/components/SchemaForm.vue","@/components/PageManage.vue","decimal.js","element-plus","@/composables/useConvert","@/store/modules/shopInfo","@/components/element-plus/el-table/ElTableEmpty/index.vue","@/components/q-icon/q-icon.vue","@/components/q-upload/q-upload.vue","@vueuse/core","@/utils/date","vue-clipboard3","@element-plus/icons-vue","@/assets/images/icon/paymentVoucher.png","@/components/qszr-core/packages/q-table/QTable","@/components/qszr-core/packages/q-table/q-table-column.vue","@/apis/http"],de):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopPurchaseList=de(e.ShopPurchaseListContext.Vue,e.ShopPurchaseListContext.ChromeTabs,e.ShopPurchaseListContext.VueRouter,e.ShopPurchaseListContext.Lodash,e.ShopPurchaseListContext.SchemaForms,e.ShopPurchaseListContext.PageManageTwo,e.ShopPurchaseListContext.Decimal,e.ShopPurchaseListContext.ElementPlus,e.ShopPurchaseListContext.UseConvert,e.ShopPurchaseListContext.ShopInfoStore,e.ShopPurchaseListContext.ElTableEmpty,e.ShopPurchaseListContext.QIcon,e.ShopPurchaseListContext.QUpload,e.ShopPurchaseListContext.VueUse,e.ShopPurchaseListContext.DateUtil,e.ShopPurchaseListContext.VueClipboard3,e.ShopPurchaseListContext.ElementPlusIconsVue,e.ShopPurchaseListContext.paymentVoucher,e.ShopPurchaseListContext.QTable,e.ShopPurchaseListContext.QTableColumn,e.ShopPurchaseListContext.Request))})(this,function(e,de,pe,fe,he,ue,Z,L,ie,ce,Ve,ge,Re,Me,Ae,ze,Ue,Fe,be,te,Y){"use strict";var Se=document.createElement("style");Se.textContent=`@charset "UTF-8";.commodity-info[data-v-4081a379]{display:flex;align-items:center}.commodity-info img[data-v-4081a379]{width:60px;height:60px}.commodity-info span[data-v-4081a379]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-left:10px}.purchase__batch[data-v-4081a379]{display:flex;justify-content:flex-end}.purchase__remark[data-v-4081a379]{padding:15px 0}.purchase__total[data-v-4081a379]{display:flex;flex-direction:column;align-items:flex-end;line-height:1.5}.purchase__total--title[data-v-4081a379]{font-size:1.2em;font-weight:600}.oneClickProcurement__commodity[data-v-3d16b876]{display:flex;align-items:center}.oneClickProcurement__commodity img[data-v-3d16b876]{width:60px;height:60px;flex-shrink:0}.oneClickProcurement__commodity span[data-v-3d16b876]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-left:10px}.oneClickProcurement__expand[data-v-3d16b876]{margin-left:20px;margin-right:20px;padding:10px;border:1px solid #efefef}.oneClickProcurement__form[data-v-3d16b876]{display:flex;justify-content:flex-end}.oneClickProcurement__pagination[data-v-3d16b876]{padding:15px 0;display:flex;justify-content:flex-end;align-items:center}.oneClickProcurement__total[data-v-3d16b876]{display:flex;flex-direction:column;align-items:flex-end;line-height:1.5}.oneClickProcurement__total--title[data-v-3d16b876]{font-size:1.2em;font-weight:600}[data-v-3d16b876] .el-table thead .el-table__cell{background-color:var(--el-fill-color-light)}.details__img[data-v-82366355]{width:80px;height:80px;vertical-align:top}[data-v-3707842f]{font-size:14px}.tools[data-v-3707842f]{padding:16px}.table[data-v-3707842f]{overflow:auto}.commodity-info[data-v-3707842f]{display:flex;align-items:center;cursor:pointer}.commodity-info img[data-v-3707842f]{width:60px;height:60px}.commodity-info p[data-v-3707842f]{width:217px;overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-left:10px}.commodity-info .type_tag[data-v-3707842f]{color:#999;font-size:14px;font-weight:400;margin-left:10px}.customer[data-v-3707842f]{width:100%;display:flex;flex-direction:column;justify-content:center;font-size:14px;color:#333}.customer div[data-v-3707842f]{display:flex;align-items:center}.customer__name[data-v-3707842f]{display:inline-block;max-width:156px;margin-right:5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.customer img[data-v-3707842f]{width:16.25px;height:15.32px;margin-left:5px;cursor:pointer}.count-down[data-v-92288512]{color:#f54319}.invoice-dialog[data-v-02ca7bd7]{color:#000}.invoice-dialog-main[data-v-02ca7bd7]{display:flex;justify-content:center;align-items:center;justify-content:space-between}.invoice-dialog-main__content[data-v-02ca7bd7]{margin:10px 0;display:flex;justify-content:center;align-items:center;justify-content:space-between}.invoice-dialog-main__note[data-v-02ca7bd7]{display:flex;justify-content:center;align-items:center;align-items:flex-start;justify-content:flex-start}.invoice-dialog-main__type[data-v-02ca7bd7]{margin-top:10px;display:flex;justify-content:center;align-items:center;justify-content:space-between}.invoice-dialog-main--price[data-v-02ca7bd7]{color:#fd0505;font-size:14px;font-weight:700}.invoice-dialog-main--price[data-v-02ca7bd7]:before{content:"￥";font-size:10px;font-weight:400}.invoice-dialog-main--msg[data-v-02ca7bd7]{color:#9a9a9a;margin:10px 0;font-size:12px}.oneClickProcurement__commodity[data-v-0be730b0]{display:flex;align-items:center}.oneClickProcurement__commodity img[data-v-0be730b0]{width:60px;height:60px;flex-shrink:0}.oneClickProcurement__commodity span[data-v-0be730b0]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-left:10px}.oneClickProcurement__form[data-v-0be730b0]{display:flex;justify-content:flex-end;margin-right:98px}.batch__commodity[data-v-819dbd96]{display:flex;align-items:center}.batch__commodity img[data-v-819dbd96]{width:60px;height:60px;flex-shrink:0}.batch__commodity span[data-v-819dbd96]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-left:10px}.batch__form[data-v-819dbd96]{display:flex;justify-content:flex-end}[data-v-84b12a8a]{font-size:14px}.invoice-title[data-v-84b12a8a]{display:flex;justify-content:center;align-items:center}.invoice-desc[data-v-84b12a8a]{display:flex;justify-content:center;align-items:center;color:#fd0505;margin-top:7px}.proof-img[data-v-84b12a8a]{width:100%;height:350px;object-fit:contain}.copy[data-v-84b12a8a]{color:#1890ff;margin-left:8px;cursor:pointer}.text-red[data-v-84b12a8a]{color:red}.text-grey[data-v-84b12a8a]{color:#999}.customer[data-v-84b12a8a]{width:100%;height:42px;display:flex;flex-direction:column;justify-content:space-around;font-size:14px;color:#333}.customer div[data-v-84b12a8a]{display:flex;align-items:center}.customer__name[data-v-84b12a8a]{display:inline-block;max-width:88px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.customer img[data-v-84b12a8a]{width:16.25px;height:15.32px;margin-left:5px;cursor:pointer}.good[data-v-b5df09d6]{padding:0 30px 0 45px;box-sizing:border-box;font-size:12px;font-family:Microsoft YaHei,Microsoft YaHei-Normal;font-weight:400;color:#000}.good__info[data-v-b5df09d6]{margin-bottom:24px}.good__img[data-v-b5df09d6]{display:flex;justify-content:flex-start;align-items:flex-start}.good__spec[data-v-b5df09d6]{width:758px}.b[data-v-b5df09d6]{font-size:12px;color:#000}[data-v-bbcafdc3]{font-size:14px}.commodity-info[data-v-bbcafdc3]{display:flex;align-items:center}.commodity-info img[data-v-bbcafdc3]{width:68px;height:68px}.commodity-info-text[data-v-bbcafdc3]{height:68px;width:217px;display:flex;flex-direction:column;justify-content:space-between;margin-left:8px}.commodity-info-text p[data-v-bbcafdc3]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.customer[data-v-bbcafdc3]{width:100%;display:flex;flex-direction:column;justify-content:space-around;font-size:14px;color:#333}.customer div[data-v-bbcafdc3]{display:flex;align-items:center}.customer__name[data-v-bbcafdc3]{display:inline-block;max-width:156px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:3px}.customer img[data-v-bbcafdc3]{width:16.25px;height:15.32px;margin-left:5px;cursor:pointer}.good[data-v-b854e3eb]{padding:0 30px 0 45px;box-sizing:border-box;font-size:12px;font-family:Microsoft YaHei,Microsoft YaHei-Normal;font-weight:400;color:#000}.good__info[data-v-b854e3eb]{margin-bottom:24px}.good__img[data-v-b854e3eb]{display:flex;justify-content:flex-start;align-items:flex-start}.good__spec[data-v-b854e3eb]{width:758px}.b[data-v-b854e3eb]{font-size:12px;color:#000}img[data-v-cdc1ed69]{vertical-align:top}[data-v-5f7655d1]{font-size:14px}.commodity-info[data-v-5f7655d1]{display:flex;align-items:center;justify-content:flex-start;width:100%}.commodity-info img[data-v-5f7655d1]{width:68px;height:68px}.commodity-info .commodity-info-text[data-v-5f7655d1]{width:217px;height:68px;margin-left:8px;display:flex;flex-direction:column;justify-content:space-between}.commodity-info .commodity-info-text p[data-v-5f7655d1]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.commodity-info .type_tag[data-v-5f7655d1]{color:#999;font-size:14px;font-weight:400}.customer[data-v-5f7655d1]{width:100%;display:flex;flex-direction:column;justify-content:space-around;font-size:14px;color:#333}.customer div[data-v-5f7655d1]{display:flex;align-items:center}.customer__name[data-v-5f7655d1]{display:inline-block;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:3px}.customer img[data-v-5f7655d1]{width:16.25px;height:15.32px;margin-left:5px;cursor:pointer}
`,document.head.appendChild(Se);const je={class:"q_plugin_container"},qe=e.defineComponent({__name:"ShopPurchaseList",setup(t){const a=e.ref("supply"),o=[{name:"supply",label:"货源"},{name:"purchaseOrder",label:"采购订单"},{name:"waitingPublish",label:"待发布"},{name:"release",label:"已发布"}],n=u=>{u&&(a.value=u)},r={supply:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ro)),purchaseOrder:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Ba)),waitingPublish:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Qa)),release:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Dn))};return(u,d)=>(e.openBlock(),e.createElementBlock("div",je,[e.createVNode(de,{"tab-list":o,value:a.value,onHandleTabs:n},null,8,["value"]),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r[a.value])))]))}}),He=t=>Y.get({url:"addon-supplier/supplier/manager/product/getSupplyList",params:{...t}}),ke=t=>Y.post({url:"gruul-mall-order/order/distribution/cost",data:t,showLoading:!1}),Ee=(t={})=>Y.post({url:"addon-supplier/supplier/order",data:t}),Ge=t=>Y.get({url:`addon-supplier/supplier/order/creation/${t}`}),Ye=(t={})=>Y.put({url:"addon-supplier/supplier/order/pay",data:t}),We=t=>Y.put({url:`addon-supplier/supplier/order/close/${t}`}),Te=t=>Y.get({url:`addon-supplier/supplier/order/storage/${t}`}),Ke=t=>Y.put({url:"addon-supplier/supplier/order/storage",data:t}),Xe=t=>Y.put({url:`addon-supplier/supplier/order/complete/${t}`}),Je=t=>Y.get({url:"addon-supplier/supplier/order/publish",params:t}),_e=(t,a)=>Y.post({url:`gruul-mall-carrier-pigeon/pigeon/group-chat-rooms/${t}/${a}`}),Ze=t=>Y.get({url:"gruul-mall-goods/manager/product/purchase/issue/products",params:t}),Qe=t=>Y.put({url:`gruul-mall-goods/manager/product/purchase/issue/product/updateStatus/${t}`}),ye=(t={})=>Y.get({url:"gruul-mall-shop/shop/info/getSupplierInfo",params:t}),ve=(t={})=>Y.get({url:"addon-supplier/supplier/order",params:t}),Ie=(t,a,o=!1)=>Y.get({url:`gruul-mall-storage/storage/shop/${t}/product/${a}?isSupplier=${o}`}),xe=()=>Y.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),De=()=>Y.get({url:"gruul-mall-shop/shop/logistics/address/list",params:{current:1,size:1e3}}),et=t=>Y.get({url:"addon-invoice/invoice/invoice-headers/pageInvoiceHeader",params:{...t,ownerType:"SHOP"}}),tt="addon-invoice/invoice/",ot=t=>Y.post({url:`${tt}invoiceRequest`,data:t}),Pe=t=>Y.get({url:"addon-invoice/invoice/invoiceSettings",params:t}),at=t=>Y.get({url:`addon-invoice/invoice/invoiceRequest/${t}`}),nt=t=>Y.get({url:"addon-invoice/invoice/invoiceRequest/pre-request",params:t}),lt=t=>Y.put({url:`addon-invoice/invoice/invoiceRequest/${t}`}),st=t=>Y.post({url:"addon-invoice/invoice/invoiceAttachment/re-send",data:t}),$e=()=>Y.get({url:"addon-invoice/invoice/invoice-headers/getDefaultInvoiceHeader",params:{invoiceHeaderOwnerType:"SHOP"}}),Be=t=>Y.post({url:"addon-supplier/supplier/order/export",data:t}),rt=e.defineComponent({__name:"search",emits:["search"],setup(t,{emit:a}){const o=e.ref([]),n=e.ref([]),r=e.reactive({supplierId:"",platformCategoryParentId:"",supplierGoodsName:""}),u=a,d=[{label:"商品名称",prop:"supplierGoodsName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称"}},{label:"供应商名称",labelWidth:85,prop:"supplierId",valueType:"select",options:o,fieldProps:{placeholder:"请输入店铺名称",props:{value:"id",label:"name",expandTrigger:"hover"},filterable:!0,remote:!0,reserveKeyword:!0,remoteMethod:l=>{y(l)}}},{label:"平台类目",valueType:"cascader",options:n,fieldProps:{placeholder:"请选择平台类目",props:{expandTrigger:"hover",label:"name",value:"id",children:"secondCategoryVos"},onChange:l=>{(l==null?void 0:l.length)>1?r.platformCategoryParentId=l[l.length-1]:r.platformCategoryParentId=""}}}],f=async()=>{const{data:l,code:i}=await xe();n.value=l};e.onMounted(()=>f());const m=l=>{l&&Object.keys(l).forEach(i=>r[i]=l[i])},h=()=>{const l=fe.cloneDeep(r);delete l.undefined,u("search",l)},y=async(l="")=>{var x;const i=await ye({supplierName:l});i.data&&((x=i.data)!=null&&x.length)&&(o.value=i.data.map(g=>({label:g.name,value:g.id})))},s=()=>{Object.keys(r).forEach(l=>r[l]=""),h()};return(l,i)=>(e.openBlock(),e.createBlock(he,{"v-model":r,columns:d,"show-number":3,onChangeFormItem:m,onSearchHandle:h,onHandleReset:s},null,8,["v-model"]))}}),it=t=>{const a=e.ref([]),o=e.ref(0),n=1e4,r=e.computed(()=>{var g;return(g=t.value.storageSkus)==null?void 0:g.reduce((k,P)=>k+=P.purchaseNum||0,0)}),u=e.computed(()=>{var g;return((g=t.value.storageSkus)==null?void 0:g.reduce((k,P)=>{var N;const z=P.purchaseNum?(N=new Z(P.salePrice))==null?void 0:N.div(1e4).mul(new Z(P.purchaseNum)):new Z(0);return new Z(k).plus(z)},new Z(0)))||new Z(0)}),d=e.computed(()=>{var k;const g=((k=t.value.storageSkus)==null?void 0:k.map(P=>(P==null?void 0:P.stockType)==="UNLIMITED"?n:Number((P==null?void 0:P.stock)||0)))||[];return Math.min(...g)}),f=e.computed(()=>u.value.plus(new Z(o.value))),m=g=>{var k;(k=t.value.storageSkus)==null||k.forEach(P=>P.purchaseNum=g)},h=async()=>{var k;let g=[];try{const P=await De();g=(k=P==null?void 0:P.data)==null?void 0:k.records}finally{a.value=g}},y=async()=>{var z;const g=a.value.find(N=>N.id===s.receiveId);if(!g)return;const k=[g==null?void 0:g.provinceCode,g==null?void 0:g.cityCode,g==null?void 0:g.regionCode];let P=0;try{const N=await ke({receiverAreaCode:k,freeRight:!1,distributionMode:["EXPRESS"],address:g==null?void 0:g.address,shopFreights:[t.value].map(F=>{var I;return{shopId:F.shopId,freights:[{templateId:F.freightTemplateId,skuInfos:(I=F.storageSkus)==null?void 0:I.map(M=>({price:M.salePrice,skuId:M.id,num:M.purchaseNum||0,weight:M.weight}))}]}})});P=Object.values(((z=N==null?void 0:N.data)==null?void 0:z.EXPRESS)||{}).reduce((F,I)=>F+=I,0)}finally{o.value=P}},s=e.reactive({remark:"",receiveId:""}),l=e.computed(()=>({totalNum:r.value,receive:s.receiveId}));return e.watch(()=>l.value,()=>y()),{receiveList:a,freightTotal:o,maxUnlimitedNum:n,totalNum:r,totalPrice:u,maxBatchNum:d,totalOrderPrice:f,changeBatchPurchaseNum:m,fetchReceiveAddress:h,purchaseFormModel:s,getOrderConfig:()=>{const g=dt(a.value,s.receiveId),k="PURCHASE",P=s.remark,z=ct(t);return{receiver:g,sellType:k,remark:P,suppliers:z}},handleRemove:g=>{L.ElMessageBox.confirm("确认移除当前规格信息").then(()=>{var k;(k=t.value.storageSkus)==null||k.splice(g,1)})}}},ct=t=>{var o;const a={supplierId:t.value.shopId,productSkus:{}};return(o=t.value.storageSkus)==null||o.forEach(n=>{n.purchaseNum&&(a.productSkus[t.value.id],a.productSkus[t.value.id]||(a.productSkus[t.value.id]=[]),a.productSkus[t.value.id].push({skuId:n.id,num:n.purchaseNum}))}),[a]},dt=(t,a="")=>{const o=t.find(n=>n.id===a);return o?{name:o.contactName,mobile:o.contactPhone,areaCode:[o==null?void 0:o.provinceCode,o==null?void 0:o.cityCode,o==null?void 0:o.regionCode],address:o==null?void 0:o.address}:{name:"",mobile:"",areaCode:[],address:""}},pt={class:"purchase"},mt={key:0,class:"purchase__batch"},ft={class:"commodity-info"},ht=["src"],ut={class:"purchase__total"},gt={class:"purchase__total--line"},_t={class:"purchase__total--line"},yt={class:"purchase__total--line"},xt={class:"purchase__total--line"},Nt=e.defineComponent({__name:"purchase",props:{lines:{default:()=>({id:"",albumPics:"",productName:"",salePrices:[],sellType:"PURCHASE",shopId:"",shopName:"",shopOwnProductStockNum:0,storageSkus:[]})}},emits:["update:lines"],setup(t,{expose:a,emit:o}){const n=e.ref(1),r=t,u=o,d=e.computed({get(){return r.lines},set(N){u("update:lines",N)}}),{maxUnlimitedNum:f,totalNum:m,freightTotal:h,totalPrice:y,maxBatchNum:s,totalOrderPrice:l,changeBatchPurchaseNum:i,receiveList:x,fetchReceiveAddress:g,purchaseFormModel:k,getOrderConfig:P,handleRemove:z}=it(d);return e.onMounted(()=>g()),a({getOrderConfig:P}),(N,U)=>{const F=e.resolveComponent("el-input-number"),I=e.resolveComponent("el-form-item"),M=e.resolveComponent("el-form"),p=e.resolveComponent("el-table-column"),c=e.resolveComponent("el-button"),_=e.resolveComponent("el-table"),$=e.resolveComponent("el-option"),R=e.resolveComponent("el-select"),q=e.resolveComponent("el-input");return e.openBlock(),e.createElementBlock("div",pt,[d.value.storageSkus&&d.value.storageSkus.length>1?(e.openBlock(),e.createElementBlock("div",mt,[e.createVNode(M,{"show-message":!1,inline:""},{default:e.withCtx(()=>[e.createVNode(I,{label:"采购数(批量)"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:n.value,"onUpdate:modelValue":U[0]||(U[0]=D=>n.value=D),max:+e.unref(s),min:0,onChange:e.unref(i)},null,8,["modelValue","max","onChange"])]),_:1})]),_:1})])):e.createCommentVNode("",!0),e.createVNode(_,{data:d.value.storageSkus,"max-height":350},{default:e.withCtx(()=>{var D;return[((D=d.value.storageSkus)==null?void 0:D.length)===1?(e.openBlock(),e.createBlock(p,{key:0,label:"商品名称","min-width":"250"},{default:e.withCtx(()=>{var E,K;return[e.createElementVNode("div",ft,[e.createElementVNode("img",{src:(K=(E=d.value.albumPics)==null?void 0:E.split(","))==null?void 0:K.shift()},null,8,ht),e.createElementVNode("span",null,e.toDisplayString(d.value.productName),1)])]}),_:1})):(e.openBlock(),e.createBlock(p,{key:1,label:"商品规格","min-width":"250"},{default:e.withCtx(({row:E})=>{var K;return[e.createTextVNode(e.toDisplayString(((K=E==null?void 0:E.specs)==null?void 0:K.join(","))||"单规格"),1)]}),_:1})),e.createVNode(p,{align:"center",label:"供货价",width:"150"},{default:e.withCtx(({row:E})=>[e.createTextVNode(" ￥"+e.toDisplayString((E==null?void 0:E.salePrice)/1e4),1)]),_:1}),e.createVNode(p,{align:"center",label:"起批数",prop:"minimumPurchase",width:"80"}),e.createVNode(p,{align:"center",label:"供应商库存",width:"100"},{default:e.withCtx(({row:E})=>[e.createTextVNode(e.toDisplayString((E==null?void 0:E.stockType)==="UNLIMITED"?"无限库存":E.stock),1)]),_:1}),e.createVNode(p,{align:"center",label:"自有库存",prop:"shopOwnProductStockNum",width:"80"}),e.createVNode(p,{align:"center",label:"采购数",width:"180"},{default:e.withCtx(({row:E})=>[e.createVNode(F,{modelValue:E.purchaseNum,"onUpdate:modelValue":K=>E.purchaseNum=K,max:(E==null?void 0:E.stockType)==="UNLIMITED"?+e.unref(f):+E.stock,min:+E.minimumPurchase,placeholder:"请输入",precision:0},null,8,["modelValue","onUpdate:modelValue","max","min"])]),_:1}),e.createVNode(p,{fixed:"right",label:"操作",width:"80"},{default:e.withCtx(({$index:E})=>[e.createVNode(c,{link:"",size:"small",type:"danger",onClick:K=>e.unref(z)(E)},{default:e.withCtx(()=>U[3]||(U[3]=[e.createTextVNode("移除")])),_:2},1032,["onClick"])]),_:1})]}),_:1},8,["data"]),e.createVNode(M,{"show-message":!1,class:"purchase__remark"},{default:e.withCtx(()=>[e.createVNode(I,{label:"收货人信息"},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:e.unref(k).receiveId,"onUpdate:modelValue":U[1]||(U[1]=D=>e.unref(k).receiveId=D),style:{width:"100%"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),D=>(e.openBlock(),e.createBlock($,{key:D.id,label:D.contactName+"  "+D.contactPhone+"   "+D.address,value:D.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(I,{label:"采购备注"},{default:e.withCtx(()=>[e.createVNode(q,{modelValue:e.unref(k).remark,"onUpdate:modelValue":U[2]||(U[2]=D=>e.unref(k).remark=D),placeholder:"请输入采购备注(100字以内)",maxlength:"100",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e.createElementVNode("div",ut,[U[4]||(U[4]=e.createElementVNode("div",{class:"purchase__total--title"},"订单合计",-1)),e.createElementVNode("div",gt,"采购数量："+e.toDisplayString(e.unref(m)),1),e.createElementVNode("div",_t,"商品总价："+e.toDisplayString(e.unref(y)),1),e.createElementVNode("div",yt,"运费："+e.toDisplayString(e.unref(h).toFixed(2)),1),e.createElementVNode("div",xt,"采购金额(应付款)：￥"+e.toDisplayString(e.unref(l)),1)])])}}}),On="",ee=(t,a)=>{const o=t.__vccOpts||t;for(const[n,r]of a)o[n]=r;return o},Ct=ee(Nt,[["__scopeId","data-v-4081a379"]]),Vt=t=>{const a=e.reactive({page:1,pageSize:5,total:0}),o=e.reactive({remark:"",receiveId:""}),n=e.ref(0),r=t,u=e.ref(0),d=e.ref([]),f=e.ref([]),m=(p,c)=>{d.value=c.map(_=>_.id)},h=p=>{e.nextTick(()=>{var $,R;const c=r.value.findIndex(q=>q.id===p),_=(R=($=r.value[c])==null?void 0:$.storageSkus)==null?void 0:R.reduce((q,D)=>q+Number(D.purchaseNum||0),0);r.value[c].totalPurchase=_})},y=e.computed(()=>p=>{var _;let c=0;return(_=p==null?void 0:p.skus)==null||_.forEach($=>{$.lotStartingNum>c&&(c=$.lotStartingNum)}),+c}),s=e.computed(()=>p=>{var _,$,R,q,D;if((($=(_=p==null?void 0:p.storageSkus)==null?void 0:_[0])==null?void 0:$.stockType)==="UNLIMITED")return 1e5;let c=(q=(R=p==null?void 0:p.skus)==null?void 0:R[0])==null?void 0:q.supplierInventory;return(D=p==null?void 0:p.skus)==null||D.forEach(E=>{E.supplierInventory<c&&(c=E.supplierInventory)}),+c}),l=e.computed(()=>p=>{const c=((p==null?void 0:p.salePrices)||[]).map(R=>Number(R)),_=Math.min(...c),$=Math.max(...c);return _===$?$/1e4:`${_/1e4}~${$/1e4}`}),i=e.computed(()=>r.value.reduce((p,c)=>{var _;return p+(((_=c.storageSkus)==null?void 0:_.reduce(($,R)=>$+=R.purchaseNum||0,0))||0)},0)),x=e.computed(()=>r.value.reduce((p,c)=>{var _;return p.add(((_=c.storageSkus)==null?void 0:_.reduce(($,R)=>{var D;const q=R.purchaseNum?(D=new Z(R.salePrice))==null?void 0:D.div(1e4).mul(new Z(R.purchaseNum||0)):new Z(0);return new Z($).plus(q)},new Z(0)))||new Z(0))},new Z(0))),g=e.computed(()=>x.value.add(new Z(u.value))),k=e.computed(()=>p=>{var c;return((c=p==null?void 0:p[0])==null?void 0:c.stockType)==="UNLIMITED"?"无限库存":p==null?void 0:p.reduce((_,$)=>_+=Number($.stock),0)}),P=(p,c)=>{var _,$;if(typeof c=="number"){const R=r.value.findIndex(q=>q.id===p);R>-1&&(($=(_=r.value[R])==null?void 0:_.storageSkus)==null||$.forEach(q=>{q.purchaseNum=c}),h(p))}},z=async()=>{var $;const p=f.value.find(R=>R.id===o.receiveId);if(!p)return;const c=[p==null?void 0:p.provinceCode,p==null?void 0:p.cityCode,p==null?void 0:p.regionCode];let _=0;try{const R=await ke({receiverAreaCode:c,freeRight:!1,distributionMode:["EXPRESS"],address:p==null?void 0:p.address,shopFreights:r.value.map(D=>{var E;return{shopId:D.shopId,freights:[{templateId:D.freightTemplateId,skuInfos:(E=D.storageSkus)==null?void 0:E.map(K=>({price:K.salePrice,skuId:K.id,num:K.purchaseNum||0,weight:K.weight}))}]}})});_=Object.values((($=R==null?void 0:R.data)==null?void 0:$.EXPRESS)||{}).reduce((D,E)=>D+=E,0)}finally{u.value=_}},N=async()=>{var c;let p=[];try{const _=await De();p=(c=_==null?void 0:_.data)==null?void 0:c.records}finally{f.value=p}},U=()=>{const p=St(f.value,o.receiveId),c="PURCHASE",_=o.remark,$=bt(r);return{receiver:p,sellType:c,remark:_,suppliers:$}},F=p=>{L.ElMessageBox.confirm("确认移除当前商品信息").then(()=>{t.value.splice(p,1),a.total=t.value.length,n.value=Date.now()})},I=(p,c)=>{L.ElMessageBox.confirm("确认移除当前规格信息").then(()=>{var _,$,R;(R=($=(_=t.value)==null?void 0:_[c])==null?void 0:$.storageSkus)==null||R.splice(p,1),t.value=t.value.filter(q=>q.storageSkus&&q.storageSkus.length>0),e.nextTick(()=>{a.total=t.value.length}),n.value=Date.now()})},M=e.computed(()=>({totalNum:i.value,receive:o.receiveId}));return e.watch(()=>M.value,()=>z()),{totalPrice:x,totalNum:i,totalOrderPrice:g,freightTotal:u,purchaseFormModel:o,tableData:r,expandRowKeys:d,expandOpen:m,handleChangePurchaseNum:h,minRowBatchNum:y,maxRowBatchNum:s,computedSalePrice:l,computedSuplier:k,changeRowBatchNum:P,getFreightCount:z,receiveList:f,fetchReceiveAddress:N,getOrderConfig:U,handleRemoveBatch:F,handleRemoveSku:I,refreshKey:n,paginationOptions:a}},bt=t=>{const a=[];return t.value.forEach(o=>{var r;let n=a.findIndex(u=>u.supplierId===o.shopId);n===-1&&(n=a.push({supplierId:o.shopId,productSkus:{}})-1),(r=o.storageSkus)==null||r.forEach(u=>{u.purchaseNum&&(a[n].productSkus[o.id],a[n].productSkus[o.id]||(a[n].productSkus[o.id]=[]),a[n].productSkus[o.id].push({skuId:u.id,num:u.purchaseNum}))})}),a.filter(o=>Object.keys(o==null?void 0:o.productSkus).length>0)},St=(t,a="")=>{const o=t.find(n=>n.id===a);return o?{name:o.contactName,mobile:o.contactPhone,areaCode:[o==null?void 0:o.provinceCode,o==null?void 0:o.cityCode,o==null?void 0:o.regionCode],address:o==null?void 0:o.address}:{name:"",mobile:"",areaCode:[],address:""}},kt={class:"oneClickProcurement"},Et={class:"oneClickProcurement__expand"},Tt={class:"oneClickProcurement__form"},It={class:"oneClickProcurement__commodity"},Dt=["src"],Pt={class:"oneClickProcurement__commodity--name"},$t={class:"oneClickProcurement__pagination"},Bt={class:"oneClickProcurement__total"},Lt={class:"oneClickProcurement__total--line"},Ot={class:"oneClickProcurement__total--line"},wt={class:"oneClickProcurement__total--line"},Rt={class:"oneClickProcurement__total--line"},Mt=1e5,At=e.defineComponent({__name:"batch-purchase",props:{lines:{default:()=>[]}},emits:["update:lines"],setup(t,{expose:a,emit:o}){const n=t,r=e.computed({get(){return n.lines},set(D){$("update:lines",D)}}),u=e.computed(()=>r.value.filter((D,E)=>E>=(_.page-1)*_.pageSize&&E<_.page*_.pageSize)),d=D=>D.storageSkus.find(ae=>ae.stockType==="UNLIMITED")?"UNLIMITED":D.storageSkus.some(ae=>ae.stock>0)?"STOCK":!1,f=(D,E)=>{if(!D)return 0;if(D==="UNLIMITED")return"无限库存";if(D==="STOCK")return P.value(E==null?void 0:E.storageSkus)},{receiveList:m,fetchReceiveAddress:h,purchaseFormModel:y,expandRowKeys:s,expandOpen:l,handleChangePurchaseNum:i,minRowBatchNum:x,maxRowBatchNum:g,computedSalePrice:k,computedSuplier:P,changeRowBatchNum:z,freightTotal:N,totalNum:U,totalPrice:F,totalOrderPrice:I,getOrderConfig:M,handleRemoveBatch:p,handleRemoveSku:c,paginationOptions:_}=Vt(r),$=o,R=D=>{_.pageSize=D},q=D=>{_.page=D};return e.onMounted(()=>{_.total=r.value.length,h()}),a({getOrderConfig:M}),(D,E)=>{const K=e.resolveComponent("el-option"),ae=e.resolveComponent("el-select"),se=e.resolveComponent("el-form-item"),S=e.resolveComponent("el-input"),C=e.resolveComponent("el-form"),j=e.resolveComponent("el-input-number"),O=e.resolveComponent("el-table-column"),G=e.resolveComponent("el-link"),ne=e.resolveComponent("el-table"),Q=e.resolveComponent("el-pagination");return e.openBlock(),e.createElementBlock("div",kt,[e.createVNode(C,{"show-message":!1,class:"oneClickProcurement__remark"},{default:e.withCtx(()=>[e.createVNode(se,{label:"收货人信息"},{default:e.withCtx(()=>[e.createVNode(ae,{modelValue:e.unref(y).receiveId,"onUpdate:modelValue":E[0]||(E[0]=V=>e.unref(y).receiveId=V),style:{width:"100%"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),V=>(e.openBlock(),e.createBlock(K,{key:V.id,label:V.contactName+"  "+V.contactPhone+"   "+V.address,value:V.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(se,{label:"采购备注"},{default:e.withCtx(()=>[e.createVNode(S,{modelValue:e.unref(y).remark,"onUpdate:modelValue":E[1]||(E[1]=V=>e.unref(y).remark=V),placeholder:"请输入采购备注(100字以内)",maxlength:"100",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(ne,{data:u.value,"expand-row-keys":e.unref(s),"row-key":"id","max-height":"450",onExpandChange:e.unref(l)},{default:e.withCtx(()=>[e.createVNode(O,{type:"expand"},{default:e.withCtx(({row:V,$index:v})=>[e.createElementVNode("div",Et,[e.createElementVNode("div",Tt,[e.createVNode(C,null,{default:e.withCtx(()=>[e.createVNode(se,{label:"采购数(批量)"},{default:e.withCtx(()=>[e.createVNode(j,{modelValue:V.batchNum,"onUpdate:modelValue":A=>V.batchNum=A,max:e.unref(g)(V),min:e.unref(x)(V),precision:0,onChange:A=>e.unref(z)(V.id,A)},null,8,["modelValue","onUpdate:modelValue","max","min","onChange"])]),_:2},1024)]),_:2},1024)]),e.createVNode(ne,{data:V.storageSkus,"row-key":"id"},{default:e.withCtx(()=>[e.createVNode(O,{label:"商品规格"},{default:e.withCtx(({row:A})=>{var w;return[e.createTextVNode(e.toDisplayString(((w=A==null?void 0:A.specs)==null?void 0:w.join(","))||"单规格"),1)]}),_:1}),e.createVNode(O,{label:"供货价",width:"130"},{default:e.withCtx(({row:A})=>[e.createTextVNode(" ￥"+e.toDisplayString((A==null?void 0:A.salePrice)/1e4),1)]),_:1}),e.createVNode(O,{label:"起批数",prop:"minimumPurchase",width:"80"}),e.createVNode(O,{label:"供应商库存",prop:"stock",width:"100"},{default:e.withCtx(({row:A})=>[e.createTextVNode(e.toDisplayString((A==null?void 0:A.stockType)==="UNLIMITED"?"无限库存":A.stock),1)]),_:1}),e.createVNode(O,{label:"自有库存",prop:"shopOwnProductStockNum",width:"80"}),e.createVNode(O,{label:"采购数",prop:"purchaseNum"},{default:e.withCtx(({row:A})=>[e.createVNode(j,{modelValue:A.purchaseNum,"onUpdate:modelValue":w=>A.purchaseNum=w,max:A.stockType==="UNLIMITED"?+Mt:+A.stock,min:+A.minimumPurchase,precision:0,onChange:w=>e.unref(i)(V.id)},null,8,["modelValue","onUpdate:modelValue","max","min","onChange"])]),_:2},1024),e.createVNode(O,{fixed:"right",label:"操作",width:"80"},{default:e.withCtx(({$index:A})=>[e.createVNode(G,{type:"danger",onClick:w=>e.unref(c)(A,v)},{default:e.withCtx(()=>E[2]||(E[2]=[e.createTextVNode("移出")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])])]),_:1}),e.createVNode(O,{label:"供应商",prop:"supplierName"}),e.createVNode(O,{label:"商品名称",width:"250"},{default:e.withCtx(({row:V})=>{var v;return[e.createElementVNode("div",It,[e.createElementVNode("img",{src:(v=V.albumPics)==null?void 0:v.split(",").shift()},null,8,Dt),e.createElementVNode("span",Pt,e.toDisplayString(V.productName),1)])]}),_:1}),e.createVNode(O,{label:"供货价"},{default:e.withCtx(({row:V})=>[e.createTextVNode("￥"+e.toDisplayString(e.unref(k)(V)),1)]),_:1}),e.createVNode(O,{label:"供应商库存"},{default:e.withCtx(({row:V})=>[e.createTextVNode(e.toDisplayString(f(d(V),V)),1)]),_:1}),e.createVNode(O,{label:"自有库存",prop:"shopOwnProductStockNum"}),e.createVNode(O,{label:"采购数",prop:"totalPurchase"}),e.createVNode(O,{label:"操作"},{default:e.withCtx(({$index:V})=>[e.createVNode(G,{type:"danger",onClick:v=>e.unref(p)(V)},{default:e.withCtx(()=>E[3]||(E[3]=[e.createTextVNode("移出")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","expand-row-keys","onExpandChange"]),e.createElementVNode("div",$t,[e.createVNode(Q,{"current-page":e.unref(_).page,"page-size":e.unref(_).pageSize,"page-sizes":[5,10,15,20],total:e.unref(_).total,layout:"total, prev, pager, next, sizes",onSizeChange:R,onCurrentChange:q},null,8,["current-page","page-size","total"])]),e.createElementVNode("div",Bt,[E[4]||(E[4]=e.createElementVNode("div",{class:"oneClickProcurement__total--title"},"订单合计",-1)),e.createElementVNode("div",Lt,"采购数量："+e.toDisplayString(e.unref(U)),1),e.createElementVNode("div",Ot,"商品总价："+e.toDisplayString(e.unref(F)),1),e.createElementVNode("div",wt,"运费："+e.toDisplayString(e.unref(N).toFixed(2)),1),e.createElementVNode("div",Rt,"采购金额(应付款)：￥"+e.toDisplayString(e.unref(I)),1)])])}}}),Rn="",zt=ee(At,[["__scopeId","data-v-3d16b876"]]),Ut={class:"details"},Ft={class:"details__line"},jt=["src"],qt={class:"details__line"},Ht=e.defineComponent({__name:"details",props:{detailsInfo:{type:Object,default:()=>({})}},setup(t){const{divTenThousand:a}=ie(),o=t;return(n,r)=>{var f,m,h,y,s;const u=e.resolveComponent("el-table-column"),d=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",Ut,[e.createElementVNode("div",Ft,[r[0]||(r[0]=e.createElementVNode("span",{class:"details__line--label"},"商品图片：",-1)),e.createElementVNode("img",{src:(h=(m=(f=o.detailsInfo)==null?void 0:f.albumPics)==null?void 0:m.split(","))==null?void 0:h.shift(),class:"details__img"},null,8,jt)]),e.createElementVNode("div",qt,"商品名称："+e.toDisplayString((y=o.detailsInfo)==null?void 0:y.productName),1),e.createVNode(d,{data:((s=o.detailsInfo)==null?void 0:s.storageSkus)||[]},{default:e.withCtx(()=>[e.createVNode(u,{label:"商品规格"},{default:e.withCtx(({row:l})=>{var i,x;return[e.createTextVNode(e.toDisplayString((i=l==null?void 0:l.specs)!=null&&i.length?(x=l==null?void 0:l.specs)==null?void 0:x.join(","):"单规格"),1)]}),_:1}),e.createVNode(u,{align:"center",label:"供货价",width:"150"},{default:e.withCtx(({row:l})=>[e.createTextVNode(" ￥"+e.toDisplayString(e.unref(a)(l==null?void 0:l.salePrice)),1)]),_:1}),e.createVNode(u,{align:"center",label:"起批数",width:"150",prop:"minimumPurchase"}),e.createVNode(u,{align:"center",label:"供应商库存",width:"150",prop:"stock"}),e.createVNode(u,{align:"center",label:"自有库存",width:"150",prop:"shopOwnProductStockNum"})]),_:1},8,["data"])])}}}),Mn="",Gt=ee(Ht,[["__scopeId","data-v-82366355"]]),Yt=()=>{const t=e.ref(!1),a=e.ref([]),o=d=>{var f;return(f=d.storageSkus)==null?void 0:f.map(m=>({...m,purchaseNum:1}))},n=(d=[])=>{a.value=d.map(f=>({...f,batchNum:1,totalPurchase:f.storageSkus.length,storageSkus:o(f)}))},r=(d=[])=>{a.value=d.map(f=>({...f,batchNum:1,totalPurchase:f.storageSkus.length,storageSkus:o(f)})),t.value=!0},u=e.ref(!1);return{batchPurchaseLines:a,showBatchDialog:t,openBatchDialog:r,setBatchPurchaseLines:n,batchDialogConfirmLoading:u}},Wt={class:"tools"},Kt={style:{color:"#999"}},Xt={class:"table_container"},Jt={class:"commodity-info"},Zt=["src"],Qt={class:"name fdc"},vt={key:1},eo={class:"type_tag"},to={style:{color:"#f54319"}},oo={class:"customer"},ao={class:"customer__name"},no={class:"dialog-footer"},lo={class:"dialog-footer"},so=e.defineComponent({__name:"index",setup(t){const a=(S,C)=>S.storageSkus?S.storageSkus.find(G=>G.stockType==="UNLIMITED")?"UNLIMITED":S.storageSkus.some(G=>Number(G.stock)>0)?"STOCK":!1:!1,o=(S,C)=>{if(!S)return 0;if(S==="UNLIMITED")return"无限库存";if(S==="STOCK")return N.value(C==null?void 0:C.storageSkus)},n=e.ref(),r=e.ref(!1),u=e.ref(),d=e.computed(()=>{var S,C;return((C=(S=u.value)==null?void 0:S.getSelectionRows)==null?void 0:C.call(S))||[]}),f=e.ref({}),m=e.ref([]),h=e.ref(!1),y=pe.useRouter(),s=pe.useRoute(),l=e.reactive({page:{current:1,size:10},total:0});s.query.supplierGoodsName&&(f.value.supplierGoodsName=s.query.supplierGoodsName);const i=(S={})=>{f.value=S,l.page.current=1,g()},x=e.ref(),g=async()=>{const S=await He({...l.page,sellType:"PURCHASE",...f.value});S.data&&(l.total=Number(S.data.total),m.value=S.data.records.map(C=>({...C,disabled:!a(C)})))};g();const k=S=>{var C,j,O;if(S)x.value={...S,purchaseNum:1,storageSkus:((j=(C=S.storageSkus)==null?void 0:C.map(G=>({...G,purchaseNum:1})))==null?void 0:j.filter(G=>G.stockType==="LIMITED"&&Number(G.stock||0)>=G.minimumPurchase||G.stockType==="UNLIMITED"))||[]},h.value=!0;else{if(d.value.length===0){L.ElMessage.error({message:"请选择需要采购的商品"});return}p((O=d.value)==null?void 0:O.map(G=>{var ne;return{...G,storageSkus:(ne=G.storageSkus)==null?void 0:ne.filter(Q=>Q.stockType==="LIMITED"&&Number(Q.stock||0)>Q.minimumPurchase||Q.stockType==="UNLIMITED")}}))}},P=S=>{_e(ce.useShopInfoStore().shopInfo.id,S.shopId).then(({code:C})=>{C===200&&y.push({path:"/message/customer/supplierService",query:{id:S.shopId}})})},z=e.computed(()=>S=>{const C=Math.min(...S.storageSkus.map(O=>Number(O.salePrice))),j=Math.max(...S.storageSkus.map(O=>Number(O.salePrice)));return C===j?j/1e4:`${C/1e4}~￥${j/1e4}`}),N=e.computed(()=>S=>{var C;return((C=S==null?void 0:S[0])==null?void 0:C.stockType)==="UNLIMITED"?"无限库存":S==null?void 0:S.reduce((j,O)=>j+=Number(O.stock),0)}),U=e.ref(null),F=e.ref(!1),I=e.ref(null),{showBatchDialog:M,openBatchDialog:p,batchPurchaseLines:c,batchDialogConfirmLoading:_}=Yt();let $=0;const R=async()=>{var j,O,G;F.value=!0,$=0;const S=(j=U.value)==null?void 0:j.getOrderConfig();if(!(S!=null&&S.receiver.mobile))return F.value=!1,L.ElMessage.error("请选择收货人信息");const C=await Ee(S);C.code===200?(O=C.data)!=null&&O.mainNo&&D((G=C.data)==null?void 0:G.mainNo):C.code===210004?(L.ElMessage.error(C.msg),g(),q()):L.ElMessage.error(C.msg||"采购失败")},q=()=>{h.value=!1,M.value=!1,F.value=!1,_.value=!1,g()},D=async S=>{if($++,$===20){F.value=!1,_.value=!1,L.ElMessage.error("创建失败，请稍后重试");return}const C=await Ge(S);console.log(C),C.data?(L.ElMessage.success("采购订单创建成功"),q()):setTimeout(()=>{D(S)},1e3)},E=async()=>{var j,O,G;_.value=!0;const S=(j=I.value)==null?void 0:j.getOrderConfig();if(!(S!=null&&S.receiver.mobile))return _.value=!1,L.ElMessage.error("请选择收货人信息");const C=await Ee(S);C.code===200?(O=C.data)!=null&&O.mainNo&&D((G=C.data)==null?void 0:G.mainNo):C.code===210004?(L.ElMessage.error(C.msg),g(),q()):L.ElMessage.error(C.msg||"采购失败")},K=S=>{n.value=S,r.value=!0},ae=S=>{l.page.size=S,g()},se=S=>{l.page.current=S,g()};return(S,C)=>{const j=e.resolveComponent("el-button"),O=e.resolveComponent("el-table-column"),G=e.resolveComponent("el-tooltip"),ne=e.resolveComponent("el-table"),Q=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(rt,{onSearch:i}),e.createElementVNode("div",Wt,[e.createElementVNode("span",Kt,"已选"+e.toDisplayString(d.value.length)+"条 ",1),e.createVNode(j,{type:"primary",onClick:C[0]||(C[0]=V=>k())},{default:e.withCtx(()=>C[8]||(C[8]=[e.createTextVNode("一键采购")])),_:1})]),e.createElementVNode("div",Xt,[e.createVNode(ne,{ref_key:"tableRef",ref:u,data:m.value,"header-cell-style":{background:"#F7F8FA",height:"48px",color:"#333"},"cell-style":{color:"#333333"}},{empty:e.withCtx(()=>[e.createVNode(Ve)]),default:e.withCtx(()=>[e.createVNode(O,{type:"selection",width:"40",selectable:a,fixed:"left"}),e.createVNode(O,{label:"商品",width:"350"},{default:e.withCtx(({row:V})=>{var v,A;return[e.createElementVNode("div",Jt,[e.createElementVNode("img",{src:(A=(v=V.albumPics)==null?void 0:v.split(","))==null?void 0:A.shift()},null,8,Zt),e.createElementVNode("div",Qt,[(V==null?void 0:V.productName.length)>=35?(e.openBlock(),e.createBlock(G,{key:0,class:"box-item",effect:"dark",content:V==null?void 0:V.productName,placement:"top"},{default:e.withCtx(()=>[e.createElementVNode("p",null,e.toDisplayString(V==null?void 0:V.productName),1)]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("p",vt,e.toDisplayString(V.productName),1)),e.createElementVNode("div",eo,e.toDisplayString(V.productType==="REAL_PRODUCT"?"实物商品":"虚拟商品"),1)])])]}),_:1}),e.createVNode(O,{label:"供货价",width:"180"},{default:e.withCtx(({row:V})=>[e.createElementVNode("span",to," ￥"+e.toDisplayString(z.value(V)),1)]),_:1}),e.createVNode(O,{label:"供应商库存",width:"120"},{default:e.withCtx(({row:V})=>[e.createTextVNode(e.toDisplayString(o(a(V),V)),1)]),_:1}),e.createVNode(O,{label:"自有库存",prop:"shopOwnProductStockNum",width:"100"},{default:e.withCtx(({row:V})=>{var v;return[e.createTextVNode(e.toDisplayString((v=V==null?void 0:V.storageSkus)==null?void 0:v.reduce((A,w)=>A+Number((w==null?void 0:w.shopOwnProductStockNum)||0),0)),1)]}),_:1}),e.createVNode(O,{label:"所属供应商",prop:"supplierName"},{default:e.withCtx(({row:V})=>[e.createElementVNode("div",oo,[e.createElementVNode("div",null,[e.createElementVNode("span",ao,e.toDisplayString(V.supplierName),1),e.createVNode(ge,{name:"icon-xiaoxi-copy",size:"18px",style:{cursor:"pointer"},svg:"",onClick:v=>P(V)},null,8,["onClick"])]),e.createElementVNode("span",null,e.toDisplayString(V.supplierContractNumber),1)])]),_:1}),e.createVNode(O,{label:"操作",width:"210",fixed:"right",align:"right"},{default:e.withCtx(({row:V})=>[e.createElementVNode("div",null,[e.createVNode(j,{link:"",type:"primary",size:"small",onClick:v=>K(V)},{default:e.withCtx(()=>C[9]||(C[9]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),e.createVNode(j,{link:"",size:"small",type:"primary",disabled:!a(V),onClick:v=>k(V)},{default:e.withCtx(()=>C[10]||(C[10]=[e.createTextVNode("一键采购")])),_:2},1032,["disabled","onClick"])])]),_:1})]),_:1},8,["data"])]),e.createVNode(ue,{"page-size":l.page.size,"page-num":l.page.current,total:l.total,onHandleSizeChange:ae,onHandleCurrentChange:se},null,8,["page-size","page-num","total"]),e.createVNode(Q,{modelValue:h.value,"onUpdate:modelValue":C[3]||(C[3]=V=>h.value=V),"close-on-click-modal":!1,"destroy-on-close":"",title:"一键采购",width:"1000px"},{footer:e.withCtx(()=>[e.createElementVNode("span",no,[e.createVNode(j,{onClick:C[2]||(C[2]=V=>h.value=!1)},{default:e.withCtx(()=>C[11]||(C[11]=[e.createTextVNode("取消")])),_:1}),e.createVNode(j,{loading:F.value,type:"primary",onClick:R},{default:e.withCtx(()=>C[12]||(C[12]=[e.createTextVNode(" 确认 ")])),_:1},8,["loading"])])]),default:e.withCtx(()=>[e.createVNode(Ct,{ref_key:"purchaseRef",ref:U,lines:x.value,"onUpdate:lines":C[1]||(C[1]=V=>x.value=V)},null,8,["lines"])]),_:1},8,["modelValue"]),e.createVNode(Q,{modelValue:e.unref(M),"onUpdate:modelValue":C[6]||(C[6]=V=>e.isRef(M)?M.value=V:null),"close-on-click-modal":!1,"destroy-on-close":"",title:"一键采购",top:"8vh",width:"1000px"},{footer:e.withCtx(()=>[e.createElementVNode("span",lo,[e.createVNode(j,{onClick:C[5]||(C[5]=V=>M.value=!1)},{default:e.withCtx(()=>C[13]||(C[13]=[e.createTextVNode("取消")])),_:1}),e.createVNode(j,{loading:e.unref(_),type:"primary",onClick:E},{default:e.withCtx(()=>C[14]||(C[14]=[e.createTextVNode(" 确认 ")])),_:1},8,["loading"])])]),default:e.withCtx(()=>[e.createVNode(zt,{ref_key:"batchPurchaseRef",ref:I,lines:e.unref(c),"onUpdate:lines":C[4]||(C[4]=V=>e.isRef(c)?c.value=V:null)},null,8,["lines"])]),_:1},8,["modelValue"]),e.createVNode(Q,{modelValue:r.value,"onUpdate:modelValue":C[7]||(C[7]=V=>r.value=V),"close-on-click-modal":!1,"destroy-on-close":"",title:"商品详情",width:"1000px"},{default:e.withCtx(()=>[e.createVNode(Gt,{"details-info":n.value},null,8,["details-info"])]),_:1},8,["modelValue"])],64)}}}),zn="",ro=Object.freeze(Object.defineProperty({__proto__:null,default:ee(so,[["__scopeId","data-v-3707842f"]])},Symbol.toStringTag,{value:"Module"})),io=e.defineComponent({__name:"search",emits:["search","supplierExport"],setup(t,{emit:a}){const o=e.ref([]),n=a,r=e.reactive({supplierId:"",no:"",date:""}),u=[{label:"订单号",prop:"no",valueType:"copy",fieldProps:{placeholder:"请输入订单号"}},{label:"供应商名称",labelWidth:85,prop:"supplierId",valueType:"select",options:o,fieldProps:{placeholder:"请输入店铺名称",props:{value:"id",label:"name",expandTrigger:"hover"},filterable:!0,remote:!0,reserveKeyword:!0,remoteMethod:s=>{f(s)}}},{label:"下单时间",prop:"date",valueType:"date-picker",fieldProps:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",format:"YYYY/MM/DD",valueFormat:"YYYY-MM-DD"}}],d=()=>{var l,i;const s=fe.cloneDeep(r);s.startTime=Array.isArray(s.date)?(l=s.date)==null?void 0:l[0]:void 0,s.endTime=Array.isArray(s.date)?(i=s.date)==null?void 0:i[1]:void 0,delete s.date,n("search",s)},f=async(s="")=>{var i;const l=await ye({supplierName:s});l.data&&((i=l.data)!=null&&i.length)&&(o.value=l.data.map(x=>({label:x.name,value:x.id})))},m=s=>{s&&Object.keys(s).forEach(l=>r[l]=s[l])},h=()=>{Object.keys(r).forEach(s=>r[s]=""),d()},y=()=>{n("supplierExport",r)};return(s,l)=>{const i=e.resolveComponent("el-button");return e.openBlock(),e.createBlock(he,{"v-model":r,columns:u,"show-number":3,onChangeFormItem:m,onSearchHandle:d,onHandleReset:h},{otherOperations:e.withCtx(()=>[e.createVNode(i,{class:"from_btn",round:"",type:"primary",onClick:y},{default:e.withCtx(()=>l[0]||(l[0]=[e.createTextVNode("导出")])),_:1})]),_:1},8,["v-model"])}}}),Le={UNPAID:"待支付",PAYMENT_AUDIT:"待审核",WAITING_FOR_DELIVER:"待发货",WAITING_FOR_PUTIN:"待入库",FINISHED:"已完成",CLOSED:"已关闭"};function co(t,a=1e3,o={}){const{immediate:n=!0,immediateCallback:r=!1}=o;let u=null;const d=e.ref(!1);function f(){u&&(clearInterval(u),u=null)}function m(){d.value=!1,f()}function h(){a<=0||(d.value=!0,r&&t(),f(),u=setInterval(t,a))}return n&&h(),{isActive:d,pause:m,resume:h,clean:f}}const po=(t,a)=>{const o=e.reactive({day:"00",hours:"00",minutes:"00",seconds:"00"});if(!a)return{...e.toRefs(o)};const u=new Date(t.replaceAll("-","/")).getTime()+parseInt(a)*1e3-new Date().getTime(),{day:d,hours:f,minutes:m,seconds:h}=mo(u);return o.day=d,o.hours=f,o.minutes=m,o.seconds=h,{...e.toRefs(o)}},mo=t=>{let r=0,u=0,d=0,f=0;for(;t>864e5;)t-=864e5,r++;for(;t>36e5;)t-=36e5,u++;for(;t>6e4;)t-=6e4,d++;for(;t>1e3;)t-=1e3,f++;return{day:String(r).padStart(2,"0"),hours:String(u).padStart(2,"0"),minutes:String(d).padStart(2,"0"),seconds:String(f).padStart(2,"0")}},fo={class:"count-down"},ho={key:0},uo=e.defineComponent({__name:"index",props:{createTime:{default:""},payTimeout:{default:""}},setup(t){const a=t,o=e.reactive({day:"00",hours:"00",minutes:"00",seconds:"00"}),n=e.ref(!0),{clean:r}=co(()=>{const{day:u,hours:d,minutes:f,seconds:m}=po(a.createTime,a.payTimeout);o.day=u.value,o.hours=d.value,o.minutes=f.value,o.seconds=m.value,u.value==="00"&&d.value==="00"&&f.value==="00"&&m.value==="00"?(n.value=!0,e.nextTick(()=>r())):n.value=!1},1e3,{immediate:!0,immediateCallback:!0});return e.onBeforeUnmount(()=>r()),(u,d)=>(e.openBlock(),e.createElementBlock("div",null,[d[0]||(d[0]=e.createElementVNode("span",null,"(",-1)),e.createElementVNode("span",fo,[o.day!=="00"?(e.openBlock(),e.createElementBlock("span",ho,e.toDisplayString(o.day)+"天",1)):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(o.hours)+":"+e.toDisplayString(o.minutes)+":"+e.toDisplayString(o.seconds),1)]),d[1]||(d[1]=e.createElementVNode("span",null,")",-1))]))}}),Fn="",go=ee(uo,[["__scopeId","data-v-92288512"]]),_o=()=>{const t=e.ref(!1),a=e.ref("");return{showProof:t,goToShowProof:n=>{var r,u;a.value=((u=(r=n==null?void 0:n.extra)==null?void 0:r.pay)==null?void 0:u.proof)||"",t.value=!0},currentProof:a}},yo=e.defineComponent({__name:"pay-order",props:{price:{default:()=>new Z(0)}},setup(t,{expose:a}){const o=t,n=e.reactive({payType:"",proof:""}),r={payType:[{required:!0,message:"请选择支付方式",trigger:"blur"}],proof:[{validator:(f,m,h)=>{n.payType==="OFFLINE"&&(m||h(new Error("请上传凭证"))),h()},trigger:"change"}]},u=e.ref(null);return a({getPayOrderFormModel:()=>new Promise((f,m)=>{u.value?u.value.validate(h=>{h?f(n):m("valid error")}):m("none instance")})}),(f,m)=>{const h=e.resolveComponent("el-form-item"),y=e.resolveComponent("el-radio"),s=e.resolveComponent("el-radio-group"),l=e.resolveComponent("el-form");return e.openBlock(),e.createBlock(l,{ref_key:"formRef",ref:u,model:n,rules:r},{default:e.withCtx(()=>[e.createVNode(h,{label:"应付款(元)"},{default:e.withCtx(()=>[e.createTextVNode("￥"+e.toDisplayString(o.price),1)]),_:1}),e.createVNode(h,{label:"支付方式",prop:"payType"},{default:e.withCtx(()=>[e.createVNode(s,{modelValue:n.payType,"onUpdate:modelValue":m[0]||(m[0]=i=>n.payType=i)},{default:e.withCtx(()=>[e.createVNode(y,{value:"OFFLINE"},{default:e.withCtx(()=>m[2]||(m[2]=[e.createTextVNode("线下付款")])),_:1}),e.createVNode(y,{value:"BALANCE"},{default:e.withCtx(()=>m[3]||(m[3]=[e.createTextVNode("店铺余额")])),_:1})]),_:1},8,["modelValue"])]),_:1}),n.payType==="OFFLINE"?(e.openBlock(),e.createBlock(h,{key:0,label:"付款凭证",prop:"proof"},{default:e.withCtx(()=>[e.createVNode(Re,{src:n.proof,"onUpdate:src":m[1]||(m[1]=i=>n.proof=i),format:{size:1,width:1e4,height:1e4},cropper:!1,height:100,width:100},null,8,["src"])]),_:1})):e.createCommentVNode("",!0)]),_:1},8,["model"])}}}),xo={PERSONAL:"个人",ENTERPRISE:"企业"},No={VAT_GENERAL:"增值税电子普通发票",VAT_SPECIAL:"增值税电子专用发票"},Co={style:{padding:"0 30px"},class:"invoice-dialog"},Vo={class:"invoice-dialog-main"},bo={class:"invoice-dialog-main--name"},So={class:"invoice-dialog-main--price"},ko={class:"invoice-dialog-main--number"},Eo={class:"invoice-dialog-main__note"},To={class:"invoice-dialog-main__type"},Io={key:1},Do={key:0},Po={class:"invoice-dialog-main__content"},$o={style:{flex:"3"}},Bo={style:{flex:"3"}},Lo={style:{flex:"3"}},Oo={class:"invoice-dialog-main__content"},wo={style:{flex:"3"}},Ro={style:{flex:"3"}},Mo={style:{flex:"3"}},Ao={class:"invoice-dialog-main__content"},zo={style:{flex:"3"}},Uo={style:{flex:"6"}},Fo={key:0,class:"invoice-dialog-main__content"},jo=e.defineComponent({__name:"invoice-dialog-main",props:{invoiceDetail:{type:Object,default:()=>({})},invoiceSetType:{type:String,default:""}},emits:["update:invoiceDetail"],setup(t,{emit:a}){const o=t,n=a,r=Me.useVModel(o,"invoiceDetail",n),{divTenThousand:u}=ie(),d=e.ref([]),f=e.computed(()=>o.invoiceDetail.invoiceStatus!=="START"?o.invoiceDetail:d.value.find(h=>h.id===r.value.invoiceHeaderId));e.watchEffect(()=>{r.value.invoiceStatus==="START"&&m()});async function m(){const{data:h,msg:y,code:s}=await et();s===200&&(d.value=h.records)}return(h,y)=>{var k,P,z,N,U,F,I,M,p,c;const s=e.resolveComponent("el-input"),l=e.resolveComponent("el-radio"),i=e.resolveComponent("el-radio-group"),x=e.resolveComponent("el-option"),g=e.resolveComponent("el-select");return e.openBlock(),e.createElementBlock("div",Co,[e.createElementVNode("div",Vo,[e.createElementVNode("div",bo,[y[3]||(y[3]=e.createTextVNode(" 供应商名称：")),e.createElementVNode("span",null,e.toDisplayString(t.invoiceDetail.shopSupplierName),1)]),e.createElementVNode("div",null,[y[4]||(y[4]=e.createTextVNode(" 开票金额 ")),e.createElementVNode("span",So,e.toDisplayString(e.unref(u)(t.invoiceDetail.invoiceAmount).toFixed(2)),1)]),e.createElementVNode("div",ko,[y[5]||(y[5]=e.createTextVNode(" 订单号： ")),e.createElementVNode("span",null,e.toDisplayString(t.invoiceDetail.orderNo),1)])]),y[12]||(y[12]=e.createElementVNode("p",{class:"invoice-dialog-main--msg"}," 1、开票金额为消费者实付款金额，红包、优惠、购物券、消费返利等不在开票范围 2、如订单发生退货退款、退款，开票金额也将对应退款金额扣除。 ",-1)),e.createElementVNode("div",Eo,[y[6]||(y[6]=e.createElementVNode("span",{style:{"flex-shrink":"0"}},"开票备注：",-1)),t.invoiceDetail.invoiceStatus!=="START"?(e.openBlock(),e.createBlock(s,{key:0,"model-value":t.invoiceDetail.billingRemarks,rows:2,style:{"margin-left":"10px"},disabled:"",type:"textarea",maxlength:"100"},null,8,["model-value"])):(e.openBlock(),e.createBlock(s,{key:1,modelValue:e.unref(r).billingRemarks,"onUpdate:modelValue":y[0]||(y[0]=_=>e.unref(r).billingRemarks=_),rows:2,style:{"margin-left":"10px"},type:"textarea",maxlength:"100",placeholder:"选填"},null,8,["modelValue"]))]),e.createElementVNode("div",To,[e.createElementVNode("div",null,[y[9]||(y[9]=e.createElementVNode("span",{style:{"margin-right":"10px"}},"发票类型：",-1)),t.invoiceDetail.invoiceStatus==="START"?(e.openBlock(),e.createBlock(i,{key:0,modelValue:e.unref(r).invoiceType,"onUpdate:modelValue":y[1]||(y[1]=_=>e.unref(r).invoiceType=_)},{default:e.withCtx(()=>[t.invoiceSetType==="VAT_GENERAL"||t.invoiceSetType==="VAT_COMBINED"?(e.openBlock(),e.createBlock(l,{key:0,label:"VAT_GENERAL"},{default:e.withCtx(()=>y[7]||(y[7]=[e.createTextVNode("增值税电子普通发票")])),_:1})):e.createCommentVNode("",!0),t.invoiceSetType==="VAT_SPECIAL"||t.invoiceSetType==="VAT_COMBINED"?(e.openBlock(),e.createBlock(l,{key:1,label:"VAT_SPECIAL"},{default:e.withCtx(()=>y[8]||(y[8]=[e.createTextVNode("增值税电子专用发票")])),_:1})):e.createCommentVNode("",!0)]),_:1},8,["modelValue"])):(e.openBlock(),e.createElementBlock("span",Io,e.toDisplayString(e.unref(No)[t.invoiceDetail.invoiceType]),1))]),t.invoiceDetail.invoiceStatus==="START"?(e.openBlock(),e.createElementBlock("div",Do,[y[10]||(y[10]=e.createElementVNode("span",null,"抬头选择：",-1)),e.createVNode(g,{modelValue:e.unref(r).invoiceHeaderId,"onUpdate:modelValue":y[2]||(y[2]=_=>e.unref(r).invoiceHeaderId=_),placeholder:"请选择抬头",size:"small"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,_=>(e.openBlock(),e.createBlock(x,{key:_.id,label:_.header,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Po,[e.createElementVNode("div",$o,[y[11]||(y[11]=e.createTextVNode(" 抬头类型： ")),e.createElementVNode("span",null,e.toDisplayString(((k=f.value)==null?void 0:k.invoiceHeaderType)&&e.unref(xo)[f.value.invoiceHeaderType]),1)]),e.createElementVNode("div",Bo,"发票抬头： "+e.toDisplayString((P=f.value)==null?void 0:P.header),1),e.createElementVNode("div",Lo,"税号："+e.toDisplayString((z=f.value)==null?void 0:z.taxIdentNo),1)]),e.createElementVNode("div",Oo,[e.createElementVNode("div",wo,"开户行："+e.toDisplayString((N=f.value)==null?void 0:N.openingBank),1),e.createElementVNode("div",Ro,"银行账号："+e.toDisplayString((U=f.value)==null?void 0:U.bankAccountNo),1),e.createElementVNode("div",Mo,"企业电话："+e.toDisplayString((F=f.value)==null?void 0:F.enterprisePhone),1)]),e.createElementVNode("div",Ao,[e.createElementVNode("div",zo,"邮箱地址："+e.toDisplayString((I=f.value)==null?void 0:I.email),1),e.createElementVNode("div",Uo,"企业地址："+e.toDisplayString((M=f.value)==null?void 0:M.enterpriseAddress),1)]),(p=t.invoiceDetail)!=null&&p.denialReason?(e.openBlock(),e.createElementBlock("div",Fo,[e.createElementVNode("div",null,"拒绝原因："+e.toDisplayString((c=t.invoiceDetail)==null?void 0:c.denialReason),1)])):e.createCommentVNode("",!0)])}}}),qn="",qo=ee(jo,[["__scopeId","data-v-02ca7bd7"]]),Ho=t=>{const a=e.ref(""),o=e.ref([]),n=e.ref([]),r=(s,l)=>{console.log(s,"row.key",n.value.includes(s.productId)),n.value.includes(s.productId)?n.value=n.value.filter(i=>i!==s.productId):n.value.push(s.productId)},u=e.computed(()=>s=>{var i,x,g,k,P;let l=((x=(i=s==null?void 0:s.skus)==null?void 0:i[0])==null?void 0:x.num)-((k=(g=s==null?void 0:s.skus)==null?void 0:g[0])==null?void 0:k.used);return(P=s==null?void 0:s.skus)==null||P.forEach(z=>{const N=(z==null?void 0:z.num)-(z==null?void 0:z.used);N<l&&(l=N)}),l}),d=(s,l)=>{var i;if(typeof l=="number"){const x=o.value.findIndex(g=>g.productId===s);x>-1&&((i=o.value[x])==null||i.skus.forEach(g=>g.inStorageNum=l))}},f=e.computed(()=>s=>{const l=o.value.findIndex(i=>i.productId===s);return l>-1?o.value[l].skus.reduce((x,g)=>x+Number(g.inStorageNum),0):0});return{remark:a,tableData:o,expandRowKeys:n,expandOpen:r,maxRowBatchNum:u,changeRowBatchNum:d,computedActualNum:f,handleRemoveCommodity:s=>{L.ElMessageBox.confirm("确认移除当前商品信息").then(()=>{o.value.splice(s,1)})},handleRemoveSku:(s,l)=>{L.ElMessageBox.confirm("确认移除当前规格信息").then(()=>{var i,x,g;(g=(x=(i=o.value)==null?void 0:i[s])==null?void 0:x.skus)==null||g.splice(l,1)})},initialInstorageData:async()=>{var l,i;const s=await Te(t.orderNo);s.data&&(a.value=(l=s==null?void 0:s.data)==null?void 0:l.remark,o.value=(i=s.data)==null?void 0:i.products)}}},Go={class:"oneClickProcurement"},Yo={class:"oneClickProcurement__form"},Wo={class:"oneClickProcurement__commodity"},Ko=["src"],Xo={class:"oneClickProcurement__commodity--name"},Jo=e.defineComponent({__name:"in-storage",props:{orderNo:{default:""}},setup(t,{expose:a}){const o=t,{remark:n,tableData:r,expandRowKeys:u,expandOpen:d,maxRowBatchNum:f,changeRowBatchNum:m,computedActualNum:h,handleRemoveCommodity:y,handleRemoveSku:s,initialInstorageData:l}=Ho(o);return e.onMounted(()=>l()),a({tableData:r,remark:n}),(i,x)=>{const g=e.resolveComponent("el-input"),k=e.resolveComponent("el-form-item"),P=e.resolveComponent("el-form"),z=e.resolveComponent("el-input-number"),N=e.resolveComponent("el-table-column"),U=e.resolveComponent("el-link"),F=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",Go,[e.createVNode(P,{"show-message":!1,class:"oneClickProcurement__remark"},{default:e.withCtx(()=>[e.createVNode(k,{label:"入库备注"},{default:e.withCtx(()=>[e.createVNode(g,{modelValue:e.unref(n),"onUpdate:modelValue":x[0]||(x[0]=I=>e.isRef(n)?n.value=I:null),placeholder:"请输入入库备注",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(F,{"max-height":450,data:e.unref(r),"expand-row-keys":e.unref(u),"row-key":"productId",onExpandChange:e.unref(d)},{default:e.withCtx(()=>[e.createVNode(N,{type:"expand"},{default:e.withCtx(({row:I,$index:M})=>[e.createElementVNode("div",Yo,[e.createVNode(P,null,{default:e.withCtx(()=>[e.createVNode(k,{label:"入库数(批量)"},{default:e.withCtx(()=>[e.createVNode(z,{modelValue:I.batchNum,"onUpdate:modelValue":p=>I.batchNum=p,max:e.unref(f)(I),min:0,precision:0,onChange:p=>e.unref(m)(I.productId,p)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),_:2},1024)]),_:2},1024)]),e.createVNode(F,{data:I.skus,"row-key":"id"},{default:e.withCtx(()=>[e.createVNode(N,{label:"商品规格11"},{default:e.withCtx(({row:p})=>{var c;return[e.createTextVNode(e.toDisplayString((c=p==null?void 0:p.specs)==null?void 0:c.join(";")),1)]}),_:1}),e.createVNode(N,{label:"采购数",prop:"num",width:"80"}),e.createVNode(N,{label:"已入库数",prop:"used",width:"100"}),e.createVNode(N,{label:"剩余入库数",width:"100"},{default:e.withCtx(({row:p})=>[e.createTextVNode(e.toDisplayString((p==null?void 0:p.num)-(p==null?void 0:p.used)),1)]),_:1}),e.createVNode(N,{label:"实际入库数（本次）",prop:"inStorageNum",width:"180"},{default:e.withCtx(({row:p})=>[e.createVNode(z,{modelValue:p.inStorageNum,"onUpdate:modelValue":c=>p.inStorageNum=c,max:(p==null?void 0:p.num)-(p==null?void 0:p.used),min:0,precision:0},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),e.createVNode(N,{fixed:"right",label:"操作",width:"80"},{default:e.withCtx(({$index:p})=>[e.createVNode(U,{type:"danger",onClick:c=>e.unref(s)(M,p)},{default:e.withCtx(()=>x[1]||(x[1]=[e.createTextVNode("移出")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:1}),e.createVNode(N,{label:"商品名称",width:"250"},{default:e.withCtx(({row:I})=>[e.createElementVNode("div",Wo,[e.createElementVNode("img",{src:I.image},null,8,Ko),e.createElementVNode("span",Xo,e.toDisplayString(I.productName),1)])]),_:1}),e.createVNode(N,{label:"采购数"},{default:e.withCtx(({row:I})=>{var M;return[e.createTextVNode(e.toDisplayString((M=I==null?void 0:I.skus)==null?void 0:M.reduce((p,c)=>p+c.num,0)),1)]}),_:1}),e.createVNode(N,{label:"已入库数"},{default:e.withCtx(({row:I})=>{var M;return[e.createTextVNode(e.toDisplayString((M=I==null?void 0:I.skus)==null?void 0:M.reduce((p,c)=>p+c.used,0)),1)]}),_:1}),e.createVNode(N,{label:"剩余入库数"},{default:e.withCtx(({row:I})=>{var M,p;return[e.createTextVNode(e.toDisplayString(((M=I==null?void 0:I.skus)==null?void 0:M.reduce((c,_)=>c+_.num,0))-((p=I==null?void 0:I.skus)==null?void 0:p.reduce((c,_)=>c+_.used,0))),1)]}),_:1}),e.createVNode(N,{label:"实际入库数（本次）"},{default:e.withCtx(({row:I})=>[e.createTextVNode(e.toDisplayString(e.unref(h)(I.id)),1)]),_:1}),e.createVNode(N,{label:"操作"},{default:e.withCtx(({$index:I})=>[e.createVNode(U,{type:"danger",onClick:M=>e.unref(y)(I)},{default:e.withCtx(()=>x[2]||(x[2]=[e.createTextVNode("移出")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","expand-row-keys","onExpandChange"])])}}}),Gn="",Zo=ee(Jo,[["__scopeId","data-v-0be730b0"]]),Qo=t=>{const a=e.reactive({orderNo:"",supplierId:"",remark:""}),o=e.ref([]);return{tableData:o,extraData:a,initialInstorageData:async()=>{var u;const r=await Te(t.orderNo);r.data&&(o.value=(u=r.data)==null?void 0:u.products,Object.keys(a).forEach(d=>{var m;const f=d;a[f]=(m=r==null?void 0:r.data)==null?void 0:m[d]}))}}},vo={class:"batch"},ea={class:"batch__commodity"},ta=["src"],oa={class:"batch__commodity--name"},aa=e.defineComponent({__name:"storage-details",props:{orderNo:{default:""}},setup(t){const a=t,{tableData:o,initialInstorageData:n,extraData:r}=Qo(a);return e.onMounted(()=>n()),(u,d)=>{const f=e.resolveComponent("el-form-item"),m=e.resolveComponent("el-form"),h=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",vo,[e.createVNode(m,{"show-message":!1,class:"purchase__remark"},{default:e.withCtx(()=>[e.createVNode(f,{label:"采购备注"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(r).remark),1)]),_:1})]),_:1}),e.createVNode(y,{data:e.unref(o),"row-key":"id","max-height":450},{default:e.withCtx(()=>[e.createVNode(h,{type:"expand"},{default:e.withCtx(({row:s})=>[e.createVNode(y,{data:s.skus,"row-key":"id"},{default:e.withCtx(()=>[e.createVNode(h,{label:"商品规格"},{default:e.withCtx(({row:l})=>{var i;return[e.createTextVNode(e.toDisplayString((i=l==null?void 0:l.specs)==null?void 0:i.join(";")),1)]}),_:1}),e.createVNode(h,{label:"采购数",prop:"num",width:"80"}),e.createVNode(h,{label:"已入库数",prop:"used",width:"100"}),e.createVNode(h,{label:"剩余入库数",width:"100"},{default:e.withCtx(({row:l})=>[e.createTextVNode(e.toDisplayString((l==null?void 0:l.num)-(l==null?void 0:l.used)),1)]),_:1})]),_:2},1032,["data"])]),_:1}),e.createVNode(h,{label:"商品名称",width:"250"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",ea,[e.createElementVNode("img",{src:s.image},null,8,ta),e.createElementVNode("span",oa,e.toDisplayString(s.productName),1)])]),_:1}),e.createVNode(h,{label:"采购数"},{default:e.withCtx(({row:s})=>{var l;return[e.createTextVNode(e.toDisplayString((l=s==null?void 0:s.skus)==null?void 0:l.reduce((i,x)=>i+x.num,0)),1)]}),_:1}),e.createVNode(h,{label:"已入库数"},{default:e.withCtx(({row:s})=>{var l;return[e.createTextVNode(e.toDisplayString((l=s==null?void 0:s.skus)==null?void 0:l.reduce((i,x)=>i+x.used,0)),1)]}),_:1}),e.createVNode(h,{label:"剩余入库数"},{default:e.withCtx(({row:s})=>{var l,i;return[e.createTextVNode(e.toDisplayString(((l=s==null?void 0:s.skus)==null?void 0:l.reduce((x,g)=>x+g.num,0))-((i=s==null?void 0:s.skus)==null?void 0:i.reduce((x,g)=>x+g.used,0))),1)]}),_:1})]),_:1},8,["data"])])}}}),Wn="",na=ee(aa,[["__scopeId","data-v-819dbd96"]]),la=()=>{const t=e.ref(""),a=e.ref(!1),o=e.ref(null);return{inStorageOrderNo:t,showInStorageDialog:a,openInStorageDialog:r=>{t.value=r,a.value=!0},inStorageRefs:o}},sa=()=>{const t=e.ref(""),a=e.ref(!1);return{storageDetailsOrderNo:t,showStorageDetailsDialog:a,openStorageDetailsDialog:n=>{t.value=n,a.value=!0}}},ra=["近一个月订单","近三个月订单","全部订单"],ia={START:{title:"申请开票",btnConfig:{text:"",type:""},describe:""},SUCCESSFULLY_INVOICED:{title:"开票成功",btnConfig:{text:"重新发送发票到邮箱",type:"primary"},describe:"开票成功后，发票将发送至您的邮箱地址，请注意查看邮件~"},REQUEST_IN_PROCESS:{title:"开票中",btnConfig:{text:"撤销开票申请",type:"danger"},describe:"开票成功后，发票将发送至您的邮箱地址，请注意查看邮件~"},FAILED_INVOICE_REQUEST:{title:"开票失败",btnConfig:{text:"重新申请开票",type:"primary"},describe:"开票失败后，您可以重新申请开票~"}},{divTenThousand:ca}=ie(),{toClipboard:da}=ze(),Ne=new Ae,pa=()=>{const{showInStorageDialog:t,inStorageOrderNo:a,openInStorageDialog:o,inStorageRefs:n}=la(),{storageDetailsOrderNo:r,showStorageDetailsDialog:u,openStorageDetailsDialog:d}=sa(),f={OFFLINE:"线下支付",BALANCE:"余额支付"},m=pe.useRouter(),h=e.ref(!1),y=e.ref(!1),s=e.ref({applicantId:"",applicantShopId:"",invoiceOwnerType:"SHOP",shopSupplierName:"",applicationTime:"",orderNo:"",invoiceAmount:"",invoiceType:"",invoiceStatus:"START",billingRemarks:"",denialReason:"",invoiceHeaderId:""}),l=e.ref("VAT_COMBINED"),i=e.ref(),x=e.ref(null),g=e.reactive({status:"",startTime:"",endTime:"",purchaser:"",no:"",supplierId:""}),k=e.reactive({page:{current:1,size:10},total:0}),P=e.ref(" "),z=e.ref("全部订单"),N=e.ref(),U=e.ref([]),F=e.ref([]),I=T=>{g.status=T,_()},M=e.computed(()=>T=>fa(T)),p=e.computed(()=>T=>Oe(T)),c=e.computed(()=>T=>ha(T)),_=async()=>{var H,W;let T=[],B=0;try{const J=await ve({...k.page,...g});T=(H=J.data)==null?void 0:H.records,B=((W=J.data)==null?void 0:W.total)||0}finally{U.value=T,k.total=Number(B)}},$=T=>{if(P.value=" ",z.value=T,z.value==="近一个月订单"){const B=Ne.getLastMonth(new Date);q(B)}else if(z.value==="近三个月订单"){const B=Ne.getLastThreeMonth(new Date);q(B)}else g.startTime="",g.endTime="",_()},R=T=>{g.startTime=T.startTime,g.endTime=T.endTime,g.purchaser=T.purchaser,g.no=T.no,g.supplierId=T.supplierId,k.page.current=1,_()},q=async T=>{const B=Ne.getYMDs(new Date);g.startTime=T,g.endTime=B,_()},D=()=>{switch(s.value.invoiceStatus){case"START":K();break;case"REQUEST_IN_PROCESS":ae();break;case"SUCCESSFULLY_INVOICED":se();break;case"FAILED_INVOICE_REQUEST":S();break}},E=()=>{s.value={applicantId:"",applicantShopId:"",invoiceOwnerType:"SHOP",shopSupplierName:"",applicationTime:"",orderNo:"",invoiceAmount:"",invoiceType:"",invoiceStatus:"START",billingRemarks:"",denialReason:"",invoiceHeaderId:""}},K=async()=>{if(!s.value.invoiceHeaderId)return L.ElMessage.error("请选择抬头");if(!s.value.invoiceType)return L.ElMessage.error("请选择发票类型");const{code:T,data:B,msg:H}=await ot(s.value);if(T!==200)return L.ElMessage.error(H||"申请开票失败");L.ElMessage.success("申请开票成功"),y.value=!1},ae=async()=>{const{data:T,code:B,msg:H}=await lt(s.value.id);if(B!==200)return L.ElMessage.error(H||"撤销开票失败");L.ElMessage.success("撤销开票成功"),y.value=!1},se=async()=>{const{data:T,code:B,msg:H}=await st({invoiceRequestId:s.value.id,shopId:s.value.applicantShopId});if(B!==200)return L.ElMessage.error(H||"重发发票失败");L.ElMessage.success("重发发票成功"),y.value=!1},S=async()=>{s.value={...s.value,applicantId:"",applicationTime:"",invoiceType:"",invoiceStatus:"START",billingRemarks:"",denialReason:"",invoiceHeaderId:""},$e().then(T=>{s.value.invoiceHeaderId=T.data.id}).catch(()=>{L.ElMessage.error("获取默认抬头失败")}),Pe({invoiceSettingsClientType:"SUPPLIER",shopId:s.value.applicantShopId}).then(T=>{l.value=T.data.invoiceSetupValue[0].invoiceType}).catch(()=>{L.ElMessage.error("获取发票设置失败")})},C=async(T,B)=>{switch(T){case"cancel":L.ElMessageBox.confirm("请确认是否将订单取消？？").then(async()=>{const{code:H,msg:W}=await We(B.no);H===200?(L.ElMessage.success({message:W||"取消成功"}),_()):L.ElMessage.error({message:W||"取消失败"})});break;case"details":m.push({path:"/goods/purchase/detail",query:{orderNo:B.no}});break;case"pay":i.value=B,h.value=!0;break;case"finish":L.ElMessageBox.confirm("完成后将无法入库，请确认订单是否已完成？？").then(async()=>{const{code:H,msg:W}=await Xe(B.no);H===200?(L.ElMessage.success({message:W||"订单入库已完成"}),_()):L.ElMessage.error({message:W||"订单完成失败"})});break;case"inStorage":o(B.no);break;case"storageDetails":d(B.no);break;case"contact":_e(B.shopId,B.supplierId).then(({code:H})=>{H===200&&m.push({path:"/message/customer/supplierService",query:{id:B.supplierId}})});break;case"invoice":j(B);break}},j=async T=>{const{data:B,code:H,msg:W}=await nt({invoiceOwnerType:"SHOP",applicantId:ce.useShopInfoStore().shopInfo.id,applicantShopId:T.supplierId,orderNo:T.no});if(H!==200||!B)return L.ElMessage.error({message:W||"获取开票信息失败"});if(B.invoiceStatus==="REQUEST_HAS_EXPIRED")return L.ElMessage.error({message:W||"已超出可开票时间"});if(B.invoiceStatus==="SERVER_NOT_SUPPORTED")return L.ElMessage.error({message:W||"供应商不支持开票"});y.value=!0,B.invoiceStatus!=="ALLOWED_INVOICING"?at(B.id).then(J=>{s.value=J.data}).catch(()=>{L.ElMessage.error("获取发票详情失败")}):(s.value.shopSupplierName=T.extraInfo.supplierName,s.value.applicantShopId=T.supplierId,s.value.orderNo=T.no,s.value.invoiceAmount=B.billMoney,$e().then(J=>{s.value.invoiceHeaderId=J.data.id}).catch(()=>{L.ElMessage.error("获取默认抬头失败")}),Pe({invoiceSettingsClientType:"SUPPLIER",shopId:T.supplierId}).then(J=>{l.value=J.data.invoiceSetupValue[0].invoiceType}).catch(()=>{L.ElMessage.error("获取发票设置失败")}))},O=async T=>{try{await da(T),L.ElMessage.success("复制成功")}catch{L.ElMessage.error("复制失败")}},G=async()=>{var W,J;const T=await((W=x.value)==null?void 0:W.getPayOrderFormModel()),{code:B,msg:H}=await Ye({...T,orderNo:(J=i.value)==null?void 0:J.no});B===200?(L.ElMessage.success("支付成功"),_(),h.value=!1):L.ElMessage.error(H||"支付失败")},ne=async()=>{const T=n.value;if(T){const B={skuStorages:ma(T.tableData),remark:T.remark,orderNo:a.value},H=await Ke(B);H.code===200?(L.ElMessage.success({message:H.msg||"入库成功"}),t.value=!1,_()):L.ElMessage.error({message:H.msg||"入库失败"})}},Q=e.ref([]),V=(T,B)=>{const H=U.value.find(W=>W.no===B);if(H)if(T===!1){const W=Q.value.findIndex(J=>J.no===B);W>-1&&Q.value.splice(W,1)}else Q.value.push(H)};function v(T){F.value=T}return{handleTabChange:I,pagination:k,multipleTableRef:N,initOrderList:_,orderDataList:U,chooseList:F,handleQuickSearchCommand:$,handleSearch:R,quickSearchTabName:z,quickSearchTabNames:ra,activeTabName:P,getMainOrderStatusText:p,computedBtnList:M,handleDispatchEvent:C,copyOrderNo:O,computedCalculateFreight:c,showPayDialog:h,currentRow:i,handlePayOrder:G,payOrderRef:x,payTypeMap:f,showInStorageDialog:t,inStorageOrderNo:a,inStorageRefs:n,storageDetailsOrderNo:r,showStorageDetailsDialog:u,handleConfirmInStorage:ne,showInvoiceDialog:y,InvoiceStatusHander:ia,invoiceDetail:s,handleInvoiceConfig:D,handleCloseInvoiceDialog:E,invoiceSetType:l,handleChangeRow:V,multiSelect:Q,handleSizeChange:T=>{k.page.size=T,_()},handleCurrentChange:T=>{k.page.current=T,_()},handleSelectionChange:v}},ma=t=>{const a=[];return t.forEach(o=>{const n=o.productId;o.skus.forEach(u=>{const d=u.skuId,f=u.inStorageNum||0;a.push({key:{productId:n,skuId:d},value:f})})}),a},Oe=t=>{if(t.status==="UNPAID")return"待支付";if(t.status==="PAYMENT_AUDIT")return"待审核";const a=["WAITING_FOR_DELIVER","WAITING_FOR_RECEIVE","COMPLETED"],o={WAITING_FOR_DELIVER:"待发货",WAITING_FOR_RECEIVE:"待入库",COMPLETED:"已完成"};if(t.status==="PAID"){let n="COMPLETED";for(const u of t.orderItems){const d=a.findIndex(f=>f===n);if(u.packageStatus==="WAITING_FOR_DELIVER"&&d>0){n="WAITING_FOR_DELIVER";continue}if(u.packageStatus==="WAITING_FOR_RECEIVE"&&d>1){n="WAITING_FOR_RECEIVE";continue}}let r=o[n];return r==="待发货"&&t.orderItems.find(d=>d.packageStatus!=="WAITING_FOR_DELIVER")&&(r="部分发货"),r}return"已关闭"},fa=t=>{const a=[],o=Oe(t);return a.push({action:"details",text:"查看",type:"primary"}),o==="待支付"?(a.push({action:"pay",text:"去支付",type:"primary"}),a.push({action:"cancel",text:"取消订单",type:"danger"})):["待入库","部分发货"].includes(o)?(a.push({action:"inStorage",text:"入库",type:"primary"}),a.push({action:"finish",text:"完成",type:"primary"}),a.push({action:"storageDetails",text:"入库详情",type:"primary"})):o==="已完成"&&(a.push({action:"storageDetails",text:"入库详情",type:"primary"}),a.push({action:"invoice",text:"申请开票",type:"primary"})),t.stockInCount===0&&a.forEach((n,r)=>{n.text==="入库详情"&&a.splice(r,1)}),a},ha=t=>t.reduce((a,o)=>a.plus(new Z(ca(o.freightPrice))),new Z(0)),ua={class:"handle_container"},ga={key:0,style:{color:"#999"}},_a={class:"table_container"},ya={class:"customer"},xa={class:"customer__name"},Na={style:{display:"flex","align-items":"center"}},Ca={style:{color:"#f54319"}},Va=["src","onClick"],ba={style:{display:"flex","justify-content":"space-around"}},Sa={class:"dialog-footer"},ka=["src"],Ea={class:"dialog-footer"},Ta={class:"invoice-title"},Ia=["id"],Da={class:"invoice-desc"},Pa={class:"dialog-footer"},$a=e.defineComponent({__name:"index",setup(t){const{handleTabChange:a,pagination:o,orderDataList:n,chooseList:r,multipleTableRef:u,handleQuickSearchCommand:d,handleSearch:f,quickSearchTabName:m,quickSearchTabNames:h,activeTabName:y,getMainOrderStatusText:s,computedBtnList:l,handleDispatchEvent:i,computedCalculateFreight:x,showPayDialog:g,showInvoiceDialog:k,handlePayOrder:P,payOrderRef:z,payTypeMap:N,currentRow:U,showInStorageDialog:F,inStorageOrderNo:I,storageDetailsOrderNo:M,showStorageDetailsDialog:p,handleConfirmInStorage:c,inStorageRefs:_,InvoiceStatusHander:$,invoiceDetail:R,handleInvoiceConfig:q,handleCloseInvoiceDialog:D,invoiceSetType:E,multiSelect:K,handleSizeChange:ae,handleCurrentChange:se,handleSelectionChange:S,initOrderList:C}=pa(),{divTenThousand:j}=ie(),{showProof:O,goToShowProof:G,currentProof:ne}=_o(),Q=[];(()=>{Object.keys(Le).forEach(A=>{Q.push([A,Le[A]])})})(),C();const v=async A=>{var w,T;if(K.value.length){let B=[""];B=K.value.map(Ce=>Ce.mainNo);const{data:H,code:W,msg:J}=await Be({exportOrderIds:B});if(W!==200)return L.ElMessage.error(J||"导出数据失败")}else{let B={no:A.no,supplierId:A.supplierId,startTime:(w=A.date)==null?void 0:w[0],endTime:(T=A.date)==null?void 0:T[1],status:y.value,exportOrderIds:""};B.status=B.status.trim();const{data:H,code:W,msg:J}=await Be(B);if(W!==200)return L.ElMessage.error(J||"导出数据失败")}};return(A,w)=>{const T=e.resolveComponent("el-icon"),B=e.resolveComponent("el-dropdown-item"),H=e.resolveComponent("el-dropdown-menu"),W=e.resolveComponent("el-dropdown"),J=e.resolveComponent("el-tab-pane"),Ce=e.resolveComponent("el-tabs"),oe=e.resolveComponent("el-table-column"),Pn=e.resolveComponent("el-link"),$n=e.resolveComponent("el-table"),re=e.resolveComponent("el-button"),me=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(io,{onSearch:e.unref(f),onSupplierExport:v},null,8,["onSearch"]),e.createVNode(Ce,{modelValue:e.unref(y),"onUpdate:modelValue":w[0]||(w[0]=b=>e.isRef(y)?y.value=b:null),class:"tab_container",onTabChange:e.unref(a)},{default:e.withCtx(()=>[e.createVNode(J,{name:" "},{label:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(e.unref(m)),1),e.createVNode(W,{placement:"bottom-end",trigger:"click",onCommand:e.unref(d)},{dropdown:e.withCtx(()=>[e.createVNode(H,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),b=>(e.openBlock(),e.createBlock(B,{key:b,command:b},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",{class:"el-dropdown-link",style:{"line-height":"40px"},onClick:e.withModifiers(()=>{},["stop"])},[e.createVNode(T,{class:"el-icon--right"},{default:e.withCtx(()=>[e.createVNode(e.unref(Ue.ArrowDown))]),_:1})])]),_:1},8,["onCommand"])]),_:1}),(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(Q,b=>e.createVNode(J,{key:b[0],label:b[1],name:b[0]},null,8,["label","name"])),64))]),_:1},8,["modelValue","onTabChange"]),e.createElementVNode("div",ua,[e.unref(r).length>=1?(e.openBlock(),e.createElementBlock("span",ga,"已选"+e.toDisplayString(e.unref(r).length)+"条 ",1)):e.createCommentVNode("",!0)]),e.createElementVNode("div",_a,[e.createVNode($n,{ref_key:"multipleTableRef",ref:u,height:"565px","cell-style":{fontSize:"14px",color:"#333333"},data:e.unref(n),"header-cell-style":{background:"#f6f8fa",height:"50px"},"header-row-style":{fontSize:"14px",color:"#000"},onSelectionChange:e.unref(S)},{empty:e.withCtx(()=>[e.createVNode(Ve)]),default:e.withCtx(()=>[e.createVNode(oe,{type:"selection",width:"40",fixed:"left"}),e.createVNode(oe,{label:"订单号",prop:"no",width:"200"}),e.createVNode(oe,{label:"供应商",prop:"extraInfo",width:"160"},{default:e.withCtx(({row:b})=>{var X,le;return[e.createElementVNode("div",ya,[e.createElementVNode("div",null,[e.createElementVNode("span",xa,e.toDisplayString((X=b==null?void 0:b.extraInfo)==null?void 0:X.supplierName),1),e.createVNode(ge,{name:"icon-xiaoxi-copy",size:"18px",style:{cursor:"pointer"},svg:"",onClick:Bn=>e.unref(i)("contact",b)},null,8,["onClick"])]),e.createElementVNode("span",null,e.toDisplayString((le=b==null?void 0:b.extraInfo)==null?void 0:le.supplierPhone),1)])]}),_:1}),e.createVNode(oe,{label:"采购数量",prop:"orderItems",width:"90"},{default:e.withCtx(({row:b})=>[e.createTextVNode(e.toDisplayString(b.orderItems.reduce((X,le)=>X+le.num,0)),1)]),_:1}),e.createVNode(oe,{label:"商品总价(元)",prop:"payAmount",width:"110"},{default:e.withCtx(({row:b})=>[e.createTextVNode(e.toDisplayString(e.unref(j)(b.payAmount).toFixed(2)),1)]),_:1}),e.createVNode(oe,{label:"运费(元)",prop:"orderItems",width:"90"},{default:e.withCtx(({row:b})=>[e.createTextVNode(e.toDisplayString(e.unref(x)(b==null?void 0:b.orderItems).toFixed(2)),1)]),_:1}),e.createVNode(oe,{label:"应付金额(元)",prop:"payAmount",width:"120"},{default:e.withCtx(({row:b})=>{var X,le;return[e.createElementVNode("div",Na,[e.createElementVNode("span",Ca,"￥"+e.toDisplayString(e.unref(j)(b.payAmount)),1),(le=(X=b==null?void 0:b.extra)==null?void 0:X.pay)!=null&&le.proof?(e.openBlock(),e.createElementBlock("img",{key:0,src:e.unref(Fe),alt:"",style:{height:"16px",width:"21px","margin-left":"4px"},onClick:Bn=>e.unref(G)(b)},null,8,Va)):e.createCommentVNode("",!0)])]}),_:1}),e.createVNode(oe,{label:"订单状态",width:"140"},{default:e.withCtx(({row:b})=>{var X;return[e.createElementVNode("div",{class:e.normalizeClass({"text-red":e.unref(s)(b)==="待支付","text-grey":e.unref(s)(b)==="待支付"}),style:{display:"flex","align-items":"center"}},[e.createTextVNode(e.toDisplayString(e.unref(s)(b))+" ",1),e.unref(s)(b)==="待支付"?(e.openBlock(),e.createBlock(go,{key:0,"create-time":b==null?void 0:b.createTime,"pay-timeout":(X=b==null?void 0:b.extra)==null?void 0:X.payTimeout},null,8,["create-time","pay-timeout"])):e.createCommentVNode("",!0)],2)]}),_:1}),e.createVNode(oe,{label:"支付方式",width:"120"},{default:e.withCtx(({row:b})=>{var X,le;return[e.createTextVNode(e.toDisplayString(e.unref(N)[(le=(X=b==null?void 0:b.extra)==null?void 0:X.pay)==null?void 0:le.payType]),1)]}),_:1}),e.createVNode(oe,{label:"下单时间",prop:"createTime",width:"180"}),e.createVNode(oe,{label:"支付时间",prop:"payTime",width:"180"},{default:e.withCtx(({row:b})=>{var X;return[e.createTextVNode(e.toDisplayString((X=b==null?void 0:b.timeNodes)==null?void 0:X.payTime),1)]}),_:1}),e.createVNode(oe,{label:"操作",fixed:"right",width:"230",align:"right"},{default:e.withCtx(({row:b})=>[e.createElementVNode("div",ba,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l)(b),X=>(e.openBlock(),e.createBlock(Pn,{key:X.action,type:X.type,onClick:le=>e.unref(i)(X.action,b)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(X.text),1)]),_:2},1032,["type","onClick"]))),128))])]),_:1})]),_:1},8,["data","onSelectionChange"])]),e.createVNode(ue,{class:"pagination","page-size":e.unref(o).page.size,"page-num":e.unref(o).page.current,total:e.unref(o).total,onHandleSizeChange:e.unref(ae),onHandleCurrentChange:e.unref(se)},null,8,["page-size","page-num","total","onHandleSizeChange","onHandleCurrentChange"]),e.createVNode(me,{modelValue:e.unref(g),"onUpdate:modelValue":w[2]||(w[2]=b=>e.isRef(g)?g.value=b:null),title:"支付订单",width:"500px","destroy-on-close":""},{footer:e.withCtx(()=>[e.createElementVNode("span",Sa,[e.createVNode(re,{onClick:w[1]||(w[1]=b=>g.value=!1)},{default:e.withCtx(()=>w[9]||(w[9]=[e.createTextVNode("取消")])),_:1}),e.createVNode(re,{type:"primary",onClick:e.unref(P)},{default:e.withCtx(()=>w[10]||(w[10]=[e.createTextVNode(" 确认 ")])),_:1},8,["onClick"])])]),default:e.withCtx(()=>{var b;return[e.createVNode(yo,{ref_key:"payOrderRef",ref:z,price:e.unref(j)((b=e.unref(U))==null?void 0:b.payAmount)},null,8,["price"])]}),_:1},8,["modelValue"]),e.createVNode(me,{modelValue:e.unref(O),"onUpdate:modelValue":w[3]||(w[3]=b=>e.isRef(O)?O.value=b:null),title:"付款凭证",width:"500px"},{default:e.withCtx(()=>[e.createElementVNode("img",{src:e.unref(ne),class:"proof-img"},null,8,ka)]),_:1},8,["modelValue"]),e.createVNode(me,{modelValue:e.unref(F),"onUpdate:modelValue":w[5]||(w[5]=b=>e.isRef(F)?F.value=b:null),title:"入库",width:"1150px"},{footer:e.withCtx(()=>[e.createElementVNode("span",Ea,[e.createVNode(re,{onClick:w[4]||(w[4]=b=>F.value=!1)},{default:e.withCtx(()=>w[11]||(w[11]=[e.createTextVNode("取消")])),_:1}),e.createVNode(re,{type:"primary",onClick:e.unref(c)},{default:e.withCtx(()=>w[12]||(w[12]=[e.createTextVNode(" 确认 ")])),_:1},8,["onClick"])])]),default:e.withCtx(()=>[e.unref(F)?(e.openBlock(),e.createBlock(Zo,{key:0,ref_key:"inStorageRefs",ref:_,"order-no":e.unref(I)},null,8,["order-no"])):e.createCommentVNode("",!0)]),_:1},8,["modelValue"]),e.createVNode(me,{modelValue:e.unref(p),"onUpdate:modelValue":w[6]||(w[6]=b=>e.isRef(p)?p.value=b:null),title:"入库详情",width:"1150px"},{default:e.withCtx(()=>[e.createVNode(na,{"order-no":e.unref(M)},null,8,["order-no"])]),_:1},8,["modelValue"]),e.createVNode(me,{modelValue:e.unref(k),"onUpdate:modelValue":w[8]||(w[8]=b=>e.isRef(k)?k.value=b:null),width:"1200px",center:"",onClose:e.unref(D)},{header:e.withCtx(({titleId:b,titleClass:X})=>[e.createElementVNode("div",Ta,[e.createElementVNode("h5",{id:b,class:e.normalizeClass(X)},e.toDisplayString(e.unref($)[e.unref(R).invoiceStatus].title),11,Ia)]),e.createElementVNode("div",Da,e.toDisplayString(e.unref($)[e.unref(R).invoiceStatus].describe),1)]),footer:e.withCtx(()=>[e.createElementVNode("span",Pa,[e.unref(R).invoiceStatus==="START"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(re,{onClick:w[7]||(w[7]=b=>k.value=!1)},{default:e.withCtx(()=>w[13]||(w[13]=[e.createTextVNode("取消")])),_:1}),e.createVNode(re,{type:"primary",onClick:e.unref(q)},{default:e.withCtx(()=>w[14]||(w[14]=[e.createTextVNode(" 确认 ")])),_:1},8,["onClick"])],64)):(e.openBlock(),e.createBlock(re,{key:1,type:e.unref($)[e.unref(R).invoiceStatus].btnConfig.type,onClick:e.unref(q)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref($)[e.unref(R).invoiceStatus].btnConfig.text),1)]),_:1},8,["type","onClick"]))])]),default:e.withCtx(()=>[e.createVNode(qo,{"invoice-detail":e.unref(R),"invoice-set-type":e.unref(E)},null,8,["invoice-detail","invoice-set-type"])]),_:1},8,["modelValue","onClose"])],64)}}}),Xn="",Ba=Object.freeze(Object.defineProperty({__proto__:null,default:ee($a,[["__scopeId","data-v-84b12a8a"]])},Symbol.toStringTag,{value:"Module"})),La=()=>{const t=e.ref([]),a=e.ref([]),o=e.reactive({supplierId:"",productName:"",categoryId:""}),n=[{label:"商品名称",prop:"productName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称"}},{label:"供应商",labelWidth:85,prop:"supplierId",valueType:"select",options:t,fieldProps:{placeholder:"请输入店铺名称",props:{value:"id",label:"name",expandTrigger:"hover"},filterable:!0,remote:!0,reserveKeyword:!0,remoteMethod:d=>{u(d)}}},{label:"平台类目",valueType:"cascader",options:a,fieldProps:{placeholder:"请选择平台类目",props:{expandTrigger:"hover",label:"name",value:"id",children:"secondCategoryVos"},onChange:d=>{d.length>1&&(o.categoryId=d[d.length-1])}}}];async function r(){const{data:d,code:f}=await xe();a.value=d}const u=async(d="")=>{const f=await ye({supplierName:d});t.value=(f==null?void 0:f.data.map(m=>({label:m.name,value:m.id})))||[]};return e.onMounted(()=>{r()}),{searchType:o,supplierList:t,platformCategoryList:a,fetchSupplierList:u,columns:n}},Oa=e.defineComponent({__name:"search",emits:["search"],setup(t,{emit:a}){const o=a,{searchType:n,columns:r}=La(),u=m=>{m&&Object.keys(m).forEach(h=>n[h]=m[h])},d=()=>{const m=fe.cloneDeep(n);m.categoryId=Array.isArray(m.categoryId)?m.categoryId.pop():"",o("search",m)},f=()=>{Object.keys(n).forEach(m=>n[m]=""),d()};return(m,h)=>(e.openBlock(),e.createBlock(he,{"v-model":e.unref(n),columns:e.unref(r),"show-number":3,onChangeFormItem:u,onSearchHandle:d,onHandleReset:f},null,8,["v-model","columns"]))}}),wa=()=>{const t=e.reactive({supplierId:"",categoryId:"",productName:""}),a=e.reactive({page:{current:1,size:10},total:0}),o=e.ref([]),n=async()=>{const{code:m,data:h}=await Je({...a.page,...t});m===200&&h&&(o.value=(h==null?void 0:h.records)||[],a.total=Number(h==null?void 0:h.total))},r=m=>{Object.keys(m).forEach(h=>{const y=h;t[y]=m[h]}),a.page.current=1,n()},u=e.computed(()=>m=>{const h=((m==null?void 0:m.prices)||[]).map(l=>Number(l)),y=Math.min(...h),s=Math.max(...h);return y===s?s/1e4:`${y/1e4}~￥${s/1e4}`});return{handleSearch:r,waitingPublishData:o,pagination:a,computedSalePrice:u,handleSizeChange:m=>{a.page.size=m,n()},handleCurrentChange:m=>{a.page.current=m,n()},initData:n}},Ra={class:"good"},Ma={class:"good__info"},Aa={class:"good__info"},za={class:"good__img"},Ua=e.defineComponent({__name:"preview",props:{currentProduct:{type:Object,default:()=>({})}},setup(t){const a=t,{divTenThousand:o}=ie(),n=e.ref([]),r=e.ref([]),u=async()=>{const{data:d}=await Ie(ce.useShopInfoStore().shopInfo.id,a.currentProduct.productId);n.value=(d==null?void 0:d.skus)||[],r.value=(d==null?void 0:d.specGroups)||[]};return e.onMounted(()=>u()),(d,f)=>{var s,l;const m=e.resolveComponent("el-image"),h=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",Ra,[e.createElementVNode("div",Ma,"店铺名称："+e.toDisplayString((s=a.currentProduct)==null?void 0:s.supplierName),1),e.createElementVNode("div",Aa,"商品名称："+e.toDisplayString((l=a.currentProduct)==null?void 0:l.productName),1),e.createElementVNode("div",za,[f[0]||(f[0]=e.createElementVNode("text",null,"商品图片：",-1)),e.createVNode(m,{"preview-src-list":[a.currentProduct.image],src:a.currentProduct.image,style:{width:"100px",height:"100px"}},null,8,["preview-src-list","src"])]),f[1]||(f[1]=e.createElementVNode("div",null,"规格：",-1)),e.createVNode(y,{data:n.value,"header-row-style":{"font-size":"12px",color:"#000000"},height:"350",stripe:""},{default:e.withCtx(()=>[r.value.length?(e.openBlock(),e.createBlock(h,{key:0,align:"center",label:"规格"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString((i==null?void 0:i.specs)&&(i==null?void 0:i.specs.join("-"))),1)]),_:1})):e.createCommentVNode("",!0),e.createVNode(h,{align:"center",label:"sku图"},{default:e.withCtx(({row:i})=>[e.createVNode(m,{src:i==null?void 0:i.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1}),e.createVNode(h,{align:"center",label:"销售价(元)"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.salePrice&&e.unref(o)(i.salePrice)),1)]),_:1}),e.createVNode(h,{align:"center",label:"划线价(元)",prop:"originalPrice"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.price&&e.unref(o)(i.price)),1)]),_:1}),e.createVNode(h,{align:"center",label:"重量(kg)",prop:"weight"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.weight),1)]),_:1})]),_:1},8,["data"])])}}}),vn="",Fa=ee(Ua,[["__scopeId","data-v-b5df09d6"]]),ja=()=>{const t=e.ref(),a=e.ref(!1);return{currentRow:t,showPreviewDialog:a,openPreviewDialog:n=>{t.value=n,a.value=!0}}},qa={class:"commodity-info"},Ha=["src"],Ga={class:"commodity-info-text"},Ya={key:1},Wa={style:{color:"#999"}},Ka={style:{color:"#f54319"}},Xa={class:"customer"},Ja={class:"customer__name"};var we=(t=>(t.REAL_PRODUCT="实物商品",t.VIRTUAL_PRODUCT="虚拟商品",t))(we||{});const Za=e.defineComponent({__name:"index",setup(t){const{handleSearch:a,waitingPublishData:o,pagination:n,computedSalePrice:r,handleSizeChange:u,handleCurrentChange:d,initData:f}=wa(),{currentRow:m,showPreviewDialog:h,openPreviewDialog:y}=ja();f();const s=pe.useRouter(),l=x=>{s.push({path:"/goods/purchase/release",query:{id:x==null?void 0:x.productId,supplierId:x==null?void 0:x.supplierId}})},i=x=>{_e(ce.useShopInfoStore().shopInfo.id,x.shopId).then(({code:g})=>{g===200&&s.push({path:"/message/customer/supplierService",query:{id:x.shopId}})})};return(x,g)=>{const k=e.resolveComponent("el-tooltip"),P=e.resolveComponent("el-button"),z=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(Oa,{onSearch:e.unref(a)},null,8,["onSearch"]),e.createVNode(e.unref(be),{data:e.unref(o),"no-border":"",style:{overflowY:"auto"}},{default:e.withCtx(()=>[e.createVNode(te,{label:"商品名称",width:"320"},{default:e.withCtx(({row:N})=>[e.createElementVNode("div",qa,[e.createElementVNode("img",{src:N==null?void 0:N.image},null,8,Ha),e.createElementVNode("div",Ga,[(N==null?void 0:N.productName.length)>=30?(e.openBlock(),e.createBlock(k,{key:0,class:"box-item",effect:"dark",content:N==null?void 0:N.productName,placement:"top"},{default:e.withCtx(()=>[e.createElementVNode("p",null,e.toDisplayString(N==null?void 0:N.productName),1)]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("p",Ya,e.toDisplayString(N==null?void 0:N.productName),1)),e.createElementVNode("span",Wa,e.toDisplayString(we[N.productType]),1)])])]),_:1}),e.createVNode(te,{label:"供货价",width:"200"},{default:e.withCtx(({row:N})=>[e.createElementVNode("span",Ka," ￥"+e.toDisplayString(e.unref(r)(N)),1)]),_:1}),e.createVNode(te,{label:"采购数",prop:"num",width:"120"}),e.createVNode(te,{label:"入库数",prop:"stockInCount",width:"120"}),e.createVNode(te,{label:"所属供应商",prop:"supplierName",width:"220"},{default:e.withCtx(({row:N})=>[e.createElementVNode("div",Xa,[e.createElementVNode("div",null,[e.createElementVNode("span",Ja,e.toDisplayString(N.supplierName),1),e.createVNode(ge,{name:"icon-xiaoxi-copy",size:"18px",style:{cursor:"pointer"},svg:"",onClick:U=>i(N)},null,8,["onClick"])]),e.createElementVNode("span",null,e.toDisplayString(N.supplierContractNumber),1)])]),_:1}),e.createVNode(te,{align:"right",label:"操作",width:"120"},{default:e.withCtx(({row:N})=>[e.createElementVNode("div",null,[e.createVNode(P,{link:"",size:"small",type:"primary",onClick:U=>e.unref(y)(N)},{default:e.withCtx(()=>g[1]||(g[1]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),e.createVNode(P,{link:"",size:"small",type:"primary",onClick:U=>l(N)},{default:e.withCtx(()=>g[2]||(g[2]=[e.createTextVNode("发布")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),e.createVNode(ue,{"page-size":e.unref(n).page.size,"page-num":e.unref(n).page.current,total:e.unref(n).total,onHandleSizeChange:e.unref(u),onHandleCurrentChange:e.unref(d)},null,8,["page-size","page-num","total","onHandleSizeChange","onHandleCurrentChange"]),e.createVNode(z,{modelValue:e.unref(h),"onUpdate:modelValue":g[0]||(g[0]=N=>e.isRef(h)?h.value=N:null),"close-on-click-modal":!1,"destroy-on-close":"",title:"查看",width:"1000px"},{default:e.withCtx(()=>[e.createVNode(Fa,{"current-product":e.unref(m)},null,8,["current-product"])]),_:1},8,["modelValue"])],64)}}}),tl="",Qa=Object.freeze(Object.defineProperty({__proto__:null,default:ee(Za,[["__scopeId","data-v-bbcafdc3"]])},Symbol.toStringTag,{value:"Module"})),va=()=>{const t=e.ref(!1),a=e.ref([]),o=e.ref([]),n=e.reactive({supplierId:"",productName:"",shopCategoryId:""}),r=[{label:"商品名称",prop:"productName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称"}},{label:"供应商",labelWidth:85,prop:"supplierId",valueType:"select",options:a,fieldProps:{placeholder:"请输入店铺名称",props:{value:"id",label:"name",expandTrigger:"hover"},filterable:!0,remote:!0,reserveKeyword:!0,remoteMethod:f=>{d(f)}}},{label:"平台类目",valueType:"cascader",options:o,fieldProps:{placeholder:"请选择平台类目",props:{expandTrigger:"hover",label:"name",value:"id",children:"secondCategoryVos"},onChange:f=>{f.length>1&&(n.shopCategoryId=f[f.length-1])}}}];async function u(){const{data:f,code:m}=await xe();o.value=f}const d=async(f="")=>{var h;const m=await ye({supplierName:f});m.data&&((h=m.data)!=null&&h.length)&&(a.value=m.data.map(y=>({label:y.name,value:y.id})))};return e.onMounted(()=>{u()}),{isShow:t,searchType:n,columns:r,supplierList:a,platformCategoryList:o,fetchSupplierList:d}},en=e.defineComponent({__name:"search",emits:["search"],setup(t,{emit:a}){const o=a,{searchType:n,columns:r}=va(),u=m=>{m&&Object.keys(m).forEach(h=>n[h]=m[h])},d=()=>{const m=fe.cloneDeep(n);m.shopCategoryId=Array.isArray(m.shopCategoryId)?m.shopCategoryId.pop():"",o("search",m)},f=()=>{Object.keys(n).forEach(m=>n[m]=""),d()};return(m,h)=>(e.openBlock(),e.createBlock(he,{"v-model":e.unref(n),columns:e.unref(r),"show-number":3,onChangeFormItem:u,onSearchHandle:d,onHandleReset:f},null,8,["v-model","columns"]))}}),tn=()=>{const t=e.ref(),a=e.ref(!1);return{currentRow:t,showPreviewDialog:a,openPreviewDialog:n=>{t.value=n,a.value=!0}}},on=()=>{const t=pe.useRouter(),a=e.reactive({page:{current:1,size:10},total:0}),o=e.reactive({supplierId:"",productName:"",shopCategoryId:"",status:""}),n=e.ref([]),r=async()=>{let l=[],i=0;try{const x=await Ze({...a.page,...o});x.code===200&&x.data&&(l=x.data.records,i=Number(x.data.total))}finally{n.value=l,a.total=i}},u=l=>{Object.keys(l).forEach(i=>{const x=i;o[x]=l[x]||""}),a.page.current=1,r()},d=l=>{L.ElMessageBox.confirm("确认上架当前商品").then(()=>{Qe(l).then(({code:i,msg:x})=>{i===200?(L.ElMessage.success({message:x||"上架成功"}),r()):L.ElMessage.error({message:x||"上架失败"})})})},f=e.computed(()=>l=>{const i=((l==null?void 0:l.salePrices)||[]).map(k=>Number(k)),x=Math.min(...i),g=Math.max(...i);return x===g?g/1e4:`${x/1e4}~￥${g/1e4}`});return{handleSearch:u,releaseData:n,pagination:a,initData:r,handleSaleOn:d,searchType:o,changeStatus:l=>{o.status=l,a.page.current=1,r()},handleSizeChange:l=>{a.page.size=l,r()},handleCurrentChange:l=>{a.page.current=l,r()},computedSalePrice:f,handleContact:l=>{_e(ce.useShopInfoStore().shopInfo.id,l.shopId).then(({code:i})=>{i===200&&t.push({path:"/message/customer/supplierService",query:{id:l.shopId}})})}}},an={class:"good"},nn={class:"good__info"},ln={class:"good__info"},sn={class:"good__img"},rn=e.defineComponent({__name:"preview",props:{currentProduct:{type:Object,default:()=>({})}},setup(t){const a=t,{divTenThousand:o}=ie(),n=e.ref([]),r=e.ref([]),u=async()=>{const{data:d}=await Ie(ce.useShopInfoStore().shopInfo.id,a.currentProduct.id);n.value=(d==null?void 0:d.skus)||[],r.value=(d==null?void 0:d.specGroups)||[]};return e.onMounted(()=>u()),(d,f)=>{var s,l;const m=e.resolveComponent("el-image"),h=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",an,[e.createElementVNode("div",nn,"店铺名称："+e.toDisplayString((s=a.currentProduct)==null?void 0:s.supplierName),1),e.createElementVNode("div",ln,"商品名称："+e.toDisplayString((l=a.currentProduct)==null?void 0:l.name),1),e.createElementVNode("div",sn,[f[0]||(f[0]=e.createElementVNode("text",null,"商品图片：",-1)),e.createVNode(m,{"preview-src-list":[a.currentProduct.pic],src:a.currentProduct.pic,style:{width:"100px",height:"100px"}},null,8,["preview-src-list","src"])]),f[1]||(f[1]=e.createElementVNode("div",null,"规格：",-1)),e.createVNode(y,{data:n.value,"header-row-style":{"font-size":"12px",color:"#000000"},height:"350",stripe:""},{default:e.withCtx(()=>[r.value.length?(e.openBlock(),e.createBlock(h,{key:0,align:"center",label:"规格"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString((i==null?void 0:i.specs)&&(i==null?void 0:i.specs.join("-"))),1)]),_:1})):e.createCommentVNode("",!0),e.createVNode(h,{align:"center",label:"sku图"},{default:e.withCtx(({row:i})=>[e.createVNode(m,{src:i==null?void 0:i.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1}),e.createVNode(h,{align:"center",label:"销售价(元)"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.salePrice&&e.unref(o)(i.salePrice)),1)]),_:1}),e.createVNode(h,{align:"center",label:"划线价(元)",prop:"originalPrice"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.price&&e.unref(o)(i.price)),1)]),_:1}),e.createVNode(h,{align:"center",label:"重量(kg)",prop:"weight"},{default:e.withCtx(({row:i})=>[e.createElementVNode("span",null,e.toDisplayString(i.weight),1)]),_:1})]),_:1},8,["data"])])}}}),sl="",cn=ee(rn,[["__scopeId","data-v-b854e3eb"]]),dn=()=>{const t=e.ref(!1),a=e.ref();return{violationReason:a,showViolationReason:t,openViolationReasonDialog:n=>{a.value=n,t.value=!0}}},pn={style:{"line-height":"30px"}},mn=["src"],fn=e.defineComponent({__name:"violation-reason",props:{productViolation:{type:Object,default:()=>({})}},setup(t){const a={PROHIBITED:"违禁品",COUNTERFEIT:"假冒伪劣",EXCESSIVE_PLATFORM_INTERVENTION:"平台介入率太高",TITLE_IRREGULARITY:"标题有问题",OTHER:"其他"},o=t,n=e.computed(()=>{var r;return{...o.productViolation,violationType:a[o.productViolation.violationType],violationEvidence:(r=o.productViolation.violationEvidence)==null?void 0:r.split(",")}});return(r,u)=>{const d=e.resolveComponent("el-col"),f=e.resolveComponent("el-row");return e.openBlock(),e.createElementBlock("div",pn,[e.createVNode(f,{gutter:8},{default:e.withCtx(()=>[e.createVNode(d,{span:12},{default:e.withCtx(()=>[e.createElementVNode("div",null,"检查员："+e.toDisplayString(n.value.rummager),1)]),_:1}),e.createVNode(d,{span:12},{default:e.withCtx(()=>[e.createElementVNode("div",null,"检查时间："+e.toDisplayString(n.value.examineDateTime),1)]),_:1})]),_:1}),e.createElementVNode("div",null,"类型："+e.toDisplayString(n.value.violationType),1),e.createElementVNode("div",null,"原因："+e.toDisplayString(n.value.violationExplain),1),e.createElementVNode("div",null,[u[0]||(u[0]=e.createTextVNode(" 相关证据： ")),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.violationEvidence,(m,h)=>(e.openBlock(),e.createElementBlock("img",{key:h,src:m,class:"violation-evidence"},null,8,mn))),128))])])}}}),il="",hn=ee(fn,[["__scopeId","data-v-cdc1ed69"]]),un={class:"tab_container"},gn={class:"commodity-info"},_n=["src"],yn={class:"commodity-info-text"},xn={key:1},Nn={class:"type_tag"},Cn={style:{color:"#f54319"}},Vn={key:0},bn={key:1},Sn={key:2,style:{color:"#999"}},kn={key:3,style:{color:"#f54319"}},En={class:"customer"},Tn={class:"customer__name"},In=e.defineComponent({__name:"index",setup(t){const{handleSearch:a,releaseData:o,pagination:n,initData:r,handleSaleOn:u,searchType:d,changeStatus:f,handleSizeChange:m,handleCurrentChange:h,computedSalePrice:y,handleContact:s}=on(),{currentRow:l,showPreviewDialog:i,openPreviewDialog:x}=tn(),{violationReason:g,showViolationReason:k,openViolationReasonDialog:P}=dn();return r(),(z,N)=>{const U=e.resolveComponent("el-tab-pane"),F=e.resolveComponent("el-tabs"),I=e.resolveComponent("el-tooltip"),M=e.resolveComponent("el-button"),p=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(en,{onSearch:e.unref(a)},null,8,["onSearch"]),e.createElementVNode("div",un,[e.createVNode(F,{"model-value":e.unref(d).status,"onUpdate:modelValue":e.unref(f)},{default:e.withCtx(()=>[e.createVNode(U,{label:"全部",name:""}),e.createVNode(U,{label:"已上架",name:"SELL_ON"}),e.createVNode(U,{label:"已下架",name:"SELL_OFF"}),e.createVNode(U,{label:"违规下架",name:"PLATFORM_SELL_OFF"})]),_:1},8,["model-value","onUpdate:modelValue"])]),e.createVNode(e.unref(be),{data:e.unref(o),style:{overflowY:"auto"},"no-border":""},{default:e.withCtx(()=>[e.createVNode(te,{label:"商品名称",width:"360"},{default:e.withCtx(({row:c})=>[e.createElementVNode("div",gn,[e.createElementVNode("img",{src:c==null?void 0:c.pic},null,8,_n),e.createElementVNode("div",yn,[(c==null?void 0:c.name.length)>=30?(e.openBlock(),e.createBlock(I,{key:0,class:"box-item",effect:"dark",content:c==null?void 0:c.name,placement:"top"},{default:e.withCtx(()=>[e.createElementVNode("p",null,e.toDisplayString(c==null?void 0:c.name),1)]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("p",xn,e.toDisplayString(c==null?void 0:c.name),1)),e.createElementVNode("div",Nn,e.toDisplayString(c.productType==="REAL_PRODUCT"?"实物商品":"虚拟商品"),1)])])]),_:1}),e.createVNode(te,{label:"价格",width:"200"},{default:e.withCtx(({row:c})=>[e.createElementVNode("span",Cn," ￥"+e.toDisplayString(e.unref(y)(c)),1)]),_:1}),e.createVNode(te,{label:"库存",width:"140"},{default:e.withCtx(({row:c})=>{var _;return[e.createTextVNode(e.toDisplayString((_=c==null?void 0:c.storageSkus)==null?void 0:_.reduce(($,R)=>$+Number(R.stock),0)),1)]}),_:1}),e.createVNode(te,{label:"状态",width:"120"},{default:e.withCtx(({row:c})=>[c!=null&&c.delete?(e.openBlock(),e.createElementBlock("span",Vn,"下架")):(c==null?void 0:c.status)==="SELL_ON"?(e.openBlock(),e.createElementBlock("span",bn,"已上架")):(c==null?void 0:c.status)==="SELL_OFF"?(e.openBlock(),e.createElementBlock("span",Sn,"已下架")):(c==null?void 0:c.status)==="PLATFORM_SELL_OFF"?(e.openBlock(),e.createElementBlock("span",kn,"违规下架")):e.createCommentVNode("",!0)]),_:1}),e.createVNode(te,{label:"所属供应商",prop:"supplierName",width:"100"},{default:e.withCtx(({row:c})=>[e.createElementVNode("div",En,[e.createElementVNode("div",null,[e.createElementVNode("span",Tn,e.toDisplayString(c.supplierName),1),e.createVNode(ge,{name:"icon-xiaoxi-copy",size:"18px",style:{cursor:"pointer"},svg:"",onClick:_=>e.unref(s)(c)},null,8,["onClick"])]),e.createElementVNode("span",null,e.toDisplayString(c.supplierContractNumber),1)])]),_:1}),e.createVNode(te,{fixed:"right",label:"操作",align:"right",width:"140"},{default:e.withCtx(({row:c})=>[e.createElementVNode("div",null,[e.createVNode(M,{link:"",size:"small",type:"primary",onClick:_=>e.unref(x)(c)},{default:e.withCtx(()=>N[2]||(N[2]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),c!=null&&c.delete||(c==null?void 0:c.status)==="SELL_OFF"?(e.openBlock(),e.createBlock(M,{key:0,link:"",size:"small",type:"primary",onClick:_=>e.unref(u)(c==null?void 0:c.id)},{default:e.withCtx(()=>N[3]||(N[3]=[e.createTextVNode("上架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),(c==null?void 0:c.status)==="PLATFORM_SELL_OFF"?(e.openBlock(),e.createBlock(M,{key:1,link:"",size:"small",type:"primary",onClick:_=>{var $;return e.unref(P)(($=c==null?void 0:c.extra)==null?void 0:$.productViolation)}},{default:e.withCtx(()=>N[4]||(N[4]=[e.createTextVNode("违规原因 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)])]),_:1})]),_:1},8,["data"]),e.createVNode(ue,{"page-size":e.unref(n).page.size,"page-num":e.unref(n).page.current,total:e.unref(n).total,onHandleSizeChange:e.unref(m),onHandleCurrentChange:e.unref(h)},null,8,["page-size","page-num","total","onHandleSizeChange","onHandleCurrentChange"]),e.createVNode(p,{modelValue:e.unref(i),"onUpdate:modelValue":N[0]||(N[0]=c=>e.isRef(i)?i.value=c:null),"close-on-click-modal":!1,"destroy-on-close":"",title:"查看",width:"1000px"},{default:e.withCtx(()=>[e.createVNode(cn,{"current-product":e.unref(l)},null,8,["current-product"])]),_:1},8,["modelValue"]),e.createVNode(p,{modelValue:e.unref(k),"onUpdate:modelValue":N[1]||(N[1]=c=>e.isRef(k)?k.value=c:null),"close-on-click-modal":!1,"destroy-on-close":"",title:"违规原因",width:"600px"},{default:e.withCtx(()=>[e.createVNode(hn,{"product-violation":e.unref(g)},null,8,["product-violation"])]),_:1},8,["modelValue"])],64)}}}),cl="",Dn=Object.freeze(Object.defineProperty({__proto__:null,default:ee(In,[["__scopeId","data-v-5f7655d1"]])},Symbol.toStringTag,{value:"Module"}));return qe});
