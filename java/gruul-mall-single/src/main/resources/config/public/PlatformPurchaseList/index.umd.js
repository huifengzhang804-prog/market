(function(e,w){typeof exports=="object"&&typeof module<"u"?module.exports=w(require("vue"),require("@/components/schema-form/index.vue"),require("lodash-es"),require("@/apis/http"),require("decimal.js"),require("element-plus"),require("vue-clipboard3"),require("element-china-area-data"),require("@/components/q-address"),require("@/utils/date"),require("@/composables/useConvert"),require("vue-router"),require("@element-plus/icons-vue"),require("@/components/pageManageS/PageManage.vue"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@/components/schema-form/index.vue","lodash-es","@/apis/http","decimal.js","element-plus","vue-clipboard3","element-china-area-data","@/components/q-address","@/utils/date","@/composables/useConvert","vue-router","@element-plus/icons-vue","@/components/pageManageS/PageManage.vue","@/components/element-plus/el-table/ElTableEmpty/index.vue"],w):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformPurchaseList=w(e.PlatformPurchaseListContext.Vue,e.PlatformPurchaseListContext.SchemaForm,e.PlatformPurchaseListContext.Lodash,e.PlatformPurchaseListContext.Request,e.PlatformPurchaseListContext.Decimal,e.PlatformPurchaseListContext.ElementPlus,e.PlatformPurchaseListContext.VueClipboard3,e.PlatformPurchaseListContext.ElementChinaAreaData,e.PlatformPurchaseListContext.QAddressIndex,e.PlatformPurchaseListContext.DateUtil,e.PlatformPurchaseListContext.UseConvert,e.PlatformPurchaseListContext.VueRouter,e.PlatformPurchaseListContext.ElementPlusIconsVue,e.PlatformPurchaseListContext.PageManage,e.PlatformPurchaseListContext.ElTableEmpty))})(this,function(e,w,J,B,j,V,K,Le,De,X,G,Z,v,ee,te){"use strict";var U=document.createElement("style");U.textContent=`@charset "UTF-8";.count-down[data-v-92288512]{color:#f54319}.name[data-v-161781b5]{max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.order-table[data-v-161781b5]{background-color:#fff;padding:0 16px;overflow-x:auto;transition:height .5s}.order-table[data-v-161781b5] .m__table--head{position:sticky;top:0;z-index:999}.order-table[data-v-161781b5] .body--header{background-color:#f7f8fa;border-radius:0}.order-table[data-v-161781b5] .m__table--head th{border:none;background-color:#f7f8fa}.order-table[data-v-161781b5] .m__table--center,.order-table[data-v-161781b5] .body--header{border:none}.order-table__commodity[data-v-161781b5]{width:280px;display:flex;justify-content:space-between;align-items:flex-start}.order-table__commodity--content[data-v-161781b5]{margin-left:10px;display:flex;justify-content:space-between;align-items:flex-start;flex-direction:column;height:63px}.order-table__commodity--name[data-v-161781b5]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-right:10px;font-weight:600}.order-table__commodity--spec[data-v-161781b5]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-right:10px}.order-table__commodity--info[data-v-161781b5]{flex-shrink:0;display:flex;flex-direction:column;align-items:flex-end}.order-table__supplier[data-v-161781b5]{display:flex;justify-content:flex-start;align-items:center;flex-direction:column;line-height:1.5}.order-table__actions[data-v-161781b5]{display:flex;flex-wrap:wrap}.order-table__actions .el-link+.el-link[data-v-161781b5]{margin-left:8px}.order-table__header[data-v-161781b5]{font-size:11px;display:flex;justify-content:space-around;align-items:center;width:100%}.proof-img[data-v-161781b5]{width:100%;height:350px;object-fit:contain}.copy[data-v-161781b5]{color:#1890ff;margin-left:8px;cursor:pointer}.text-red[data-v-161781b5]{color:#f54319}.no_data[data-v-161781b5]{margin-top:100px;display:flex;flex-direction:column;justify-content:center;align-items:center}.no_data img[data-v-161781b5]{width:200px;height:210px}.no_data .cont[data-v-161781b5]{color:#737b80;text-align:center}[data-v-161781b5] .el-empty__image>img{width:230px}[data-v-161781b5] .el-empty__image{width:auto}
`,document.head.appendChild(U);const ae=(a={})=>B.get({url:"gruul-mall-shop/shop/info/getSupplierInfo",params:a}),ne=(a={})=>B.get({url:"addon-supplier/supplier/order",params:a}),Y=a=>B.post({url:"addon-supplier/supplier/order/export",data:a}),oe=e.defineComponent({__name:"purchase-search",emits:["changeShow","search","supplierExport"],setup(a,{emit:i}){const n=e.ref(!1),c=e.ref([]),o=i;e.watch(()=>n.value,d=>o("changeShow",d));const r=e.reactive({supplierId:"",no:"",date:""}),l=[{label:"订单号",labelWidth:60,prop:"no",valueType:"copy",fieldProps:{placeholder:"请输入订单号"}},{label:"供应商",labelWidth:60,prop:"supplierId",valueType:"select",options:c,fieldProps:{placeholder:"请选择供应商",props:{value:"id",label:"name",expandTrigger:"hover"},filterable:!0,remote:!0,remoteMethod:d=>{S(d)}}},{label:"下单时间",prop:"date",valueType:"date-picker",fieldProps:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",format:"YYYY/MM/DD",valueFormat:"YYYY-MM-DD"}}],m=d=>{d&&Object.keys(d).forEach(f=>r[f]=d[f])},h=()=>{var f,u;const d=J.cloneDeep(r);d.startTime=Array.isArray(d.date)?(f=d.date)==null?void 0:f[0]:void 0,d.endTime=Array.isArray(d.date)?(u=d.date)==null?void 0:u[1]:void 0,delete d.date,o("search",d)},x=()=>{Object.keys(r).forEach(d=>r[d]=""),h()},S=async(d="")=>{var u;const f=await ae({supplierName:d});f.data&&((u=f.data)!=null&&u.length)&&(c.value=f.data.map(k=>({...k,label:k.name,value:k.id})))},A=()=>{o("supplierExport",r)};return(d,f)=>{const u=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",null,[n.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(w,{key:0,columns:l,"v-model":r,"has-unfold":"",onChangeFormItem:m,onSearchHandle:h,onHandleReset:x},{otherOperations:e.withCtx(()=>[e.createVNode(u,{class:"from_btn",round:"",type:"primary",onClick:A},{default:e.withCtx(()=>f[0]||(f[0]=[e.createTextVNode("导出")])),_:1})]),_:1},8,["v-model"]))])}}}),re=["近一个月订单","近三个月订单","全部订单"],{divTenThousand:le}=G(),{toClipboard:se}=K(),q=new X,$={UNPAID:"待支付",PAYMENT_AUDIT:"待审核",WAITING_FOR_DELIVER:"待发货",WAITING_FOR_PUTIN:"待入库",FINISHED:"已完成",CLOSED:"已关闭"},ie=(a=[])=>a.reduce((i,n)=>i.plus(new j(le(n.freightPrice))),new j(0)),ce=()=>{const a={OFFLINE:"线下支付",BALANCE:"余额支付"},i=Z.useRouter(),n=e.ref(!1),c=e.ref(),o=e.reactive({status:"",startTime:"",endTime:"",purchaser:"",no:"",supplierId:""}),r=e.reactive({page:{current:1,size:10},total:0}),l=e.ref(" "),m=e.ref("全部订单"),h=e.ref([]),x=s=>{o.status=s,u()},S=s=>{se(s).then(()=>{V.ElMessage.success("复制成功")}).catch(()=>V.ElMessage.error("复制失败"))},A=e.computed(()=>s=>pe()),d=e.computed(()=>s=>de(s)),f=e.computed(()=>s=>ie(s)),u=()=>{let s=[],_=0;ne({...r.page,...o,needSupplier:!0}).then(N=>{var T,L;s=(T=N.data)==null?void 0:T.records,_=((L=N.data)==null?void 0:L.total)||0}).finally(()=>{h.value=s,r.total=Number(_)})},k=s=>{if(l.value=" ",m.value=s,m.value==="近一个月订单"){const _=q.getLastMonth(new Date);O(_)}else if(m.value==="近三个月订单"){const _=q.getLastThreeMonth(new Date);O(_)}else o.startTime="",o.endTime="",u()},I=s=>{o.startTime=s.startTime,o.endTime=s.endTime,o.purchaser=s.purchaser,o.no=s.no,o.supplierId=s.supplierId,r.page.current=1,u()},O=s=>{const _=q.getYMDs(new Date);o.startTime=s,o.endTime=_,u()},R=(s,_)=>{switch(s){case"details":i.push({path:"/order/purchase/details",query:{orderNo:_.no}});break}},P=e.ref([]);return{handleTabChange:x,pagination:r,initOrderList:u,orderDataList:h,handleQuickSearchCommand:k,handleSearch:I,quickSearchTabName:m,quickSearchTabNames:re,activeTabName:l,getMainOrderStatusText:d,computedBtnList:A,handleDispatchEvent:R,computedCalculateFreight:f,showPayDialog:n,currentRow:c,payTypeMap:a,copyOrderNo:S,multiSelect:P,handleChangeRow:(s,_)=>{const N=h.value.find(T=>T.no===_);if(N)if(s===!1){const T=P.value.findIndex(L=>L.no===_);T>-1&&P.value.splice(T,1)}else P.value.push(N)}}},de=a=>{if(!a)return"";if(a.status==="UNPAID")return"待支付";if(a.status==="PAYMENT_AUDIT")return"待审核";const i=["WAITING_FOR_DELIVER","WAITING_FOR_RECEIVE","COMPLETED"],n={WAITING_FOR_DELIVER:"待发货",WAITING_FOR_RECEIVE:"待入库",COMPLETED:"已完成"};if(a.status==="PAID"){let c="COMPLETED";for(const r of a.orderItems){const l=i.findIndex(m=>m===c);if(r.packageStatus==="WAITING_FOR_DELIVER"&&l>0){c="WAITING_FOR_DELIVER";continue}r.packageStatus==="WAITING_FOR_RECEIVE"&&l>1&&(c="WAITING_FOR_RECEIVE")}let o=n[c];return o==="待发货"&&a.orderItems.find(l=>l.packageStatus!=="WAITING_FOR_DELIVER")&&(o="部分发货"),o}return"已关闭"},pe=a=>{const i=[];return i.push({action:"details",text:"查看详情",type:"primary"}),i},me=()=>{const a=e.ref(!1),i=e.ref("");return{showProof:a,goToShowProof:c=>{var o,r;i.value=((r=(o=c==null?void 0:c.extra)==null?void 0:o.pay)==null?void 0:r.proof)||"",a.value=!0},currentProof:i}};function fe(a,i=1e3,n={}){const{immediate:c=!0,immediateCallback:o=!1}=n;let r=null;const l=e.ref(!1);function m(){r&&(clearInterval(r),r=null)}function h(){l.value=!1,m()}function x(){i<=0||(l.value=!0,o&&a(),m(),r=setInterval(a,i))}return c&&x(),{isActive:l,pause:h,resume:x,clean:m}}const he=(a,i)=>{const n=e.reactive({day:"00",hours:"00",minutes:"00",seconds:"00"});if(!i)return{...e.toRefs(n)};const r=new Date(a.replaceAll("-","/")).getTime()+parseInt(i)*1e3-new Date().getTime(),{day:l,hours:m,minutes:h,seconds:x}=ue(r);return n.day=l,n.hours=m,n.minutes=h,n.seconds=x,{...e.toRefs(n)}},ue=a=>{let o=0,r=0,l=0,m=0;for(;a>864e5;)a-=864e5,o++;for(;a>36e5;)a-=36e5,r++;for(;a>6e4;)a-=6e4,l++;for(;a>1e3;)a-=1e3,m++;return{day:String(o).padStart(2,"0"),hours:String(r).padStart(2,"0"),minutes:String(l).padStart(2,"0"),seconds:String(m).padStart(2,"0")}},_e={class:"count-down"},xe={key:0},ge=e.defineComponent({__name:"index",props:{createTime:{default:""},payTimeout:{default:""}},setup(a){const i=a,n=e.reactive({day:"00",hours:"00",minutes:"00",seconds:"00"}),c=e.ref(!0),{clean:o}=fe(()=>{const{day:r,hours:l,minutes:m,seconds:h}=he(i.createTime,i.payTimeout);n.day=r.value,n.hours=l.value,n.minutes=m.value,n.seconds=h.value,r.value==="00"&&l.value==="00"&&m.value==="00"&&h.value==="00"?(c.value=!0,e.nextTick(()=>o())):c.value=!1},1e3,{immediate:!0,immediateCallback:!0});return e.onBeforeUnmount(()=>o()),(r,l)=>(e.openBlock(),e.createElementBlock("div",null,[l[0]||(l[0]=e.createElementVNode("span",null,"(",-1)),e.createElementVNode("span",_e,[n.day!=="00"?(e.openBlock(),e.createElementBlock("span",xe,e.toDisplayString(n.day)+"天",1)):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(n.hours)+":"+e.toDisplayString(n.minutes)+":"+e.toDisplayString(n.seconds),1)]),l[1]||(l[1]=e.createElementVNode("span",null,")",-1))]))}}),we="",H=(a,i)=>{const n=a.__vccOpts||a;for(const[c,o]of i)n[c]=o;return n},ye=H(ge,[["__scopeId","data-v-92288512"]]),be={class:"table_container overh"},Te={style:{color:"#f54319"}},Ce=["onClick"],Ee={class:"name"},Se={class:"name"},Ne=["src"],Ve=e.defineComponent({__name:"PlatformPurchaseList",setup(a){const{handleTabChange:i,pagination:n,initOrderList:c,orderDataList:o,handleQuickSearchCommand:r,handleSearch:l,quickSearchTabName:m,quickSearchTabNames:h,activeTabName:x,getMainOrderStatusText:S,computedBtnList:A,handleDispatchEvent:d,computedCalculateFreight:f,payTypeMap:u,handleChangeRow:k,multiSelect:I}=ce(),{divTenThousand:O}=G(),{showProof:R,goToShowProof:P,currentProof:Q}=me(),s=[];(()=>{Object.keys($).forEach(y=>{s.push([y,$[y]])})})(),c();const N=async y=>{var C,F;if(I.value.length){let E=[""];E=I.value.map(W=>W.mainNo);const{data:z,code:M,msg:D}=await Y({exportOrderIds:E});return M!==200?V.ElMessage.error(D||"导出失败"):V.ElMessage.error("导出成功")}else{let E={no:y.no,supplierId:y.supplierId,startTime:(C=y.date)==null?void 0:C[0],endTime:(F=y.date)==null?void 0:F[1],status:x.value,exportOrderIds:""};E.status=E.status.trim();const{data:z,code:M,msg:D}=await Y(E);return M!==200?V.ElMessage.error(D||"导出失败"):V.ElMessage.success("导出成功")}},T=y=>{n.page.size=y,c(),console.log(I.value,"multiSelect")},L=y=>{n.page.current=y,c()};return(y,C)=>{const F=e.resolveComponent("el-icon"),E=e.resolveComponent("el-dropdown-item"),z=e.resolveComponent("el-dropdown-menu"),M=e.resolveComponent("el-dropdown"),D=e.resolveComponent("el-tab-pane"),W=e.resolveComponent("el-tabs"),g=e.resolveComponent("el-table-column"),ke=e.resolveComponent("el-link"),Ie=e.resolveComponent("el-table"),Pe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(oe,{onSearch:e.unref(l),onSupplierExport:N},null,8,["onSearch"]),e.createVNode(W,{modelValue:e.unref(x),"onUpdate:modelValue":C[0]||(C[0]=t=>e.isRef(x)?x.value=t:null),style:{padding:"0 16px"},onTabChange:e.unref(i)},{default:e.withCtx(()=>[e.createVNode(D,{name:" "},{label:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(e.unref(m)),1),e.createVNode(M,{placement:"bottom-end",trigger:"click",onCommand:e.unref(r)},{dropdown:e.withCtx(()=>[e.createVNode(z,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),t=>(e.openBlock(),e.createBlock(E,{key:t,command:t},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",{class:"el-dropdown-link",style:{height:"40px"},onClick:e.withModifiers(()=>{},["stop"])},[e.createVNode(F,{class:"el-icon--right",style:{position:"relative",top:"12px"}},{default:e.withCtx(()=>[e.createVNode(e.unref(v.ArrowDown))]),_:1})])]),_:1},8,["onCommand"])]),_:1}),(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(s,t=>e.createVNode(D,{key:t[0],label:t[1],name:t[0]},null,8,["label","name"])),64))]),_:1},8,["modelValue","onTabChange"]),e.createElementVNode("div",be,[e.createVNode(Ie,{data:e.unref(o),"header-row-style":{fontSize:"14",color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{fontSize:"14",color:"#333333"},onSelectionChange:C[1]||(C[1]=t=>I.value=t)},{empty:e.withCtx(()=>[e.createVNode(te,{"image-index":"9"})]),default:e.withCtx(()=>[e.createVNode(g,{type:"selection",width:"40",fixed:"left"}),e.createVNode(g,{label:"订单",prop:"no",width:"220"}),e.createVNode(g,{label:"采购数量",prop:"no",width:"100"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString((t==null?void 0:t.orderItems)&&(t==null?void 0:t.orderItems.reduce((p,b)=>p+b.num,0))),1)]),_:1}),e.createVNode(g,{label:"商品总价(元)",prop:"payAmount",width:"150"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(O)(t.payAmount).toFixed(2)),1)]),_:1}),e.createVNode(g,{label:"运费(元)",prop:"orderItems",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(f)(t==null?void 0:t.orderItems).toFixed(2)),1)]),_:1}),e.createVNode(g,{label:"应收金额(元)",prop:"payAmount",width:"150"},{default:e.withCtx(({row:t})=>{var p,b;return[e.createElementVNode("span",Te,e.toDisplayString(e.unref(O)(t.payAmount).toFixed(2)),1),(b=(p=t==null?void 0:t.extra)==null?void 0:p.pay)!=null&&b.proof?(e.openBlock(),e.createElementBlock("i",{key:0,class:"iconfont icon-pingzhengzhongxin",style:{"font-size":"22px",color:"#306bff",position:"relative",top:"3px",left:"2px",cursor:"pointer"},onClick:Re=>e.unref(P)(t)},null,8,Ce)):e.createCommentVNode("",!0)]}),_:1}),e.createVNode(g,{label:"订单状态",width:"200"},{default:e.withCtx(({row:t})=>{var p;return[e.createElementVNode("span",{class:e.normalizeClass([{"text-red":e.unref(S)(t)==="待支付"},"df"])},[e.createTextVNode(e.toDisplayString(e.unref(S)(t))+" ",1),e.unref(S)(t)==="待支付"?(e.openBlock(),e.createBlock(ye,{key:0,"create-time":t==null?void 0:t.createTime,"pay-timeout":(p=t==null?void 0:t.extra)==null?void 0:p.payTimeout},null,8,["create-time","pay-timeout"])):e.createCommentVNode("",!0)],2)]}),_:1}),e.createVNode(g,{label:"供应商",width:"180"},{default:e.withCtx(({row:t})=>{var p,b;return[e.createElementVNode("div",null,[e.createElementVNode("p",Ee,e.toDisplayString((p=t==null?void 0:t.extraInfo)==null?void 0:p.supplierName),1),e.createElementVNode("p",null,e.toDisplayString((b=t==null?void 0:t.extraInfo)==null?void 0:b.supplierPhone),1)])]}),_:1}),e.createVNode(g,{label:"店铺",width:"180"},{default:e.withCtx(({row:t})=>{var p;return[e.createElementVNode("div",null,[e.createElementVNode("p",Se,e.toDisplayString(t==null?void 0:t.shopName),1),e.createElementVNode("p",null,e.toDisplayString((p=t==null?void 0:t.extraInfo)==null?void 0:p.supplierPhone),1)])]}),_:1}),e.createVNode(g,{label:"支付方式",width:"120"},{default:e.withCtx(({row:t})=>{var p,b;return[e.createTextVNode(e.toDisplayString(e.unref(u)[(b=(p=t==null?void 0:t.extra)==null?void 0:p.pay)==null?void 0:b.payType]),1)]}),_:1}),e.createVNode(g,{label:"下单时间",prop:"createTime",width:"180"}),e.createVNode(g,{label:"支付时间",width:"180"},{default:e.withCtx(({row:t})=>{var p;return[e.createTextVNode(e.toDisplayString((p=t==null?void 0:t.timeNodes)==null?void 0:p.payTime),1)]}),_:1}),e.createVNode(g,{label:"操作",fixed:"right",align:"right"},{default:e.withCtx(({row:t})=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(A)(t),p=>(e.openBlock(),e.createBlock(ke,{key:p.action,type:p.type,onClick:b=>e.unref(d)(p.action,t)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p.text),1)]),_:2},1032,["type","onClick"]))),128))]),_:1})]),_:1},8,["data"])]),e.createVNode(ee,{"page-size":e.unref(n).page.size,"page-num":e.unref(n).page.current,total:e.unref(n).total,onReload:e.unref(c),onHandleSizeChange:T,onHandleCurrentChange:L},null,8,["page-size","page-num","total","onReload"]),e.createVNode(Pe,{modelValue:e.unref(R),"onUpdate:modelValue":C[2]||(C[2]=t=>e.isRef(R)?R.value=t:null),title:"付款凭证",width:"500px"},{default:e.withCtx(()=>[e.createElementVNode("img",{src:e.unref(Q),class:"proof-img"},null,8,Ne)]),_:1},8,["modelValue"])],64)}}}),Ae="";return H(Ve,[["__scopeId","data-v-161781b5"]])});
