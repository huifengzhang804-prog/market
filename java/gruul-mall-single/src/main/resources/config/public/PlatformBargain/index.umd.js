(function(e,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("vue"),require("@vueuse/core"),require("@/components/schema-form/index.vue"),require("@/apis/http"),require("@/components/PageManage.vue"),require("vue-router"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/schema-form/index.vue","@/apis/http","@/components/PageManage.vue","vue-router","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue"],g):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformBargain=g(e.PlatformBargainContext.Vue,e.PlatformBargainContext.VueUse,e.PlatformBargainContext.SchemaForm,e.PlatformBargainContext.Request,e.PlatformBargainContext.PageManageTwo,e.PlatformBargainContext.VueRouter,e.PlatformBargainContext.ElementPlus,e.PlatformBargainContext.ElTableEmpty))})(this,function(e,g,O,x,T,R,f,F){"use strict";var B=document.createElement("style");B.textContent=`@charset "UTF-8";.goods[data-v-fef57254]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[data-v-fef57254] .el-dialog__body{padding-bottom:0!important}[data-v-fef57254] .el-link+.el-link{margin-left:10px}
`,document.head.appendChild(B);const I=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchDelBtn:{type:Boolean,default:!0},selectOptions:{type:Object,default(){return{}}}},emits:["update:modelValue","batchDel","search"],setup(l,{emit:u}){const n=l,C=[{label:"活动名称",labelWidth:75,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"NOT_STARTED",label:"未开始"},{value:"PROCESSING",label:"进行中"},{value:"OVER",label:"已结束"},{value:"SHOP_SELL_OFF",label:"已下架"},{value:"ILLEGAL_SELL_OFF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],m=u,V=g.useVModel(n,"modelValue",m),b=d=>{d&&Object.keys(d).forEach(r=>n.modelValue[r]=d[r])},c=()=>{Object.keys(n.modelValue).forEach(d=>n.modelValue[d]=""),m("search")};return(d,r)=>{const E=e.resolveComponent("el-button");return e.openBlock(),e.createBlock(O,{"v-model":e.unref(V),columns:C,onChangeFormItem:b,onSearchHandle:r[1]||(r[1]=N=>m("search")),onHandleReset:c},{otherOperations:e.withCtx(()=>[l.showBatchDelBtn?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(E,{key:0,disabled:l.batchDisabled,round:"",plain:"",onClick:r[0]||(r[0]=N=>m("batchDel"))},{default:e.withCtx(()=>r[2]||(r[2]=[e.createTextVNode("批量移除")])),_:1},8,["disabled"]))]),_:1},8,["v-model"])}}}),y="addon-bargain/bargain",P=l=>x.get({url:y,params:l}),D=l=>x.get({url:`${y}/illegal/reason/${l}`}),M=l=>x.del({url:y,data:l}),z=l=>x.put({url:`${y}/platform/sellOf`,data:l}),A={class:"table_container"},q={class:"goods"},G={class:"goods"},$={class:"dialog-footer"},H=e.defineComponent({__name:"PlatformBargain",setup(l){const u=e.ref({keywords:"",status:""}),n=e.ref({size:10,current:1}),h=e.ref(0),C=R.useRouter(),m=e.ref([]),V=e.ref([]),b={NOT_STARTED:"未开始",PROCESSING:"进行中",OVER:"已结束",ILLEGAL_SELL_OFF:"违规下架",SHOP_SELL_OFF:"已下架"},c=e.ref({shopId:"",bargainId:"",violationReason:""}),d=e.ref(),r=e.ref(!1),E=a=>{r.value=!0,c.value.shopId=a.shopId,c.value.bargainId=a.id},N=()=>{d.value.resetFields()},U=()=>{d.value.validate(async(a,o)=>{if(a){const{code:s,msg:p}=await z(c.value);if(s!==200){f.ElMessage.error(p);return}f.ElMessage.success("下架成功");const i=m.value.find(w=>w.id===c.value.bargainId);i&&(i.status="ILLEGAL_SELL_OFF"),r.value=!1}else console.log("error submit!",o)})},j=async()=>{if(!V.value.length){f.ElMessage.info("请选择需要删除的活动");return}if(!await f.ElMessageBox.confirm("确定删除活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const o=V.value.map(i=>({shopId:i.shopId,activityId:i.id})),{code:s,data:p}=await M(o);if(s!==200){f.ElMessage.error("删除失败");return}f.ElMessage.success("删除成功"),_()},W=a=>{C.push({name:"bargainBaseinfo",query:{activityId:a.id,shopId:a.shopId}})},S=e.ref(""),J=async a=>{const{data:o}=await D(a.id);S.value=o||"暂无违规原因"},K=()=>{_()};async function _(){const{status:a,keywords:o}=u.value,s={...n.value,status:a,keyword:o},{code:p,data:i}=await P(s);if(p!==200)return f.ElMessage.error("获取活动列表失败");m.value=i.records,n.value.current=i.current,n.value.size=i.size,h.value=i.total}const Q=a=>{n.value.size=a,_()},X=a=>{n.value.current=a,_()};return e.onBeforeMount(()=>{_()}),(a,o)=>{const s=e.resolveComponent("el-table-column"),p=e.resolveComponent("el-link"),i=e.resolveComponent("el-tooltip"),w=e.resolveComponent("el-table"),Y=e.resolveComponent("el-input"),Z=e.resolveComponent("el-form-item"),v=e.resolveComponent("el-form"),L=e.resolveComponent("el-button"),ee=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(I,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=t=>u.value=t),onBatchDel:j,onSearch:K},null,8,["modelValue"]),e.createElementVNode("div",A,[e.createVNode(w,{ref:"multipleTableRef",data:m.value,"header-row-style":{fontSize:"14px",color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{fontSize:"14px",color:"#333333"},onSelectionChange:o[1]||(o[1]=t=>V.value=t)},{empty:e.withCtx(()=>[e.createVNode(F)]),default:e.withCtx(()=>[e.createVNode(s,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",q,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(s,{label:"活动名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",G,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(s,{label:"活动状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:t.status==="ILLEGAL_SELL_OFF"?"#F54319":["SHOP_SELL_OFF","OVER"].includes(t.status)?"#999":""})},e.toDisplayString(b[t.status]),5)]),_:1}),e.createVNode(s,{label:"活动时间"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(s,{label:"活动商品",width:"140"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.productNum),1)]),_:1}),e.createVNode(s,{label:"支付单数",width:"140"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.payOrder),1)]),_:1}),e.createVNode(s,{label:"操作",align:"right",fixed:"right"},{default:e.withCtx(({row:t})=>[["ILLEGAL_SELL_OFF"].includes(t.status)?(e.openBlock(),e.createBlock(i,{key:0,class:"box-item",effect:"dark",content:S.value,placement:"bottom-start"},{default:e.withCtx(()=>[e.createVNode(p,{underline:!1,type:"primary",size:"small",onMouseenterOnce:k=>J(t)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode(" 违规原因 ")])),_:2},1032,["onMouseenterOnce"])]),_:2},1032,["content"])):e.createCommentVNode("",!0),["NOT_STARTED","PROCESSING"].includes(t.status)?(e.openBlock(),e.createBlock(p,{key:1,underline:!1,type:"danger",size:"small",onClick:k=>E(t)},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode(" 违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(p,{underline:!1,type:"primary",size:"small",onClick:k=>W(t)},{default:e.withCtx(()=>o[8]||(o[8]=[e.createTextVNode(" 查看 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createVNode(T,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=t=>n.value=t),"load-init":!0,total:h.value,onHandleSizeChange:Q,onHandleCurrentChange:X,onReload:_},null,8,["modelValue","total"]),e.createVNode(ee,{modelValue:r.value,"onUpdate:modelValue":o[5]||(o[5]=t=>r.value=t),title:"违规下架",width:"500",center:"",onClose:N},{footer:e.withCtx(()=>[e.createElementVNode("div",$,[e.createVNode(L,{onClick:o[4]||(o[4]=t=>r.value=!1)},{default:e.withCtx(()=>o[9]||(o[9]=[e.createTextVNode("取消")])),_:1}),e.createVNode(L,{type:"primary",onClick:U},{default:e.withCtx(()=>o[10]||(o[10]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(v,{ref_key:"illegalReasonFormRef",ref:d,model:c.value,rules:{violationReason:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(Z,{label:"",prop:"violationReason"},{default:e.withCtx(()=>[e.createVNode(Y,{modelValue:c.value.violationReason,"onUpdate:modelValue":o[3]||(o[3]=t=>c.value.violationReason=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),te="";return((l,u)=>{const n=l.__vccOpts||l;for(const[h,C]of u)n[h]=C;return n})(H,[["__scopeId","data-v-fef57254"]])});
