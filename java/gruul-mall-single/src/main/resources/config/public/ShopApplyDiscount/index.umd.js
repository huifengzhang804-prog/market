(function(e,y){typeof exports=="object"&&typeof module<"u"?module.exports=y(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/apis/http"),require("@/components/PageManage.vue"),require("element-plus"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","@/apis/http","@/components/PageManage.vue","element-plus","vue-router"],y):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopApplyDiscount=y(e.ShopApplyDiscountContext.Vue,e.ShopApplyDiscountContext.VueUse,e.ShopApplyDiscountContext.SchemaForms,e.ShopApplyDiscountContext.Request,e.ShopApplyDiscountContext.PageManageTwo,e.ShopApplyDiscountContext.ElementPlus,e.ShopApplyDiscountContext.VueRouter))})(this,function(e,y,k,C,R,i,A){"use strict";var T=document.createElement("style");T.textContent=`@charset "UTF-8";.col-last[data-v-8bf2d47d]{display:flex;justify-content:flex-end}.m-l-20[data-v-8bf2d47d]{margin-left:20px}.container[data-v-281315ed]{overflow-y:scroll}.reason[data-v-281315ed]{padding:10px 10px 20px}.status[data-v-281315ed]{color:#f54319}.grey[data-v-281315ed]{color:#999}[data-v-281315ed] .el-button.is-link{padding:0}[data-v-281315ed] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(T);const B=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(n,{emit:m}){const c=n,u=[{label:"活动名称",prop:"name",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"IN_PROGRESS",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"OFF_SHELF",label:"已下架"},{value:"VIOLATION_OFF_SHELF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],r=m,h=y.useVModel(c,"modelValue",r),d=f=>{f&&Object.keys(f).forEach(p=>{h.value[p]=f[p]})},E=()=>{Object.keys(c.modelValue).forEach(f=>{h.value[f]=""}),r("search")};return(f,p)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(k,{"v-model":e.unref(h),columns:u,onSearchHandle:p[0]||(p[0]=S=>r("search")),onChangeFormItem:d,onHandleReset:E},null,8,["v-model"]),p[1]||(p[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}}),Y="",F=(n,m)=>{const c=n.__vccOpts||n;for(const[u,r]of m)c[u]=r;return c},H=F(B,[["__scopeId","data-v-8bf2d47d"]]),x="addon-full-reduction/full/reduction",L=n=>C.post({url:`${x}/page`,data:n}),w=n=>C.post({url:`${x}/shelf`,data:n}),O=n=>C.del({url:`${x}/batch/delete`,data:n});var _=(n=>(n.NOT_STARTED="NOT_STARTED",n.IN_PROGRESS="IN_PROGRESS",n.FINISHED="FINISHED",n.OFF_SHELF="OFF_SHELF",n.VIOLATION_OFF_SHELF="VIOLATION_OFF_SHELF",n))(_||{});const D={NOT_STARTED:{value:"NOT_STARTED",label:"未开始",style:"nots"},IN_PROGRESS:{value:"IN_PROGRESS",label:"进行中",style:"ongoing"},FINISHED:{value:"FINISHED",label:"已结束",style:"hasEnded"},OFF_SHELF:{value:"OFF_SHELF",label:"已下架",style:"off"},VIOLATION_OFF_SHELF:{value:"VIOLATION_OFF_SHELF",label:"违规下架",style:"off"}};var b=(n=>(n[""]="未选择满减条件",n.FULL_REDUCTION="满减",n.FULL_DISCOUNT="满折",n))(b||{});const M={class:"q_plugin_container pt15"},P={class:"search_container"},$={class:"handle_container"},q={class:"table_container"},z={class:"reason"},G=e.defineComponent({__name:"ShopApplyDiscount",setup(n){const m=A.useRouter(),c=e.ref([]),u=e.ref({name:"",status:""}),r=e.reactive({size:10,current:1,total:0}),h=e.ref();d();async function d(){console.log(u.value,"searchParam");const a={...r,...u.value},{code:o,data:l}=await L(a);if(o!==200)return i.ElMessage.error("获取活动列表失败");c.value=l.records,r.current=l.current,r.size=l.size,r.total=l.total}const E=async a=>{try{if(!await i.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{code:l}=await O([a]);if(l!==200){i.ElMessage.error("删除失败");return}i.ElMessage.success("删除成功"),c.value=c.value.filter(s=>s.id!==a),r.total--}catch(o){console.error("isValidate",o)}},f=a=>{r.size=a,d()},p=a=>{r.current=a,d()},S=e.ref([]),N=e.ref(!1),g=e.ref("违规原因"),j=a=>{g.value=a,N.value=!0},U=async a=>{if(!await i.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{msg:l,code:s}=await w({id:a});if(s!==200)return i.ElMessage.error(l??"下架失败！");i.ElMessage.success("下架成功！"),d()},I=(a,o)=>{m.push({name:"applyDiscountBaseinfo",query:{id:a,isLookUp:o}})},J=()=>{i.ElMessageBox.confirm("确定删除选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async a=>{if(a==="cancel")return;const o=S.value.filter(s=>s.status!==_.IN_PROGRESS).map(s=>s.id),{code:l}=await O(o);if(l!==200){i.ElMessage.error("删除失败");return}i.ElMessage.success("删除成功"),d()}})},K=a=>{S.value=a},Q=()=>{g.value="",N.value=!1};return(a,o)=>{const l=e.resolveComponent("el-button"),s=e.resolveComponent("el-table-column"),W=e.resolveComponent("el-table"),X=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("div",P,[e.createVNode(H,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=t=>u.value=t),onSearch:d},null,8,["modelValue"])]),e.createElementVNode("div",$,[e.createVNode(l,{round:"",type:"primary",onClick:o[1]||(o[1]=t=>e.unref(m).push({name:"applyDiscountBaseinfo"}))},{default:e.withCtx(()=>o[3]||(o[3]=[e.createTextVNode(" 新增满减 ")])),_:1}),e.createVNode(l,{disabled:!S.value.length,round:"",onClick:J},{default:e.withCtx(()=>o[4]||(o[4]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",q,[e.createVNode(W,{ref_key:"multipleTableRef",ref:h,data:c.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:K},{default:e.withCtx(()=>[e.createVNode(s,{selectable:t=>t.status!==e.unref(_).IN_PROGRESS,fixed:"",type:"selection",width:"30"},null,8,["selectable"]),e.createVNode(s,{label:"活动名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.name),1)]),_:1}),e.createVNode(s,{label:"类型",width:"80"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(b)[t.firstRuleType]),1)]),_:1}),e.createVNode(s,{label:"使用规则",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,e.toDisplayString(t.firstRuleDesc),1)]),_:1}),e.createVNode(s,{label:"状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",{class:e.normalizeClass({status:t.status==="VIOLATION_OFF_SHELF",grey:t.status==="OFF_SHELF"||t.status==="FINISHED"})},e.toDisplayString(e.unref(D)[t.status]&&e.unref(D)[t.status].label),3)]),_:1}),e.createVNode(s,{label:"活动时间",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(s,{label:"活动商品"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.productType==="ALL_PRODUCT"?"全部":`${t.product}${t.productType==="SPECIFIED_PRODUCT_NOT_PARTICIPATE"?"(除外)":""}`),1)]),_:1}),e.createVNode(s,{label:"支付单数"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.order||0),1)]),_:1}),e.createVNode(s,{fixed:"right",label:"操作",align:"right"},{default:e.withCtx(({row:t})=>[e.createVNode(l,{link:"",type:"primary",onClick:V=>I(t.id,"true")},{default:e.withCtx(()=>o[5]||(o[5]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),t.status===e.unref(_).IN_PROGRESS?(e.openBlock(),e.createBlock(l,{key:0,link:"",type:"primary",onClick:V=>U(t.id)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode(" 下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status===e.unref(_).NOT_STARTED?(e.openBlock(),e.createBlock(l,{key:1,link:"",type:"primary",onClick:V=>I(t.id,"false")},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode(" 编辑 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status===e.unref(_).VIOLATION_OFF_SHELF?(e.openBlock(),e.createBlock(l,{key:2,link:"",type:"primary",onClick:V=>j(t.violation)},{default:e.withCtx(()=>o[8]||(o[8]=[e.createTextVNode("违规原因 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status!==e.unref(_).IN_PROGRESS?(e.openBlock(),e.createBlock(l,{key:3,link:"",type:"danger",onClick:V=>E(t.id)},{default:e.withCtx(()=>o[9]||(o[9]=[e.createTextVNode(" 删除 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(R,{"load-init":!0,"page-num":r.current,"page-size":r.size,total:r.total,onReload:d,onHandleSizeChange:f,onHandleCurrentChange:p},null,8,["page-num","page-size","total"]),e.createVNode(X,{modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=t=>N.value=t),center:"",title:"违规原因",width:"600px",onClose:Q},{default:e.withCtx(()=>[e.createElementVNode("div",z,e.toDisplayString(g.value),1)]),_:1},8,["modelValue"])])}}}),Z="";return F(G,[["__scopeId","data-v-281315ed"]])});
