(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("element-plus"),require("@/components/qszr-core/packages/q-table/q-table-column.vue"),require("@/components/qszr-core/packages/q-table/QTable"),require("@/assets/json/data.json"),require("@/utils/Storage"),require("vue-router"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","element-plus","@/components/qszr-core/packages/q-table/q-table-column.vue","@/components/qszr-core/packages/q-table/QTable","@/assets/json/data.json","@/utils/Storage","vue-router","@/apis/http"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.DeliveryList=p(e.DeliveryListContext.Vue,e.DeliveryListContext.ElementPlus,e.DeliveryListContext.QTableColumn,e.DeliveryListContext.QTable,e.DeliveryListContext.handleGetCompanyName,e.DeliveryListContext.Storage,e.DeliveryListContext.VueRouter,e.DeliveryListContext.Request))})(this,function(e,p,b,I,v,V,z,O){"use strict";var q=document.createElement("style");q.textContent=`@charset "UTF-8";.orderIndex-table__img-box[data-v-17065101]{width:200px;display:flex;justify-content:flex-start}.orderIndex-table__img[data-v-17065101]{border-radius:5px;position:relative}.orderIndex-table__img-mask[data-v-17065101]{margin-left:5px;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;font-size:12px;color:#000}.orderIndex-table__img-mask--name[data-v-17065101]{width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.orderIndex-table__img-mask--integral[data-v-17065101]{width:100px;display:flex;justify-content:space-between}.orderIndex-table__img-mask--integral[data-v-17065101]>:nth-child(1){font-size:12px;color:#000}.is-complete[data-v-17065101]{background:#eef1f6}.header-table[data-v-17065101]{width:100%;display:flex;justify-content:space-between;align-items:center}.money_text[data-v-17065101]{font-size:12px;color:#000}.orderIndex-table__img-box[data-v-55bf2bc9]{width:200px;display:flex;justify-content:flex-start}.orderIndex-table__img[data-v-55bf2bc9]{flex-shrink:0;border-radius:5px;position:relative}.orderIndex-table__img-mask[data-v-55bf2bc9]{margin-left:5px;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;font-size:12px;color:#000}.orderIndex-table__img-mask--name[data-v-55bf2bc9]{width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.orderIndex-table__img-mask--integral[data-v-55bf2bc9]{width:100px;display:flex;justify-content:space-between}.orderIndex-table__img-mask--integral[data-v-55bf2bc9]>:nth-child(1){font-size:12px;color:#000}.is-complete[data-v-55bf2bc9]{background:#eef1f6}.header-table[data-v-55bf2bc9]{width:100%;display:flex;justify-content:space-between;align-items:center}.money_text[data-v-55bf2bc9]{font-size:12px;color:#000}.table_item[data-v-ffe03f41] .el-form-item__content{flex-direction:column;display:flex;flex:1;overflow:hidden}.avatar_text_box[data-v-ffe03f41]{display:flex;justify-content:space-between;align-items:flex-start}.send[data-v-ffe03f41]{font-size:14px;color:#333}.DatchDelivery_container[data-v-ffe03f41]{padding:0 25px}.DatchDelivery_container__tabText[data-v-ffe03f41]{color:#000}.DatchDelivery_container__tool[data-v-ffe03f41]{align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:100;margin-top:auto}
`,document.head.appendChild(q);const $={style:{"margin-right":"36px"}},j={class:"orderIndex-table__img-box"},U={class:"orderIndex-table__img-mask"},B={class:"orderIndex-table__img-mask--name"},G={class:"orderIndex-table__img-mask--integral"},F={style:{color:"#838383","font-size":"10px"}},M={class:"avatar_text avatar_text__bottom money_text"},A={style:{color:"#2e99f3","margin-right":"10px"}},X={style:{padding:"0 10px 0"},class:"money_text"},P=e.defineComponent({__name:"express-table",props:{tableData:{type:Array,default:()=>[]}},emits:["filterOrderList","express-No","express-company-name"],setup(m,{emit:n}){const _=v.map(i=>({label:i.companyName,value:{value:i.companyCode,label:i.companyName,companyType:i.companyType},companyType:i.companyType})),l=m,f=n,g=(i,d)=>{f("express-No",i,d)},N=(i,d)=>{f("express-company-name",i,d)};return(i,d)=>{const s=e.resolveComponent("el-button"),C=e.resolveComponent("el-row"),w=e.resolveComponent("el-image"),E=e.resolveComponent("el-select-v2"),u=e.resolveComponent("el-form-item"),k=e.resolveComponent("el-input");return e.openBlock(),e.createBlock(e.unref(I),{data:l.tableData,class:"orderIndex-table q-table"},{header:e.withCtx(({row:o})=>[e.createElementVNode("div",$,"订单号:"+e.toDisplayString(o.no),1),e.createElementVNode("div",null,"创建时间:"+e.toDisplayString(o.createTime),1),e.createVNode(C,{style:{flex:"1"},justify:"end"},{default:e.withCtx(()=>[e.createVNode(s,{type:"primary",link:"",size:"small",onClick:c=>f("filterOrderList",o)},{default:e.withCtx(()=>d[0]||(d[0]=[e.createTextVNode("移除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:e.withCtx(()=>[e.createVNode(b,{prop:"name",label:"商品",align:"left"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",j,[e.createVNode(w,{fits:"cover",style:{width:"63px",height:"63px"},shape:"square",size:"large",src:o.image,title:o.productName},null,8,["src","title"]),e.createElementVNode("div",U,[e.createElementVNode("span",B,e.toDisplayString(o.productName),1),e.createElementVNode("div",G,[e.createElementVNode("span",null,"积分"+e.toDisplayString(o.price),1),e.createElementVNode("span",F,"共"+e.toDisplayString(o.num)+"件",1)])])])]),_:1}),e.createVNode(b,{prop:"age",label:"客户"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",M,[e.createElementVNode("span",A,"买家昵称 : "+e.toDisplayString(o.buyerNickname),1),e.createElementVNode("div",X," (收货人："+e.toDisplayString(o.integralOrderReceiverVO.name)+","+e.toDisplayString(o.integralOrderReceiverVO.mobile)+") ",1)])]),_:1}),e.createVNode(b,{prop:"sex",label:"操作",align:"right"},{default:e.withCtx(({row:o})=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createVNode(u,{label:"物流公司",style:{width:"230px"}},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:o.expressCompanyName,"onUpdate:modelValue":c=>o.expressCompanyName=c,placeholder:"请选择物流公司",options:e.unref(_),"value-key":"value",onChange:c=>N(c,o)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:2},1024),e.createVNode(u,{label:"运单号码",style:{width:"230px"}},{default:e.withCtx(()=>[e.createVNode(k,{modelValue:o.expressNo,"onUpdate:modelValue":c=>o.expressNo=c,style:{height:"28px"},maxlength:"40",onChange:c=>g(c,o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])}}}),xe="",D=(m,n)=>{const _=m.__vccOpts||m;for(const[l,f]of n)_[l]=f;return _},H=D(P,[["__scopeId","data-v-17065101"]]),W={style:{"margin-right":"36px"}},J={style:{"margin-right":"36px"}},K={class:"orderIndex-table__img-box"},Y={class:"orderIndex-table__img-mask"},Z={class:"orderIndex-table__img-mask--name"},Q={class:"orderIndex-table__img-mask--integral"},ee={style:{color:"#838383","font-size":"10px"}},te={class:"avatar_text avatar_text__bottom money_text"},ae={style:{color:"#2e99f3","margin-right":"10px"}},oe={class:"money_text"},ne=e.defineComponent({__name:"un-express-table",props:{tabData:{type:Array,default:()=>[]}},emits:["filterOrderList"],setup(m,{emit:n}){const _=n,l=m;return(f,g)=>{const N=e.resolveComponent("el-button"),i=e.resolveComponent("el-row"),d=e.resolveComponent("el-image");return e.openBlock(),e.createBlock(e.unref(I),{data:l.tabData,class:"orderIndex-table"},{header:e.withCtx(({row:s})=>[e.createElementVNode("div",W,"订单号:"+e.toDisplayString(s.no),1),e.createElementVNode("div",J,"创建时间:"+e.toDisplayString(s.createTime),1),e.createVNode(i,{style:{flex:"1"},justify:"end"},{default:e.withCtx(()=>[e.createVNode(N,{type:"primary",link:"",size:"small",onClick:C=>_("filterOrderList",s)},{default:e.withCtx(()=>g[0]||(g[0]=[e.createTextVNode("移除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:e.withCtx(()=>[e.createVNode(b,{label:"商品",align:"left"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",K,[e.createVNode(d,{fits:"cover",style:{width:"63px",height:"63px"},shape:"square",size:"large",src:s.image,title:s.productName},null,8,["src","title"]),e.createElementVNode("div",Y,[e.createElementVNode("span",Z,e.toDisplayString(s.productName),1),e.createElementVNode("div",Q,[e.createElementVNode("span",null,"积分"+e.toDisplayString(s.price),1),e.createElementVNode("span",ee,"共"+e.toDisplayString(s.num)+"件",1)])])])]),_:1}),e.createVNode(b,{label:"客户",align:"center"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",te,[e.createElementVNode("span",ae,"买家昵称 : "+e.toDisplayString(s.buyerNickname),1),e.createElementVNode("div",oe,"(收货人："+e.toDisplayString(s.integralOrderReceiverVO.name)+","+e.toDisplayString(s.integralOrderReceiverVO.mobile)+")",1)])]),_:1})]),_:1},8,["data"])}}}),fe="",re=D(ne,[["__scopeId","data-v-55bf2bc9"]]),L="addon-integral/integral/"+"order/",le=m=>O.put({url:L+"deliver",data:m}),se=()=>O.get({url:L+"deliver/batch/undeliver"}),ie={class:"q_plugin_container fdc1 overh"},de={class:"DatchDelivery_container__tool"},ce=e.defineComponent({__name:"DeliveryList",setup(m){const n=e.ref([]),_=z.useRouter(),l=e.reactive({deliverType:"EXPRESS",expressCompany:{logisticsCompanyCode:"",logisticsCompanyName:"",expressNo:""}}),f=[{key:"EXPRESS",value:"手动发货"},{key:"WITHOUT",value:"无需物流发货"}],g=e.reactive({deliverType:[{required:!0,trigger:"blur",message:"请选择"}],addressaddress:[{required:!0,trigger:"change",message:"请选择服务"}],printId:[{required:!0,trigger:"change",message:"请选择"}]}),N=v.map(t=>({label:t.companyName,value:{value:t.companyCode,label:t.companyName,companyType:t.companyType},companyType:t.companyType}));d();function i(t){const a=n.value.filter(x=>x.no!==t.no);n.value=a,new V().setItem("integralOrderSendGoods",a,24*60*60*1e3)}function d(){n.value=new V().getItem("integralOrderSendGoods")??[],n.value.forEach(t=>{t.expressCompanyName="",t.expressName="",t.expressNo=""})}async function s(){const{data:t,code:a}=await se();if(console.log("data",t),a===200){p.ElMessage.success("导入成功"),t.forEach(r=>{r.integralOrderReceiverVO=r.integralOrderReceiver,r.expressCompanyName="",r.expressName="",r.expressNo=""}),n.value=t;return}p.ElMessage.error("导入失败")}const C=async()=>{let t;switch(l.deliverType){case"EXPRESS":t=w();break;default:t=E();break}t&&u(t)};function w(){return console.log("abData.value",n.value),n.value.every(a=>a.expressCompanyName&&a.expressName&&a.expressNo)?n.value.map(a=>{const{no:r,expressCompanyName:x,expressName:h,expressNo:T}=a;return{integralOrderNo:r,integralOrderDeliverType:l.deliverType,expressCompanyName:x,expressName:h,expressNo:T}}):(p.ElMessage.error({message:"请选择物流服务或填写运单号"}),!1)}const E=()=>n.value.map(a=>{const{no:r}=a;return{integralOrderNo:r,integralOrderDeliverType:l.deliverType}});async function u(t){const{code:a,data:r}=await le(t);if(a!==200)return p.ElMessage.error({message:"发货失败"});new V().setItem("integralOrderSendGoods",[],60*60*24),p.ElMessage.success({message:"发货成功"}),_.replace({name:"integralMall",query:{type:"order"}})}const k=t=>{n.value.forEach(a=>{a.expressCompanyName=t.value,a.expressName=t.label})},o=()=>{new V().setItem("integralOrderSendGoods",[],60*60*24),_.replace({name:"integralMall",query:{type:"order"}})},c=(t,a)=>{const r=n.value.find(x=>x.no===a.no);r&&(r.expressNo=t)},pe=(t,a)=>{const r=n.value.find(x=>x.no===a.no);r&&(r.expressCompanyName=t.value,r.expressName=t.label)};return(t,a)=>{const r=e.resolveComponent("el-radio"),x=e.resolveComponent("el-radio-group"),h=e.resolveComponent("el-form-item"),T=e.resolveComponent("el-select-v2"),S=e.resolveComponent("el-button"),R=e.resolveComponent("el-row"),me=e.resolveComponent("el-form"),_e=e.resolveComponent("el-popconfirm");return e.openBlock(),e.createElementBlock("div",ie,[e.createVNode(me,{ref:"DatchDeliveryFormRef",model:l,rules:g,class:"DatchDelivery_container fdc1 overh"},{default:e.withCtx(()=>[e.createVNode(h,{label:"发货方式",prop:"deliverType","label-width":"100px"},{default:e.withCtx(()=>[e.createVNode(x,{modelValue:l.deliverType,"onUpdate:modelValue":a[0]||(a[0]=y=>l.deliverType=y),class:"ml-4",size:"default"},{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(f,y=>e.createVNode(r,{key:y.key,label:y.key,size:"small"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y.value),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),e.withDirectives(e.createVNode(h,{label:"物流公司",prop:"logisticsCompanyCode","label-width":"100px"},{default:e.withCtx(()=>[e.createVNode(T,{modelValue:l.expressCompany,"onUpdate:modelValue":a[1]||(a[1]=y=>l.expressCompany=y),options:e.unref(N),"value-key":"value",placeholder:"请选择物流公司",style:{width:"444px"},onChange:k},null,8,["modelValue","options"])]),_:1},512),[[e.vShow,l.deliverType!=="WITHOUT"]]),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(R,{justify:"end",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(S,{type:"primary",link:"",onClick:s},{default:e.withCtx(()=>a[2]||(a[2]=[e.createTextVNode("导入全部待发货订单")])),_:1})]),_:1})]),_:1}),e.createVNode(h,{class:"fdc1 overh table_item"},{default:e.withCtx(()=>[e.withDirectives(e.createVNode(H,{tableData:n.value,onFilterOrderList:i,onExpressNo:c,onExpressCompanyName:pe},null,8,["tableData"]),[[e.vShow,l.deliverType==="EXPRESS"]]),e.withDirectives(e.createVNode(re,{tabData:n.value,onFilterOrderList:i},null,8,["tabData"]),[[e.vShow,!["EXPRESS"].includes(l.deliverType)]])]),_:1})]),_:1},8,["model","rules"]),e.createElementVNode("div",de,[e.createVNode(R,{justify:"center",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(S,{round:"",type:"primary",onClick:C},{default:e.withCtx(()=>a[3]||(a[3]=[e.createTextVNode("确认")])),_:1}),e.createVNode(_e,{title:"确定退出批量发货?",onConfirm:o},{reference:e.withCtx(()=>[e.createVNode(S,{round:""},{default:e.withCtx(()=>a[4]||(a[4]=[e.createTextVNode("取消")])),_:1})]),_:1})]),_:1})])])}}}),ge="";return D(ce,[["__scopeId","data-v-ffe03f41"]])});
