(function(e,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("vue"),require("@vueuse/core"),require("@/components/schema-form/index.vue"),require("vue-router"),require("@/components/PageManage.vue"),require("element-plus"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/schema-form/index.vue","vue-router","@/components/PageManage.vue","element-plus","@/apis/http"],b):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformSetMeal=b(e.PlatformSetMealContext.Vue,e.PlatformSetMealContext.VueUse,e.PlatformSetMealContext.SchemaForm,e.PlatformSetMealContext.VueRouter,e.PlatformSetMealContext.PageManageTwo,e.PlatformSetMealContext.ElementPlus,e.PlatformSetMealContext.Request))})(this,function(e,b,k,M,T,C,V){"use strict";var E=document.createElement("style");E.textContent=`@charset "UTF-8";.name[data-v-0024cbe4]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.origin[data-v-0024cbe4]{display:flex;justify-content:start;align-items:center}.origin--name[data-v-0024cbe4]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}[data-v-0024cbe4] .el-dialog__body{padding-bottom:0!important}[data-v-0024cbe4] .el-button.is-link{padding:0}[data-v-0024cbe4] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(E);const L=e.defineComponent({__name:"head-operation-p",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchBtn:{type:Boolean,default:!0}},emits:["update:modelValue","del","search"],setup(l,{emit:m}){const r=l,_=[{label:"活动名称",prop:"keyword",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"setMealStatus",valueType:"select",options:[{label:"全部状态",value:""},{label:"未开始",value:"NOT_STARTED"},{label:"进行中",value:"PROCESSING"},{label:"已结束",value:"OVER"},{label:"已下架",value:"MERCHANT_SELL_OFF"},{label:"违规下架",value:"ILLEGAL_SELL_OFF"}],fieldProps:{placeholder:"请选择"}}],d=m,x=b.useVModel(r,"modelValue",d),a=c=>{c&&Object.keys(c).forEach(s=>r.modelValue[s]=c[s])},h=()=>{x.value.forceUpdate=!x.value.forceUpdate,d("search")},u=()=>{Object.keys(r.modelValue).forEach(c=>r.modelValue[c]=""),d("search")};return(c,s)=>{const f=e.resolveComponent("el-button");return e.openBlock(),e.createBlock(k,{"v-model":e.unref(x),columns:_,onChangeFormItem:a,onSearchHandle:h,onHandleReset:u},{otherOperations:e.withCtx(()=>[l.showBatchBtn?(e.openBlock(),e.createBlock(f,{key:0,round:"",disabled:c.$props.batchDisabled,onClick:s[0]||(s[0]=S=>d("del"))},{default:e.withCtx(()=>s[1]||(s[1]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])):e.createCommentVNode("",!0)]),_:1},8,["v-model"])}}});var w=(l=>(l.NOT_STARTED="未开始",l.PROCESSING="进行中",l.OVER="已结束",l.MERCHANT_SELL_OFF="已下架",l.ILLEGAL_SELL_OFF="违规下架",l))(w||{});const y="addon-matching-treasure/setMeal",B=l=>V.post({url:`${y}/${l.shopId}/${l.setMealId}?violationExplain=${l.violationExplain}`}),O=l=>V.get({url:y,params:l}),I=l=>V.del({url:y,data:l}),R={class:"table_container"},F={class:"name"},D={class:"origin"},P={class:"origin--name",style:{width:"180px","margin-left":"10px"}},$={class:"dialog-footer"},z=e.defineComponent({__name:"set-meal-list-p",props:{search:{type:Object,default:()=>({})},showOffShelfBtn:{type:Boolean,default:!0}},setup(l,{expose:m}){const r=M.useRouter(),_=l,d=e.ref([]),x=e.ref(),a=e.reactive({size:10,current:1,total:0}),h=e.ref([]),u=e.ref({shopId:"",setMealId:"",violationExplain:""}),c=e.ref(),s=e.ref(!1);e.watch(()=>_.search,n=>{f()},{deep:!0});async function f(){const{setMealStatus:n,keyword:o}=_.search,i={...a,...{setMealStatus:n,keyword:o}},{code:N,data:p}=await O(i);if(N!==200)return C.ElMessage.error("获取套餐列表失败");d.value=p.records,a.current=p.current,a.size=p.size,a.total=p.total}const S=(n,o)=>{r.push({name:"bundlePriceBaseinfo",query:{setMealId:n.id,shopId:n.shopId,isLookUp:o}})},U=async n=>{const{code:o}=await I(n);if(o!==200){C.ElMessage.error("删除失败");return}C.ElMessage.success("删除成功"),f()},j=n=>{a.current=1,a.size=n,f()},G=n=>{a.current=n,f()},H=n=>{s.value=!0,u.value.shopId=n.shopId,u.value.setMealId=n.id},A=()=>{c.value.resetFields()},J=()=>{c.value.validate(async(n,o)=>{if(n){const{code:g,msg:i}=await B(u.value);if(g!==200){C.ElMessage.error(i);return}C.ElMessage.success("下架成功"),f(),s.value=!1}else console.log("error submit!",o)})};return f(),m({chooseList:h,handleDelBatch:U}),(n,o)=>{const g=e.resolveComponent("ElTableEmpty"),i=e.resolveComponent("el-table-column"),N=e.resolveComponent("el-image"),p=e.resolveComponent("el-button"),K=e.resolveComponent("el-tooltip"),Q=e.resolveComponent("el-table"),W=e.resolveComponent("el-input"),X=e.resolveComponent("el-form-item"),Y=e.resolveComponent("el-form"),Z=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",R,[e.createVNode(Q,{ref_key:"multipleTableRef",ref:x,class:"table_container",data:d.value,"header-row-style":{color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{color:"#333333"}},{empty:e.withCtx(()=>[e.createVNode(g,{imageIndex:"7"})]),default:e.withCtx(()=>[e.createVNode(i,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",F,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(i,{label:"套餐名称",width:"230px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",D,[e.createVNode(N,{style:{width:"52px",height:"52px"},src:t.setMealMainPicture},null,8,["src"]),e.createElementVNode("div",P,e.toDisplayString(t.setMealName),1)])]),_:1}),e.createVNode(i,{label:"套餐类型",width:"150"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.setMealType==="OPTIONAL_PRODUCT"?"自选套餐":"固定套餐"),1)]),_:1}),e.createVNode(i,{label:"状态",width:"150"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:t.setMealStatus==="ILLEGAL_SELL_OFF"?"#F12F22":""})},e.toDisplayString(e.unref(w)[t.setMealStatus]),5)]),_:1}),e.createVNode(i,{label:"活动时间",width:"230px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("p",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("p",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(i,{label:"活动商品",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.productCount),1)]),_:1}),e.createVNode(i,{label:"支付单数",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.orderCount),1)]),_:1}),e.createVNode(i,{label:"操作",fixed:"right",align:"right",width:"150"},{default:e.withCtx(({row:t})=>[e.createVNode(p,{link:"",type:"primary",onClick:v=>S(t,"true")},{default:e.withCtx(()=>o[3]||(o[3]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),["NOT_STARTED","PROCESSING"].includes(t.setMealStatus)?(e.openBlock(),e.createBlock(p,{key:0,link:"",type:"danger",onClick:v=>H(t)},{default:e.withCtx(()=>o[4]||(o[4]=[e.createTextVNode("违规下架")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.setMealStatus==="ILLEGAL_SELL_OFF"?(e.openBlock(),e.createBlock(K,{key:1,class:"box-item",effect:"dark",content:t.violationExplain,placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(p,{link:"",type:"primary"},{default:e.withCtx(()=>o[5]||(o[5]=[e.createTextVNode("违规原因")])),_:1})]),_:2},1032,["content"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(T,{class:"pagination","page-num":a.current,"load-init":!0,"page-size":a.size,total:a.total,onReload:f,onHandleSizeChange:j,onHandleCurrentChange:G},null,8,["page-num","page-size","total"]),e.createVNode(Z,{modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=t=>s.value=t),title:"违规下架",width:"500",center:"",onClose:A},{footer:e.withCtx(()=>[e.createElementVNode("div",$,[e.createVNode(p,{onClick:o[1]||(o[1]=t=>s.value=!1)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode("取消")])),_:1}),e.createVNode(p,{type:"primary",onClick:J},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(Y,{ref_key:"illegalReasonFormRef",ref:c,model:u.value,rules:{violationExplain:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(X,{label:"",prop:"violationExplain"},{default:e.withCtx(()=>[e.createVNode(W,{modelValue:u.value.violationExplain,"onUpdate:modelValue":o[0]||(o[0]=t=>u.value.violationExplain=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ee="",q=((l,m)=>{const r=l.__vccOpts||l;for(const[_,d]of m)r[_]=d;return r})(z,[["__scopeId","data-v-0024cbe4"]]);return e.defineComponent({__name:"PlatformSetMeal",setup(l){const m=e.ref({setMealStatus:"",keyword:""}),r=e.ref(),_=e.computed(()=>r.value?!r.value.chooseList.length:!0),d=async()=>{if(!await C.ElMessageBox.confirm("确定批量删除套餐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const a=r.value.chooseList.map(h=>({shopId:h.shopId,setMealId:h.id}));r.value.handleDelBatch(a)};return(x,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(L,{showBatchBtn:!1,modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=h=>m.value=h),"batch-disabled":_.value,onDel:d},null,8,["modelValue","batch-disabled"]),a[1]||(a[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1)),e.createVNode(q,{ref_key:"mealListRef",ref:r,search:m.value},null,8,["search"])],64))}})});
