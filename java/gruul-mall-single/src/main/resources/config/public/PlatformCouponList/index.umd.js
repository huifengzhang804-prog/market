(function(e,C){typeof exports=="object"&&typeof module<"u"?module.exports=C(require("vue"),require("@vueuse/core"),require("@/components/schema-form/index.vue"),require("vue-router"),require("@/utils/date"),require("@/composables/useConvert"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/schema-form/index.vue","vue-router","@/utils/date","@/composables/useConvert","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus"],C):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformCouponList=C(e.PlatformCouponListContext.Vue,e.PlatformCouponListContext.VueUse,e.PlatformCouponListContext.SchemaForm,e.PlatformCouponListContext.VueRouter,e.PlatformCouponListContext.DateUtil,e.PlatformCouponListContext.UseConvert,e.PlatformCouponListContext.PageManage,e.PlatformCouponListContext.Request,e.PlatformCouponListContext.ElementPlus))})(this,function(e,C,U,L,Ne,T,z,x,h){"use strict";var N=document.createElement("style");N.textContent=`@charset "UTF-8";.flex[data-v-b317cb5e]{display:flex;align-items:center;margin-bottom:15px}[data-v-aeba9f71]{font-size:14px}.name[data-v-aeba9f71]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[data-v-aeba9f71] .el-dialog__body{padding-bottom:0!important}*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.fixed{position:fixed}.flex{display:flex}.resize{resize:both}[resize~=none]{resize:none}.underline{text-decoration-line:underline}.blur{--un-blur:blur(8px);filter:var(--un-blur) var(--un-brightness) var(--un-contrast) var(--un-drop-shadow) var(--un-grayscale) var(--un-hue-rotate) var(--un-invert) var(--un-saturate) var(--un-sepia)}
`,document.head.appendChild(N);const V=n=>n&&typeof n=="object"&&"default"in n?n:{default:n},A=V(U),k=V(T),O=V(z),q=e.defineComponent({__name:"head-operation2",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchBtn:{type:Boolean,default:!0}},emits:["update:modelValue","delCoupon","search"],setup(n,{emit:d}){const u=n,_=[{label:"\u6D3B\u52A8\u540D\u79F0",labelWidth:75,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"}},{label:"\u4F18\u60E0\u5238\u72B6\u6001",labelWidth:95,prop:"status",valueType:"select",options:[{value:"",label:"\u5168\u90E8\u72B6\u6001"},{value:"NOT_OPEN",label:"\u672A\u5F00\u59CB"},{value:"OPEN",label:"\u8FDB\u884C\u4E2D"},{value:"CLOSED",label:"\u5DF2\u7ED3\u675F"},{value:"SHOP_BANED",label:"\u5DF2\u4E0B\u67B6"},{value:"BANED",label:"\u8FDD\u89C4\u4E0B\u67B6"}],fieldProps:{placeholder:"\u8BF7\u9009\u62E9"}},{label:"\u4F18\u60E0\u5238\u7C7B\u578B",labelWidth:95,prop:"type",valueType:"select",options:[{value:"",label:"\u5168\u90E8\u4F18\u60E0\u5238"},{value:"PRICE_DISCOUNT",label:"\u65E0\u95E8\u69DB\u6298\u6263\u5238"},{value:"PRICE_REDUCE",label:"\u65E0\u95E8\u69DB\u73B0\u91D1\u5238"},{value:"REQUIRED_PRICE_DISCOUNT",label:"\u6EE1\u6298\u5238"},{value:"REQUIRED_PRICE_REDUCE",label:"\u6EE1\u51CF\u5238"}],fieldProps:{placeholder:"\u8BF7\u9009\u62E9"}}],c=d,m=C.useVModel(u,"modelValue",c),g=()=>{Object.keys(u.modelValue).forEach(r=>u.modelValue[r]=""),c("search")},l=r=>{r&&Object.keys(r).forEach(s=>u.modelValue[s]=r[s])};return(r,s)=>{const D=e.resolveComponent("el-button");return e.openBlock(),e.createBlock(A.default,{"v-model":e.unref(m),columns:_,"has-unfold":"",onChangeFormItem:l,onSearchHandle:s[1]||(s[1]=f=>c("search")),onHandleReset:g},{otherOperations:e.withCtx(()=>[n.showBatchBtn?(e.openBlock(),e.createBlock(D,{key:0,disabled:r.$props.batchDisabled,round:"",onClick:s[0]||(s[0]=f=>c("delCoupon"))},{default:e.withCtx(()=>[e.createTextVNode("\u6279\u91CF\u79FB\u9664")]),_:1},8,["disabled"])):e.createCommentVNode("",!0)]),_:1},8,["v-model"])}}}),ke="",R=(n,d)=>{const u=n.__vccOpts||n;for(const[_,c]of d)u[_]=c;return u},M=R(q,[["__scopeId","data-v-b317cb5e"]]);k.default();const $={PRICE_DISCOUNT:"\u65E0\u95E8\u69DB\u6298\u6263\u5238",PRICE_REDUCE:"\u65E0\u95E8\u69DB\u73B0\u91D1\u5238",REQUIRED_PRICE_DISCOUNT:"\u6EE1\u6298\u5238",REQUIRED_PRICE_REDUCE:"\u6EE1\u51CF\u5238"};var b=(n=>(n.PRICE_REDUCE="PRICE_REDUCE",n.PRICE_DISCOUNT="PRICE_DISCOUNT",n.REQUIRED_PRICE_REDUCE="REQUIRED_PRICE_REDUCE",n.REQUIRED_PRICE_DISCOUNT="REQUIRED_PRICE_DISCOUNT",n))(b||{});const Q="addon-coupon/coupon/",H=n=>x.get({url:"addon-coupon/coupon",params:n}),j=n=>x.del({url:"addon-coupon/coupon/batch",data:n}),W=n=>x.put({url:"addon-coupon/coupon/ban/batch",data:n}),G=n=>x.get({url:`${Q}illegal/${n}/reason`}),p=n=>(e.pushScopeId("data-v-aeba9f71"),n=n(),e.popScopeId(),n),K={class:"table_container"},J={class:"name"},X={class:"name"},Y={key:0},Z=p(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),v={key:1},ee=p(()=>e.createElementVNode("span",null,"\u6298\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),te={key:2},ne=p(()=>e.createElementVNode("span",null,"\u6EE1",-1)),oe=p(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u6253",-1)),ae=p(()=>e.createElementVNode("span",null,"\u6298",-1)),le={key:3},ue=p(()=>e.createElementVNode("span",null,"\u6EE1",-1)),se=p(()=>e.createElementVNode("span",null,"\u5143\uFF0C\u51CF",-1)),re=p(()=>e.createElementVNode("span",null,"\u5143",-1)),ie={key:0},ce={key:1},de={class:"pagination"},pe={class:"dialog-footer"},_e=e.defineComponent({__name:"coupon-list2",props:{search:{type:Object,default:()=>({})}},setup(n,{expose:d}){const u=L.useRouter(),_=n,{divTenThousand:c}=k.default(),m=e.ref([]),g=e.ref(),l=e.ref({size:10,current:1,total:0}),r=e.ref([]),s=e.ref({shopId:"",couponId:"",violationReason:""}),D=e.ref(),f=e.ref(!1);E();async function E(){const o={...l.value,..._.search},{code:i,data:a}=await H(o);if(i!==200)return h.ElMessage.error("\u83B7\u53D6\u4F18\u60E0\u5238\u5217\u8868\u5931\u8D25");m.value=a.records,l.value.current=a.current,l.value.size=a.size,l.value.total=a.total}const fe=o=>{f.value=!0,s.value.shopId=o.shopId,s.value.couponId=o.id},he=()=>{D.value.resetFields()},Ee=async()=>{await D.value.validate(async(o,i)=>{if(o){const{code:a,msg:y}=await W(s.value);if(a!==200){h.ElMessage.error(y);return}h.ElMessage.success("\u4E0B\u67B6\u6210\u529F");const B=m.value.find(F=>F.id===s.value.couponId);B&&(B.status="BANED"),f.value=!1,E()}else console.log("error submit!",i)})},Ce=o=>{u.push({name:"couponBaseInfo",query:{id:o.id,shopId:o.shopId}})},I=e.ref(""),w=e.ref(""),be=async o=>{if(w.value!==o.id){w.value=o.id;const{data:i}=await G(o.id);I.value=i||"\u6682\u65E0\u8FDD\u89C4\u539F\u56E0"}},ge=async o=>{const{code:i,msg:a}=await j(o);if(i!==200){h.ElMessage.error(a||"\u5220\u9664\u5931\u8D25");return}h.ElMessage.success("\u5220\u9664\u6210\u529F"),E()},De=o=>{l.value.current=1,l.value.size=o,E()},ye=o=>{l.value.current=o,E()};return d({chooseList:r,handleDelBatch:ge,initCouponList:E}),(o,i)=>{const a=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-link"),B=e.resolveComponent("el-tooltip"),F=e.resolveComponent("el-table"),xe=e.resolveComponent("el-input"),Be=e.resolveComponent("el-form-item"),Ve=e.resolveComponent("el-form"),S=e.resolveComponent("el-button"),Fe=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",K,[e.createVNode(F,{ref_key:"multipleTableRef",ref:g,"cell-style":{fontSize:"12px",color:"#333333"},data:m.value,style:{width:"100%"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"header-row-style":{fontSize:"14px",color:"#000"}},{default:e.withCtx(()=>[e.createVNode(a,{label:"\u5E97\u94FA\u540D\u79F0",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",J,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(a,{label:"\u6D3B\u52A8\u540D\u79F0",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",X,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(a,{label:"\u7C7B\u578B",width:"100"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref($)[t.type]),1)]),_:1}),e.createVNode(a,{label:"\u4F7F\u7528\u89C4\u5219",width:"210"},{default:e.withCtx(({row:t})=>[t.type===e.unref(b).PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",Y,[e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(c)(t.amount)),1),Z])):e.createCommentVNode("",!0),t.type===e.unref(b).PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",v,[e.createElementVNode("span",null,e.toDisplayString(t.discount),1),ee])):e.createCommentVNode("",!0),t.type===e.unref(b).REQUIRED_PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",te,[ne,e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(c)(t.requiredAmount)),1),oe,e.createElementVNode("span",null,e.toDisplayString(t.discount),1),ae])):e.createCommentVNode("",!0),t.type===e.unref(b).REQUIRED_PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",le,[ue,e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(c)(t.requiredAmount)),1),se,e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(c)(t.amount)),1),re])):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(t.rules),1)]),_:1}),e.createVNode(a,{label:"\u72B6\u6001",prop:"address",width:"100"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:t.status==="BANED"?"#F54319":t.status==="OK"||t.status==="SHOP_BANED"?"#999":""})},e.toDisplayString(t.statusText),5)]),_:1}),e.createVNode(a,{label:"\u6709\u6548\u671F",width:"200"},{default:e.withCtx(({row:t})=>[t.startDate?(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("div",null,"\u8D77\uFF1A"+e.toDisplayString(t.startDate),1),e.createElementVNode("div",null,"\u6B62\uFF1A"+e.toDisplayString(t.endDate),1)])):(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("div",null,"\u9886\u5238\u5F53\u65E5\u8D77"+e.toDisplayString(t.days)+"\u5929\u5185\u53EF\u7528",1)]))]),_:1}),e.createVNode(a,{label:"\u5DF2\u9886\u53D6",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.num-t.stock),1)]),_:1}),e.createVNode(a,{label:"\u5269\u4F59",prop:"stock",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.stock),1)]),_:1}),e.createVNode(a,{label:"\u5DF2\u4F7F\u7528",prop:"usedCount",width:"120"}),e.createVNode(a,{align:"right",fixed:"right",class:"el-table__fixed",label:"\u64CD\u4F5C",width:"200"},{default:e.withCtx(({row:t})=>[e.createVNode(y,{underline:!1,size:"small",style:{padding:"0 5px 0 0"},type:"primary",onClick:P=>Ce(t)},{default:e.withCtx(()=>[e.createTextVNode(" \u67E5\u770B ")]),_:2},1032,["onClick"]),["BANED"].includes(t.status)?(e.openBlock(),e.createBlock(B,{key:0,class:"box-item",effect:"dark",content:I.value,placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(y,{underline:!1,size:"small",style:{padding:"0 5px"},type:"primary",onMouseover:P=>be(t)},{default:e.withCtx(()=>[e.createTextVNode(" \u8FDD\u89C4\u539F\u56E0 ")]),_:2},1032,["onMouseover"])]),_:2},1032,["content"])):e.createCommentVNode("",!0),["\u672A\u5F00\u59CB","\u8FDB\u884C\u4E2D"].includes(t.statusText)?(e.openBlock(),e.createBlock(y,{key:1,underline:!1,size:"small",style:{padding:"0 5px"},type:"danger",onClick:P=>fe(t)},{default:e.withCtx(()=>[e.createTextVNode("\u8FDD\u89C4\u4E0B\u67B6 ")]),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createElementVNode("div",de,[e.createVNode(O.default,{"page-size":l.value.size,"page-num":l.value.current,total:l.value.total,"load-init":!0,onHandleSizeChange:De,onHandleCurrentChange:ye},null,8,["page-size","page-num","total"])]),e.createVNode(Fe,{modelValue:f.value,"onUpdate:modelValue":i[2]||(i[2]=t=>f.value=t),title:"\u8FDD\u89C4\u4E0B\u67B6",width:"500",center:"",onClose:he},{footer:e.withCtx(()=>[e.createElementVNode("div",pe,[e.createVNode(S,{onClick:i[1]||(i[1]=t=>f.value=!1)},{default:e.withCtx(()=>[e.createTextVNode("\u53D6\u6D88")]),_:1}),e.createVNode(S,{type:"primary",onClick:Ee},{default:e.withCtx(()=>[e.createTextVNode("\u786E\u5B9A")]),_:1})])]),default:e.withCtx(()=>[e.createVNode(Ve,{ref_key:"illegalReasonFormRef",ref:D,model:s.value,rules:{violationReason:[{required:!0,message:"\u8BF7\u8F93\u5165\u8FDD\u89C4\u539F\u56E0",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(Be,{label:"",prop:"violationReason"},{default:e.withCtx(()=>[e.createVNode(xe,{modelValue:s.value.violationReason,"onUpdate:modelValue":i[0]||(i[0]=t=>s.value.violationReason=t),placeholder:"\u8BF7\u8F93\u5165\u8FDD\u89C4\u539F\u56E0\uFF0C\u5FC5\u586B",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Re="",me=R(_e,[["__scopeId","data-v-aeba9f71"]]),Ie="";return e.defineComponent({__name:"PlatformCouponList",setup(n){const d=e.ref({status:"",type:"",keywords:""}),u=e.ref(),_=e.computed(()=>u.value?!u.value.chooseList.length:!0),c=()=>{u.value.initCouponList()},m=async()=>{if(!await h.ElMessageBox.confirm("\u786E\u5B9A\u5220\u9664\u8FD9\u4E9B\u4F18\u60E0\u5238\u5417?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}))return;const l=u.value.chooseList.map(r=>({couponId:r.id,shopId:r.shopId}));u.value.handleDelBatch(l)};return(g,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(M,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=r=>d.value=r),showBatchBtn:!1,"batch-disabled":_.value,onSearch:c,onDelCoupon:m},null,8,["modelValue","batch-disabled"]),e.createVNode(me,{ref_key:"couponListRef",ref:u,search:d.value},null,8,["search"])],64))}})});
