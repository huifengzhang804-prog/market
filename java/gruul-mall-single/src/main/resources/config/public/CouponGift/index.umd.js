(function(e,C){typeof exports=="object"&&typeof module<"u"?module.exports=C(require("vue"),require("@vueuse/core"),require("@/utils/date"),require("@/composables/useConvert"),require("element-plus"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/utils/date","@/composables/useConvert","element-plus","@/apis/http"],C):(e=typeof globalThis<"u"?globalThis:e||self,e.CouponGift=C(e.CouponGiftContext.Vue,e.CouponGiftContext.VueUse,e.CouponGiftContext.DateUtil,e.CouponGiftContext.UseConvert,e.CouponGiftContext.ElementPlus,e.CouponGiftContext.Request))})(this,function(e,C,M,A,F,k){"use strict";var b=document.createElement("style");b.textContent=`@charset "UTF-8";.title[data-v-3f5ddc36]{font-size:14px;color:#606266;font-weight:700;margin-bottom:40px}.msg[data-v-3f5ddc36]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-3f5ddc36]{display:flex;margin-top:10px;height:50px}.period-validity[data-v-3f5ddc36]{width:300px;display:flex}.text[data-v-3f5ddc36]{font-size:14px;color:#333}.goodsData[data-v-3f5ddc36]{border:1px solid #ccc}.goods-list[data-v-3f5ddc36]{width:90%;margin-top:20px;height:300px;border:1px solid transparent}.goods-list__info[data-v-3f5ddc36]{display:flex}.goods-list__goods-list__info-name[data-v-3f5ddc36]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-3f5ddc36]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-3f5ddc36]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-3f5ddc36]:before{content:"\\ffe5";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-3f5ddc36]{font-size:16px}.ruleform-date[data-v-3f5ddc36]{width:100%;display:flex;align-items:center}.flex[data-v-3f5ddc36]{height:70px}.flex-item[data-v-3f5ddc36]{width:40%}.coupon-rules[data-v-3f5ddc36]{height:70px;display:flex;justify-content:center;align-items:center}.nav-button[data-v-3f5ddc36]{margin-top:auto;width:100%;padding:15px 0;display:flex;justify-content:center;background-color:#fff;box-shadow:0 0 10px #0000000d}
`,document.head.appendChild(b);const I=o=>o&&typeof o=="object"&&"default"in o?o:{default:o},Y=I(M),P=I(A),{divTenThousand:pe,mulTenThousand:S}=P.default(),O={PRICE_DISCOUNT:"\u65E0\u95E8\u69DB\u6298\u6263\u5238",PRICE_REDUCE:"\u65E0\u95E8\u69DB\u73B0\u91D1\u5238",REQUIRED_PRICE_DISCOUNT:"\u6EE1\u6298\u5238",REQUIRED_PRICE_REDUCE:"\u6EE1\u51CF\u5238"};var R=(o=>(o.PERIOD="PERIOD",o.IMMEDIATELY="IMMEDIATELY",o))(R||{});function q(o){return o?S(o):""}const G=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(o,{emit:l}){const a=o,i=l,t=C.useVModel(a,"modelValue",i);return(c,s)=>{const m=e.resolveComponent("el-option"),B=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(B,{modelValue:e.unref(t),"onUpdate:modelValue":s[0]||(s[0]=_=>e.isRef(t)?t.value=_:null),placeholder:a.placeholder,style:{width:"150px"},onChange:s[1]||(s[1]=_=>i("change",_))},{default:e.withCtx(()=>[e.renderSlot(c.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(a.list).length?a.list:e.unref(O),(_,x)=>(e.openBlock(),e.createBlock(m,{key:x,label:_,value:x},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),Q=o=>k.post({url:"addon-coupon/coupon/gifts",data:o}),j=(o,l,a)=>{if(o==="PRICE_REDUCE"){z(o,l);return}if(o==="PRICE_DISCOUNT"){U(o,l);return}if(o==="REQUIRED_PRICE_REDUCE"){U(o,l),L(o,l,a);return}if(o==="REQUIRED_PRICE_DISCOUNT"){const i=[{required:!0,message:"\u8BF7\u8F93\u5165\u91D1\u989D",trigger:"blur"},{validator:(c,s,m)=>{Number(s)<=0?m(new Error("\u91D1\u989D\u5FC5\u987B\u5927\u4E8E0")):m()},trigger:"blur"}],t=[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"},{validator:(c,s,m)=>{Number(s)<=0&&Number(s)<100?m(new Error("0.1~99\u4E4B\u95F4")):m()},trigger:"blur"}];l.requiredAmount=i,l.discount=t}},z=(o,l)=>{l.discount.length&&(l.discount[0].required=!1),l.requiredAmount.length&&(l.discount[0].required=!1);const a=[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"},{validator:(i,t,c)=>{Number(t)<=0?c(new Error("\u91D1\u989D\u5FC5\u987B\u5927\u4E8E0")):c()},trigger:"blur"}];l.amount=a},U=(o,l)=>{l.requiredAmount.length&&(l.discount[0].required=!1),l.amount.length&&(l.amount[0].required=!1);const a=[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"},{validator:(i,t,c)=>{Number(t)<=0&&Number(t)<100?c(new Error("0.1~99\u4E4B\u95F4")):c()},trigger:"blur"}];l.discount=a},L=(o,l,a)=>{l.discount.length&&(l.discount[0].required=!1);const i=[{required:!0,message:"\u8BF7\u8F93\u5165\u91D1\u989D",trigger:"blur"},{validator:(c,s,m)=>{Number(s)<=0?m(new Error("\u91D1\u989D\u5FC5\u987B\u5927\u4E8E0")):m()},trigger:"blur"}],t=[...i,{validator:(c,s,m)=>{Number(a.requiredAmount)-Number(s)<=0?m(new Error(`\u6EE1\u51CF\u91D1\u989D\u5FC5\u987B\u5C0F\u4E8E${Number(a.requiredAmount)}`)):m()},trigger:"blur"}];l.amount=t,l.requiredAmount=i},f=o=>(e.pushScopeId("data-v-3f5ddc36"),o=o(),e.popScopeId(),o),$={class:"content_container"},H=f(()=>e.createElementVNode("h1",{class:"title"},"\u57FA\u672C\u4FE1\u606F",-1)),J=f(()=>e.createElementVNode("span",{class:"msg"},"\u4F18\u60E0\u5238\u540D\u79F0\u4E0D\u8D85\u8FC75\u4E2A\u5B57",-1)),K={key:0,class:"ruleform-date"},W=f(()=>e.createElementVNode("span",{style:{margin:"0 10px"}},"\u81F3",-1)),X={class:"period-validity text"},Z={class:"coupon-rules"},v=f(()=>e.createElementVNode("span",{style:{"margin-left":"10px"}},"\u6298\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),ee=f(()=>e.createElementVNode("span",{style:{"margin-left":"5px"}},"\u5143\uFF0C\u65E0\u95E8\u69DB\u4F7F\u7528",-1)),te={key:2,class:"flex",style:{width:"100%"}},oe=f(()=>e.createElementVNode("span",null,"\u6EE1",-1)),ue=f(()=>e.createElementVNode("span",null,"\u5143,\u6253",-1)),le=f(()=>e.createElementVNode("span",{style:{"margin-left":"5px"}},"\u6298",-1)),re={key:3,class:"flex"},ne=f(()=>e.createElementVNode("span",null,"\u6EE1",-1)),ae=f(()=>e.createElementVNode("span",null,"\u5143,\u51CF",-1)),de=f(()=>e.createElementVNode("span",{style:{"margin-left":"5px"}},"\u5143",-1)),ie={class:"nav-button"},se=e.defineComponent({__name:"CouponGift",props:{properties:{type:Object,required:!0}},setup(o){const l=o,a=new Y.default,i=e.ref(),t=e.ref({name:"",days:1,endDate:"",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:R.PERIOD,startDate:"",num:1,limit:1,productType:l.properties.productType}),c={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u540D\u79F0",trigger:"blur"}],effectType:[{required:!0,message:"\u8BF7\u9009\u62E9\u6709\u6548\u65F6\u95F4",trigger:["blur","change"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u4F18\u60E0\u5238\u7C7B\u578B",trigger:["blur","change"]}],discount:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"}],num:[{required:!0,message:"\u8BF7\u8F93\u5165\u6BCF\u4EBA\u53D1\u9001\u6570\u91CF",trigger:"blur"}],limit:[{required:!0,message:"\u8BF7\u8F93\u5165\u6BCF\u4EBA\u53D1\u9001\u6570\u91CF",trigger:"blur"}],requiredAmount:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"}],amount:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u89C4\u5219",trigger:"blur"}],days:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u6709\u6548\u671F",trigger:"blur"},{validator:(r,u,p)=>{Number(u)===0?p("\u6700\u5C111\u5929"):p()},trigger:"blur"}],startDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65E5\u671F",trigger:["blur","change"]}],endDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65E5\u671F",trigger:["blur","change"]}]},s=async()=>{var r,u;if(!!i.value)try{if(!await i.value.validate())return;B();const d=_();m(d);const{code:g}=await Q({coupon:d,userIds:l.properties.userIds});if(g!==200){F.ElMessage.error("\u4FDD\u5B58\u5931\u8D25");return}F.ElMessage.success("\u4FDD\u5B58\u6210\u529F"),l.properties.toBack&&l.properties.toBack()}catch(p){if((r=p.requiredAmount)!=null&&r.length){F.ElMessage.info(p.requiredAmount[0].message);return}if((u=p.amount)!=null&&u.length){F.ElMessage.info(p.amount[0].message);return}}};function m(r){r.effectType==="PERIOD"&&(r.days=null),r.effectType==="IMMEDIATELY"&&(r.startDate="",r.endDate=""),r.type==="PRICE_REDUCE"&&(r.requiredAmount=null,r.discount=null),r.type==="PRICE_DISCOUNT"&&(r.amount=null,r.requiredAmount=null),r.type==="REQUIRED_PRICE_REDUCE"&&(r.discount=null),r.type==="REQUIRED_PRICE_DISCOUNT"&&(r.amount=null)}const B=()=>{if(t.value.effectType==="PERIOD"){t.value.days=1;return}t.value.startDate="",t.value.endDate=""};function _(){const{name:r,days:u,endDate:p,productType:d,type:g,requiredAmount:w,discount:V,amount:h,effectType:E,startDate:D,num:y,limit:T,productIds:N}=t.value;return{name:r,days:u,endDate:p,productType:d,type:g,requiredAmount:q(w).toString(),discount:V,amount:q(h).toString(),effectType:E,startDate:D,num:y,limit:y,productIds:N}}const x=()=>{j(t.value.type,c,t.value),t.value.amount=1,t.value.requiredAmount=1,t.value.discount=1},me=r=>!!t.value.endDate?t.value.endDate<a.getYMDs(r)||a.getYMDs(r)<a.getYMDs(new Date):a.getYMDs(r)<a.getYMDs(new Date),ce=r=>!!t.value.startDate?t.value.startDate>a.getYMDs(r)||a.getYMDs(r)<a.getYMDs(new Date):!1;return(r,u)=>{const p=e.resolveComponent("el-input"),d=e.resolveComponent("el-form-item"),g=e.resolveComponent("el-radio"),w=e.resolveComponent("el-radio-group"),V=e.resolveComponent("el-row"),h=e.resolveComponent("el-date-picker"),E=e.resolveComponent("el-input-number"),D=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-table"),T=e.resolveComponent("el-form"),N=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$,[H,e.createVNode(T,{ref_key:"ruleFormRef",ref:i,"inline-message":!1,model:t.value,rules:c,"label-width":"auto"},{default:e.withCtx(()=>[e.createVNode(d,{label:"\u4F18\u60E0\u5238\u540D\u79F0",prop:"name"},{default:e.withCtx(()=>[e.createVNode(p,{modelValue:t.value.name,"onUpdate:modelValue":u[0]||(u[0]=n=>t.value.name=n),modelModifiers:{trim:!0},maxlength:"5",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u540D\u79F0",style:{width:"551px"}},null,8,["modelValue"]),J]),_:1}),e.createVNode(d,{label:"\u6709\u6548\u65F6\u95F4",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(V,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(w,{modelValue:t.value.effectType,"onUpdate:modelValue":u[1]||(u[1]=n=>t.value.effectType=n),class:"ml-4"},{default:e.withCtx(()=>[e.createVNode(g,{value:"PERIOD"},{default:e.withCtx(()=>[e.createTextVNode("\u56FA\u5B9A\u65F6\u95F4")]),_:1}),e.createVNode(g,{value:"IMMEDIATELY"},{default:e.withCtx(()=>[e.createTextVNode("\u9886\u5238\u7ACB\u5373\u751F\u6548")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(V,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[t.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",K,[e.createVNode(d,{"inline-message":!1,prop:"startDate"},{default:e.withCtx(()=>[e.createVNode(h,{modelValue:t.value.startDate,"onUpdate:modelValue":u[2]||(u[2]=n=>t.value.startDate=n),"disabled-date":me,format:"YYYY/MM/DD",placeholder:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),W]),_:1}),e.createVNode(d,{"inline-message":!1,prop:"endDate"},{default:e.withCtx(()=>[e.createVNode(h,{modelValue:t.value.endDate,"onUpdate:modelValue":u[3]||(u[3]=n=>t.value.endDate=n),"disabled-date":ce,format:"YYYY/MM/DD",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})])):(e.openBlock(),e.createBlock(d,{key:1,prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",X,[e.createTextVNode(" \u9886\u5238\u5F53\u65E5\u8D77 "),e.createVNode(E,{modelValue:t.value.days,"onUpdate:modelValue":u[4]||(u[4]=n=>t.value.days=n),modelModifiers:{number:!0},controls:!1,max:99999,min:t.value.days?1:0,style:{width:"20%",margin:"0 5px"}},null,8,["modelValue","min"]),e.createTextVNode(" \u5929\u5185\u53EF\u7528 ")])]),_:1}))]),_:1})]),_:1}),e.createVNode(d,{label:"\u6D3B\u52A8\u89C4\u5219"},{default:e.withCtx(()=>[e.createVNode(y,{"cell-style":{height:"60px"},data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(D,{label:"\u9009\u62E9\u4F18\u60E0\u5238\u7C7B\u578B",width:"170"},{default:e.withCtx(()=>[e.createVNode(d,{prop:"type"},{default:e.withCtx(()=>[e.createVNode(G,{modelValue:t.value.type,"onUpdate:modelValue":u[5]||(u[5]=n=>t.value.type=n),placeholder:"\u5168\u90E8\u7C7B\u578B",onChange:x},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(D,{label:"\u4F18\u60E0\u5238\u89C4\u5219",width:"280"},{default:e.withCtx(()=>[e.createElementVNode("div",Z,[t.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(d,{key:0,prop:"discount"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:t.value.discount,"onUpdate:modelValue":u[6]||(u[6]=n=>t.value.discount=n),modelModifiers:{number:!0},controls:!1,max:9.9,min:.1,precision:1,style:{width:"40%"}},null,8,["modelValue"]),v]),_:1})):e.createCommentVNode("",!0),t.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(d,{key:1,prop:"amount"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:t.value.amount,"onUpdate:modelValue":u[7]||(u[7]=n=>t.value.amount=n),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"40%"}},null,8,["modelValue"]),ee]),_:1})):e.createCommentVNode("",!0),t.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",te,[e.createVNode(d,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[oe,e.createVNode(E,{modelValue:t.value.requiredAmount,"onUpdate:modelValue":u[8]||(u[8]=n=>t.value.requiredAmount=n),modelModifiers:{number:!0},controls:!1,max:99999,min:0,style:{width:"60%",margin:"0 5px"}},null,8,["modelValue"]),ue]),_:1}),e.createVNode(d,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:t.value.discount,"onUpdate:modelValue":u[9]||(u[9]=n=>t.value.discount=n),modelModifiers:{number:!0},controls:!1,max:9.9,min:.1,precision:1,style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"]),le]),_:1})])):e.createCommentVNode("",!0),t.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",re,[e.createVNode(d,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[ne,e.createVNode(E,{modelValue:t.value.requiredAmount,"onUpdate:modelValue":u[10]||(u[10]=n=>t.value.requiredAmount=n),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"80%","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(d,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[ae,e.createVNode(E,{modelValue:t.value.amount,"onUpdate:modelValue":u[11]||(u[11]=n=>t.value.amount=n),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"]),de]),_:1})])):e.createCommentVNode("",!0)])]),_:1}),e.createVNode(D,{label:"\u6BCF\u4EBA\u53D1\u9001\uFF08\u5F20\uFF09"},{default:e.withCtx(()=>[e.createVNode(d,{prop:"num"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:t.value.num,"onUpdate:modelValue":u[12]||(u[12]=n=>t.value.num=n),modelModifiers:{number:!0},controls:!1,max:99999,min:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e.createElementVNode("div",ie,[e.createVNode(N,{plain:"",round:"",onClick:u[13]||(u[13]=n=>l.properties.toBack&&l.properties.toBack())},{default:e.withCtx(()=>[e.createTextVNode("\u8FD4\u56DE")]),_:1}),e.createVNode(N,{round:"",type:"primary",onClick:s},{default:e.withCtx(()=>[e.createTextVNode("\u4FDD\u5B58")]),_:1})])],64)}}}),fe="";return((o,l)=>{const a=o.__vccOpts||o;for(const[i,t]of l)a[i]=t;return a})(se,[["__scopeId","data-v-3f5ddc36"]])});
