(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("@/apis/http"),require("element-plus"),require("decimal.js"),require("@/composables/useConvert"),require("@/store/modules/shopInfo"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","element-plus","decimal.js","@/composables/useConvert","@/store/modules/shopInfo","vue-router"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopEditConsignmentCommodity=h(e.ShopEditConsignmentCommodityContext.Vue,e.ShopEditConsignmentCommodityContext.Request,e.ShopEditConsignmentCommodityContext.ElementPlus,e.ShopEditConsignmentCommodityContext.Decimal,e.ShopEditConsignmentCommodityContext.UseConvert,e.ShopEditConsignmentCommodityContext.ShopInfoStore,e.ShopEditConsignmentCommodityContext.VueRouter))})(this,function(e,h,B,a,oe,re,$){"use strict";var z=document.createElement("style");z.textContent=`@charset "UTF-8";.distribution__form[data-v-cb7214bf]{padding:0 16px}.distribution__title[data-v-cb7214bf]{font-weight:700;padding:15px 0}.distribution__container[data-v-cb7214bf]{padding:0 20px}.distribution__btns[data-v-cb7214bf]{margin-top:auto;display:flex;justify-content:center;align-items:center;position:sticky;bottom:0;padding:10px 0;box-shadow:0 0 10px #d5d5d5;z-index:9}
`,document.head.appendChild(z);var A=(o=>(o.UNLIMITED="无限库存",o.PRODUCT_LIMITED="商品限购",o.SKU_LIMITED="规格限购",o))(A||{});const ie=()=>h.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),le=o=>h.get({url:"gruul-mall-goods/goods/product/category",params:o}),se=()=>h.get({url:"gruul-mall-goods/consignment/config"}),ae=o=>h.get({url:`gruul-mall-goods/manager/product/consignment/${o}`}),de=o=>h.post({url:"gruul-mall-goods/manager/product/consignment/update",data:o}),ce=o=>h.get({url:`gruul-mall-goods/goods/product/label/searchByShopType/${o}`,params:{size:1e3}}),{divTenThousand:w,mulTenThousand:q}=oe(),pe={name:"",saleDescribe:"",platformCategoryId:[],categoryId:"",providerId:"",widePic:"",distributionMode:[],videoUrl:"",albumPics:"",productType:"REAL_PRODUCT",specGroups:[],platformCategory:{one:null,two:null,three:null},shopCategory:{one:null,two:null,three:null},skus:[{id:"",image:"",initSalesVolume:0,limitNum:0,limitType:"UNLIMITED",price:0,productId:"",initStock:0,salePrice:0,shopId:"",stockType:"UNLIMITED",weight:0,specs:[]}],productParameters:[],productAttributes:[],serviceIds:[],detail:"",freightTemplateId:"0",status:"SELL_ON",brandId:""},me=()=>{const o=$.useRoute(),l=$.useRouter(),d=e.ref(),p=e.ref([]),m=e.ref([]),i=e.reactive({name:"",shopCategory:[],saleDescribe:"",labelId:"",consignmentPriceSetting:{type:"UNIFY",sale:0,scribe:0},unifyPriceSetting:{type:"",sale:"",scribe:""}}),P={name:{required:!0,message:"请输入商品名称",trigger:"blur"},shopCategory:{required:!0,message:"请选择店铺类目",trigger:"change",type:"array"}},k={expandTrigger:"hover",label:"name",value:"id"},I=e.ref(pe),g=e.ref([]),y=e.ref([]),C=e.ref([]);async function u(){const{code:s,data:r,success:S}=await ie();if(s!==200){B.ElMessage.error("获取平台分类失败");return}g.value=R(1,r==null?void 0:r.map(E=>({...E,id:E.categoryId})))}async function b(){const{code:s,data:r}=await le({current:1,size:500});if(s!==200){B.ElMessage.error("获取店铺分类失败");return}y.value=R(1,r.records)}async function n(){const{code:s,data:r}=await ce(re.useShopInfoStore().shopInfo.shopType);if(s!==200){B.ElMessage.error("获取商品标签失败");return}C.value=r}const V=async()=>{var E,T,U,f,N,D,L,t,c,_,x,K,H,J,O,Q,X,Z,v,ee;const s=o.query.id,{data:r}=await ae(s);i.name=r==null?void 0:r.name,i.saleDescribe=r==null?void 0:r.saleDescribe,i.labelId=r==null?void 0:r.labelId,I.value.platformCategoryId=[(T=(E=r==null?void 0:r.extra)==null?void 0:E.platformCategory)==null?void 0:T.one,(f=(U=r==null?void 0:r.extra)==null?void 0:U.platformCategory)==null?void 0:f.two,(D=(N=r==null?void 0:r.extra)==null?void 0:N.platformCategory)==null?void 0:D.three],i.consignmentPriceSetting.type=(t=(L=r==null?void 0:r.extra)==null?void 0:L.consignmentPriceSetting)==null?void 0:t.type,i.consignmentPriceSetting.sale=w((_=(c=r==null?void 0:r.extra)==null?void 0:c.consignmentPriceSetting)==null?void 0:_.sale).toNumber(),i.consignmentPriceSetting.scribe=w((K=(x=r==null?void 0:r.extra)==null?void 0:x.consignmentPriceSetting)==null?void 0:K.scribe).toNumber(),i.shopCategory=[(J=(H=r==null?void 0:r.extra)==null?void 0:H.shopCategory)==null?void 0:J.one,(Q=(O=r==null?void 0:r.extra)==null?void 0:O.shopCategory)==null?void 0:Q.two,(Z=(X=r==null?void 0:r.extra)==null?void 0:X.shopCategory)==null?void 0:Z.three];const S=(v=r==null?void 0:r.storageSpecSku)==null?void 0:v[0];p.value=(ee=S==null?void 0:S.skus)==null?void 0:ee.map(W=>{var te,ne;return{...W,salePrice:(te=w(W.salePrice))==null?void 0:te.toString(),price:(ne=w(W.price))==null?void 0:ne.toString()}}),m.value=(S==null?void 0:S.specGroups)||[],Y(i,p)},F=async()=>{const{data:s,code:r}=await se();r===200&&s&&(i.unifyPriceSetting.sale=w(s==null?void 0:s.sale).toString(),i.unifyPriceSetting.scribe=w(s==null?void 0:s.scribe).toString(),i.unifyPriceSetting.type=s==null?void 0:s.type)};e.watch(()=>i.consignmentPriceSetting,()=>Y(i,p),{deep:!0});const M=async()=>{u(),b(),n();try{await F()}finally{V()}},G=()=>{l.back()},j=()=>{var s;(s=d.value)==null||s.validate(async r=>{var S,E,T,U;if(r){const f={shopCategory:{one:(S=i==null?void 0:i.shopCategory)==null?void 0:S[0],two:(E=i==null?void 0:i.shopCategory)==null?void 0:E[1],three:(T=i==null?void 0:i.shopCategory)==null?void 0:T[2]},id:(U=o.query)==null?void 0:U.id,name:i.name,saleDescribe:i.saleDescribe,labelId:i.labelId},N={};i.consignmentPriceSetting.type==="UNIFY"?(N.type=i.unifyPriceSetting.type,N.sale=q(i.unifyPriceSetting.sale).toString(),N.scribe=q(i.unifyPriceSetting.scribe).toString()):(N.type=i.consignmentPriceSetting.type,N.sale=q(i.consignmentPriceSetting.sale).toString(),N.scribe=q(i.consignmentPriceSetting.scribe).toString()),f.consignmentPriceSetting=N;const{code:D,success:L,msg:t}=await de(f);D===200&&L?(B.ElMessage.success({message:t||"修改商品信息成功"}),G()):B.ElMessage.error({message:t})}})};return e.onMounted(()=>M()),{formRef:d,distributionFormModel:i,distributionFormRules:P,platformCategoryList:g,currentComodityInfo:I,shopCascaderProps:k,shopCategoryList:y,LabelList:C,distributionSkus:p,divTenThousand:w,specGroups:m,cancelDistribution:G,handleConfirmDistribution:j}};function Y(o,l){var d,p,m,i,P,k,I;((d=o==null?void 0:o.consignmentPriceSetting)==null?void 0:d.type)==="UNIFY"?((p=o==null?void 0:o.unifyPriceSetting)==null?void 0:p.type)==="RATE"?l.value=(m=l.value)==null?void 0:m.map(g=>{var C,u,b,n;const y=(u=new a(g.salePrice))==null?void 0:u.mul(new a(1).add(new a(((C=o==null?void 0:o.unifyPriceSetting)==null?void 0:C.sale)||0).div(100))).toString();return{...g,actualSalePrice:y,actualPrice:(n=new a(y))==null?void 0:n.mul(new a(1).add(new a(((b=o==null?void 0:o.unifyPriceSetting)==null?void 0:b.scribe)||0).div(100))).toString()}}):l.value=(i=l.value)==null?void 0:i.map(g=>{var C,u,b,n;const y=(u=new a(g.salePrice))==null?void 0:u.add(new a(((C=o==null?void 0:o.unifyPriceSetting)==null?void 0:C.sale)||0)).toString();return{...g,actualSalePrice:y,actualPrice:(n=new a(y))==null?void 0:n.add(new a(((b=o==null?void 0:o.unifyPriceSetting)==null?void 0:b.scribe)||0)).toString()}}):((P=o==null?void 0:o.consignmentPriceSetting)==null?void 0:P.type)==="RATE"?l.value=(k=l.value)==null?void 0:k.map(g=>{var C,u,b,n;const y=(u=new a(g.salePrice))==null?void 0:u.mul(new a(1).add(new a(((C=o==null?void 0:o.unifyPriceSetting)==null?void 0:C.sale)||0).div(100))).toString();return{...g,actualSalePrice:y,actualPrice:(n=new a(y))==null?void 0:n.mul(new a(1).add(new a(((b=o==null?void 0:o.consignmentPriceSetting)==null?void 0:b.scribe)||0).div(100))).toString()}}):l.value=(I=l.value)==null?void 0:I.map(g=>{var C,u,b,n;const y=(u=new a(g.salePrice))==null?void 0:u.add(new a(((C=o==null?void 0:o.consignmentPriceSetting)==null?void 0:C.sale)||0)).toString();return{...g,actualSalePrice:y,actualPrice:(n=new a(y))==null?void 0:n.add(new a(((b=o==null?void 0:o.consignmentPriceSetting)==null?void 0:b.scribe)||0)).toString()}})}function R(o,l){const d=o===3;for(let p=0;p<l.length;){const m=l[p];if(d){m.disabled=!1,p++;continue}const i=m.children||m.secondCategoryVos||m.categoryThirdlyVos;delete m.secondCategoryVos,delete m.categoryThirdlyVos;const P=!i||i.length===0;if(m.disabled=P,P){l.splice(p,1);continue}if(R(o+1,i),i.length===0){l.splice(p,1);continue}m.children=i,p++}return l}const ge={class:"distribution fdc1 overh"},ye={class:"distribution__container"},Ce={class:"distribution__container"},fe={class:"distribution__container fdc1 overh"},ue={class:"price-settings"},be={class:"distribution__btns"},Ve=e.defineComponent({__name:"ShopEditConsignmentCommodity",setup(o){const{distributionFormModel:l,distributionSkus:d,distributionFormRules:p,platformCategoryList:m,shopCascaderProps:i,currentComodityInfo:P,shopCategoryList:k,LabelList:I,specGroups:g,formRef:y,cancelDistribution:C,handleConfirmDistribution:u}=me();return(b,n)=>{const V=e.resolveComponent("el-form-item"),F=e.resolveComponent("el-input"),M=e.resolveComponent("el-cascader"),G=e.resolveComponent("el-option"),j=e.resolveComponent("el-select"),s=e.resolveComponent("el-col"),r=e.resolveComponent("el-row"),S=e.resolveComponent("el-radio"),E=e.resolveComponent("el-radio-group"),T=e.resolveComponent("el-input-number"),U=e.resolveComponent("el-image"),f=e.resolveComponent("el-table-column"),N=e.resolveComponent("el-table"),D=e.resolveComponent("el-form"),L=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",ge,[e.createVNode(D,{ref_key:"formRef",ref:y,class:"distribution__form fdc1 overh",model:e.unref(l),rules:e.unref(p)},{default:e.withCtx(()=>[n[24]||(n[24]=e.createElementVNode("div",{class:"distribution__title"},"基础信息",-1)),e.createElementVNode("div",ye,[e.createVNode(V,{label:"商品类型"},{default:e.withCtx(()=>n[10]||(n[10]=[e.createTextVNode("实物商品")])),_:1}),e.createVNode(V,{label:"销售方式"},{default:e.withCtx(()=>n[11]||(n[11]=[e.createTextVNode("代销商品（采购商品可供各店铺采购，代销商品可以让各店铺帮您将商品销售出去；）")])),_:1}),e.createVNode(V,{label:"商品名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:e.unref(l).name,"onUpdate:modelValue":n[0]||(n[0]=t=>e.unref(l).name=t),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),e.createVNode(V,{label:"平台类目"},{default:e.withCtx(()=>[e.createVNode(M,{ref:"platformCategoryRef",modelValue:e.unref(P).platformCategoryId,"onUpdate:modelValue":n[1]||(n[1]=t=>e.unref(P).platformCategoryId=t),clearable:"",class:"inputWidth",style:{width:"100%"},options:e.unref(m),props:e.unref(i),disabled:"",placeholder:"请选择平台类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"店铺类目",prop:"shopCategory"},{default:e.withCtx(()=>[e.createVNode(M,{ref:"shopCategoryRef",modelValue:e.unref(l).shopCategory,"onUpdate:modelValue":n[2]||(n[2]=t=>e.unref(l).shopCategory=t),clearable:"",style:{width:"100%"},class:"inputWidth",options:e.unref(k),props:e.unref(i),placeholder:"请选择店铺类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"商品标签"},{default:e.withCtx(()=>[e.createVNode(j,{modelValue:e.unref(l).labelId,"onUpdate:modelValue":n[3]||(n[3]=t=>e.unref(l).labelId=t),class:"inputWidth",placeholder:"请选择商品标签",style:{width:"100%"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(I),t=>(e.openBlock(),e.createBlock(G,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(V,{label:"卖点描述",prop:"saleDescribe"},{default:e.withCtx(()=>[e.createVNode(F,{modelValue:e.unref(l).saleDescribe,"onUpdate:modelValue":n[4]||(n[4]=t=>e.unref(l).saleDescribe=t),class:"inputWidth",placeholder:"请填写卖点描述",maxlength:"60"},null,8,["modelValue"])]),_:1})]),e.unref(d).length===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[13]||(n[13]=e.createElementVNode("div",{class:"distribution__title"},"单规格信息",-1)),e.createElementVNode("div",Ce,[e.createVNode(r,{gutter:8},{default:e.withCtx(()=>[e.createVNode(s,{span:6},{default:e.withCtx(()=>n[12]||(n[12]=[e.createTextVNode("规格类型：单规格")])),_:1}),e.createVNode(s,{span:6},{default:e.withCtx(()=>{var t,c;return[e.createTextVNode("供货价："+e.toDisplayString((c=(t=e.unref(d))==null?void 0:t[0])==null?void 0:c.salePrice),1)]}),_:1}),e.createVNode(s,{span:6},{default:e.withCtx(()=>{var t,c,_,x;return[e.createTextVNode("销量（注水）："+e.toDisplayString(Number(((c=(t=e.unref(d))==null?void 0:t[0])==null?void 0:c.initSalesVolume)||0)+Number(((x=(_=e.unref(d))==null?void 0:_[0])==null?void 0:x.salesVolume)||0)),1)]}),_:1}),e.createVNode(s,{span:6},{default:e.withCtx(()=>{var t,c;return[e.createTextVNode("重量："+e.toDisplayString((c=(t=e.unref(d))==null?void 0:t[0])==null?void 0:c.weight),1)]}),_:1}),e.createVNode(s,{span:6},{default:e.withCtx(()=>{var t,c,_,x;return[e.createTextVNode("库存数："+e.toDisplayString(((c=(t=e.unref(d))==null?void 0:t[0])==null?void 0:c.stockType)==="UNLIMITED"?"无限库存":(x=(_=e.unref(d))==null?void 0:_[0])==null?void 0:x.stock),1)]}),_:1}),e.createVNode(s,{span:6},{default:e.withCtx(()=>{var t,c;return[e.createTextVNode("限购类型："+e.toDisplayString(e.unref(A)[(c=(t=e.unref(d))==null?void 0:t[0])==null?void 0:c.limitType]),1)]}),_:1})]),_:1})])],64)):e.createCommentVNode("",!0),n[25]||(n[25]=e.createElementVNode("div",{class:"distribution__title"},"价格设置",-1)),e.createElementVNode("div",fe,[e.createElementVNode("div",ue,[e.createVNode(E,{modelValue:e.unref(l).consignmentPriceSetting.type,"onUpdate:modelValue":n[5]||(n[5]=t=>e.unref(l).consignmentPriceSetting.type=t)},{default:e.withCtx(()=>[e.createVNode(S,{value:"RATE"},{default:e.withCtx(()=>n[14]||(n[14]=[e.createTextVNode("按比例设价")])),_:1}),e.createVNode(S,{value:"REGULAR"},{default:e.withCtx(()=>n[15]||(n[15]=[e.createTextVNode("固定金额设价")])),_:1})]),_:1},8,["modelValue"]),e.unref(l).consignmentPriceSetting.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[n[16]||(n[16]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(T,{modelValue:e.unref(l).consignmentPriceSetting.sale,"onUpdate:modelValue":n[6]||(n[6]=t=>e.unref(l).consignmentPriceSetting.sale=t),controls:!1,precision:2,max:100},null,8,["modelValue"]),n[17]||(n[17]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[n[18]||(n[18]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(T,{modelValue:e.unref(l).consignmentPriceSetting.scribe,"onUpdate:modelValue":n[7]||(n[7]=t=>e.unref(l).consignmentPriceSetting.scribe=t),controls:!1,precision:2,max:100},null,8,["modelValue"]),n[19]||(n[19]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[n[20]||(n[20]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(T,{modelValue:e.unref(l).consignmentPriceSetting.sale,"onUpdate:modelValue":n[8]||(n[8]=t=>e.unref(l).consignmentPriceSetting.sale=t),controls:!1,precision:2},null,8,["modelValue"]),n[21]||(n[21]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[n[22]||(n[22]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(T,{modelValue:e.unref(l).consignmentPriceSetting.scribe,"onUpdate:modelValue":n[9]||(n[9]=t=>e.unref(l).consignmentPriceSetting.scribe=t),controls:!1,precision:2},null,8,["modelValue"]),n[23]||(n[23]=e.createElementVNode("span",null," 元",-1))]),_:1})],64))]),e.createVNode(N,{data:e.unref(d),class:"f1"},{default:e.withCtx(()=>[e.createVNode(f,{fixed:"left",width:"150",label:"规格图"},{default:e.withCtx(({row:t})=>[e.createVNode(U,{src:t==null?void 0:t.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),(t,c)=>(e.openBlock(),e.createBlock(f,{key:c,width:"150",label:t==null?void 0:t.name},{default:e.withCtx(({row:_})=>{var x;return[e.createTextVNode(e.toDisplayString(Array.isArray(_.specs)?(x=_.specs)==null?void 0:x[c]:_.specs.name),1)]}),_:2},1032,["label"]))),128)),e.createVNode(f,{width:"150",label:"供货价",prop:"salePrice"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(new(e.unref(a))(t==null?void 0:t.salePrice).toFixed(2)),1)]),_:1}),e.createVNode(f,{width:"150",label:"划线价",prop:"actualPrice"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(new(e.unref(a))(t==null?void 0:t.actualPrice).toFixed(2)),1)]),_:1}),e.createVNode(f,{width:"150",label:"销售价",prop:"actualSalePrice"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(new(e.unref(a))(t==null?void 0:t.actualSalePrice).toFixed(2)),1)]),_:1}),e.createVNode(f,{width:"150",label:"库存"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString((t==null?void 0:t.stockType)==="UNLIMITED"?"无限库存":t==null?void 0:t.initStock),1)]),_:1}),e.createVNode(f,{width:"150",label:"限购类型"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(A)[t==null?void 0:t.limitType]),1)]),_:1}),e.createVNode(f,{width:"150",label:"规格限购"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString((t==null?void 0:t.limitType)!=="UNLIMITED"?String(t.limitNum):""),1)]),_:1}),e.createVNode(f,{width:"150",label:"重量",prop:"weight"}),e.createVNode(f,{width:"150",label:"销量（注水）"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(Number((t==null?void 0:t.initSalesVolume)||0)+Number((t==null?void 0:t.salesVolume)||0)),1)]),_:1})]),_:1},8,["data"])])]),_:1},8,["model","rules"]),e.createElementVNode("div",be,[e.createVNode(L,{onClick:e.unref(C)},{default:e.withCtx(()=>n[26]||(n[26]=[e.createTextVNode("取消")])),_:1},8,["onClick"]),e.createVNode(L,{type:"primary",onClick:e.unref(u)},{default:e.withCtx(()=>n[27]||(n[27]=[e.createTextVNode("确认")])),_:1},8,["onClick"])])])}}}),Se="";return((o,l)=>{const d=o.__vccOpts||o;for(const[p,m]of l)d[p]=m;return d})(Ve,[["__scopeId","data-v-cb7214bf"]])});
