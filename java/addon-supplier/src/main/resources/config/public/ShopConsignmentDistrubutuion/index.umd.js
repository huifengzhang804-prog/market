(function(e,S){typeof exports=="object"&&typeof module<"u"?module.exports=S(require("vue"),require("@/apis/http"),require("element-plus"),require("decimal.js"),require("vue-router"),require("@/composables/useConvert")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","element-plus","decimal.js","vue-router","@/composables/useConvert"],S):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopConsignmentDistrubutuion=S(e.ShopConsignmentDistrubutuionContext.Vue,e.ShopConsignmentDistrubutuionContext.Request,e.ShopConsignmentDistrubutuionContext.ElementPlus,e.ShopConsignmentDistrubutuionContext.Decimal,e.ShopConsignmentDistrubutuionContext.VueRouter,e.ShopConsignmentDistrubutuionContext.UseConvert))})(this,function(e,S,D,x,G,j){"use strict";var A=document.createElement("style");A.textContent=`@charset "UTF-8";.distribution .distribution_form[data-v-0dd92bf7]{padding-left:16px;padding-right:16px}.distribution__title[data-v-0dd92bf7]{font-weight:700;padding:15px 0}.distribution__container[data-v-0dd92bf7]{padding:0 20px}.distribution__btns[data-v-0dd92bf7]{margin-top:20px;display:flex;justify-content:center;align-items:center;position:sticky;bottom:0;z-index:9;background-color:#fff;box-shadow:0 0 10px #d5d5d5;padding-top:10px;padding-bottom:10px}.distribution__btns .el-button[data-v-0dd92bf7]{width:75px;height:40px}
`,document.head.appendChild(A);var L=(r=>(r.UNLIMITED="无限库存",r.PRODUCT_LIMITED="商品限购",r.SKU_LIMITED="规格限购",r))(L||{});const W=(r,o,l=!1)=>S.get({url:`gruul-mall-storage/storage/shop/${r}/product/${o}?isSupplier=${l}`}),z=()=>S.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),K=r=>S.get({url:"gruul-mall-goods/goods/product/category",params:r}),H=()=>S.get({url:"gruul-mall-goods/consignment/config"}),J=(r,o)=>S.get({url:`addon-supplier/supplier/manager/product/get/${o}/${r}`}),O=r=>S.post({url:"gruul-mall-goods/consignment/single/pave/goods",data:r}),{divTenThousand:w,mulTenThousand:U}=j(),Q={name:"",saleDescribe:"",platformCategoryId:[],categoryId:"",providerId:"",widePic:"",distributionMode:[],videoUrl:"",albumPics:"",productType:"REAL_PRODUCT",specGroups:[],platformCategory:{one:null,two:null,three:null},shopCategory:{one:null,two:null,three:null},skus:[{id:"",image:"",initSalesVolume:0,limitNum:0,limitType:"UNLIMITED",price:0,productId:"",initStock:0,salePrice:0,shopId:"",stockType:"UNLIMITED",weight:0,specs:[]}],productParameters:[],productAttributes:[],serviceIds:[],detail:"",freightTemplateId:"0",status:"SELL_ON",brandId:""},X=()=>{const r=G.useRoute(),o=G.useRouter(),l=e.ref(),s=e.ref([]),d=e.ref([]),i=e.reactive({name:"",shopCategory:"",saleDescribe:"",consignmentPriceSetting:{type:"UNIFY",sale:0,scribe:0},unifyPriceSetting:{type:"",sale:"",scribe:""}}),u={name:{required:!0,message:"请输入商品名称",trigger:"blur"},shopCategory:{required:!0,message:"请选择店铺类目",trigger:"change",type:"array"}},k={expandTrigger:"hover",label:"name",value:"id"},_=e.ref(Q),h=e.ref([]),P=e.ref([]);async function T(){const{code:c,data:f,success:a}=await z();if(c!==200){D.ElMessage.error("获取平台分类失败");return}h.value=F(1,f==null?void 0:f.map(y=>({...y,id:y.categoryId})))}async function Y(){const{code:c,data:f}=await K({current:1,size:500});if(c!==200){D.ElMessage.error("获取店铺分类失败");return}P.value=F(1,f.records)}const n=async()=>{var y,p,g,E,b,t;const c=r.query.shopId,f=r.query.id,{data:a}=await J(f,c);i.name=a==null?void 0:a.name,_.value.platformCategoryId=[(p=(y=a==null?void 0:a.extra)==null?void 0:y.platformCategory)==null?void 0:p.one,(E=(g=a==null?void 0:a.extra)==null?void 0:g.platformCategory)==null?void 0:E.two,(t=(b=a==null?void 0:a.extra)==null?void 0:b.platformCategory)==null?void 0:t.three]},V=async()=>{const{data:c,code:f}=await H();f===200&&c&&(i.unifyPriceSetting.sale=w(c==null?void 0:c.sale).toString(),i.unifyPriceSetting.scribe=w(c==null?void 0:c.scribe).toString(),i.unifyPriceSetting.type=c==null?void 0:c.type)};e.watch(()=>i.consignmentPriceSetting,()=>$(i,s),{deep:!0});const R=async()=>{var y,p;const c=r.query.shopId,f=r.query.id,{data:a}=await W(c,f);s.value=(p=(y=a==null?void 0:a.skus)==null?void 0:y.map(g=>{var E,b;return{...g,salePrice:(E=w(g.salePrice))==null?void 0:E.toString(),price:(b=w(g.price))==null?void 0:b.toString()}}))==null?void 0:p.filter(g=>!((g==null?void 0:g.stockType)!=="UNLIMITED"&&Number(g==null?void 0:g.stock)===0)),d.value=(a==null?void 0:a.specGroups)||[],$(i,s)},B=async()=>{n(),T(),Y();try{await V()}finally{R()}},I=()=>{o.back()},q=()=>{var c;(c=l.value)==null||c.validate(async f=>{var a,y,p,g,E;if(f){const b={shopCategory:{one:(a=i==null?void 0:i.shopCategory)==null?void 0:a[0],two:(y=i==null?void 0:i.shopCategory)==null?void 0:y[1],three:(p=i==null?void 0:i.shopCategory)==null?void 0:p[2]},shopProductKey:{shopId:(g=r.query)==null?void 0:g.shopId,productId:(E=r.query)==null?void 0:E.id},name:i.name,saleDescribe:i.saleDescribe},t={};i.consignmentPriceSetting.type==="UNIFY"?(t.type=i.unifyPriceSetting.type,t.sale=U(i.unifyPriceSetting.sale||0).toString(),t.scribe=U(i.unifyPriceSetting.scribe||0).toString()):(t.type=i.consignmentPriceSetting.type,t.sale=U(i.consignmentPriceSetting.sale||0).toString(),t.scribe=U(i.consignmentPriceSetting.scribe||0).toString()),b.consignmentPriceSetting=t;const{code:m,success:C,msg:N}=await O(b);m===200&&C?(D.ElMessage.success({message:N||"铺货完成"}),I()):D.ElMessage.error({message:N})}})};return B(),{formRef:l,distributionFormModel:i,distributionFormRules:u,platformCategoryList:h,currentComodityInfo:_,shopCascaderProps:k,shopCategoryList:P,distributionSkus:s,divTenThousand:w,specGroups:d,cancelDistribution:I,handleConfirmDistribution:q}},M={UNIFY:(r,o)=>{var s;const l=(s=r==null?void 0:r.unifyPriceSetting)==null?void 0:s.type;return M[l](r,o)},RATE:(r,o)=>{var s,d;const l=((s=r==null?void 0:r.consignmentPriceSetting)==null?void 0:s.type)==="UNIFY"?"unifyPriceSetting":"consignmentPriceSetting";return(d=o.value)==null?void 0:d.map(i=>{var _,h,P,T;const u=(h=new x(i.salePrice))==null?void 0:h.mul(new x(1).add(new x(((_=r[l])==null?void 0:_.sale)||0).div(100))).toFixed(2),k=(T=new x(u))==null?void 0:T.mul(new x(1).add(new x(((P=r[l])==null?void 0:P.scribe)||0).div(100)));return{...i,actualSalePrice:u,actualPrice:k}})},REGULAR:(r,o)=>{var s,d;const l=((s=r==null?void 0:r.consignmentPriceSetting)==null?void 0:s.type)==="UNIFY"?"unifyPriceSetting":"consignmentPriceSetting";return(d=o.value)==null?void 0:d.map(i=>{var _,h,P,T;const u=(h=new x(i.salePrice))==null?void 0:h.add(new x(((_=r[l])==null?void 0:_.sale)||0)).toFixed(2),k=(T=new x(u))==null?void 0:T.add(new x(((P=r[l])==null?void 0:P.scribe)||0)).toFixed(2);return{...i,actualSalePrice:u,actualPrice:k}})},undefined:()=>[]};function $(r,o){var s;const l=(s=r==null?void 0:r.consignmentPriceSetting)==null?void 0:s.type;o.value=M[l](r,o)}function F(r,o){const l=r===3;for(let s=0;s<o.length;){const d=o[s];if(l){d.disabled=!1,s++;continue}const i=d.children||d.secondCategoryVos||d.categoryThirdlyVos;delete d.secondCategoryVos,delete d.categoryThirdlyVos;const u=!i||i.length===0;if(d.disabled=u,u){o.splice(s,1);continue}if(F(r+1,i),i.length===0){o.splice(s,1);continue}d.children=i,s++}return o}const Z=e.defineComponent({__name:"batch-unify-settings",props:{type:{default:""},sale:{default:0},scribe:{default:0}},setup(r){return(o,l)=>{const s=e.resolveComponent("el-input-number"),d=e.resolveComponent("el-form-item");return o.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(d,{prop:"sale"},{default:e.withCtx(()=>[l[0]||(l[0]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(s,{"model-value":o.sale,controls:!1,precision:2,disabled:""},null,8,["model-value"]),l[1]||(l[1]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(d,{prop:"scribe"},{default:e.withCtx(()=>[l[2]||(l[2]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(s,{"model-value":o.scribe,controls:!1,precision:2,disabled:""},null,8,["model-value"]),l[3]||(l[3]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):o.type==="REGULAR"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(d,{prop:"sale"},{default:e.withCtx(()=>[l[4]||(l[4]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(s,{"model-value":o.sale,controls:!1,precision:2,disabled:""},null,8,["model-value"]),l[5]||(l[5]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(d,{prop:"scribe"},{default:e.withCtx(()=>[l[6]||(l[6]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(s,{"model-value":o.scribe,controls:!1,precision:2,disabled:""},null,8,["model-value"]),l[7]||(l[7]=e.createElementVNode("span",null," 元",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[],64))}}}),v={class:"distribution fdc1 overh"},ee={class:"distribution__container"},te={class:"distribution__container"},ne={class:"distribution__container fdc1 overh"},oe={class:"price-settings"},re={class:"distribution__btns"},le=e.defineComponent({__name:"ShopConsignmentDistrubutuion",setup(r){const{distributionFormModel:o,distributionSkus:l,distributionFormRules:s,platformCategoryList:d,shopCascaderProps:i,currentComodityInfo:u,shopCategoryList:k,specGroups:_,formRef:h,cancelDistribution:P,handleConfirmDistribution:T}=X();return(Y,n)=>{const V=e.resolveComponent("el-form-item"),R=e.resolveComponent("el-input"),B=e.resolveComponent("el-cascader"),I=e.resolveComponent("el-col"),q=e.resolveComponent("el-row"),c=e.resolveComponent("el-radio"),f=e.resolveComponent("el-radio-group"),a=e.resolveComponent("el-input-number"),y=e.resolveComponent("el-image"),p=e.resolveComponent("el-table-column"),g=e.resolveComponent("el-table"),E=e.resolveComponent("el-form"),b=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",v,[e.createVNode(E,{class:"distribution_form fdc1 overh",ref_key:"formRef",ref:h,model:e.unref(o),rules:e.unref(s)},{default:e.withCtx(()=>[n[24]||(n[24]=e.createElementVNode("div",{class:"distribution__title"},"基础信息",-1)),e.createElementVNode("div",ee,[e.createVNode(V,{label:"商品类型"},{default:e.withCtx(()=>n[9]||(n[9]=[e.createTextVNode("实物商品")])),_:1}),e.createVNode(V,{label:"销售方式"},{default:e.withCtx(()=>n[10]||(n[10]=[e.createTextVNode("代销商品（采购商品可供各店铺采购，代销商品可以让各店铺帮您将商品销售出去；）")])),_:1}),e.createVNode(V,{label:"商品名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:e.unref(o).name,"onUpdate:modelValue":n[0]||(n[0]=t=>e.unref(o).name=t),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),e.createVNode(V,{label:"平台类目"},{default:e.withCtx(()=>[e.createVNode(B,{ref:"platformCategoryRef",modelValue:e.unref(u).platformCategoryId,"onUpdate:modelValue":n[1]||(n[1]=t=>e.unref(u).platformCategoryId=t),clearable:"",class:"inputWidth",style:{width:"100%"},options:e.unref(d),props:e.unref(i),placeholder:"请选择平台类目","show-all-levels":"",disabled:""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"店铺类目",prop:"shopCategory"},{default:e.withCtx(()=>[e.createVNode(B,{ref:"shopCategoryRef",modelValue:e.unref(o).shopCategory,"onUpdate:modelValue":n[2]||(n[2]=t=>e.unref(o).shopCategory=t),clearable:"",style:{width:"100%"},class:"inputWidth",options:e.unref(k),props:e.unref(i),placeholder:"请选择店铺类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"卖点描述",prop:"saleDescribe"},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:e.unref(o).saleDescribe,"onUpdate:modelValue":n[3]||(n[3]=t=>e.unref(o).saleDescribe=t),class:"inputWidth",placeholder:"请填写卖点描述",maxlength:"60"},null,8,["modelValue"])]),_:1})]),e.unref(l).length===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[12]||(n[12]=e.createElementVNode("div",{class:"distribution__title"},"单规格信息",-1)),e.createElementVNode("div",te,[e.createVNode(q,{gutter:8},{default:e.withCtx(()=>[e.createVNode(I,{span:6},{default:e.withCtx(()=>n[11]||(n[11]=[e.createTextVNode("规格类型：单规格")])),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var t,m;return[e.createTextVNode("供货价："+e.toDisplayString((m=(t=e.unref(l))==null?void 0:t[0])==null?void 0:m.salePrice),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var t,m,C,N;return[e.createTextVNode("销量（注水）："+e.toDisplayString(Number(((m=(t=e.unref(l))==null?void 0:t[0])==null?void 0:m.initSalesVolume)||0)+Number(((N=(C=e.unref(l))==null?void 0:C[0])==null?void 0:N.salesVolume)||0)),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var t,m;return[e.createTextVNode("重量："+e.toDisplayString((m=(t=e.unref(l))==null?void 0:t[0])==null?void 0:m.weight),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var t,m,C,N;return[e.createTextVNode("库存数："+e.toDisplayString(((m=(t=e.unref(l))==null?void 0:t[0])==null?void 0:m.stockType)==="UNLIMITED"?"无限库存":(N=(C=e.unref(l))==null?void 0:C[0])==null?void 0:N.stock),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var t,m;return[e.createTextVNode("限购类型："+e.toDisplayString(e.unref(L)[(m=(t=e.unref(l))==null?void 0:t[0])==null?void 0:m.limitType]),1)]}),_:1})]),_:1})])],64)):e.createCommentVNode("",!0),n[25]||(n[25]=e.createElementVNode("div",{class:"distribution__title"},"价格设置",-1)),e.createElementVNode("div",ne,[e.createElementVNode("div",oe,[e.createVNode(f,{modelValue:e.unref(o).consignmentPriceSetting.type,"onUpdate:modelValue":n[4]||(n[4]=t=>e.unref(o).consignmentPriceSetting.type=t)},{default:e.withCtx(()=>[e.createVNode(c,{value:"UNIFY"},{default:e.withCtx(()=>n[13]||(n[13]=[e.createTextVNode("统一设价")])),_:1}),e.createVNode(c,{value:"RATE"},{default:e.withCtx(()=>n[14]||(n[14]=[e.createTextVNode("按比例设价")])),_:1}),e.createVNode(c,{value:"REGULAR"},{default:e.withCtx(()=>n[15]||(n[15]=[e.createTextVNode("固定金额设价")])),_:1})]),_:1},8,["modelValue"]),e.unref(o).consignmentPriceSetting.type==="UNIFY"?(e.openBlock(),e.createBlock(Z,{key:0,sale:+e.unref(o).unifyPriceSetting.sale,scribe:+e.unref(o).unifyPriceSetting.scribe,type:e.unref(o).unifyPriceSetting.type},null,8,["sale","scribe","type"])):e.unref(o).consignmentPriceSetting.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[n[16]||(n[16]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(a,{modelValue:e.unref(o).consignmentPriceSetting.sale,"onUpdate:modelValue":n[5]||(n[5]=t=>e.unref(o).consignmentPriceSetting.sale=t),controls:!1,precision:2,max:100},null,8,["modelValue"]),n[17]||(n[17]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[n[18]||(n[18]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(a,{modelValue:e.unref(o).consignmentPriceSetting.scribe,"onUpdate:modelValue":n[6]||(n[6]=t=>e.unref(o).consignmentPriceSetting.scribe=t),controls:!1,precision:2,max:100},null,8,["modelValue"]),n[19]||(n[19]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[n[20]||(n[20]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(a,{modelValue:e.unref(o).consignmentPriceSetting.sale,"onUpdate:modelValue":n[7]||(n[7]=t=>e.unref(o).consignmentPriceSetting.sale=t),controls:!1,precision:2},null,8,["modelValue"]),n[21]||(n[21]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[n[22]||(n[22]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(a,{modelValue:e.unref(o).consignmentPriceSetting.scribe,"onUpdate:modelValue":n[8]||(n[8]=t=>e.unref(o).consignmentPriceSetting.scribe=t),controls:!1,precision:2},null,8,["modelValue"]),n[23]||(n[23]=e.createElementVNode("span",null," 元",-1))]),_:1})],64))]),e.createVNode(g,{data:e.unref(l),"max-height":500,class:"f1"},{default:e.withCtx(()=>[e.createVNode(p,{fixed:"left",width:"150",label:"规格图"},{default:e.withCtx(({row:t})=>[e.createVNode(y,{src:t==null?void 0:t.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(t,m)=>(e.openBlock(),e.createBlock(p,{key:m,width:"150",label:t==null?void 0:t.name},{default:e.withCtx(({row:C})=>{var N;return[e.createTextVNode(e.toDisplayString(Array.isArray(C.specs)?(N=C.specs)==null?void 0:N[m]:C.specs.name),1)]}),_:2},1032,["label"]))),128)),e.createVNode(p,{width:"150",label:"供货价",prop:"salePrice"}),e.createVNode(p,{width:"150",label:"划线价",prop:"actualPrice"}),e.createVNode(p,{width:"150",label:"销售价",prop:"actualSalePrice"}),e.createVNode(p,{width:"150",label:"库存"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString((t==null?void 0:t.stockType)==="UNLIMITED"?"无限库存":t==null?void 0:t.stock),1)]),_:1}),e.createVNode(p,{width:"150",label:"销量（注水）"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(Number((t==null?void 0:t.initSalesVolume)||0)+Number((t==null?void 0:t.salesVolume)||0)),1)]),_:1}),e.createVNode(p,{width:"150",label:"限购类型"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(L)[t==null?void 0:t.limitType]),1)]),_:1}),e.createVNode(p,{width:"150",label:"规格限购"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString((t==null?void 0:t.limitType)!=="UNLIMITED"&&(t==null?void 0:t.limitNum)||"/"),1)]),_:1}),e.createVNode(p,{width:"150",label:"重量",prop:"weight"})]),_:1},8,["data"])])]),_:1},8,["model","rules"]),e.createElementVNode("div",re,[e.createVNode(b,{onClick:e.unref(P)},{default:e.withCtx(()=>n[26]||(n[26]=[e.createTextVNode("取消")])),_:1},8,["onClick"]),e.createVNode(b,{style:{"margin-left":"40px"},type:"primary",onClick:e.unref(T)},{default:e.withCtx(()=>n[27]||(n[27]=[e.createTextVNode("确认")])),_:1},8,["onClick"])])])}}}),de="";return((r,o)=>{const l=r.__vccOpts||r;for(const[s,d]of o)l[s]=d;return l})(le,[["__scopeId","data-v-0dd92bf7"]])});
