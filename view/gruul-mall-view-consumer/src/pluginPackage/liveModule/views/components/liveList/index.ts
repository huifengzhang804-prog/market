import type { Joint_Live_List_Status } from '@/pluginPackage/liveModule/apis/CreateLive/model'
import storage from '@/utils/storage'
// 主播端
const viewLivePageUrl = '/pluginPackage/liveModule/views/liveAnchor'
// 用户端
const viewLivePageUserUrl = '/pluginPackage/liveModule/views/Audience'
// 本地存储 key
const CREATE_LIVE_ROOM_STORAGE_KEY = 'CREATE_LIVE_ROOM_STORAGE_KEY'
// 本地存储 key
const USER_LIVE_ROOM_STORAGE_KEY = 'CREATE_LIVE_ROOM_STORAGE_KEY'
enum TABBAR_URL {
  LIVE_ACTIVE = 'data:image/png;base64,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',
  LIVE_UN_ACTIVE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAoCAYAAABjPNNTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAATnSURBVHgBvVjbUeNKEB0ZQwE/VzeCKyKAzcCOAIgAu4riUXxcOwLYCLx8UDyr7I3AJgK0EeAMVmTgT4rnnqPt0bbGkizsxV2l0kga9Zzp7umXZ0rQ9fX18dvbWwvDcH9/f9vMSMLvxPO83uvr69fDw8OoaL5X9PH8/LxWqVS6GAb23cLCQrC7u/tgZqDLy8ufiucI11ds/lve/Ereh6urq/8B8E4xI7VnBWj54Ipk7OPqAHgfQgmyJns5ALvv7+8N+4xxiKuZpZazs7MNbGajWq2uY45v30OND3g/fHl5iY6Ojobuf91u1398fGxhzrF6HcEM6u463iSAoLarCpoBQG2CIef5ZjJFsL8wy/64SfDqmz8aGwOaAgmRd3BryeMIk7cxOdQMFxcXO9hEzUxJWYeFanZMKwU0sUmeOA0QaqprgNwAdnzvABzhmYu2Mf8LGK+pq873+D4wvw9HTNQSAP2U9WIimKWlpS8YWrMIcED7ycaMSUR+b1/KLkK7S/4A5htKGkMAOF1eXh40m82RKUHg0xD7CxSfEJrZtjwyJPoNptb2REqJSwBAquIk56eJ7qIE2BP3sFCKDlAKzBc8dU984Z38MLDOmqfv6enp3hQY9AxAU5unZiDRugUKodHsOvKtV4HKaAfxBRBty+j5+bljPgiQG6PpmAlEPuRnxFfSlCCQRLrUFN6dmt82f+vl7LQhkaY0QBIdMm5btLW9vb36pPlZqtWH1VJmxNE2IzYamXIUSxG7D8pMFr5NtW43a94YSErR/LGVHhj1zCcSVDug5OUxkPVTNAZSS5FO18yB9Dpwdzvu9xRInnQjUqTB/o2TXIZoh1aaDBbu4UuBxMQtO4Yt9swcCRHr1o4RWGr6WwokVL1uxysrK6GZI0FAAzt2c4MUSBX6hmXD3d8iMa14TQBe19/cgxP7K4CdK0BFkdwD/bJqBzorhtojMxv5Wa5EE9YY0f3od5AgI8zY3Kr5HPLzHLOmi4uL04ODg9akeYm6tbvByQ7MFARJRB+Zj438U2aeK8kIV4DFAjMFwSkzxNXKzmc+qp/1wdXvUyCZMkncDZjRfPSEizZ6ZgpCbbVhCzncUxVp6nTDof6wY6RODTNHghaSKCMlR0JuxBmo8aaZIznZepj6ph+oLh1DJZZ/Ojk5Q+jmDGNZEMT+3Y6RkRybOZB2VwD5fey7+0Lyx6H8UJN649NISttAHqOs/DUzM9e1Dui4TN0yDZEvu2tq3cySIxMk8zuWDfLosw2S10yaBSD43imAuWVKbleNtTd+tPYRF0yT4nFZurm52RGA1i+e2lo/iwr7k3ToKG37Or8r2/gs4NfRDTEKArwaRf9NBIn2HO2RJa6uPXK7ZFlE1aJLsSnd4qQLJxumtqIiPoVZEKJOF+C2BFBT9XICaTw1EM6G/A4JPTCs8j+89zE/QFfiPwBjSRLgrlkz3DLOb7KTIb45t07PtUlxsHHNw5hK18DTJ3aqu2Q8oS341A4XlPZJn88iuUCD4wGBVNckl7Q2WRg4ciVJR24TUDBmy8MmEA056TVIYAdXzRQTE1m2cG5RN/V00sLOHDVl1zNOOLSUa5Nw4jZFjrDrNVNA0vSKVQzQPssPZtkANlxdXY2KsimYy509mJDwv1lzcyVJtbAgKtMgyOrflCXYcpumgbVu8zbzC7NPDyXehmzQAAAAAElFTkSuQmCC',
  GOODS_ACTIVE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANUSURBVHgB7VhRUtswEN2V7WRo+8ER3BPgFqfTP5wTQE/QcIKSEyScADgB6QmAE8T8dYhp0xOQnqD5oyS2tytFTmJmwIpNWzqT9+O1pF09raTVSggVQJ63eWeLFgqxg0QeALq6ZkSIQ6T0ojb42oMKQCiJ28bblkXiiC1sPt4SRwDJYVmipQhOG/4RARwsSmgMIM6J6Icu2ELBHiV05x0hdJ2r6BBWxMoEp77fIe5sQYzaD3lHeRmxkxHlzo6dQdSGP0VQdQjidKZJo0QkzY0vw9GjOu8910qt/sKb6f4q070SwUmjccMec03J5Ugm9jcW5XodO9P4NQ6HYxNdAYaQ3lPkJIgOTclJyLYJpNnU8s63W6a6xgRtwl0lsPfK7MiNmc5Y9xqY6hkT5I3hyW8K+B1KgoAuVKeEW6Y6xgSzIIwpDKEsSMZEJbimKrlNIk+GuGZ/opRjXGEAfmIQTz/SuTNN2ssbyF5uM3UcDgccYEufLxWgHIKtqWO7/NdcFGvcbW/vocAz9UMQ8klxmdNH6GgxJMrXGXNA2OFPoLoguH+qbHH9nhQSguZGFIVStpe0vUysRVHzvvFJw+9ow5f1KOpCCdz5fpdJBFK+b0MuL/aeIihmgwi1/DzwUOAuJKhG9s7vzA0hfrz1/QBWBJ/hAevuzv9lwsG2i/QKCbLbz3hau4sSci2E/iokJTmOo3053LkVzoak7SJdUWQY9KKebRz6DPo0sBabphBMRrdV2c8JC1ksDYoG+ijBFBZHUmLH+/XBdQtSRVIZB1PgvO15bXB9wMlCc4lAAGUJUnZ2MqxEBGrNCNyZdUojMIe2g+6t57m/HLGXVSCmIyhLsB7HvYVxccpr5icLnmZ/AYbgNXyixcBy7Jt5TslTnlhpCGUJyq2v06R8COD16LxMumCIWhwfS518qbomtIvSNhsKINMkTjhD4CkWJFxel2EW5U2hY1xTbgi55gjScf1V2sPwujBpLSSoSM5G2YOK0AMLV9F5NifJQ1gTrIo1wapYE6yKNcGqWBOsiv+ToMll5m9hns3INMrSd4dJzT7lO2zpR6Iy0Jf6GYjm7z+5R46J7/eX7g//BgjD2lX0JvvNTbETxx9mNzcyev18WtBYPoc4L+Lcq8ZvCvtU91ZuUdAAAAAASUVORK5CYII=',
  GOODS_UN_ACTIVE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMCSURBVHgB7VhLctpAEG2E+e04AjcIOYHFCUJOEFjwWwVOAJzA9ooCFsInsH0C5BuQE0Q5QdhB8c1reQYPqhCNRiGxq3hVg0ZiuvWmp7unNQmKAcdx8ovFopJMJq9xW0QriL88tNlut3tqtVoTioEEGWIwGFQsy7pBNx8y1APRvilRI4LD4ZCJtZVH8/1+/4j2w1eaSHxAUy1KmEyvVqv1KSIiExyPx11YpCeJod85ZR1h5a5C9LbRaHToXATFCx1xy0tXAjkvRKYAmakkCZlqlOW2KAKENbTJMXgMj0V3LnTccHCRJrQJsvXo1Qp9HXIBknJp86vVqqIrq00QqeST6HomESlkfCsimGxdOW2CUFoU129kCM6LfOUo15WJ4oMF/gHBGZnDU3Xp4CiK2Xk3m81XzJRznLYj/yXMYdnHVCrVqVarc/nwSh2xXq+ncin/A/J4dwUcCuiX5MODBbE7lHF54D4GumjPqrRMMZilu91un8kAvGfLAOFMENDPflkW/3EKc7l/sCAeFjHI7zebzVJQOSbgE2RyEO6RAZCqeniHzf2gDnYvpJ+yuOUxrk+c3ghUv1MRSpBnxvvvQcCyvsASNkUEyyi51C84dHaUUIJw2gelOGD4e2sUkjyWZQIB2GbdYbJWmGLp1Bw4IHpPYjeANbqkCWUsl2V3uM6ETjtsomEWtGUHyrgKqeB6L5WTJuRYznMIwHY6nS797h2RCUKx6rg2+wxeci3uPdKH1FPg8mu5XJaV/zwyJZjL5Sb0WiY5SAM/6eXbg8k/kSbgGndChn3xu1JTsm6XTAly6Isy6SgFsD9mMpkeaSKbzd5ygg88ltW49yfZKwoBl0lYFpdefKWA5sosrwuR40oiIDjw5rw6p3JfJIKCpIfLhGJCTMyNIvNmdpJTuBCMiwvBuLgQjIsLwbi4EIyL90kwyvHYuaFWMy6a/+2AwtRBaWR8SGQC8VHv99Xzn6OzmdFoNI3yrXEOoLCd1ev1j/L+aIlxcPNZ/XL7x+AKuw8OR6cavwDEzosM/UP+NgAAAABJRU5ErkJggg==',
  HOME_UN_ACTIVE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAoCAYAAABjPNNTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANxSURBVHgB7VhtUuJAEO3Jl6vrlhyBvUGQwPpTT7B6AuUEwgnEE6gn0D2BegL5uSVQxBPIEdgqq1CSmd7uhAQUVgMJWNb6qqBmkprMm+43Pd0D8AEgIEMMSiVbUyrvSemuum4XMoIGGcErOScA2FGauNRNo/P4w6lCRkhtyb5t53XTvCSC9sTHBdTN29YxpEQqSz7Ytk0Eb2KCCA0JqgICu0EXof5Udi55IZACc1uS9HdINE5HT/DMarYDF/e3yLpKvwEU+eE0Xel5O/PqdC5LDvUXE1QItYggY/W32zUHskAvzsInmGedPhWLuzAHZrJkqD/jnJrb4WjsDlDurTdd919jnhynTto8iiecQ6eJSbL+rHCD5IcjXan5e2y1t8ayBYUmeHE57qOAK2vgV4Tr9iABErnbL5f3LcO4iQmS/sw1fycJQcZKu30ldb8QbSiBsOuZZifphnrTkqw/BIj1xvr70mqdwhxA284NDOOcXD7UpuiiUjVeBMxDkj/omQa5d6g/wJ5EsbfaajUgJWbV6VSSwwA9ci+5SWoysXuToF/aPNBBoygR6pTmujA9WZum0wmSrD+l1Cm9CUUO+Mv6KquikUzkMxFNGE+fkfQc54h2Xj3qU/t45bZVhwUiIOpTWBORrIgoYmVcVmI6QexRu7Jy+7qgs8RLnUqEnYhoHIKIVLiDWX+6LCyTIGOl1aorVLWorwuxH7Un4yRqoEvj/IFyQ1giOBfQhPZz9ET9iVojSyLE5yz9bRsC67BUBLnAdtQbgHYRtWOSobmBzR3sYg1hA94DfNySHtebzTgfeObu4CRBcOEdgQquXx4YmZUPi8Qnyazwf5Dsb23lX3vP2RT/IAVSkXx0Nqu69O8HJWdqAssB2jOMe05w0xA1IAUEaNHEVNoa91S+XoGCO03ABh0OB2THXJgdYCpLpiLJB8CgWMyBJg4D0lQWEKldDFcQgnMBJSqWO3+ql1qTVrtdpfrlO+edo4MAe3xRwAmDuSYLabP5VJaMMMzYD2BB+IyTWeFjkhQs+hCpwsYsGI+xOEwVxzGxcRSIO4oeXLzbXpnqHhTXUtczrxRjAr6fRyFOAnpM0vAnypaJkja4FLD0zqjMXCZG14fjmHQ3BV2+CIjubZaH6QQDTq8N42LMpIt6hbgwfWpC9KxvsrGIy4el4i+vmZa53pPB0QAAAABJRU5ErkJggg==',
  HOME_ACTIVE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAoCAYAAABjPNNTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALmSURBVHgB7VjbcRoxFNXy/jMlkA5wB0kFsSswfDC8PmIq8LqCkA+G4TGDXQG4gtABuAJTAvnlmXM2kkdmAS+r3WU88ZnZQdI+dLj36OpeCfEBYIkA0Wq18olEIrfZbKbVanUmAkJMBIROp/MTBCdoDmOx2AT9WxEQjC3Zbrdz8Xh8uN1u87v3QNYulUr3whBGJKV7h2jm2AfRMa5HkLtTY8AI7m+YuN83yW63+wOEmqqP9q9KpeK4mNYF0d8a0RmIfvNL1JcmqT+dINBQBAmSSaVSlyQuh3JSp1fCB06ypNTfAJN/lUOz1Wp1Xa/Xp0fesaX7HfjRqWeSu/qzLGu6Xq+vvbhQWnCAKyuHRrB0EZgLD/BEst/v34BQU01CN6bTadvrJISJTt8lSf3hR495jXK53BQ+MBgMsovFghZV2pzJ742EH5L84HK5HGr6m+Of071jYYhTdWod+EigIeTAHAXMQS85EoLGH5LJZGOfhFwkd/UHco+ZTOb2FP2dQNSTMd6Q7PV6d3jIVn207/GCLULEvrCGeYu6rKwDBGm14nuCDhK7OpUWHbMd0wbVCuY/uYySICE91lB9WPdGtfduizQ/g7eIEMwFsHi+qz4M9Ue1dUu+7rPUB4jaIkIwF9B0KbB4H1T7lSTNjRs0t1rFF+IM4HZLPer5wBt312q1Jh8SZwQM9bS7YQRWPoSJT5JB4f8gyW3t2H1mU7yEAYxIsrbGVvaCQDzZR5YBGvnjC66JCdGEMADiWRYkGYjzJAvSLF+fUWZc4LeAcUXsfJbkBqBVhMQVkwSZByhiTvplkuoZa5KlLEh8Yd6JrtoI5jwo4A7G0tY0mzdyt4JMUgsiJHzGyaDwYUk6qxDZkFHYOAV6jEV0cEUB18LBinzGgyze86x7EIif9r0YIFiI8QDM6SBKuMoWV0krTxl4YpsTEUM/PtThcjeDLoOv+HcEEhkOESSOngVpB/Wh6ZNSQsAfh3H4ECn+AjgBtD7TKZMhAAAAAElFTkSuQmCC',
}
function toLive(data: { id: string; pushAddress: string }) {
  // @ts-ignore

  getApp().globalData.groupID = data.id
  // 推流地址过长 为了安全考虑利用本地传输 immediately 立即开播
  storage.set(CREATE_LIVE_ROOM_STORAGE_KEY, { ...data, immediately: true })
  uni.redirectTo({ url: `${viewLivePageUrl}` })
}
function toUserLive(data: { id: string; pullAddress: string; status: Joint_Live_List_Status }) {
  // @ts-ignore

  getApp().globalData.groupID = data.id
  // 推流地址过长 为了安全考虑利用本地传输 immediately 立即开播
  storage.set(USER_LIVE_ROOM_STORAGE_KEY, { ...data, immediately: true })
  uni.navigateTo({ url: `${viewLivePageUserUrl}` })
}
function getUserLiveStorageSyncFn() {
  return storage.get(USER_LIVE_ROOM_STORAGE_KEY) || {}
}

// pullAddress 是一个逗号字符串拼接的拉流地址 顺序为 RTMP地址  FLV地址  HLS地址  WebRTC地址
// video 组件微信小程序仅支持 HLS地址 APP使用 FLV地址
function formatPullAddress(pullAddress: string) {
  let index = 1
  // #ifdef APP-PLUS
  // #endif
  // #ifdef MP-WEIXIN
  index = 2
  // #endif
  return pullAddress.split(',')[index]
}
export {
  viewLivePageUrl,
  TABBAR_URL,
  CREATE_LIVE_ROOM_STORAGE_KEY,
  USER_LIVE_ROOM_STORAGE_KEY,
  viewLivePageUserUrl,
  toLive,
  toUserLive,
  getUserLiveStorageSyncFn,
  formatPullAddress,
}
