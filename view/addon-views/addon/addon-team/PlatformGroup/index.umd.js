(function(e,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/components/PageManage.vue"),require("@/utils/http"),require("decimal.js"),require("vue-router"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","@/components/PageManage.vue","@/utils/http","decimal.js","vue-router","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue"],_):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformGroup=_(e.PlatformGroupContext.Vue,e.PlatformGroupContext.VueUse,e.PlatformGroupContext.SchemaForm,e.PlatformGroupContext.PageManageTwo,e.PlatformGroupContext.UtilsHttp,e.PlatformGroupContext.Decimal,e.PlatformGroupContext.VueRouter,e.PlatformGroupContext.ElementPlus,e.PlatformGroupContext.ElTableEmpty))})(this,function(e,_,O,z,V,te,R,p,T){"use strict";var I=document.createElement("style");I.textContent=`*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.visible{visibility:visible}.fixed{position:fixed}.resize{resize:both}[resize~=none]{resize:none}.underline{text-decoration-line:underline}.blur{--un-blur:blur(8px);filter:var(--un-blur) var(--un-brightness) var(--un-contrast) var(--un-drop-shadow) var(--un-grayscale) var(--un-hue-rotate) var(--un-invert) var(--un-saturate) var(--un-sepia)}[data-v-fc9295b7] .el-dialog__body{padding-bottom:0!important}[data-v-fc9295b7] .el-link+.el-link{margin-left:10px}
`,document.head.appendChild(I);const P=e.defineComponent({__name:"head-search-p",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchDelBtn:{type:Boolean,default:!0},selectOptions:{type:Object,default(){return{}}}},emits:["update:modelValue","batchDel","search"],setup(l,{emit:m}){const s=l,y=[{label:"活动名称",labelWidth:75,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"OPENING",label:"未开始"},{value:"OPEN",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"SHOP_OFF_SHELF",label:"已下架"},{value:"VIOLATION",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],d=m,u=_.useVModel(s,"modelValue",d),k=()=>{Object.keys(u.value).forEach(N=>u.value[N]=""),d("search")};return(N,a)=>{const b=e.resolveComponent("el-button"),f=e.resolveComponent("el-config-provider");return e.openBlock(),e.createBlock(f,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(O,{modelValue:e.unref(u),"onUpdate:modelValue":a[1]||(a[1]=x=>e.isRef(u)?u.value=x:null),columns:y,style:{"margin-bottom":"30px"},onSearchHandle:a[2]||(a[2]=x=>d("search")),onHandleReset:k},{otherOperations:e.withCtx(()=>[l.showBatchDelBtn?(e.openBlock(),e.createBlock(b,{key:0,round:"",plain:"",onClick:a[0]||(a[0]=x=>d("batchDel"))},{default:e.withCtx(()=>a[3]||(a[3]=[e.createTextVNode("批量移除")])),_:1})):e.createCommentVNode("",!0)]),_:1},8,["modelValue"])]),_:1})}}}),v=l=>V.http.get({url:"addon-team/team/activity",params:l},{isMock:!1}),B=l=>V.http.post({url:"addon-team/team/activity/delete/batch",data:l}),D=l=>V.http.post({url:"addon-team/team/activity/platform/violate",data:l}),L=l=>V.http.get({url:`addon-team/team/activity/illegal/${l}/reason`}),ne="",G={class:"q_plugin_container"},F={class:"table_container"},A={class:"goods"},M={class:"dialog-footer"},H=e.defineComponent({__name:"PlatformGroup",setup(l){const m=e.ref({keywords:"",status:""}),s=e.ref({size:10,current:1}),g=e.ref(0),y=R.useRouter(),d=e.ref([]),u=e.ref([]),k={OPENING:"未开始",PREHEAT:"预热中",OPEN:"进行中",FINISHED:"已结束",VIOLATION:"违规下架",SHOP_OFF_SHELF:"已下架"},N={COMMON:"普通拼团",STAIRS:"阶梯拼团"},a=e.ref({shopId:"",teamActivityId:"",violationReason:""}),b=e.ref(),f=e.ref(!1),x=o=>{f.value=!0,a.value.shopId=o.shopId,a.value.teamActivityId=o.id},q=()=>{b.value.resetFields()},j=()=>{b.value.validate(async(o,n)=>{if(o){const{code:r,msg:c}=await D(a.value);if(r!==200){p.ElMessage.error(c);return}p.ElMessage.success("下架成功");const i=d.value.find(C=>C.id===a.value.teamActivityId);i&&(i.status="VIOLATION"),f.value=!1}else console.log("error submit!",n)})},$=async()=>{if(!u.value.length){p.ElMessage.info("请选择需要删除的活动");return}if(!await p.ElMessageBox.confirm("确定删除活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=u.value.map(i=>({shopId:i.shopId,activityId:i.id})),{code:r,data:c}=await B(n);if(r!==200){p.ElMessage.error("删除失败");return}p.ElMessage.success("删除成功"),h()},U=o=>{y.push({name:"groupDetail",query:{activityId:o.id,shopId:o.shopId}})},w=e.ref(""),W=async o=>{if(o.rejectReason&&w)return;const{data:n}=await L(o.id);w.value=n||"暂无违规原因",o.rejectReason=!0},J=()=>{h()};async function h(){const{status:o,keywords:n}=m.value,r={...s.value,status:o,keyword:n},{code:c,data:i}=await v(r);if(c!==200)return p.ElMessage.error("获取活动列表失败");d.value=i.records.map(C=>({...C,rejectReason:!1})),s.value.current=i.current,s.value.size=i.size,g.value=i.total}const K=o=>{s.value.size=o,h()},Q=o=>{s.value.current=o,h()};return e.onBeforeMount(()=>{h()}),(o,n)=>{const r=e.resolveComponent("el-table-column"),c=e.resolveComponent("el-link"),i=e.resolveComponent("el-tooltip"),C=e.resolveComponent("el-table"),X=e.resolveComponent("el-input"),Y=e.resolveComponent("el-form-item"),Z=e.resolveComponent("el-form"),S=e.resolveComponent("el-button"),ee=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",G,[e.createVNode(P,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=t=>m.value=t),showBatchDelBtn:!1,onBatchDel:$,onSearch:J},null,8,["modelValue"]),e.createElementVNode("div",F,[e.createVNode(C,{ref:"multipleTableRef",data:d.value,"header-row-style":{fontSize:"14px",color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{fontSize:"14px",color:"#333333"},onSelectionChange:n[1]||(n[1]=t=>u.value=t)},{empty:e.withCtx(()=>[e.createVNode(T,{imageIndex:"7"})]),default:e.withCtx(()=>[e.createVNode(r,{label:"店铺名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",A,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(r,{label:"活动名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(r,{label:"拼团模式",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(N[t.mode]),1)]),_:1}),e.createVNode(r,{label:"状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:["VIOLATION"].includes(t.status)?"#F54319":["FINISHED","SHOP_OFF_SHELF"].includes(t.status)?"#999":"#333"})},e.toDisplayString(k[t.status]),5)]),_:1}),e.createVNode(r,{label:"活动时间",width:"210"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(r,{label:"活动商品",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.productNum),1)]),_:1}),e.createVNode(r,{label:"支付单数",align:"center",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.orders),1)]),_:1}),e.createVNode(r,{label:"操作",align:"right",width:"150px",fixed:"right"},{default:e.withCtx(({row:t})=>[e.createVNode(c,{underline:!1,type:"primary",size:"small",onClick:E=>U(t)},{default:e.withCtx(()=>n[5]||(n[5]=[e.createTextVNode(" 查看 ")])),_:2},1032,["onClick"]),["VIOLATION"].includes(t.status)?(e.openBlock(),e.createBlock(i,{key:0,visible:t.rejectReason},{content:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(w.value),1)]),default:e.withCtx(()=>[e.createVNode(c,{type:"primary",size:"small",underline:!1,onMouseenter:E=>W(t),onMouseleave:E=>t.rejectReason=!1},{default:e.withCtx(()=>n[6]||(n[6]=[e.createTextVNode(" 违规原因 ")])),_:2},1032,["onMouseenter","onMouseleave"])]),_:2},1032,["visible"])):e.createCommentVNode("",!0),["OPENING","PREHEAT","OPEN"].includes(t.status)?(e.openBlock(),e.createBlock(c,{key:1,underline:!1,type:"danger",size:"small",onClick:E=>x(t)},{default:e.withCtx(()=>n[7]||(n[7]=[e.createTextVNode(" 违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(z,{class:"pagination","page-size":s.value.size,"page-num":s.value.current,"load-init":!0,total:g.value,onHandleSizeChange:K,onHandleCurrentChange:Q,onReload:h},null,8,["page-size","page-num","total"]),e.createVNode(ee,{modelValue:f.value,"onUpdate:modelValue":n[4]||(n[4]=t=>f.value=t),title:"违规下架",width:"500",center:"",onClose:q},{footer:e.withCtx(()=>[e.createElementVNode("div",M,[e.createVNode(S,{onClick:n[3]||(n[3]=t=>f.value=!1)},{default:e.withCtx(()=>n[8]||(n[8]=[e.createTextVNode("取消")])),_:1}),e.createVNode(S,{type:"primary",onClick:j},{default:e.withCtx(()=>n[9]||(n[9]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(Z,{ref_key:"illegalReasonFormRef",ref:b,model:a.value,rules:{violationReason:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(Y,{label:"",prop:"violationReason"},{default:e.withCtx(()=>[e.createVNode(X,{modelValue:a.value.violationReason,"onUpdate:modelValue":n[2]||(n[2]=t=>a.value.violationReason=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),oe="";return((l,m)=>{const s=l.__vccOpts||l;for(const[g,y]of m)s[g]=y;return s})(H,[["__scopeId","data-v-fc9295b7"]])});
