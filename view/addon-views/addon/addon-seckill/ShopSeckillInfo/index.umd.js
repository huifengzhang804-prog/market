(function(e,N){typeof exports=="object"&&typeof module<"u"?module.exports=N(require("vue"),require("vue-router"),require("element-plus"),require("@/composables/useConvert"),require("decimal.js"),require("@/apis/http"),require("@/components/q-choose-goods-popup/q-choose-goods-popup.vue"),require("@/components/QSafeBtn/QSafeBtn.vue")):typeof define=="function"&&define.amd?define(["vue","vue-router","element-plus","@/composables/useConvert","decimal.js","@/apis/http","@/components/q-choose-goods-popup/q-choose-goods-popup.vue","@/components/QSafeBtn/QSafeBtn.vue"],N):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopSeckillInfo=N(e.ShopSeckillInfoContext.Vue,e.ShopSeckillInfoContext.VueRouter,e.ShopSeckillInfoContext.ElementPlus,e.ShopSeckillInfoContext.UseConvert,e.ShopSeckillInfoContext.Decimal,e.ShopSeckillInfoContext.Request,e.ShopSeckillInfoContext.QChooseGoodsPopup,e.ShopSeckillInfoContext.QSafeBtn))})(this,function(e,N,g,K,Ie,q,O,G){"use strict";var A=document.createElement("style");A.textContent=`@charset "UTF-8";*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.relative{position:relative}.sticky{position:sticky}[top~=\"30vh\"]{top:30vh}.h1{height:.25rem}.flex{display:flex}.transform{transform:translate(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotate(var(--un-rotate-z)) skew(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}.border,[border=\"\"]{border-width:1px}.underline{text-decoration-line:underline}.blur{--un-blur:blur(8px);filter:var(--un-blur) var(--un-brightness) var(--un-contrast) var(--un-drop-shadow) var(--un-grayscale) var(--un-hue-rotate) var(--un-invert) var(--un-saturate) var(--un-sepia)}.disabled{opacity:.5;cursor:not-allowed}.title[data-v-5c286665]{font-size:14px;color:#323233;font-weight:700;margin-bottom:30px;text-align:center}.msg[data-v-5c286665]{padding-left:15px;font-size:12px;color:#c4c4c4}.position_container[data-v-5c286665]{scrollbar-width:none;-ms-overflow-style:none;height:100%;position:relative;display:flex;flex-direction:column;overflow-y:scroll;padding:30px 40px 0}.position_container[data-v-5c286665]::-webkit-scrollbar{display:none}.nav-button[data-v-5c286665]{position:sticky;bottom:0;padding:15px 0;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:999;margin-top:auto;width:calc(100% + 80px);transform:translate(-40px);display:flex;justify-content:center}.goods-list[data-v-5c286665]{width:100%;height:500px;overflow-x:scroll}.goods-list__info[data-v-5c286665]{width:100%;display:flex}.goods-list__goods-list__info-name[data-v-5c286665]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-5c286665]{width:260px;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-5c286665]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-5c286665]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.table-msg[data-v-5c286665]{font-size:12px;color:#838383}.flex[data-v-5c286665]{display:flex;justify-content:space-between;align-items:center}
`,document.head.appendChild(A);let S=[],B=0;const F=p=>{S=[],B=0;for(let c=0;c<p.length;c++)c===0?(S.push(1),B=0):p[c].productId===p[c-1].productId?(S[B]+=1,S.push(0)):(S.push(1),B=c)},X=({row:p,column:c,rowIndex:x,columnIndex:T})=>{if(T===0){const y=S[x],U=y>0?1:0;return{rowspan:y,colspan:U}}},L="addon-seckill/seckill/activity",Z=p=>q.post({url:L+"/round",data:p}),W=p=>q.post({url:L,data:p}),H=p=>q.post({url:L+"/detail",data:p}),ve="",J={class:"position_container"},ee={class:"title"},te={key:0},oe={class:"goods-list"},ne={class:"goods-list__info"},ae={style:{width:"60px",height:"60px"}},le={class:"goods-list__goods-list__info-name"},se={class:"goods-list__goods-list__info-name--name"},re={class:"table-msg"},ie={key:0,class:"table-msg"},de={key:0,class:"table-msg"},ce={key:0,class:"nav-button"},ue={key:1,class:"nav-button"},pe={class:"flex"},me={class:"dialog-footer"},fe=e.defineComponent({__name:"ShopSeckillInfo",setup(p){const c=e.ref(!1),x=N.useRouter(),T=N.useRoute().query,y=T.secKillId,U=T.shopId,s=!!y,{mulTenThousand:ke,divTenThousand:ge}=K(),R=e.ref(),D=e.reactive({maxPrice:"",minPrice:"",activity:{endTime:"",startTime:""},keyword:"",categoryFirstId:""}),z=e.ref(new Map),M=e.ref(!1),l=e.ref({name:"",date:"",round:null,payTimeout:15,stackable:{vip:!1,coupon:!1,full:!1},products:[],startTime:"",endTime:""}),he=e.reactive({name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],date:[{required:!1,message:"请选择活动日期",trigger:["blur","change"]}],round:[{required:!1,message:"请选择活动时段",trigger:["blur","change"]}],payTimeout:[{required:!0,message:"请输入订单关闭时间",trigger:"blur"}]}),m=e.ref([]);e.onMounted(()=>{be()}),e.watch(()=>l.value.date,n=>{s||(l.value.round=null,Z({date:n}).then(({data:t})=>{const r=new Map;t.forEach(a=>{r.set(a.round,a)}),z.value=r}))}),e.watch(()=>m.value,n=>F(n));const xe=async n=>{c.value=!0;try{if(s){x.back();return}if(!n||(await n.validate(),!_e()))return;const t=new Map,r=[];m.value.forEach(b=>{let i=t.get(b.productId);i||(i={id:b.productId,skus:[]},t.set(i.id,i),r.push(i));const f=b.sku;i.skus.push({id:f.skuId,stock:f.seckillStock,specs:(f.skuName||[]).join(","),price:ke(f.seckillPrice)})});const a=l.value;a.products=r;const{code:u,msg:V}=await W(a);if(u!==200){g.ElMessage.error(V),c.value=!1;return}c.value=!1,g.ElMessage.success("保存成功"),x.push({path:"/marketingApp/secondsKill",query:{flag:!0}})}finally{c.value=!1}};function _e(){return l.value.payTimeout?m.value.length?m.value.every(n=>n.sku.seckillPrice)?m.value.every(n=>n.sku.seckillStock)?!0:(g.ElMessage.info("请输入秒杀库存"),!1):(g.ElMessage.info("请输入秒杀价"),!1):(g.ElMessage.info("请选择适用商品"),!1):(g.ElMessage.info("订单关闭时间3-360分钟"),!1)}async function be(){if(!y)return;const{code:n,data:t}=await H({shopId:U,activityId:y});if(n!==200){g.ElMessage.error("获取秒杀信息失败");return}const{name:r,date:a,startTime:u,endTime:V,payTimeout:b,stackable:i,products:f}=t;l.value={name:r,date:a,round:0,payTimeout:b,stackable:i,products:f,startTime:u,endTime:V};const w=[];f.forEach(C=>{var v;(v=C.skus)==null||v.forEach(k=>{var d;w.push({productId:C.id,productName:C.name,productPic:C.image,sku:{skuId:k.id,skuName:(d=k.specs)==null?void 0:d.split(","),seckillPrice:E(k.price),seckillStock:k.stock,actualPaidPrice:""}})})}),m.value=w,console.log(w)}const ye=n=>{var r;const t=[];for(let a=0;a<n.tempGoods.length;a++){const u=n.tempGoods[a],{productId:V,productName:b,pic:i,shopId:f,stocks:w,salePrices:C,stockTypes:v,specs:k}=u;if((r=u==null?void 0:u.skuIds)!=null&&r.length)for(let d=0;d<u.skuIds.length;d++){const $=u.skuIds[d],j=C[d],P=w[d],o=v[d],h=k[d].split(" ");(P>0&&o==="LIMITED"||o==="UNLIMITED")&&t.push({sku:{seckillPrice:.01,seckillStock:1,seckillLimit:0,actualPaidPrice:0,productId:V,skuId:$,skuPrice:j,skuStock:P,stockType:o,skuName:h},productId:V,productName:b,productPic:i,shopId:f})}}if((t==null?void 0:t.length)===0)return g.ElMessage.error("请至少选择一个存在库存的商品");m.value=t,M.value=!1},Ve=()=>{const n=l.value;if(!n.date||n.round===null)return g.ElMessage.warning("请选择活动时间");const t=z.value.get(n.round),r=n.date;D.activity.startTime=`${r} ${t.startTime}`,D.activity.endTime=`${r} ${t.endTime}`,M.value=!0},Y=(n,t)=>n==="UNLIMITED"?1e5:t,I=e.ref(!1),Q=e.ref("0"),_=e.ref({stock:1,price:.01}),we=()=>{_.value={stock:1,price:.01},I.value=!1},E=n=>ge(n).toNumber(),Ce=()=>{m.value.forEach(n=>{if(n.productId===Q.value){const{stockType:t,skuPrice:r,skuStock:a}=n.sku;n.sku.seckillStock=_.value.stock>Y(t,a)?Y(t,a):_.value.stock,n.sku.seckillPrice=_.value.price>E(r)?E(r):_.value.price}}),I.value=!1},Ne=n=>{Q.value=n.productId,I.value=!0},Se=async(n,t)=>{if(await g.ElMessageBox.confirm("确定移除该商品?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})){const a=m.value.findIndex(u=>n===u.productId&&t===u.sku.skuId);a!==-1&&(m.value.splice(a,1),F(m.value))}},Te=n=>new Date(n).toLocaleDateString()===new Date().toLocaleDateString()?!1:new Date(n).getTime()<new Date().getTime();return(n,t)=>{const r=e.resolveComponent("el-input"),a=e.resolveComponent("el-form-item"),u=e.resolveComponent("el-date-picker"),V=e.resolveComponent("el-option"),b=e.resolveComponent("el-select"),i=e.resolveComponent("el-input-number"),f=e.resolveComponent("el-checkbox"),w=e.resolveComponent("el-link"),C=e.resolveComponent("el-row"),v=e.resolveComponent("el-image"),k=e.resolveComponent("el-button"),d=e.resolveComponent("el-table-column"),$=e.resolveComponent("el-table"),j=e.resolveComponent("el-form"),P=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("h1",ee,e.toDisplayString(s?"基本信息":"新增秒杀"),1),e.createVNode(j,{ref_key:"ruleFormRef",ref:R,model:l.value,rules:he,"label-width":"auto",class:"f1"},{default:e.withCtx(()=>[e.createVNode(a,{label:"活动名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.name=o),modelModifiers:{trim:!0},disabled:s,maxlength:10,minlength:3,placeholder:"请输入活动名称",style:{width:"60%"}},null,8,["modelValue"]),t[16]||(t[16]=e.createElementVNode("span",{class:"msg"},"活动名称不超过10个字",-1))]),_:1}),e.createVNode(a,{label:"活动日期",prop:"date",required:""},{default:e.withCtx(()=>[e.createVNode(u,{modelValue:l.value.date,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.date=o),disabled:s,"disabled-date":Te,format:"YYYY-MM-DD",placeholder:"请选择日期",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e.createVNode(a,{label:"活动时段",prop:"round",required:""},{default:e.withCtx(()=>[s?(e.openBlock(),e.createElementBlock("p",te,e.toDisplayString(l.value.startTime+" - "+l.value.endTime),1)):(e.openBlock(),e.createBlock(b,{key:1,modelValue:l.value.round,"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.round=o),placeholder:"请选择选择时段",style:{width:"240px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(z.value.values(),o=>(e.openBlock(),e.createBlock(V,{key:o.round,label:o.startTime+" - "+o.endTime,value:o.round},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1}),e.createVNode(a,{label:"未支付订单",prop:"payTimeout",required:""},{default:e.withCtx(()=>[e.createVNode(i,{modelValue:l.value.payTimeout,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.payTimeout=o),controls:!1,disabled:s,max:360,min:3,style:{width:"25%"}},null,8,["modelValue"]),t[17]||(t[17]=e.createElementVNode("span",{class:"msg"},[e.createElementVNode("span",{style:{color:"#000","margin-right":"20px"}},"分钟后关闭订单"),e.createTextVNode(" 可输入3-360分钟")],-1))]),_:1}),e.createVNode(a,{label:"优惠叠加",prop:"stackable"},{default:e.withCtx(()=>[e.createVNode(f,{modelValue:l.value.stackable.vip,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.stackable.vip=o),disabled:s,label:"会员价"},null,8,["modelValue"]),e.createVNode(f,{modelValue:l.value.stackable.coupon,"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.stackable.coupon=o),disabled:s,label:"优惠券"},null,8,["modelValue"]),e.createVNode(f,{modelValue:l.value.stackable.full,"onUpdate:modelValue":t[6]||(t[6]=o=>l.value.stackable.full=o),disabled:s,label:"满减"},null,8,["modelValue"]),t[18]||(t[18]=e.createElementVNode("span",{class:"msg"},"买家下单时仅可用与勾选的活动类型同时使用",-1))]),_:1}),e.createVNode(a,{label:"适用商品",required:""},{default:e.withCtx(()=>[e.createVNode(C,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(w,{disabled:s,underline:!1,type:"primary",onClick:Ve},{default:e.withCtx(()=>t[19]||(t[19]=[e.createTextVNode("选择商品 ")])),_:1})]),_:1}),e.withDirectives(e.createElementVNode("div",oe,[e.createVNode($,{"cell-style":{height:"80px"},data:m.value,"header-cell-style":{fontSize:"14px",color:"#606266",background:"#f2f2f2",height:"54px",fontWeight:"normal"},"span-method":e.unref(X),border:"",height:"100%"},{default:e.withCtx(()=>[e.createVNode(d,{label:"商品信息"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",ne,[e.createElementVNode("div",ae,[e.createVNode(v,{"preview-src-list":[o.productPic],"preview-teleported":!0,src:o.productPic,fit:"cover",style:{width:"60px",height:"60px"}},null,8,["preview-src-list","src"])]),e.createElementVNode("div",le,[e.withDirectives(e.createVNode(k,{disabled:s,link:"",type:"primary",onClick:h=>Ne(o)},{default:e.withCtx(()=>t[20]||(t[20]=[e.createTextVNode("批量设置 ")])),_:2},1032,["onClick"]),[[e.vShow,!s]]),e.createElementVNode("div",se,e.toDisplayString(o.productName),1)])])]),_:1}),e.createVNode(d,{align:"center",label:"规格",width:"100px"},{default:e.withCtx(({row:o})=>{var h;return[e.createElementVNode("div",re,e.toDisplayString(((h=o.sku.skuName)==null?void 0:h.join(""))||"-"),1)]}),_:1}),e.createVNode(d,{align:"center",label:"秒杀价（元）",width:"120px"},{default:e.withCtx(({row:o})=>[e.createVNode(i,{modelValue:o.sku.seckillPrice,"onUpdate:modelValue":h=>o.sku.seckillPrice=h,controls:!1,disabled:s,max:o.sku.skuPrice&&E(o.sku.skuPrice),min:.01,precision:2,style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue","max"]),s?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ie,"销售价：￥"+e.toDisplayString(E(o.sku.skuPrice)),1))]),_:1}),e.createVNode(d,{align:"center",label:"秒杀库存",width:"120px"},{default:e.withCtx(({row:o})=>[e.createVNode(i,{modelValue:o.sku.seckillStock,"onUpdate:modelValue":h=>o.sku.seckillStock=h,controls:!1,disabled:s,max:o.sku.stockType&&Y(o.sku.stockType,o.sku.skuStock),min:0,precision:0,style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue","max"]),s?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",de,e.toDisplayString(o.sku.stockType==="UNLIMITED"?"无限库存":`${"库存"+o.sku.skuStock}`),1))]),_:1}),e.createVNode(d,{label:"操作",width:"80px"},{default:e.withCtx(({row:o})=>[e.createVNode(w,{disabled:s,underline:!1,type:"primary",onClick:h=>Se(o.productId,o.sku.skuId)},{default:e.withCtx(()=>t[21]||(t[21]=[e.createTextVNode(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","span-method"])],512),[[e.vShow,m.value.length]])]),_:1})]),_:1},8,["model","rules"]),s?(e.openBlock(),e.createElementBlock("div",ce,[e.createVNode(k,{plain:"",round:"",onClick:t[7]||(t[7]=o=>e.unref(x).back())},{default:e.withCtx(()=>t[22]||(t[22]=[e.createTextVNode("返回")])),_:1})])):(e.openBlock(),e.createElementBlock("div",ue,[e.createVNode(k,{plain:"",round:"",onClick:t[8]||(t[8]=o=>e.unref(x).back())},{default:e.withCtx(()=>t[23]||(t[23]=[e.createTextVNode("取消")])),_:1}),e.createVNode(G,{loading:c.value,round:"",type:"primary",onClick:t[9]||(t[9]=o=>xe(R.value))},{default:e.withCtx(()=>t[24]||(t[24]=[e.createTextVNode("确定 ")])),_:1},8,["loading"])])),e.createVNode(O,{modelValue:M.value,"onUpdate:modelValue":t[10]||(t[10]=o=>M.value=o),searchParam:D,"onUpdate:searchParam":t[11]||(t[11]=o=>D=o),pointGoodsList:m.value,searchConsignmentProduct:!0,onOnConfirm:ye},null,8,["modelValue","searchParam","pointGoodsList"]),e.createVNode(P,{modelValue:I.value,"onUpdate:modelValue":t[15]||(t[15]=o=>I.value=o),center:"","destroy-on-close":"",title:"批量设置",top:"30vh",width:"500",onClose:we},{footer:e.withCtx(()=>[e.createElementVNode("div",me,[e.createVNode(k,{onClick:t[14]||(t[14]=o=>I.value=!1)},{default:e.withCtx(()=>t[27]||(t[27]=[e.createTextVNode("取消")])),_:1}),e.createVNode(G,{type:"primary",onClick:Ce},{default:e.withCtx(()=>t[28]||(t[28]=[e.createTextVNode(" 确定")])),_:1})])]),default:e.withCtx(()=>[e.createElementVNode("div",pe,[t[25]||(t[25]=e.createTextVNode(" 秒杀价 ")),e.createVNode(i,{modelValue:_.value.price,"onUpdate:modelValue":t[12]||(t[12]=o=>_.value.price=o),controls:!1,min:.01,precision:2,onChange:n.handleChange},null,8,["modelValue","onChange"]),t[26]||(t[26]=e.createTextVNode(" 库存 ")),e.createVNode(i,{modelValue:_.value.stock,"onUpdate:modelValue":t[13]||(t[13]=o=>_.value.stock=o),controls:!1,min:0,precision:0,onChange:n.handleChange},null,8,["modelValue","onChange"])])]),_:1},8,["modelValue"])])}}}),Ee="";return((p,c)=>{const x=p.__vccOpts||p;for(const[T,y]of c)x[T]=y;return x})(fe,[["__scopeId","data-v-5c286665"]])});
