(function(e,x){typeof exports=="object"&&typeof module<"u"?module.exports=x(require("vue"),require("@/apis/http"),require("element-plus"),require("decimal.js"),require("@/composables/useConvert"),require("@/store/modules/shopInfo"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","element-plus","decimal.js","@/composables/useConvert","@/store/modules/shopInfo","vue-router"],x):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopEditConsignmentCommodity=x(e.ShopEditConsignmentCommodityContext.Vue,e.ShopEditConsignmentCommodityContext.Request,e.ShopEditConsignmentCommodityContext.ElementPlus,e.ShopEditConsignmentCommodityContext.Decimal,e.ShopEditConsignmentCommodityContext.UseConvert,e.ShopEditConsignmentCommodityContext.ShopInfoStore,e.ShopEditConsignmentCommodityContext.VueRouter))})(this,function(e,x,k,d,oe,re,j){"use strict";var W=document.createElement("style");W.textContent=`@charset "UTF-8";.distribution[data-v-29b2afa6]{overflow-y:scroll}.distribution__form[data-v-29b2afa6]{padding:0 16px}.distribution__title[data-v-29b2afa6]{font-weight:700;padding:15px 0}.distribution__container[data-v-29b2afa6]{padding:0 20px}.distribution__btns[data-v-29b2afa6]{margin-top:auto;display:flex;justify-content:center;align-items:center;position:sticky;bottom:0;padding:10px 0;box-shadow:0 0 10px #d5d5d5;z-index:9}
`,document.head.appendChild(W);var $=(n=>(n.UNLIMITED="不限购",n.PRODUCT_LIMITED="限购",n.SKU_LIMITED="规格限购",n))($||{});const ie=()=>x.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),le=n=>x.get({url:"gruul-mall-goods/goods/product/category",params:n}),se=()=>x.get({url:"gruul-mall-goods/consignment/config"}),ae=n=>x.get({url:`gruul-mall-goods/manager/product/consignment/${n}`}),de=n=>x.post({url:"gruul-mall-goods/manager/product/consignment/update",data:n}),ce=n=>x.get({url:`gruul-mall-goods/goods/product/label/searchByShopType/${n}`,params:{size:1e3}}),{divTenThousand:E,mulTenThousand:D}=oe(),pe={name:"",saleDescribe:"",platformCategoryId:[],categoryId:"",providerId:"",widePic:"",distributionMode:[],videoUrl:"",albumPics:"",productType:"REAL_PRODUCT",specGroups:[],platformCategory:{one:null,two:null,three:null},shopCategory:{one:null,two:null,three:null},skus:[{id:"",image:"",initSalesVolume:0,limitNum:0,limitType:"UNLIMITED",price:0,productId:"",initStock:0,salePrice:0,shopId:"",stockType:"UNLIMITED",weight:0,specs:[]}],productParameters:[],productAttributes:[],serviceIds:[],detail:"",freightTemplateId:"0",status:"SELL_ON",brandId:""},me=()=>{const n=j.useRoute(),l=j.useRouter(),b=e.ref(),c=e.ref([]),p=e.ref([]),i=e.reactive({name:"",shopCategory:[],saleDescribe:"",labelId:"",consignmentPriceSetting:{type:"UNIFY",sale:0,scribe:0},unifyPriceSetting:{type:"",sale:"",scribe:""}}),_={name:{required:!0,message:"请输入商品名称",trigger:"blur"},shopCategory:{required:!0,message:"请选择店铺类目",trigger:"change",type:"array"}},U={expandTrigger:"hover",label:"name",value:"id"},I=e.ref(pe),m=e.ref([]),g=e.ref([]),y=e.ref([]);async function C(){const{code:a,data:o,success:f}=await ie();if(a!==200){k.ElMessage.error("获取平台分类失败");return}m.value=M(1,o==null?void 0:o.map(N=>({...N,id:N.categoryId})))}async function S(){const{code:a,data:o}=await le({current:1,size:500});if(a!==200){k.ElMessage.error("获取店铺分类失败");return}g.value=M(1,o.records)}async function t(){const{code:a,data:o}=await ce(re.useShopInfoStore().shopInfo.shopType);if(a!==200){k.ElMessage.error("获取商品标签失败");return}y.value=o}const V=async()=>{var N,u,T,w,h,s,r,P,L,B,Y,K,H,J,O,Q,X,Z,v,ee;const a=n.query.id,{data:o}=await ae(a);i.name=o==null?void 0:o.name,i.saleDescribe=o==null?void 0:o.saleDescribe,i.labelId=o==null?void 0:o.labelId,I.value.platformCategoryId=[(u=(N=o==null?void 0:o.extra)==null?void 0:N.platformCategory)==null?void 0:u.one,(w=(T=o==null?void 0:o.extra)==null?void 0:T.platformCategory)==null?void 0:w.two,(s=(h=o==null?void 0:o.extra)==null?void 0:h.platformCategory)==null?void 0:s.three],i.consignmentPriceSetting.type=(P=(r=o==null?void 0:o.extra)==null?void 0:r.consignmentPriceSetting)==null?void 0:P.type,i.consignmentPriceSetting.sale=E((B=(L=o==null?void 0:o.extra)==null?void 0:L.consignmentPriceSetting)==null?void 0:B.sale).toNumber(),i.consignmentPriceSetting.scribe=E((K=(Y=o==null?void 0:o.extra)==null?void 0:Y.consignmentPriceSetting)==null?void 0:K.scribe).toNumber(),i.shopCategory=[(J=(H=o==null?void 0:o.extra)==null?void 0:H.shopCategory)==null?void 0:J.one,(Q=(O=o==null?void 0:o.extra)==null?void 0:O.shopCategory)==null?void 0:Q.two,(Z=(X=o==null?void 0:o.extra)==null?void 0:X.shopCategory)==null?void 0:Z.three];const f=(v=o==null?void 0:o.storageSpecSku)==null?void 0:v[0];c.value=(ee=f==null?void 0:f.skus)==null?void 0:ee.map(R=>{var te,ne;return{...R,salePrice:(te=E(R.salePrice))==null?void 0:te.toString(),price:(ne=E(R.price))==null?void 0:ne.toString()}}),p.value=(f==null?void 0:f.specGroups)||[],z(i,c)},q=async()=>{const{data:a,code:o}=await se();o===200&&a&&(i.unifyPriceSetting.sale=E(a==null?void 0:a.sale).toString(),i.unifyPriceSetting.scribe=E(a==null?void 0:a.scribe).toString(),i.unifyPriceSetting.type=a==null?void 0:a.type)};e.watch(()=>i.consignmentPriceSetting,()=>z(i,c),{deep:!0});const F=async()=>{C(),S(),t();try{await q()}finally{V()}},G=()=>{l.back()},A=()=>{var a;(a=b.value)==null||a.validate(async o=>{var f,N,u,T;if(o){const w={shopCategory:{one:(f=i==null?void 0:i.shopCategory)==null?void 0:f[0],two:(N=i==null?void 0:i.shopCategory)==null?void 0:N[1],three:(u=i==null?void 0:i.shopCategory)==null?void 0:u[2]},id:(T=n.query)==null?void 0:T.id,name:i.name,saleDescribe:i.saleDescribe,labelId:i.labelId},h={};i.consignmentPriceSetting.type==="UNIFY"?(h.type=i.unifyPriceSetting.type,h.sale=D(i.unifyPriceSetting.sale).toString(),h.scribe=D(i.unifyPriceSetting.scribe).toString()):(h.type=i.consignmentPriceSetting.type,h.sale=D(i.consignmentPriceSetting.sale).toString(),h.scribe=D(i.consignmentPriceSetting.scribe).toString()),w.consignmentPriceSetting=h;const{code:s,success:r,msg:P}=await de(w);s===200&&r?(k.ElMessage.success({message:P||"修改商品信息成功"}),G()):k.ElMessage.error({message:P})}})};return e.onMounted(()=>F()),{formRef:b,distributionFormModel:i,distributionFormRules:_,platformCategoryList:m,currentComodityInfo:I,shopCascaderProps:U,shopCategoryList:g,LabelList:y,distributionSkus:c,divTenThousand:E,specGroups:p,cancelDistribution:G,handleConfirmDistribution:A}};function z(n,l){var b,c,p,i,_,U,I;((b=n==null?void 0:n.consignmentPriceSetting)==null?void 0:b.type)==="UNIFY"?((c=n==null?void 0:n.unifyPriceSetting)==null?void 0:c.type)==="RATE"?l.value=(p=l.value)==null?void 0:p.map(m=>{var y,C,S,t;const g=(C=new d(m.salePrice))==null?void 0:C.mul(new d(1).add(new d(((y=n==null?void 0:n.unifyPriceSetting)==null?void 0:y.sale)||0).div(100))).toString();return{...m,actualSalePrice:g,actualPrice:(t=new d(g))==null?void 0:t.mul(new d(1).add(new d(((S=n==null?void 0:n.unifyPriceSetting)==null?void 0:S.scribe)||0).div(100))).toString()}}):l.value=(i=l.value)==null?void 0:i.map(m=>{var y,C,S,t;const g=(C=new d(m.salePrice))==null?void 0:C.add(new d(((y=n==null?void 0:n.unifyPriceSetting)==null?void 0:y.sale)||0)).toString();return{...m,actualSalePrice:g,actualPrice:(t=new d(g))==null?void 0:t.add(new d(((S=n==null?void 0:n.unifyPriceSetting)==null?void 0:S.scribe)||0)).toString()}}):((_=n==null?void 0:n.consignmentPriceSetting)==null?void 0:_.type)==="RATE"?l.value=(U=l.value)==null?void 0:U.map(m=>{var y,C,S,t;const g=(C=new d(m.salePrice))==null?void 0:C.mul(new d(1).add(new d(((y=n==null?void 0:n.consignmentPriceSetting)==null?void 0:y.sale)||0).div(100))).toString();return{...m,actualSalePrice:g,actualPrice:(t=new d(g))==null?void 0:t.mul(new d(1).add(new d(((S=n==null?void 0:n.consignmentPriceSetting)==null?void 0:S.scribe)||0).div(100))).toString()}}):l.value=(I=l.value)==null?void 0:I.map(m=>{var y,C,S,t;const g=(C=new d(m.salePrice))==null?void 0:C.add(new d(((y=n==null?void 0:n.consignmentPriceSetting)==null?void 0:y.sale)||0)).toString();return{...m,actualSalePrice:g,actualPrice:(t=new d(g))==null?void 0:t.add(new d(((S=n==null?void 0:n.consignmentPriceSetting)==null?void 0:S.scribe)||0)).toString()}})}function M(n,l){const b=n===3;for(let c=0;c<l.length;){const p=l[c];if(b){p.disabled=!1,c++;continue}const i=p.children||p.secondCategoryVos||p.categoryThirdlyVos;delete p.secondCategoryVos,delete p.categoryThirdlyVos;const _=!i||i.length===0;if(p.disabled=_,_){l.splice(c,1);continue}if(M(n+1,i),i.length===0){l.splice(c,1);continue}p.children=i,c++}return l}const ge={class:"distribution"},ye={class:"distribution__container"},ue={class:"distribution__container fdc1 overh"},Ce={class:"price-settings"},fe={class:"distribution__btns"},be=e.defineComponent({__name:"ShopEditConsignmentCommodity",setup(n){const{distributionFormModel:l,distributionSkus:b,distributionFormRules:c,platformCategoryList:p,shopCascaderProps:i,currentComodityInfo:_,shopCategoryList:U,LabelList:I,specGroups:m,formRef:g,cancelDistribution:y,handleConfirmDistribution:C}=me();return(S,t)=>{const V=e.resolveComponent("el-form-item"),q=e.resolveComponent("el-input"),F=e.resolveComponent("el-cascader"),G=e.resolveComponent("el-option"),A=e.resolveComponent("el-select"),a=e.resolveComponent("el-radio"),o=e.resolveComponent("el-radio-group"),f=e.resolveComponent("el-input-number"),N=e.resolveComponent("el-image"),u=e.resolveComponent("el-table-column"),T=e.resolveComponent("el-table"),w=e.resolveComponent("el-form"),h=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ge,[e.createVNode(w,{ref_key:"formRef",ref:g,class:"distribution__form fdc1 overh",model:e.unref(l),rules:e.unref(c)},{default:e.withCtx(()=>[t[22]||(t[22]=e.createElementVNode("div",{class:"distribution__title"},"基础信息",-1)),e.createElementVNode("div",ye,[e.createVNode(V,{label:"商品类型"},{default:e.withCtx(()=>t[10]||(t[10]=[e.createTextVNode("实物商品")])),_:1}),e.createVNode(V,{label:"销售方式"},{default:e.withCtx(()=>t[11]||(t[11]=[e.createTextVNode("代销商品（采购商品可供各店铺采购，代销商品可以让各店铺帮您将商品销售出去；）")])),_:1}),e.createVNode(V,{label:"商品名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(q,{modelValue:e.unref(l).name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.unref(l).name=s),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),e.createVNode(V,{label:"平台类目"},{default:e.withCtx(()=>[e.createVNode(F,{ref:"platformCategoryRef",modelValue:e.unref(_).platformCategoryId,"onUpdate:modelValue":t[1]||(t[1]=s=>e.unref(_).platformCategoryId=s),clearable:"",class:"inputWidth",style:{width:"100%"},options:e.unref(p),props:e.unref(i),disabled:"",placeholder:"请选择平台类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"店铺类目",prop:"shopCategory"},{default:e.withCtx(()=>[e.createVNode(F,{ref:"shopCategoryRef",modelValue:e.unref(l).shopCategory,"onUpdate:modelValue":t[2]||(t[2]=s=>e.unref(l).shopCategory=s),clearable:"",style:{width:"100%"},class:"inputWidth",options:e.unref(U),props:e.unref(i),placeholder:"请选择店铺类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(V,{label:"商品标签"},{default:e.withCtx(()=>[e.createVNode(A,{modelValue:e.unref(l).labelId,"onUpdate:modelValue":t[3]||(t[3]=s=>e.unref(l).labelId=s),class:"inputWidth",placeholder:"请选择商品标签",style:{width:"100%"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(I),s=>(e.openBlock(),e.createBlock(G,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(V,{label:"卖点描述",prop:"saleDescribe"},{default:e.withCtx(()=>[e.createVNode(q,{modelValue:e.unref(l).saleDescribe,"onUpdate:modelValue":t[4]||(t[4]=s=>e.unref(l).saleDescribe=s),class:"inputWidth",placeholder:"请填写卖点描述",maxlength:"60"},null,8,["modelValue"])]),_:1})]),t[23]||(t[23]=e.createElementVNode("div",{class:"distribution__title"},"价格设置",-1)),e.createElementVNode("div",ue,[e.createElementVNode("div",Ce,[e.createVNode(o,{modelValue:e.unref(l).consignmentPriceSetting.type,"onUpdate:modelValue":t[5]||(t[5]=s=>e.unref(l).consignmentPriceSetting.type=s)},{default:e.withCtx(()=>[e.createVNode(a,{value:"RATE"},{default:e.withCtx(()=>t[12]||(t[12]=[e.createTextVNode("按比例设价")])),_:1}),e.createVNode(a,{value:"REGULAR"},{default:e.withCtx(()=>t[13]||(t[13]=[e.createTextVNode("固定金额设价")])),_:1})]),_:1},8,["modelValue"]),e.unref(l).consignmentPriceSetting.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[t[14]||(t[14]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(f,{modelValue:e.unref(l).consignmentPriceSetting.sale,"onUpdate:modelValue":t[6]||(t[6]=s=>e.unref(l).consignmentPriceSetting.sale=s),controls:!1,precision:2,max:100},null,8,["modelValue"]),t[15]||(t[15]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[t[16]||(t[16]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(f,{modelValue:e.unref(l).consignmentPriceSetting.scribe,"onUpdate:modelValue":t[7]||(t[7]=s=>e.unref(l).consignmentPriceSetting.scribe=s),controls:!1,precision:2,max:100},null,8,["modelValue"]),t[17]||(t[17]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(V,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[t[18]||(t[18]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(f,{modelValue:e.unref(l).consignmentPriceSetting.sale,"onUpdate:modelValue":t[8]||(t[8]=s=>e.unref(l).consignmentPriceSetting.sale=s),controls:!1,precision:2},null,8,["modelValue"]),t[19]||(t[19]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(V,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[t[20]||(t[20]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(f,{modelValue:e.unref(l).consignmentPriceSetting.scribe,"onUpdate:modelValue":t[9]||(t[9]=s=>e.unref(l).consignmentPriceSetting.scribe=s),controls:!1,precision:2},null,8,["modelValue"]),t[21]||(t[21]=e.createElementVNode("span",null," 元",-1))]),_:1})],64))]),e.createVNode(T,{data:e.unref(b),"max-height":"600","cell-style":{height:"50px"}},{default:e.withCtx(()=>{var s;return[e.unref(b)&&((s=e.unref(b)[0])!=null&&s.image)?(e.openBlock(),e.createBlock(u,{key:0,fixed:"left",width:"150",label:"规格图"},{default:e.withCtx(({row:r})=>[e.createVNode(N,{src:r==null?void 0:r.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(r,P)=>(e.openBlock(),e.createBlock(u,{key:P,width:"150",label:r==null?void 0:r.name},{default:e.withCtx(({row:L})=>{var B;return[e.createTextVNode(e.toDisplayString(Array.isArray(L.specs)?(B=L.specs)==null?void 0:B[P]:L.specs.name),1)]}),_:2},1032,["label"]))),128)),e.createVNode(u,{width:"150",label:"供货价",prop:"salePrice"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(new(e.unref(d))(r==null?void 0:r.salePrice).toFixed(2)),1)]),_:1}),e.createVNode(u,{width:"150",label:"划线价",prop:"actualPrice"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(new(e.unref(d))(r==null?void 0:r.actualPrice).toFixed(2)),1)]),_:1}),e.createVNode(u,{width:"150",label:"销售价",prop:"actualSalePrice"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(new(e.unref(d))(r==null?void 0:r.actualSalePrice).toFixed(2)),1)]),_:1}),e.createVNode(u,{width:"150",label:"库存"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString((r==null?void 0:r.stockType)==="UNLIMITED"?"无限库存":r==null?void 0:r.initStock),1)]),_:1}),e.createVNode(u,{width:"150",label:"限购类型"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(e.unref($)[r==null?void 0:r.limitType]),1)]),_:1}),e.createVNode(u,{width:"150",label:"规格限购"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString((r==null?void 0:r.limitType)!=="UNLIMITED"?String(r.limitNum):""),1)]),_:1}),e.createVNode(u,{width:"150",label:"重量",prop:"weight"}),e.createVNode(u,{width:"150",label:"销量（注水）"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(Number((r==null?void 0:r.initSalesVolume)||0)+Number((r==null?void 0:r.salesVolume)||0)),1)]),_:1})]}),_:1},8,["data"])])]),_:1},8,["model","rules"])]),e.createElementVNode("div",fe,[e.createVNode(h,{onClick:e.unref(y)},{default:e.withCtx(()=>t[24]||(t[24]=[e.createTextVNode("取消")])),_:1},8,["onClick"]),e.createVNode(h,{type:"primary",onClick:e.unref(C)},{default:e.withCtx(()=>t[25]||(t[25]=[e.createTextVNode("确认")])),_:1},8,["onClick"])])],64)}}}),Se="";return((n,l)=>{const b=n.__vccOpts||n;for(const[c,p]of l)b[c]=p;return b})(be,[["__scopeId","data-v-29b2afa6"]])});
