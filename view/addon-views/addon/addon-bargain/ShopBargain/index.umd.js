(function(e,N){typeof exports=="object"&&typeof module<"u"?module.exports=N(require("vue"),require("@/components/ChromeTab.vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/components/PageManage.vue"),require("element-plus"),require("@/store/modules/shopInfo"),require("vue-router"),require("@/utils/Storage"),require("@/composables/useConvert"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@/components/ChromeTab.vue","@vueuse/core","@/components/SchemaForm.vue","@/components/PageManage.vue","element-plus","@/store/modules/shopInfo","vue-router","@/utils/Storage","@/composables/useConvert","@/apis/http"],N):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopBargain=N(e.ShopBargainContext.Vue,e.ShopBargainContext.ChromeTabs,e.ShopBargainContext.VueUse,e.ShopBargainContext.SchemaForm,e.ShopBargainContext.PageManageTwo,e.ShopBargainContext.ElementPlus,e.ShopBargainContext.ShopInfoStore,e.ShopBargainContext.VueRouter,e.ShopBargainContext.Storage,e.ShopBargainContext.UseConvert,e.ShopBargainContext.Request))})(this,function(e,N,q,R,D,p,$,F,H,U,E){"use strict";var z=document.createElement("style");z.textContent=`@charset "UTF-8";.container[data-v-6bc3ad83]{overflow-y:scroll}[data-v-6bc3ad83] .el-button.is-link{padding:0}[data-v-6bc3ad83] .el-button+.el-button{margin-left:10px}.bargain_origin[data-v-3e54ced6]{display:flex;justify-content:center;align-items:center}.bargain_origin--name[data-v-3e54ced6]{width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.bargain_origin--shop_name[data-v-3e54ced6]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}
`,document.head.appendChild(z);const j={class:"q_plugin_container"},W={class:"fdc1 overh"},J=e.defineComponent({__name:"ShopBargain",setup(o){const u=e.reactive({activeName:"bargainList",tabsList:[{label:"砍价列表",name:"bargainList"},{label:"砍价订单",name:"bargainOrder"}]}),{activeName:m,tabsList:g}=e.toRefs(u),f={bargainList:e.defineAsyncComponent(()=>Promise.resolve().then(()=>oe)),bargainOrder:e.defineAsyncComponent(()=>Promise.resolve().then(()=>pe))},s=l=>{m.value=l};return(l,y)=>(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(N,{"tab-list":e.unref(g),value:e.unref(m),onHandleTabs:s},null,8,["tab-list","value"]),e.createElementVNode("div",W,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(f[e.unref(m)])))])]))}}),K=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(o,{emit:u}){const m=o,f=[{label:"活动名称",prop:"keyword",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"PROCESSING",label:"进行中"},{value:"OVER",label:"已结束"},{value:"SHOP_SELL_OFF",label:"已下架"},{value:"ILLEGAL_SELL_OFF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],s=u,l=q.useVModel(m,"modelValue",s),y=()=>{Object.keys(l.value).forEach(x=>l.value[x]=""),s("search")};return(x,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{modelValue:e.unref(l),"onUpdate:modelValue":i[0]||(i[0]=V=>e.isRef(l)?l.value=V:null),columns:f,onSearchHandle:i[1]||(i[1]=V=>s("search")),onHandleReset:y},null,8,["modelValue"]),i[2]||(i[2]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}}),w="addon-bargain/bargain",Q="addon-bargain/bargainOrder",X=o=>E.put({url:w+"/shop/sellOf",data:o}),Y=o=>E.get({url:w+"/illegal/reason/"+o}),Z=o=>E.get({url:w,params:o}),M=o=>E.del({url:w,data:o}),v=o=>E.get({url:Q,params:o}),ee={BARGAINING:"砍价中",FAILED_TO_BARGAIN:"砍价失败",SUCCESSFUL_BARGAIN:"砍价成功"};var A=(o=>(o.NOT_STARTED="未开始",o.PROCESSING="进行中",o.OVER="已结束",o.ILLEGAL_SELL_OFF="违规下架",o.SHOP_SELL_OFF="已下架",o))(A||{});const te={class:"handle_container",style:{"padding-top":"16px"}},ae={class:"table_container f1"},ne=e.defineComponent({__name:"BargainList",setup(o){const u=e.reactive({keyword:"",status:""}),m=F.useRouter(),g=e.computed(()=>r=>Number(r)===0?"全部":r+""),f=e.ref([]),s=e.reactive({size:10,current:1,total:0}),l=e.ref(!1),y=e.ref(),x=e.ref("");i();async function i(){const{status:r,keyword:t}=u,h={...s,keyword:t,shopId:$.useShopInfoStore().shopInfo.id,status:r},{code:c,data:d}=await Z(h);if(c!==200)return p.ElMessage.error("获取活动列表失败");f.value=d.records,s.current=d.current,s.size=d.size,s.total=d.total}const V=async r=>{try{if(!await p.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{shopId:h,id:c}=r,{code:d,data:P,msg:T}=await M([{activityId:c,shopId:h}]);if(d!==200){p.ElMessage.error(T||"删除失败");return}p.ElMessage.success("删除成功"),f.value=f.value.filter(a=>a.id!==r.id),s.total--}catch{}},B=e.ref([]),k=r=>{B.value=r},b=r=>{s.size=r,i()},_=r=>{s.current=r,i()},S=()=>{var t;if(((t=new H().getItem("shopStore"))==null?void 0:t.shopMode)==="O2O"){p.ElMessage.warning("O2O店铺暂不支持该活动");return}m.push({name:"bargainBaseinfo"})},C=()=>{p.ElMessageBox.confirm("确定删除选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async r=>{if(console.log("action",r),r==="cancel")return;const t=B.value.filter(c=>c.status!=="PROCESSING").map(c=>({shopId:c.shopId,activityId:c.id})),{code:h}=await M(t);if(h!==200){p.ElMessage.error("删除失败");return}p.ElMessage.success("删除成功"),i()}})},O=(r,t)=>{const{id:h,shopId:c}=r;m.push({name:"bargainBaseinfo",query:{activityId:h,shopId:c,isLookUp:t.toString()}})},L=r=>{p.ElMessageBox.confirm("确定下架选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async t=>{if(t==="cancel")return;const{code:h}=await X(r);if(h!==200){p.ElMessage.error("下架失败");return}p.ElMessage.success("下架成功"),i()}})},n=async r=>{const{code:t,data:h}=await Y(r);t!==200&&p.ElMessage.error("违规原因获取失败"),x.value=h,l.value=!0};return(r,t)=>{const h=e.resolveComponent("el-config-provider"),c=e.resolveComponent("el-button"),d=e.resolveComponent("el-table-column"),P=e.resolveComponent("el-table"),T=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(h,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(K,{modelValue:u,"onUpdate:modelValue":t[0]||(t[0]=a=>u=a),onSearch:i},null,8,["modelValue"])]),_:1}),e.createElementVNode("div",te,[e.createVNode(c,{round:"",type:"primary",onClick:S},{default:e.withCtx(()=>t[2]||(t[2]=[e.createTextVNode("新增砍价")])),_:1}),e.createVNode(c,{round:"",disabled:!B.value.length,onClick:C},{default:e.withCtx(()=>t[3]||(t[3]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",ae,[e.createVNode(P,{ref_key:"multipleTableRef",ref:y,data:f.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:k},{default:e.withCtx(()=>[e.createVNode(d,{type:"selection",width:"30",fixed:"",selectable:a=>a.status!=="PROCESSING"},null,8,["selectable"]),e.createVNode(d,{label:"活动名称"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(a.name),1)]),_:1}),e.createVNode(d,{label:"状态",width:"180"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:["ILLEGAL_SELL_OFF"].includes(a.status)?"#F54319":["OVER","SHOP_SELL_OFF"].includes(a.status)?"#999":"#333"})},e.toDisplayString(e.unref(A)[a.status]),5)]),_:1}),e.createVNode(d,{label:"活动时间"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(a.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(a.endTime),1)]),_:1}),e.createVNode(d,{label:"活动商品",width:"150"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(g.value(a.productNum)),1)]),_:1}),e.createVNode(d,{label:"支付单数",width:"150"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",null,e.toDisplayString(a.payOrder||0),1)]),_:1}),e.createVNode(d,{label:"操作",fixed:"right",align:"right",width:"200"},{default:e.withCtx(({row:a})=>[e.createVNode(c,{type:"primary",link:"",onClick:I=>O(a,!0)},{default:e.withCtx(()=>t[4]||(t[4]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),a.status==="PROCESSING"?(e.openBlock(),e.createBlock(c,{key:0,type:"primary",link:"",onClick:I=>L({bargainId:a.id,shopId:a.shopId})},{default:e.withCtx(()=>t[5]||(t[5]=[e.createTextVNode("下架")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.status==="ILLEGAL_SELL_OFF"?(e.openBlock(),e.createBlock(c,{key:1,type:"primary",link:"",onClick:I=>n(a.id)},{default:e.withCtx(()=>t[6]||(t[6]=[e.createTextVNode("违规原因")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.status!=="PROCESSING"?(e.openBlock(),e.createBlock(c,{key:2,type:"danger",link:"",onClick:I=>V(a)},{default:e.withCtx(()=>t[7]||(t[7]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(D,{"page-size":s.size,"page-num":s.current,total:s.total,onHandleCurrentChange:_,onHandleSizeChange:b},null,8,["page-size","page-num","total"]),e.createVNode(T,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value=a),title:"违规原因",width:"500",center:""},{default:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(x.value),1)]),_:1},8,["modelValue"])],64)}}}),me="",G=(o,u)=>{const m=o.__vccOpts||o;for(const[g,f]of u)m[g]=f;return m},oe=Object.freeze(Object.defineProperty({__proto__:null,default:G(ne,[["__scopeId","data-v-6bc3ad83"]])},Symbol.toStringTag,{value:"Module"})),re={class:"table_container"},le={class:"bargain_origin"},ie={class:"bargain_origin--name",style:{width:"170px","margin-left":"5px"}},se={class:"bargain_origin"},ce={class:"bargain_origin--shop_name",style:{width:"205px","margin-left":"5px"}},de=e.defineComponent({__name:"BargainOrder",setup(o){const u=e.reactive({form:{keyword:""},bargainOrderList:[],chooseList:[]}),m=F.useRouter(),{form:g,bargainOrderList:f,chooseList:s}=e.toRefs(u),l=e.reactive({size:10,current:1,total:0}),{divTenThousand:y}=U(),x=[{label:"发起人",prop:"keyword",valueType:"copy",labelWidth:55,fieldProps:{placeholder:"请输入活动发起人"}}];i();async function i(){const{code:b,data:_,msg:S}=await v({...l,keyword:g.value.keyword});if(b!==200){p.ElMessage.error(S||"获取砍价活动详情");return}f.value=_.records,l.size=_.size,l.total=_.total,l.current=_.current}const V=()=>{Object.keys(g.value).forEach(b=>g.value[b]=""),i()},B=b=>{l.size=b,i()},k=b=>{l.current=b,i()};return(b,_)=>{const S=e.resolveComponent("el-image"),C=e.resolveComponent("el-table-column"),O=e.resolveComponent("el-button"),L=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{modelValue:e.unref(g),"onUpdate:modelValue":_[0]||(_[0]=n=>e.isRef(g)?g.value=n:null),columns:x,onSearchHandle:i,onHandleReset:V},null,8,["modelValue"]),e.createElementVNode("div",re,[e.createVNode(L,{ref:"multipleTableRef",data:e.unref(f),stripe:"","header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:_[1]||(_[1]=n=>s.value=n)},{default:e.withCtx(()=>[e.createVNode(C,{label:"发起人",width:"240px"},{default:e.withCtx(({row:n})=>[e.createElementVNode("div",le,[e.createVNode(S,{style:{width:"30px",height:"30px","border-radius":"3px"},fit:"",src:n.userHeadPortrait},null,8,["src"]),e.createElementVNode("div",ie,e.toDisplayString(n.userNickname),1)])]),_:1}),e.createVNode(C,{label:"商品信息",width:"280px"},{default:e.withCtx(({row:n})=>[e.createElementVNode("div",se,[e.createVNode(S,{style:{width:"36px",height:"36px"},fit:"",src:n.productPic},null,8,["src"]),e.createElementVNode("div",ce,e.toDisplayString(n.productName),1)])]),_:1}),e.createVNode(C,{label:"销售价(元)",width:"120"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",null,e.toDisplayString(n.salePrice&&e.unref(y)(n.salePrice)),1)]),_:1}),e.createVNode(C,{label:"底价(元)",width:"120"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",null,e.toDisplayString(n.floorPrice&&e.unref(y)(n.floorPrice)),1)]),_:1}),e.createVNode(C,{label:"砍价人数",width:"120"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",null,e.toDisplayString(n.bargainingPeople),1)]),_:1}),e.createVNode(C,{label:"砍价开始时间",width:"200px"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",null,e.toDisplayString(n.createTime),1)]),_:1}),e.createVNode(C,{label:"砍价结束时间",width:"200px"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",null,e.toDisplayString(n.endTime),1)]),_:1}),e.createVNode(C,{label:"状态",width:"120"},{default:e.withCtx(({row:n})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:n.bargainStatus==="SUCCESSFUL_BARGAIN"?"#00BB2C":""})},e.toDisplayString(e.unref(ee)[n.bargainStatus]),5)]),_:1}),e.createVNode(C,{label:"操作",fixed:"right",width:"130",align:"right"},{default:e.withCtx(({row:n})=>[e.createVNode(O,{link:"",type:"primary",onClick:()=>e.unref(m).push({name:"BargainHelpInfo",query:{id:n.id}})},{default:e.withCtx(()=>_[2]||(_[2]=[e.createTextVNode("帮砍记录")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createVNode(D,{"page-size":l.size,"page-num":l.current,total:l.total,onHandleCurrentChange:k,onHandleSizeChange:B},null,8,["page-size","page-num","total"])],64)}}}),fe="",pe=Object.freeze(Object.defineProperty({__proto__:null,default:G(de,[["__scopeId","data-v-3e54ced6"]])},Symbol.toStringTag,{value:"Module"}));return J});
