(function(e,N){typeof exports=="object"&&typeof module<"u"?module.exports=N(require("vue"),require("@/components/ChromeTab.vue"),require("@/q-plugin/components/printer.vue"),require("@/q-plugin/components/printTemplate.vue"),require("@/q-plugin/components/printingTask.vue"),require("element-plus"),require("vue-router"),require("@/components/SchemaForm.vue"),require("@/libs/validate"),require("@/apis/http"),require("@/components/slide-captcha/SliderCaptcha.vue"),require("@/apis/sign")):typeof define=="function"&&define.amd?define(["vue","@/components/ChromeTab.vue","@/q-plugin/components/printer.vue","@/q-plugin/components/printTemplate.vue","@/q-plugin/components/printingTask.vue","element-plus","vue-router","@/components/SchemaForm.vue","@/libs/validate","@/apis/http","@/components/slide-captcha/SliderCaptcha.vue","@/apis/sign"],N):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopStoreList=N(e.ShopStoreListContext.Vue,e.ShopStoreListContext.ChromeTabs,e.ShopStoreListContext.SetPinter,e.ShopStoreListContext.SetPrintTemplate,e.ShopStoreListContext.SetPrintingTask,e.ShopStoreListContext.ElementPlus,e.ShopStoreListContext.VueRouter,e.ShopStoreListContext.SchemaForm,e.ShopStoreListContext.LibsValidate,e.ShopStoreListContext.Request,e.ShopStoreListContext.SliderCaptcha,e.ShopStoreListContext.SignAPI))})(this,function(e,N,O,P,q,n,D,A,R,k,F,U){"use strict";var w=document.createElement("style");w.textContent=`@charset "UTF-8";[data-v-6f0454d0]{font-size:14px}.addsalesclerk__phone[data-v-115ea386]{display:flex;align-items:center;margin-bottom:15px}.addsalesclerk__phone--input[data-v-115ea386]{margin-left:35px}.addsalesclerk__code[data-v-115ea386]{display:flex;align-items:center}.addsalesclerk__code--title[data-v-115ea386]{width:72px;text-align:right}
`,document.head.appendChild(w);const j={class:"q_plugin_container"},H=e.defineComponent({__name:"ShopStoreList",setup(a){const i=[{name:"storeList",label:"门店列表"},{name:"salesclerkList",label:"店员列表"},{name:"printer",label:"打印机"},{name:"printTemplate",label:"打印模板"},{name:"printingTask",label:"打印任务"}],f={storeList:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ne)),salesclerkList:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ge)),printer:O,printTemplate:P,printingTask:q},p=e.ref("storeList"),d=x=>{p.value=x};return(x,m)=>(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(N,{"tab-list":i,value:p.value,style:{"margin-bottom":"16px"},onHandleTabs:d},null,8,["value"]),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(f[p.value]),{mode:"STORE_PICKUP_SELF"}))]))}}),B=a=>k.get({url:"addon-shop-store/store/list",params:a}),z=(a,i)=>k.del({url:`addon-shop-store/store/del/${a}/${i}`}),G=(a,i)=>k.put({url:`addon-shop-store/store/update/${a}`,data:i}),K=a=>k.post({url:"addon-shop-store/assistant/issue",data:a}),X=a=>k.get({url:"addon-shop-store/assistant/list",data:a}),J=(a,i)=>k.put({url:`addon-shop-store/assistant/set/store/${a}`,params:i}),Q=a=>k.del({url:`addon-shop-store/assistant/del/${a}`}),W=a=>{const{captchaTrack:i,form:f,id:p,smsType:d}=a;return k.post({url:`gruul-mall-uaa/uaa/auth/captcha/sms/${d}`,data:{captchaTrack:i,form:f,id:p}})},Y={class:"handle_container"},Z={class:"table_container"},ee={class:"ellipsis"},te={class:"ellipsis"},oe=["onClick"],se=["onClick"],ae=["onClick"],le=e.defineComponent({__name:"storeList",setup(a){const i=D.useRouter(),f=e.ref([]),p=e.reactive([{value:"",label:"全部"},{value:"NORMAL",label:"已启用"},{value:"SHOP_FORBIDDEN",label:"已禁用"}]),d=e.ref({state:""}),x=[{label:"门店状态",prop:"state",valueType:"select",options:p,fieldProps:{placeholder:"请选择"}}];m();async function m(){const{code:u,data:c}=await B({size:5,status:d.value.state});u===200&&c?f.value=c.records:n.ElMessage.error("获取列表失败")}const C=(u,c,V)=>{i.push({path:"/shop/store/AddStore",query:{shopId:u,id:c,lookType:V}})},E=(u,c)=>{n.ElMessageBox.confirm("确定删除该门店吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{code:V,msg:S}=await z(u,c);V===200?(n.ElMessage.success("删除成功"),m()):n.ElMessage.error(S||"删除失败")})},r=async(u,c,V)=>{const{code:S,msg:h}=await G(V,[{shopId:u,ids:[c]}]);S===200?n.ElMessage.success("修改状态成功"):n.ElMessage.error(h||"修改状态失败"),m()},g=()=>{Object.keys(d.value).forEach(u=>{d.value[u]=""}),m()};return(u,c)=>{const V=e.resolveComponent("el-config-provider"),S=e.resolveComponent("el-button"),h=e.resolveComponent("el-table-column"),b=e.resolveComponent("el-switch"),L=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(V,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(A,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=o=>d.value=o),columns:x,onSearchHandle:m,onHandleReset:g},null,8,["modelValue"])]),_:1}),e.createElementVNode("div",Y,[e.createVNode(S,{round:"",type:"primary",onClick:c[1]||(c[1]=o=>e.unref(i).push("/shop/store/AddStore"))},{default:e.withCtx(()=>c[2]||(c[2]=[e.createTextVNode("添加门店")])),_:1})]),e.createElementVNode("div",Z,[e.createVNode(L,{data:f.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},"empty-text":"暂无数据~",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(h,{label:"门店名称","show-overflow-tooltip":""},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",ee,e.toDisplayString(o.storeName),1)]),_:1}),e.createVNode(h,{label:"负责人手机号",width:"130"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",null,e.toDisplayString(o.functionaryPhone),1)]),_:1}),e.createVNode(h,{label:"负责人姓名",width:"100"},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",null,e.toDisplayString(o.functionaryName),1)]),_:1}),e.createVNode(h,{label:"地址",width:"350","show-overflow-tooltip":""},{default:e.withCtx(({row:o})=>[e.createElementVNode("div",te,e.toDisplayString(o.detailedAddress),1)]),_:1}),e.createVNode(h,{label:"状态"},{default:e.withCtx(({row:o})=>[e.createVNode(b,{modelValue:o.status,"onUpdate:modelValue":y=>o.status=y,"active-value":"NORMAL","inactive-value":"SHOP_FORBIDDEN","inline-prompt":"","active-text":"开启","inactive-text":"关闭",onClick:y=>r(o.shopId,o.id,o.status)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),e.createVNode(h,{align:"right",label:"操作",width:"200px"},{default:e.withCtx(({row:o})=>[e.createElementVNode("span",{style:{color:"#555cfd",cursor:"pointer",margin:"0 10px"},onClick:y=>C(o.shopId,o.id,"OnlyLook")},"查看",8,oe),o.status==="NORMAL"?(e.openBlock(),e.createElementBlock("span",{key:0,style:{color:"#555cfd",cursor:"pointer","margin-left":"10px"},onClick:y=>C(o.shopId,o.id,"Edite")},"编辑",8,se)):e.createCommentVNode("",!0),o.status!=="NORMAL"?(e.openBlock(),e.createElementBlock("span",{key:1,style:{color:"#f54319",cursor:"pointer","margin-left":"10px"},onClick:y=>E(o.shopId,o.id)},"删除",8,ae)):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])])])}}}),be="",$=(a,i)=>{const f=a.__vccOpts||a;for(const[p,d]of i)f[p]=d;return f},ne=Object.freeze(Object.defineProperty({__proto__:null,default:$(le,[["__scopeId","data-v-6f0454d0"]])},Symbol.toStringTag,{value:"Module"})),re={class:"fdc1 overh"},ie={class:"handle_container fcenter"},de={class:"table_container"},ce={class:"ellipsis"},pe={class:"ellipsis"},me={class:"addsalesclerk__phone"},_e={class:"addsalesclerk__phone--input"},ue={class:"addsalesclerk__code"},fe={class:"dialog-footer"},he={class:"addsalesclerk__phone"},Ce={class:"addsalesclerk__phone--input"},xe={class:"addsalesclerk__code"},Ve={class:"dialog-footer"},ke=e.defineComponent({__name:"salesclerkList",setup(a){const i=e.ref([]),f=e.ref([]),p=e.ref(!1),d=e.ref(!1),x=e.ref(!1),m=e.ref(60),C=e.ref(null),E=e.ref(),r=e.ref({assistantPhone:"",assistantPhoneCode:""}),g=e.ref({shopAssistantId:"",storeId:""}),u=e.ref("");e.onMounted(()=>{o(),y()});const c=l=>{n.ElMessage.success("验证码已发送"),m.value-=1,x.value=!1,r.value.assistantPhoneCode=l==null?void 0:l.data,C.value=setInterval(()=>{if(m.value-=1,m.value<=0){m.value=60,C.value&&(clearInterval(C.value),C.value=null);return}},999)},V=async()=>{if(!r.value.assistantPhone)return n.ElMessage.error("请填写手机号");if(!R.REGEX_MOBILE(r.value.assistantPhone))return n.ElMessage.error("请填写正确的手机号");const{code:l,data:t}=await U.doGetCaptchaSlider(r.value.assistantPhone,"SHOP_STORE_FOUND");l===200&&(t.captcha?(E.value=t.captcha,x.value=!0):r.value.assistantPhoneCode=t.smsCode)},S=async()=>{clearInterval(C.value),C.value=null,m.value=60;const{code:l,msg:t}=await K(r.value);l===200?(n.ElMessage.success("添加成功"),o(),r.value={assistantPhone:"",assistantPhoneCode:""},p.value=!1):(r.value.assistantPhone="",r.value.assistantPhoneCode="",n.ElMessage.error(t||"添加失败"))},h=(l,t,_)=>{u.value=l,g.value.shopAssistantId=t,g.value.storeId=_,d.value=!0},b=async()=>{const{code:l,msg:t}=await J(g.value.shopAssistantId,{storeId:g.value.storeId});l===200?(d.value=!1,n.ElMessage.success("添加成功"),o()):n.ElMessage.error(t||"添加失败")},L=async l=>{n.ElMessageBox.confirm("确定删除该店员吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{code:t,msg:_}=await Q(l);t===200?(n.ElMessage.success("删除成功"),o()):n.ElMessage.error(_||"删除失败")})};async function o(){const{code:l,data:t}=await X();l===200&&t?i.value=t:n.ElMessage.error("获取列表失败"),p.value=!1}async function y(){const{code:l,data:t}=await B({size:5});l===200&&t?f.value=t.records:n.ElMessage.error("获取列表失败")}const I=()=>{p.value=!1,Object.keys(r.value).forEach(l=>r.value[l]=""),m.value=60,clearInterval(C.value)};return(l,t)=>{const _=e.resolveComponent("el-button"),T=e.resolveComponent("el-table-column"),Se=e.resolveComponent("el-table"),v=e.resolveComponent("el-input"),M=e.resolveComponent("el-dialog"),ye=e.resolveComponent("el-option"),Ne=e.resolveComponent("el-select");return e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("div",ie,[e.createVNode(_,{round:"",type:"primary",onClick:t[0]||(t[0]=s=>p.value=!0)},{default:e.withCtx(()=>t[8]||(t[8]=[e.createTextVNode(" 添加店员")])),_:1}),t[9]||(t[9]=e.createElementVNode("div",{style:{color:"#8f8f95"},class:"mla"},"店员凭手机号登录门店移动端，核销到店自提订单",-1))]),e.createElementVNode("div",de,[e.createVNode(Se,{data:i.value,"header-cell-style":{"background-color":"#F6F8FA","font-weight":"bold",color:"#515151"},"empty-text":"暂无数据~",style:{width:"100%",height:"calc(100vh - 210px)"}},{default:e.withCtx(()=>[e.createVNode(T,{label:"店员手机号"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",ce,e.toDisplayString(s.assistantPhone),1)]),_:1}),e.createVNode(T,{label:"所属门店"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",pe,e.toDisplayString(s.storeName?s.storeName:""),1)]),_:1}),e.createVNode(T,{align:"right",label:"操作"},{default:e.withCtx(({row:s})=>[e.createVNode(_,{link:"",type:"primary",style:{"margin-right":"16px"},onClick:Ee=>h(s.assistantPhone,s.id,s.storeId)},{default:e.withCtx(()=>t[10]||(t[10]=[e.createTextVNode("编辑")])),_:2},1032,["onClick"]),e.createVNode(_,{link:"",type:"danger",onClick:Ee=>L(s.id)},{default:e.withCtx(()=>t[11]||(t[11]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createVNode(M,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=s=>p.value=s),center:"",title:"店员",width:"500px","before-close":I},{footer:e.withCtx(()=>[e.createElementVNode("span",fe,[e.createVNode(_,{round:"",onClick:I},{default:e.withCtx(()=>t[15]||(t[15]=[e.createTextVNode("取消")])),_:1}),e.createVNode(_,{round:"",type:"primary",onClick:S},{default:e.withCtx(()=>t[16]||(t[16]=[e.createTextVNode(" 保存 ")])),_:1})])]),default:e.withCtx(()=>[e.createElementVNode("div",me,[t[13]||(t[13]=e.createTextVNode(" 店员手机号 ")),e.createElementVNode("div",_e,[e.createVNode(v,{modelValue:r.value.assistantPhone,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.assistantPhone=s),maxlength:"11",placeholder:"请输入电话号码",style:{width:"200px"}},null,8,["modelValue"]),m.value===60?(e.openBlock(),e.createBlock(_,{key:0,plain:"",onClick:V},{default:e.withCtx(()=>t[12]||(t[12]=[e.createTextVNode("获取验证码")])),_:1})):(e.openBlock(),e.createBlock(_,{key:1,disabled:"",link:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.value),1)]),_:1}))])]),e.createElementVNode("div",ue,[t[14]||(t[14]=e.createElementVNode("div",{class:"addsalesclerk__code--title"},"验证码",-1)),e.createVNode(v,{modelValue:r.value.assistantPhoneCode,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.assistantPhoneCode=s),maxlength:"6",placeholder:"请输入验证码",style:{width:"200px","margin-left":"35px"}},null,8,["modelValue"])])]),_:1},8,["modelValue"]),e.createVNode(M,{modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=s=>d.value=s),center:"",title:"所属门店",width:"500px"},{footer:e.withCtx(()=>[e.createElementVNode("span",Ve,[e.createVNode(_,{round:"",onClick:t[5]||(t[5]=s=>d.value=!1)},{default:e.withCtx(()=>t[19]||(t[19]=[e.createTextVNode("取消")])),_:1}),e.createVNode(_,{round:"",type:"primary",onClick:b},{default:e.withCtx(()=>t[20]||(t[20]=[e.createTextVNode(" 保存 ")])),_:1})])]),default:e.withCtx(()=>[e.createElementVNode("div",he,[t[17]||(t[17]=e.createTextVNode(" 店员手机号 ")),e.createElementVNode("div",Ce,e.toDisplayString(u.value),1)]),e.createElementVNode("div",xe,[t[18]||(t[18]=e.createElementVNode("div",{class:"addsalesclerk__code--title"},"所属门店",-1)),e.createVNode(Ne,{modelValue:g.value.storeId,"onUpdate:modelValue":t[4]||(t[4]=s=>g.value.storeId=s),placeholder:"选择门店",style:{"margin-left":"35px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,s=>(e.openBlock(),e.createBlock(ye,{key:s.id,label:s.storeName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),e.createVNode(F,{modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=s=>x.value=s),"do-submit":e.unref(W),"get-form":()=>r.value.assistantPhone,scale:1,"captcha-list":E.value,"sms-type":"SHOP_STORE_FOUND",onSuccess:c},null,8,["modelValue","do-submit","get-form","captcha-list"])])}}}),Te="",ge=Object.freeze(Object.defineProperty({__proto__:null,default:$(ke,[["__scopeId","data-v-115ea386"]])},Symbol.toStringTag,{value:"Module"}));return H});
