(function(e,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue"),require("vue-router"),require("@/components/chrome-tab/index.vue"),require("@/components/qszr-core/packages/q-table/QTable"),require("@/components/qszr-core/packages/q-table/q-table-column.vue"),require("@/components/PageManage.vue"),require("element-plus"),require("@/composables/useConvert"),require("@/components/SchemaForm.vue"),require("@vueuse/core"),require("@/store/modules/GDRegionData"),require("@/components/q-address"),require("lodash-es"),require("@/utils/date"),require("vue-clipboard3"),require("@element-plus/icons-vue"),require("@/components/remark/remark-flag.vue"),require("@/components/remark/remark-popup.vue"),require("@/utils/Storage"),require("@/components/q-editor/editor.vue"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","vue-router","@/components/chrome-tab/index.vue","@/components/qszr-core/packages/q-table/QTable","@/components/qszr-core/packages/q-table/q-table-column.vue","@/components/PageManage.vue","element-plus","@/composables/useConvert","@/components/SchemaForm.vue","@vueuse/core","@/store/modules/GDRegionData","@/components/q-address","lodash-es","@/utils/date","vue-clipboard3","@element-plus/icons-vue","@/components/remark/remark-flag.vue","@/components/remark/remark-popup.vue","@/utils/Storage","@/components/q-editor/editor.vue","@/apis/http"],j):(e=typeof globalThis<"u"?globalThis:e||self,e.Integral=j(e.IntegralContext.Vue,e.IntegralContext.VueRouter,e.IntegralContext.ChromeTab,e.IntegralContext.QTable,e.IntegralContext.QTableColumn,e.IntegralContext.PageManageTwo,e.IntegralContext.ElementPlus,e.IntegralContext.UseConvert,e.IntegralContext.SchemaForm,e.IntegralContext.VueUse,e.IntegralContext.GDRegionData,e.IntegralContext.QAddressIndex,e.IntegralContext.Lodash,e.IntegralContext.DateUtil,e.IntegralContext.VueClipboard3,e.IntegralContext.ElementPlusIconsVue,e.IntegralContext.RemarkFlag,e.IntegralContext.RemarkPopup,e.IntegralContext.Storage,e.IntegralContext.Editor,e.IntegralContext.Request))})(this,function(e,j,Ge,de,R,ce,_,pe,me,fe,Le,Ue,$e,Ae,Pe,Me,qe,Fe,ze,ue,I){"use strict";var ge=document.createElement("style");ge.textContent=`@charset "UTF-8";[data-v-42288e29]{font-size:14px}.commodity[data-v-42288e29]{display:flex;justify-content:center;align-items:center;justify-content:flex-start;align-items:flex-start}.commodity__right[data-v-42288e29]{height:68px;margin-left:10px;display:flex;flex-direction:column;justify-content:space-between}.commodity__right--name[data-v-42288e29]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.commodity__right--price[data-v-42288e29]{width:150px;margin-top:15px;font-size:12px}.del[data-v-42288e29]{cursor:pointer;margin:0 10px;color:red}.bj[data-v-42288e29]{cursor:pointer;margin:0 10px;color:#409eff}.show[data-v-42288e29]{display:none}.input-with-select[data-v-42288e29]{width:350px;float:right;position:relative;z-index:9}[data-v-42288e29] .body--header{width:14px;height:14px;float:left;border:0;transform:translate(5px,50px)}[data-v-42288e29] .m__table--head.padding:after{content:""}[data-v-42288e29] .m__table--body:after{content:""}.notShipment__info[data-v-09bc95fc]{display:flex;justify-content:center;align-items:center;flex-direction:column;color:#838383;align-items:start}.notShipment__show[data-v-09bc95fc]{font-size:14px;color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.el-table td[data-v-09bc95fc]{border-bottom:none}.tableStyle[data-v-09bc95fc]:before{width:0}.el-table[data-v-09bc95fc]{border-radius:9px;border:1px solid #d5d5d5}.el-table th.is-leaf[data-v-09bc95fc]{border-bottom:none}.footer[data-v-09bc95fc]{display:flex;justify-content:flex-end;align-items:center}.demo-tabs>.el-tabs__content[data-v-cefa0b69]{padding:32px;color:#6b778c;font-size:32px;font-weight:600}[data-v-0e8f2f1b]{font-size:14px}.goods-Infor[data-v-0e8f2f1b]{display:flex;justify-content:center;align-items:center;align-items:flex-start}.goods-Infor__name[data-v-0e8f2f1b]{height:68px;display:flex;justify-content:center;align-items:center;flex-direction:column;justify-content:space-around;align-items:flex-start;overflow:hidden}.goods-Infor__name--integral[data-v-0e8f2f1b]{color:#ff7417}.base-vip-table[data-v-0e8f2f1b]{overflow:auto}.base-vip-table-top[data-v-0e8f2f1b]{display:flex;justify-content:center;align-items:center;justify-content:space-between;width:100%}.base-vip-table-top__left[data-v-0e8f2f1b]{color:#333}.base-vip-table-top__left span[data-v-0e8f2f1b]:after{content:"|";padding:0 5px}.base-vip-table-top__left span[data-v-0e8f2f1b]:last-child:after{content:""}.operation[data-v-0e8f2f1b]{text-align:right;display:flex}.ellipsis[data-v-0e8f2f1b]{width:250px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;white-space:normal;text-overflow:unset;word-break:break-all}.content[data-v-0e8f2f1b]{display:flex;flex-direction:column;height:45px;justify-content:space-around}.fix[data-v-0e8f2f1b]{width:100%;cursor:pointer;display:flex;justify-content:center;align-items:center;height:40px;background:#f9f9f9}.fix__arrow[data-v-0e8f2f1b]{margin-left:4px}.fix__down[data-v-0e8f2f1b]{transform:rotate(180deg)}.warning[data-v-0e8f2f1b]{line-height:24px;padding:14px;margin-bottom:10px;background:rgba(233,0,0,.05);color:#e90000;font-size:14px}.warning span[data-v-0e8f2f1b]{font-size:18px;font-weight:700;color:#f72020}.item[data-v-0e8f2f1b]{height:25px;line-height:25px}.title[data-v-fbd3af3a]{margin:15px 10px;display:flex;justify-content:center;align-items:center;justify-content:flex-start;font-size:14px;color:#555cfd;font-weight:700}.title[data-v-fbd3af3a]:before{content:"";display:inline-block;height:14px;width:2.5px;background:#555cfd;margin-right:9px}.use_rules[data-v-fbd3af3a]{font-size:14px;font-family:sans-serif,sans-serif-Normal;font-weight:400;text-align:LEFT;color:#333;line-height:30px}.use_rules__msg[data-v-fbd3af3a]{font-size:14px;text-align:LEFT;color:#d3d3d3}.save[data-v-fbd3af3a]{margin:30px 0;text-align:center}.get_rules[data-v-fbd3af3a]{text-indent:1em;padding:10px 0}.p20[data-v-fbd3af3a]{padding:0 0 0 20px}
`,document.head.appendChild(ge);const je={class:"q_plugin_container"},He=e.defineComponent({__name:"Integral",setup(N){const h=e.ref("goods"),g=j.useRoute(),l=[{label:"积分商品",name:"goods"},{label:"积分订单",name:"order"},{label:"积分规则",name:"rules"}],r={goods:e.defineAsyncComponent(()=>Promise.resolve().then(()=>_t)),order:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ml)),rules:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Dl))};e.watchEffect(()=>{g.query.type&&g.query.type==="order"&&(h.value=g.query.type)});const x=f=>{f&&(h.value=f)};return(f,C)=>(e.openBlock(),e.createElementBlock("div",je,[e.createVNode(Ge,{"tab-list":l,value:h.value,onHandleTabs:x},null,8,["value"]),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r[h.value])))]))}}),Z="addon-integral/integral/",ie=Z+"product/",te=Z+"order/",Ye=N=>I.get({url:ie+"list",params:N}),Ve=(N,h)=>I.put({url:ie+`updateStatus/${N}`,data:h}),Qe=N=>I.del({url:ie+`delete/${N}`}),We=N=>I.get({url:te+"list",params:N}),Xe=()=>I.get({url:Z+"rules/info"}),Je=N=>I.post({url:Z+"rules/save",data:N}),Ke=N=>I.post({url:Z+"rules/update",data:N}),Ze=N=>I.get({url:te+`deliver/single/undeliver/${N}`}),ve=N=>I.put({url:te+"deliver",data:N}),et=N=>I.put({url:te+`deliver/complete/${N}`}),tt=()=>I.get({url:"gruul-mall-freight/fright/list",params:{current:1,size:1e3}}),lt=()=>I.put({url:"addon-integral/integral/order/warning"}),ot={class:"handle_container"},at={class:"commodity"},nt={style:{width:"68px",height:"68px"}},rt={class:"commodity__right"},st={class:"commodity__right--name"},it={key:0,class:"virtual_product"},dt={key:1},ct={key:0,class:"virtual_product"},pt={style:{color:"#ecb789"}},mt={style:{color:"red"}},ft={style:{"font-size":"16px"}},ut={key:0},gt={key:1},Vt={class:"shop-name"},yt=e.defineComponent({__name:"integral-goods",setup(N){const{divTenThousand:h}=pe(),g=e.reactive({size:20,current:1,total:0}),l=e.ref({status:"",keywords:""}),r=j.useRouter(),x=e.ref([]),f=e.ref([]),C=[{label:"商品名称",prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入商品名称"}}];b();async function b(){const{status:s,keywords:n}=l.value,{code:y,data:E,msg:S}=await Ye({keyword:n,status:s,...g});if(y!==200){_.ElMessage.error(S||"获取积分商品列表失败");return}x.value=E.records,g.total=E.total}const T=()=>{Object.keys(l.value).forEach(s=>l.value[s]=""),b()},k=async()=>{if(!f.value.length){_.ElMessage.error("请选择商品");return}try{if(!await _.ElMessageBox.confirm("确定进行删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=f.value.map(y=>y.id);await B(n),f.value=[]}catch{return}},B=async s=>{const{code:n,data:y,msg:E}=await Qe(s);if(n!==200){_.ElMessage.error(E||"删除失败");return}_.ElMessage.success(E||"删除成功"),b()},U=async s=>{if(!f.value.length){_.ElMessage.error("请选择商品");return}try{if(!await _.ElMessageBox.confirm(`确定进行${s==="SELL_OFF"?"下":"上"}架?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const y=f.value.map(E=>E.id);await q(s,y),f.value=[]}catch{return!1}};async function q(s,n){const{code:y,data:E,msg:S}=await Ve(s,n);if(y!==200)return _.ElMessage.error(S||"操作失败"),!1;_.ElMessage.success("操作成功"),b()}const H=()=>{r.push({name:"addIntegralMallGoods"})},F=s=>{r.push({name:"addIntegralMallGoods",query:{id:s.id}})},w=async(s,n)=>{switch(s){case"DELETE":try{if(!await _.ElMessageBox.confirm("确定进行删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;B([n.id])}catch(y){console.log(y)}break}},o=s=>{g.size=s,b()},t=s=>{g.current=s,b()},u=async s=>{const{code:n,data:y,msg:E}=await Ve(s.status==="SELL_OFF"?"SELL_ON":"SELL_OFF",[s.id]);if(n!==200)return _.ElMessage.error(E||"操作失败"),!1;b()},c=()=>{f.value=[],b()};return(s,n)=>{const y=e.resolveComponent("el-tab-pane"),E=e.resolveComponent("el-tabs"),S=e.resolveComponent("el-button"),$=e.resolveComponent("el-image"),O=e.resolveComponent("el-tooltip"),G=e.resolveComponent("el-switch");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(me,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=p=>l.value=p),columns:C,onSearchHandle:b,onHandleReset:T},null,8,["modelValue"]),e.createVNode(E,{modelValue:l.value.status,"onUpdate:modelValue":n[1]||(n[1]=p=>l.value.status=p),class:"demo-tabs tab_container",onTabChange:c},{default:e.withCtx(()=>[e.createVNode(y,{label:"全部",name:""}),e.createVNode(y,{label:"已上架",name:"SELL_ON"}),e.createVNode(y,{label:"已下架",name:"SELL_OFF"})]),_:1},8,["modelValue"]),e.createElementVNode("div",ot,[e.createVNode(S,{type:"primary",onClick:H},{default:e.withCtx(()=>n[5]||(n[5]=[e.createTextVNode("新增积分商品")])),_:1}),l.value.status!=="SELL_ON"?(e.openBlock(),e.createBlock(S,{key:0,disabled:f.value.length===0,onClick:n[2]||(n[2]=p=>U("SELL_ON"))},{default:e.withCtx(()=>n[6]||(n[6]=[e.createTextVNode("批量上架")])),_:1},8,["disabled"])):e.createCommentVNode("",!0),l.value.status!=="SELL_OFF"?(e.openBlock(),e.createBlock(S,{key:1,disabled:f.value.length===0,onClick:n[3]||(n[3]=p=>U("SELL_OFF"))},{default:e.withCtx(()=>n[7]||(n[7]=[e.createTextVNode("批量下架")])),_:1},8,["disabled"])):e.createCommentVNode("",!0),e.createVNode(S,{disabled:f.value.length===0,onClick:k},{default:e.withCtx(()=>n[8]||(n[8]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createVNode(e.unref(de),{ref:"multipleTableRef","checked-item":f.value,"onUpdate:checkedItem":n[4]||(n[4]=p=>f.value=p),data:x.value,selection:!0,style:{overflow:"auto"},"no-border":""},{default:e.withCtx(()=>[e.createVNode(R,{label:"商品",prop:"goodInfo",align:"left",width:"280"},{default:e.withCtx(({row:p})=>[e.createElementVNode("div",at,[e.createElementVNode("div",nt,[e.createVNode($,{style:{width:"68px",height:"68px"},src:p.pic,fit:"fill"},null,8,["src"])]),e.createElementVNode("div",rt,[e.createElementVNode("div",st,[p.name.length>=30?(e.openBlock(),e.createBlock(O,{key:0,effect:"dark",content:p.name,placement:"top-start"},{default:e.withCtx(()=>[e.createElementVNode("span",null,[p.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",it,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(p==null?void 0:p.name),1)])]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("span",dt,[p.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",ct,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(p==null?void 0:p.name),1)]))])])])]),_:1}),e.createVNode(R,{label:"积分",prop:"productType",align:"left",width:"160"},{default:e.withCtx(({row:p})=>[e.createElementVNode("div",pt,[e.createElementVNode("span",null,e.toDisplayString(p.integralPrice),1)])]),_:1}),e.createVNode(R,{label:"销售价(元)",prop:"salePrice",align:"left",width:"160"},{default:e.withCtx(({row:p})=>[e.createElementVNode("div",mt,[e.unref(h)(p.salePrice)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("span",ft,e.toDisplayString(e.unref(h)(p.salePrice).toFixed(2).split(".")[0]),1),+e.unref(h)(p.salePrice).toFixed(2)>0?(e.openBlock(),e.createElementBlock("span",ut,"."+e.toDisplayString(e.unref(h)(p.salePrice).toFixed(2).split(".")[1]),1)):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("span",gt,"0"))])]),_:1}),e.createVNode(R,{label:"库存",prop:"stock",align:"left",width:"120"}),e.createVNode(R,{label:"商品状态",width:"120",align:"left"},{default:e.withCtx(({row:p})=>[e.createElementVNode("span",Vt,[e.createVNode(G,{"model-value":p.status==="SELL_ON",class:"ml-2","inline-prompt":"","active-text":"上架","inactive-text":"下架",onChange:L=>u(p)},null,8,["model-value","onChange"])])]),_:1}),e.createVNode(R,{label:"操作",align:"right",width:"120",fixed:"right"},{default:e.withCtx(({row:p})=>[e.createVNode(S,{type:"primary",link:"",onClick:L=>F(p)},{default:e.withCtx(()=>n[9]||(n[9]=[e.createTextVNode("编辑")])),_:2},1032,["onClick"]),p.status==="SELL_OFF"?(e.openBlock(),e.createBlock(S,{key:0,type:"danger",link:"",onClick:L=>w("DELETE",p)},{default:e.withCtx(()=>n[10]||(n[10]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["checked-item","data"]),e.createVNode(ce,{class:"pagination","page-size":g.size,"page-num":g.current,total:g.total,onHandleSizeChange:o,onHandleCurrentChange:t},null,8,["page-size","page-num","total"])],64)}}}),Ol="",v=(N,h)=>{const g=N.__vccOpts||N;for(const[l,r]of h)g[l]=r;return g},_t=Object.freeze(Object.defineProperty({__proto__:null,default:v(yt,[["__scopeId","data-v-42288e29"]])},Symbol.toStringTag,{value:"Module"})),xt={style:{display:"flex","justify-content":"space-between","border-bottom":"1px dashed #ccc",height:"90px"}},Nt={style:{display:"flex","justify-content":"space-around","flex-direction":"column"}},ht={style:{"font-weight":"bold"}},kt={key:0},Ct={key:1},bt={style:{display:"flex","justify-content":"space-around","flex-direction":"column"}},Et={key:0,style:{width:"300px"}},wt={style:{margin:"5px 0",display:"flex","justify-content":"space-between",height:"30px"}},St={class:"send"},Tt={key:0,class:"send",style:{"font-weight":"bold"}},It={key:1,class:"send",style:{"font-weight":"bold"}},Rt={class:"send"},Dt={style:{display:"flex"}},Bt={class:"notShipment__info",style:{width:"200px","padding-left":"10px"}},Ot={class:"notShipment__show"},Gt={style:{"text-align":"center"}},Lt={style:{"font-size":"12px"}},Ut={class:"footer"},$t=e.defineComponent({__name:"notShipment",props:{currentNo:{type:String,required:!0},isShow:{type:Boolean,required:!0}},emits:["update:isShow","upload-list"],setup(N,{emit:h}){const g=N,l=e.ref([]),r=h,x=fe.useVModel(g,"isShow",r),f=e.ref({sellerRemark:"",buyerRemark:"",payTime:"",deliveryTime:"",accomplishTime:"",buyerId:"",buyerNickname:"",createTime:"",freightPrice:0,image:"",salePrice:"",integralOrderReceiver:{address:"",area:[],createTime:"",id:"",mobile:"",name:"",orderNo:"",updateTime:""},no:"",num:1,price:"",productName:"",status:"PAID",productType:"REAL_PRODUCT"}),C=e.ref(),b=e.ref(),T=e.reactive({address:[],company:[{required:!0,message:"请选择物流公司",trigger:"change"}],expressNo:[{required:!0,message:"请填写物流单号",trigger:"blur"},{min:8,max:20,message:"请填写正确的物流单号",trigger:"blur"}],expressCode:[{required:!0,message:"请选择物流公司",trigger:"change"}]}),k=e.reactive({deliverType:"EXPRESS",receiver:{name:"",mobile:"",address:""},expressCompany:"",expressCode:"",addressaddress:"",expressNo:"",expressName:""});B(),U();async function B(){if(!g.currentNo){_.ElMessage.error("获取订单号失败"),x.value=!1;return}const{code:o,data:t,msg:u}=await Ze(g.currentNo);if(o!==200){_.ElMessage.error(u||"获取订单详情失败"),x.value=!1;return}f.value=t,C.value.toggleRowSelection(f.value,!0)}async function U(){const{data:o}=await tt();l.value=o==null?void 0:o.records}const q=async()=>{var o;try{if(await((o=b.value)==null?void 0:o.validate())){const u=F(k.deliverType);console.log(u);const{code:c,msg:s,data:n}=await ve([u]);if(c!==200){_.ElMessage.error(s||"发货失败");return}_.ElMessage.success("发货成功"),x.value=!1,r("upload-list")}}catch{}},H=o=>{var t,u,c;k.expressName=((c=(u=(t=l.value)==null?void 0:t.filter(s=>s.logisticsCompanyCode===o))==null?void 0:u.pop())==null?void 0:c.logisticsCompanyName)||""},F=o=>{var n,y;const{deliverType:t,expressCode:u,expressNo:c,expressName:s}=k;return o==="EXPRESS"?{integralOrderNo:g.currentNo,integralOrderDeliverType:((n=f.value)==null?void 0:n.productType)==="REAL_PRODUCT"?"EXPRESS":"WITHOUT",expressCompanyName:u,expressNo:c,expressName:s}:{integralOrderNo:g.currentNo,integralOrderDeliverType:((y=f.value)==null?void 0:y.productType)==="REAL_PRODUCT"?"EXPRESS":"WITHOUT"}},w=()=>{x.value=!1};return(o,t)=>{const u=e.resolveComponent("el-option"),c=e.resolveComponent("el-select"),s=e.resolveComponent("el-col"),n=e.resolveComponent("el-row"),y=e.resolveComponent("el-form-item"),E=e.resolveComponent("el-input"),S=e.resolveComponent("el-avatar"),$=e.resolveComponent("el-table-column"),O=e.resolveComponent("el-table"),G=e.resolveComponent("el-form"),p=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(G,{ref_key:"ruleFormRef",ref:b,model:k,class:"notShipment",rules:T},{default:e.withCtx(()=>{var L,Y,z,Q,W,m,i;return[e.createElementVNode("div",xt,[e.createElementVNode("div",Nt,[e.createElementVNode("div",ht,e.toDisplayString((Y=(L=f.value)==null?void 0:L.integralOrderReceiver)==null?void 0:Y.name),1),e.createElementVNode("div",null,e.toDisplayString((Q=(z=f.value)==null?void 0:z.integralOrderReceiver)==null?void 0:Q.mobile),1),f.value.integralOrderReceiver.address?(e.openBlock(),e.createElementBlock("div",kt,e.toDisplayString((W=f.value.integralOrderReceiver.area)==null?void 0:W.join(""))+" "+e.toDisplayString(f.value.integralOrderReceiver.address),1)):(e.openBlock(),e.createElementBlock("div",Ct,"暂无地址信息"))]),e.createElementVNode("div",bt,[((m=f.value)==null?void 0:m.productType)==="REAL_PRODUCT"?(e.openBlock(),e.createElementBlock("div",Et,[k.deliverType!=="WITHOUT"?(e.openBlock(),e.createBlock(y,{key:0,"label-width":"120px",prop:"expressCode"},{label:e.withCtx(()=>t[3]||(t[3]=[e.createElementVNode("div",{class:"send"},"物流公司",-1)])),default:e.withCtx(()=>[e.createVNode(n,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(s,{span:20},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:k.expressCode,"onUpdate:modelValue":t[0]||(t[0]=V=>k.expressCode=V),placeholder:"请选择物流公司",class:"m-2",style:{width:"100%",height:"30px"},onChange:H},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,V=>(e.openBlock(),e.createBlock(u,{key:V.logisticsCompanyName,label:V.logisticsCompanyName,value:V.logisticsCompanyCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0),k.deliverType==="EXPRESS"?(e.openBlock(),e.createBlock(y,{key:1,"label-width":"120px",prop:"expressNo"},{label:e.withCtx(()=>t[4]||(t[4]=[e.createElementVNode("div",null,"物流单号",-1)])),default:e.withCtx(()=>[e.createVNode(n,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(s,{span:20},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:k.expressNo,"onUpdate:modelValue":t[1]||(t[1]=V=>k.expressNo=V),placeholder:"",style:{width:"100%",height:"30px"},maxlength:"40"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0)])):((i=f.value)==null?void 0:i.productType)==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createBlock(y,{key:1,"label-width":"90px"},{default:e.withCtx(()=>t[5]||(t[5]=[e.createElementVNode("div",{style:{color:"#f20404"}},"您可通过网络形式(如:聊天工具将商品发给用户)发货",-1)])),_:1})):e.createCommentVNode("",!0)])]),e.createElementVNode("div",wt,[e.createVNode(y,{"label-width":"70px",left:""},{label:e.withCtx(()=>t[6]||(t[6]=[e.createElementVNode("div",{class:"send"},"订单号：",-1)])),default:e.withCtx(()=>[e.createElementVNode("div",St,e.toDisplayString(g.currentNo),1)]),_:1}),e.createVNode(y,{"label-width":"90px"},{label:e.withCtx(()=>t[7]||(t[7]=[e.createElementVNode("div",{class:"send"},"配送方式：",-1)])),default:e.withCtx(()=>{var V;return[((V=f.value)==null?void 0:V.productType)==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("div",Tt,"无需物流")):(e.openBlock(),e.createElementBlock("div",It,"快递配送"))]}),_:1}),e.createVNode(y,{"label-width":"90px"},{label:e.withCtx(()=>t[8]||(t[8]=[e.createElementVNode("div",{class:"send"},"下单时间：",-1)])),default:e.withCtx(()=>[e.createElementVNode("div",Rt,e.toDisplayString(f.value.createTime),1)]),_:1})]),e.createVNode(O,{ref_key:"tableRef",ref:C,"empty-text":"暂无数据~",data:[f.value],"max-height":"250",style:{width:"100%","margin-bottom":"20px"},"header-row-style":()=>({fontSize:"14px",color:"#333333",fontWeight:"bold"})},{default:e.withCtx(()=>[e.createVNode($,{label:"商品",align:"center"},{default:e.withCtx(({row:V})=>[e.createElementVNode("div",Dt,[e.createVNode(S,{style:{width:"68px",height:"68px","flex-shrink":"0"},shape:"square",size:"large",src:V.image},null,8,["src"]),e.createElementVNode("div",Bt,[e.createElementVNode("div",Ot,e.toDisplayString(V.productName),1)])])]),_:1}),e.createVNode($,{label:"数量",width:"200",align:"center"},{default:e.withCtx(({row:V})=>[e.createElementVNode("div",Gt,[e.createElementVNode("div",Lt,e.toDisplayString(V.num)+" 件",1)])]),_:1})]),_:1},8,["data"]),k.deliverType==="PRINT_EXPRESS"?(e.openBlock(),e.createBlock(y,{key:0,"label-width":"90px",prop:""},{label:e.withCtx(()=>t[9]||(t[9]=[e.createElementVNode("div",null,"发货地址",-1)])),default:e.withCtx(()=>[e.createVNode(n,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(s,{span:20},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:k.addressaddress,"onUpdate:modelValue":t[2]||(t[2]=V=>k.addressaddress=V),placeholder:"选择发货地址",style:{width:"100%",height:"30px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.deliveryAddressData,V=>(e.openBlock(),e.createBlock(u,{key:V.id,value:V.id,label:`${e.unref(Ue.AddressFn)(e.unref(Le.regionData),[V.provinceCode,V.cityCode,V.regionCode])}${V.address}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0)]}),_:1},8,["model","rules"]),e.createElementVNode("footer",Ut,[e.createVNode(p,{onClick:w},{default:e.withCtx(()=>t[10]||(t[10]=[e.createTextVNode("取消")])),_:1}),t[12]||(t[12]=e.createTextVNode()),e.createVNode(p,{type:"primary",onClick:q},{default:e.withCtx(()=>t[11]||(t[11]=[e.createTextVNode("确认")])),_:1})])],64)}}}),Ll="",At=v($t,[["__scopeId","data-v-09bc95fc"]]),Pt={class:"my-header"},Mt=["id"],qt=e.defineComponent({__name:"order-shipment",props:{isShow:{type:Boolean,default:!1},currentNo:{type:String,default:""}},emits:["update:isShow","upload-list"],setup(N,{emit:h}){const g=N,l=h,r=fe.useVModel(g,"isShow",l),x=()=>{r.value=!1};return(f,C)=>{const b=e.resolveComponent("el-dialog");return e.openBlock(),e.createBlock(b,{modelValue:e.unref(r),"onUpdate:modelValue":C[2]||(C[2]=T=>e.isRef(r)?r.value=T:null),width:"700","before-close":x,"destroy-on-close":""},{header:e.withCtx(({titleId:T,titleClass:k})=>[e.createElementVNode("div",Pt,[e.createElementVNode("h4",{id:T,class:e.normalizeClass(k)},"商品发货",10,Mt)])]),default:e.withCtx(()=>[e.createVNode(At,{"is-show":e.unref(r),"onUpdate:isShow":C[0]||(C[0]=T=>e.isRef(r)?r.value=T:null),"current-no":g.currentNo,onUploadList:C[1]||(C[1]=T=>l("upload-list"))},null,8,["is-show","current-no"])]),_:1},8,["modelValue"])}}}),Ul="",Ft=v(qt,[["__scopeId","data-v-cefa0b69"]]),zt={UNPAID:"未支付",PAID:"待发货",ON_DELIVERY:"已发货",ACCOMPLISH:"已完成",SYSTEM_CLOSED:"已关闭"},jt={class:"handle_container"},Ht={class:"base-vip-table-top"},Yt={class:"base-vip-table-top__left"},Qt={class:"goods-Infor"},Wt={class:"goods-Infor__name"},Xt={class:"ellipsis"},Jt={key:0,class:"virtual_product"},Kt={key:1},Zt={key:0,class:"virtual_product"},vt={class:"goods-Infor__name--integral"},el={class:"commodity__right--price"},tl={key:0},ll={class:"content"},ol={style:{width:"200px"}},al={style:{width:"100px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},nl={key:0},rl={style:{width:"200px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},sl={style:{display:"inline",color:"#ecb789"}},il={class:"commodity__right--price content"},dl={key:0},cl={class:"money_text",style:{"margin-bottom":"5px"}},pl=e.defineComponent({__name:"integral-order",emits:["search-data","changeShow"],setup(N,{emit:h}){Pe();const g=e.reactive({size:20,current:1,total:0}),l=e.ref({no:"",consignee:"",productName:"",date:[],status:"",affiliationPlatform:""}),{divTenThousand:r}=pe(),x=e.ref(!1),f=e.ref([]),C=e.ref(""),b=j.useRouter(),T=e.ref([]),k=e.ref([]),B=e.ref(!1),U=e.ref(""),q=e.ref("calc(100vh - 310px)"),H=[{label:"订单号",labelWidth:60,prop:"no",valueType:"copy",fieldProps:{placeholder:"请输入订单号",maxlength:20}},{label:"收货人姓名",prop:"consignee",labelWidth:90,valueType:"copy",fieldProps:{placeholder:"请输入收货人姓名",maxlength:30}},{label:"商品名称",prop:"productName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称",maxlength:30}},{label:"创建时间",prop:"date",valueType:"date-picker",fieldProps:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",valueFormat:"YYYY-MM-DD"}},{label:"所属渠道",prop:"affiliationPlatform",valueType:"select",options:[{label:"全部",value:""},{label:"小程序",value:"WECHAT_MINI_APP"},{label:"PC商城",value:"PC"},{label:"H5商城",value:"H5"},{label:"IOS",value:"IOS"},{label:"安卓",value:"ANDROID"},{label:"鸿蒙",value:"HARMONY"}],fieldProps:{placeholder:"请选择"}}];w();const F=e.ref("0");async function w(){var X,J;const m=$e.cloneDeep(l.value);Array.isArray(m.date)&&(m.startTime=(X=m.date)==null?void 0:X[0],m.endTime=(J=m.date)==null?void 0:J[1]),delete m.date;const{code:i,data:V,msg:A}=await We({...g,...m});if(i!==200){_.ElMessage.error(A||"获取订单失败");return}T.value=V.records,g.total=V.total,F.value=V.waitDeliveryNum}const o=()=>{Object.keys(l.value).forEach(m=>l.value[m]=""),w()},t=m=>{U.value=m.no,B.value=!0},u=m=>{f.value=[m.no],m.sellerRemark&&(C.value=m.sellerRemark),x.value=!0},c=m=>{g.size=m,w()},s=m=>{g.current=m,w()},n=()=>{k.value=[],w()},y=m=>{b.push({name:"integralMallOrderDetail",query:{no:m}})},E=async m=>{try{await _.ElMessageBox.confirm("确认关闭订单?","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warning"});const{code:i,msg:V,data:A}=await et(m.no);if(i!==200){_.ElMessage.error(V||"关闭订单失败");return}_.ElMessage.success("关闭订单成功"),m.status="SYSTEM_CLOSED"}catch{}},S=e.ref(!1);e.watch(()=>S.value,m=>{q.value=m?"calc(100vh - 450px)":"calc(100vh - 310px)"});const $=e.ref("0"),O=new Ae,G=e.ref(" "),p=e.ref("全部订单"),L=async m=>{if(l.value.status=m,w(),m==="PAID"){const{code:i,data:V,msg:A}=await lt();if(i!==200)return _.ElMessage.error(A||"获取待发货订单总数失败");$.value=V}},Y=m=>{if(G.value=" ",p.value=m,p.value==="近一个月订单"){const i=O.getLastMonth(new Date);z(i)}else if(p.value==="近三个月订单"){const i=O.getLastThreeMonth(new Date);z(i)}else l.value.date=[],w()},z=async m=>{const i=O.getYMDs(new Date);l.value.date=[m,i],w()},Q={WECHAT_MINI_APP:"小程序",WECHAT_MP:"公众号",PC:"PC商城",H5:"H5商城",IOS:"IOS",ANDROID:"安卓",HARMONY:"鸿蒙"},W=()=>{if(console.log(k.value),!k.value.length)return _.ElMessage.error("请选择商品");const m=k.value.filter(i=>i.status==="PAID");if(!m.length)return _.ElMessage.error("暂无待发货订单");new ze().setItem("integralOrderSendGoods",m,60*60*24),b.push({name:"integralMallOrderDelivery"})};return(m,i)=>{const V=e.resolveComponent("el-config-provider"),A=e.resolveComponent("el-icon"),X=e.resolveComponent("el-dropdown-item"),J=e.resolveComponent("el-dropdown-menu"),le=e.resolveComponent("el-dropdown"),P=e.resolveComponent("el-tab-pane"),oe=e.resolveComponent("el-badge"),ae=e.resolveComponent("el-tabs"),ne=e.resolveComponent("el-button"),re=e.resolveComponent("el-image"),se=e.resolveComponent("el-tooltip"),ee=e.resolveComponent("el-row"),K=e.resolveComponent("el-link");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(V,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(me,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=a=>l.value=a),columns:H,onSearchHandle:w,onHandleReset:o},null,8,["modelValue"])]),_:1}),e.createVNode(ae,{modelValue:G.value,"onUpdate:modelValue":i[1]||(i[1]=a=>G.value=a),class:"demo-tabs tab_container",onTabChange:L},{default:e.withCtx(()=>[e.createVNode(P,{name:" "},{label:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(p.value),1),e.createVNode(le,{placement:"bottom-end",trigger:"click",onCommand:Y},{dropdown:e.withCtx(()=>[e.createVNode(J,null,{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(["近一个月订单","近三个月订单","全部订单"],a=>e.createVNode(X,{key:a,command:a},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(a),1)]),_:2},1032,["command"])),64))]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("span",{class:"el-dropdown-link",style:{height:"40px"},onClick:e.withModifiers(()=>{},["stop"])},[e.createVNode(A,{class:"el-icon--right",style:{position:"relative",top:"12px"}},{default:e.withCtx(()=>[e.createVNode(e.unref(Me.ArrowDown))]),_:1})])]),_:1})]),_:1}),e.createVNode(P,{label:"待付款",name:"UNPAID"}),e.createVNode(P,{name:"PAID"},{label:e.withCtx(()=>[e.createVNode(oe,{value:F.value,class:"item"},{default:e.withCtx(()=>i[7]||(i[7]=[e.createElementVNode("span",null,"待发货",-1)])),_:1},8,["value"])]),_:1}),e.createVNode(P,{label:"待收货",name:"ON_DELIVERY"}),e.createVNode(P,{label:"已完成",name:"ACCOMPLISH"}),e.createVNode(P,{label:"已关闭",name:"SYSTEM_CLOSED"})]),_:1},8,["modelValue"]),e.createElementVNode("div",jt,[e.createVNode(ne,{onClick:W},{default:e.withCtx(()=>i[8]||(i[8]=[e.createTextVNode("批量发货")])),_:1})]),e.createVNode(e.unref(de),{"checked-item":k.value,"onUpdate:checkedItem":i[2]||(i[2]=a=>k.value=a),data:T.value,class:"base-vip-table",style:e.normalizeStyle({height:q.value}),"header-selection":"","no-border":""},{header:e.withCtx(({row:a})=>[e.createElementVNode("div",Ht,[e.createElementVNode("div",Yt,[e.createElementVNode("span",null,"订单号 : "+e.toDisplayString(a.no),1),e.createElementVNode("span",null,"创建时间 : "+e.toDisplayString(a.createTime),1),e.createElementVNode("span",null,e.toDisplayString(Q[a.affiliationPlatform]),1)]),e.createVNode(qe,{content:a.sellerRemark,onSeeRemark:M=>u(a)},null,8,["content","onSeeRemark"])])]),default:e.withCtx(()=>[e.createVNode(R,{label:"商品",width:"390",align:"left"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",Qt,[e.createVNode(re,{class:"customer-Infor__img",fit:"cover",style:{width:"68px",height:"68px","margin-right":"10px"},src:a.image},null,8,["src"]),e.createElementVNode("div",Wt,[e.createElementVNode("div",Xt,[a.productName.length>=35?(e.openBlock(),e.createBlock(se,{key:0,effect:"dark",content:a.productName,placement:"top-start"},{default:e.withCtx(()=>[e.createElementVNode("span",null,[a.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",Jt,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(a.productName),1)])]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("span",Kt,[a.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",Zt,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(a.productName),1)]))]),e.createElementVNode("div",vt,[e.createElementVNode("div",el,[e.createElementVNode("span",null,e.toDisplayString(a.price),1),i[11]||(i[11]=e.createElementVNode("span",null,"积分",-1)),a.salePrice!=="0"?(e.openBlock(),e.createElementBlock("span",tl,[i[9]||(i[9]=e.createTextVNode("+")),i[10]||(i[10]=e.createElementVNode("span",null,"￥",-1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(r)(a.salePrice)),1)])):e.createCommentVNode("",!0)])])])])]),_:1}),e.createVNode(R,{label:"客户信息",align:"left",width:"250"},{default:e.withCtx(({row:a})=>{var M;return[e.createElementVNode("div",ll,[e.createElementVNode("div",ol,[e.createElementVNode("span",al,e.toDisplayString(a.integralOrderReceiverVO.name?a.integralOrderReceiverVO.name:a.buyerNickname),1),a.integralOrderReceiverVO.mobile?(e.openBlock(),e.createElementBlock("span",nl,"("+e.toDisplayString(a.integralOrderReceiverVO.mobile)+")",1)):e.createCommentVNode("",!0)]),e.createElementVNode("div",rl,e.toDisplayString((M=a.integralOrderReceiverVO.area)==null?void 0:M.join(""))+" "+e.toDisplayString(a.integralOrderReceiverVO.address),1)])]}),_:1}),e.createVNode(R,{prop:"sex",label:"交易信息",align:"left",width:"230",class:"rate_size"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",sl,[e.createElementVNode("div",il,[e.createElementVNode("div",null,[e.createTextVNode(e.toDisplayString(a.price)+"积分 ",1),a.salePrice!=="0"?(e.openBlock(),e.createElementBlock("span",dl,[i[12]||(i[12]=e.createTextVNode("+")),i[13]||(i[13]=e.createElementVNode("span",null,"￥",-1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(r)(a.salePrice)),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"(运费"+e.toDisplayString(a.freightPrice&&e.unref(r)(a.freightPrice).toFixed(2))+"元)",1)])])]),_:1}),e.createVNode(R,{label:"订单状态",width:"120",align:"left"},{default:e.withCtx(({row:a})=>[e.createVNode(ee,{justify:"space-between",align:"middle"},{default:e.withCtx(()=>[e.createVNode(ee,{justify:"space-between",align:"middle",style:{"flex-direction":"column"}},{default:e.withCtx(()=>[e.createElementVNode("div",cl,e.toDisplayString(e.unref(zt)[a.status]),1)]),_:2},1024)]),_:2},1024)]),_:1}),e.createVNode(R,{label:"操作",align:"right",fixed:"right",width:"160"},{default:e.withCtx(({row:a})=>[["PAID"].includes(a.status)?(e.openBlock(),e.createBlock(K,{key:0,underline:!1,style:{"margin-left":"15px"},type:"primary",onClick:M=>t(a)},{default:e.withCtx(()=>i[14]||(i[14]=[e.createTextVNode(" 发货 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(K,{underline:!1,style:{"margin-left":"15px"},type:"primary",onClick:M=>y(a.no)},{default:e.withCtx(()=>i[15]||(i[15]=[e.createTextVNode("查看详情")])),_:2},1032,["onClick"]),["UNPAID"].includes(a.status)?(e.openBlock(),e.createBlock(K,{key:1,underline:!1,style:{"margin-left":"15px"},type:"danger",onClick:M=>E(a)},{default:e.withCtx(()=>i[16]||(i[16]=[e.createTextVNode(" 关闭订单 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["checked-item","data","style"]),e.createVNode(ce,{"page-size":g.size,"page-num":g.current,total:g.total,onHandleSizeChange:c,onHandleCurrentChange:s},null,8,["page-size","page-num","total"]),e.createVNode(Fe,{isShow:x.value,"onUpdate:isShow":i[3]||(i[3]=a=>x.value=a),ids:f.value,"onUpdate:ids":i[4]||(i[4]=a=>f.value=a),remark:C.value,"onUpdate:remark":i[5]||(i[5]=a=>C.value=a),"remark-type":"INTEGRAL",onSuccess:n},null,8,["isShow","ids","remark"]),e.createVNode(Ft,{isShow:B.value,"onUpdate:isShow":i[6]||(i[6]=a=>B.value=a),"current-no":U.value,onUploadList:w},null,8,["isShow","current-no"])],64)}}}),$l="",ml=Object.freeze(Object.defineProperty({__proto__:null,default:v(pl,[["__scopeId","data-v-0e8f2f1b"]])},Symbol.toStringTag,{value:"Module"})),fl={style:{padding:"16px",overflow:"auto"}},ul={class:"use_rules p20"},gl={key:0,style:{border:"1px solid #ccc"}},Vl={key:1},yl={class:"use_rules p20"},_l={key:1},xl={class:"use_rules p20"},Nl={key:0,style:{border:"1px solid #ccc"}},hl={key:1},kl={class:"use_rules p20"},Cl={class:"get_rules"},bl={class:"get_rules"},El={class:"get_rules"},wl={class:"save"},Sl={key:0},Tl={key:0},Il={key:1},Rl=e.defineComponent({__name:"IntegralRules",setup(N){const h=e.ref(!1),g=e.ref(!1),l=e.ref({indate:0,useRule:"<div>（1）积分使用过程中不找零、不兑现、不开发票，不可转移至其他账户。</div><div>（2）使用积分进行兑换，兑换申请一经提交, 一律不能退货</div><div>（3）如因积分商品缺货等原因导致的退货退款，积分会原路返还</div><div>（4）兑换礼品涉及运费和配送费由用户自行承担。</div><div>（5）启山智软保留最终解释权。</div>",ruleInfo:"<div>月度滚动过期制。 每个自然月的第1天00：00分自动清零 已满一年的积分。 举例：2022年8月1日开始清除2023年7月31日</div>",integralGainRule:[{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SHARE",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"LOGIN",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SING_IN",open:!1},{rulesParameter:{consumeJson:[{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]},gainRuleType:"CONSUME",open:!1}]}),r=e.ref({LOGIN:[{key:0,value:0},{key:0,value:0}],SING_IN:[{key:0,value:0},{key:0,value:0}],CONSUME:[{key:0,value:0},{key:0,value:0}]});C();const x=e.ref([{consumeGrowthValueType:"ORDER_QUANTITY",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"ORDER_AMOUNT",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]),f=e.ref("ORDER_QUANTITY");async function C(){var c;const{code:o,data:t,msg:u}=await Xe();if(o!==200){_.ElMessage.error(u||"积分规则获取失败");return}if(t&&t.useRule){B(t),l.value=t,x.value=t.integralGainRule[3].rulesParameter.consumeJson,((c=t.integralGainRule[3].rulesParameter.consumeJson[0])==null?void 0:c.isSelected)===!0?f.value="ORDER_QUANTITY":f.value="ORDER_AMOUNT";return}g.value=!0}const b=(o=!1)=>{h.value=!h.value,o&&C()},T=async()=>{if(!q())return;const o=U();if(o==="COMPLETE"){k();const{code:t,msg:u}=await(g.value?Je(l.value):Ke(l.value));if(t!==200){_.ElMessage.error(u||`${g.value?"保存":"修改"}积分规则失败`);return}_.ElMessage.success(`${g.value?"保存":"修改"}积分规则成功`),C(),F()}else _.ElMessage.info(`连续${o==="LOGIN"?"登录":"签到"}天数输入重复，请修改`)};function k(){l.value.integralGainRule.forEach(o=>{let t={};const u=r.value[o.gainRuleType];if(u){for(let c=0;c<u.length;c++){const s=u[c].key,n=u[c].value;t[s]=n}o.rulesParameter.extendValue=t}o.gainRuleType==="CONSUME"&&(o.open?x.value.forEach(c=>{c.isSelected=c.consumeGrowthValueType===f.value}):x.value.forEach(c=>{c.isSelected=!1}),o.rulesParameter.consumeJson=x.value)})}function B(o){o.integralGainRule.forEach(t=>{let u=[];if(r.value[t.gainRuleType]){for(const s in t.rulesParameter.extendValue)u.push({key:s,value:t.rulesParameter.extendValue[s]});r.value[t.gainRuleType]=u}})}function U(){const o=new Map;if(r.value.LOGIN.filter(c=>!o.has(c.key)&&o.set(c.key,c.value)).length!==r.value.LOGIN.length)return"LOGIN";o.clear();const u=r.value.SING_IN.filter(c=>!o.has(c.key)&&o.set(c.key,c.value)).length;return u!==r.value.SING_IN.length?(console.log("singInLen",u),"SING_IN"):"COMPLETE"}function q(){const{indate:o,useRule:t,ruleInfo:u,integralGainRule:c}=l.value;if(!o)return _.ElMessage.info("请输入积分有效期"),!1;if(!t.trim().length||t==="<p><br></p>")return _.ElMessage.info("请输入积分规则"),!1;if(!u.trim().length||u==="<p><br></p>")return _.ElMessage.info("请输入积分值信息"),!1;if(c.every(y=>!!y.rulesParameter.basicsValue))return _.ElMessage.info("请输入首次赠送积分值信息"),!1;const n=H();return console.log(n),n?(_.ElMessage.info(n),!1):!0}function H(){let o="";const t=r.value.LOGIN,u=r.value.SING_IN,c=r.value.SING_IN;if(t.forEach(s=>{if(!s.key)return o="请输入连续登录天数",o;if(!s.value)return o="请输入连续登录赠送积分值",o}),o||(u.forEach(s=>{if(!s.key)return o="请输入连续签到天数",o;if(!s.value)return o="请输入连续登签到赠送积分值",o}),o)||(c.forEach(s=>{if(!s.key)return o;if(!s.value)return o="请输入赠送的积分值",o}),o))return o}function F(){h.value=!1,g.value=!1}const w=o=>{console.log(o),o==="ORDER_QUANTITY"&&(x.value[0].isSelected=!0,x.value[1].isSelected=!1),o==="ORDER_AMOUNT"&&(x.value[1].isSelected=!0,x.value[0].isSelected=!1)};return(o,t)=>{var O,G,p,L,Y,z,Q,W,m,i,V,A,X,J,le,P,oe,ae,ne,re,se,ee,K,a,M,ye,_e,xe,Ne,he,ke,Ce,be,Ee,we,Se,Te,Ie,Re,De,Be,Oe;const u=e.resolveComponent("el-button"),c=e.resolveComponent("el-input-number"),s=e.resolveComponent("el-checkbox"),n=e.resolveComponent("el-input"),y=e.resolveComponent("el-radio"),E=e.resolveComponent("el-form-item"),S=e.resolveComponent("el-radio-group"),$=e.resolveDirective("dompurify-html");return e.openBlock(),e.createElementBlock("div",fl,[e.withDirectives(e.createVNode(u,{round:"",type:"primary",onClick:t[0]||(t[0]=d=>b(!1))},{default:e.withCtx(()=>t[21]||(t[21]=[e.createTextVNode("编辑积分规则")])),_:1},512),[[e.vShow,!h.value]]),t[54]||(t[54]=e.createElementVNode("div",{class:"title"},"积分使用规则",-1)),e.createElementVNode("div",ul,[h.value?(e.openBlock(),e.createElementBlock("div",gl,[e.createVNode(ue,{modelValue:l.value.useRule,"onUpdate:modelValue":t[1]||(t[1]=d=>l.value.useRule=d),height:200},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",Vl,null,512)),[[$,l.value.useRule]])]),t[55]||(t[55]=e.createElementVNode("div",{class:"title"},"积分有效期",-1)),e.createElementVNode("div",yl,[e.createElementVNode("div",null,[t[22]||(t[22]=e.createTextVNode(" 积分有效期为 ")),h.value?(e.openBlock(),e.createBlock(c,{key:0,modelValue:l.value.indate,"onUpdate:modelValue":t[2]||(t[2]=d=>l.value.indate=d),controls:!1,min:1,max:12,style:{width:"50px"}},null,8,["modelValue"])):(e.openBlock(),e.createElementBlock("span",_l,e.toDisplayString(l.value.indate),1)),t[23]||(t[23]=e.createTextVNode(" 个月 "))])]),t[56]||(t[56]=e.createElementVNode("div",{class:"title"},"积分值规则",-1)),e.createElementVNode("div",xl,[h.value?(e.openBlock(),e.createElementBlock("div",Nl,[e.createVNode(ue,{modelValue:l.value.ruleInfo,"onUpdate:modelValue":t[3]||(t[3]=d=>l.value.ruleInfo=d)},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",hl,null,512)),[[$,l.value.ruleInfo]])]),t[57]||(t[57]=e.createElementVNode("div",{class:"title"},"积分获取规则",-1)),e.createElementVNode("div",kl,[h.value&&((O=l.value)!=null&&O.integralGainRule)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(s,{modelValue:l.value.integralGainRule[0].open,"onUpdate:modelValue":t[4]||(t[4]=d=>l.value.integralGainRule[0].open=d)},{default:e.withCtx(()=>t[24]||(t[24]=[e.createTextVNode("分享")])),_:1},8,["modelValue"]),t[50]||(t[50]=e.createElementVNode("span",{class:"use_rules__msg"},"（限制用户首次分享才可获得积分）",-1)),e.createElementVNode("div",Cl,[t[25]||(t[25]=e.createTextVNode(" 每日首次分享获得 ")),e.createVNode(c,{modelValue:l.value.integralGainRule[0].rulesParameter.basicsValue,"onUpdate:modelValue":t[5]||(t[5]=d=>l.value.integralGainRule[0].rulesParameter.basicsValue=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[26]||(t[26]=e.createTextVNode(" 点积分 "))]),e.createVNode(s,{modelValue:l.value.integralGainRule[1].open,"onUpdate:modelValue":t[6]||(t[6]=d=>l.value.integralGainRule[1].open=d)},{default:e.withCtx(()=>t[27]||(t[27]=[e.createTextVNode("登录")])),_:1},8,["modelValue"]),t[51]||(t[51]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日首次登录获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",bl,[t[28]||(t[28]=e.createTextVNode(" 每日首次登录获得 ")),e.createVNode(c,{modelValue:l.value.integralGainRule[1].rulesParameter.basicsValue,"onUpdate:modelValue":t[7]||(t[7]=d=>l.value.integralGainRule[1].rulesParameter.basicsValue=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[29]||(t[29]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(c,{modelValue:r.value.LOGIN[0].key,"onUpdate:modelValue":t[8]||(t[8]=d=>r.value.LOGIN[0].key=d),controls:!1,min:1,max:6,style:{width:"100px"}},null,8,["modelValue"]),t[30]||(t[30]=e.createTextVNode(" 天连续登录将额外获赠 ")),e.createVNode(c,{modelValue:r.value.LOGIN[0].value,"onUpdate:modelValue":t[9]||(t[9]=d=>r.value.LOGIN[0].value=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[31]||(t[31]=e.createTextVNode(" 点积分； 第 ")),e.createVNode(c,{modelValue:r.value.LOGIN[1].key,"onUpdate:modelValue":t[10]||(t[10]=d=>r.value.LOGIN[1].key=d),controls:!1,min:1,max:7,style:{width:"100px"}},null,8,["modelValue"]),t[32]||(t[32]=e.createTextVNode(" 天连续登录将额外获得 ")),e.createVNode(c,{modelValue:r.value.LOGIN[1].value,"onUpdate:modelValue":t[11]||(t[11]=d=>r.value.LOGIN[1].value=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[33]||(t[33]=e.createTextVNode(" 点积分。 "))]),e.createVNode(s,{modelValue:l.value.integralGainRule[2].open,"onUpdate:modelValue":t[12]||(t[12]=d=>l.value.integralGainRule[2].open=d),style:{"margin-right":"30px"}},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("签到")])),_:1},8,["modelValue"]),t[52]||(t[52]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日签到获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",El,[t[35]||(t[35]=e.createTextVNode(" 每日首次签到获得 ")),e.createVNode(c,{modelValue:l.value.integralGainRule[2].rulesParameter.basicsValue,"onUpdate:modelValue":t[13]||(t[13]=d=>l.value.integralGainRule[2].rulesParameter.basicsValue=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[36]||(t[36]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(c,{modelValue:r.value.SING_IN[0].key,"onUpdate:modelValue":t[14]||(t[14]=d=>r.value.SING_IN[0].key=d),max:6,controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[37]||(t[37]=e.createTextVNode(" 天连续签到将额外获赠 ")),e.createVNode(c,{modelValue:r.value.SING_IN[0].value,"onUpdate:modelValue":t[15]||(t[15]=d=>r.value.SING_IN[0].value=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[38]||(t[38]=e.createTextVNode("点积分； 第 ")),e.createVNode(c,{modelValue:r.value.SING_IN[1].key,"onUpdate:modelValue":t[16]||(t[16]=d=>r.value.SING_IN[1].key=d),controls:!1,min:1,style:{width:"100px"},max:7},null,8,["modelValue"]),t[39]||(t[39]=e.createTextVNode(" 天连续签到将额外获得 ")),e.createVNode(c,{modelValue:r.value.SING_IN[1].value,"onUpdate:modelValue":t[17]||(t[17]=d=>r.value.SING_IN[1].value=d),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),t[40]||(t[40]=e.createTextVNode(" 点积分。 "))]),e.createVNode(s,{modelValue:l.value.integralGainRule[3].open,"onUpdate:modelValue":t[18]||(t[18]=d=>l.value.integralGainRule[3].open=d),style:{"margin-right":"30px"}},{default:e.withCtx(()=>t[41]||(t[41]=[e.createTextVNode("消费获得")])),_:1},8,["modelValue"]),t[53]||(t[53]=e.createElementVNode("span",{class:"use_rules__msg"},"（成功交易笔数及实付金额只统计订单状态为【已完成】的数值，且将【已结算订单、积分订单、储值充值】剔除）",-1)),e.createVNode(S,{modelValue:f.value,"onUpdate:modelValue":t[19]||(t[19]=d=>f.value=d),class:"ml-4",style:{"margin-top":"5px",display:"flex","flex-direction":"column","align-items":"start","margin-left":"20px"},onChange:w},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value,(d,Bl)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:Bl},[d.consumeGrowthValueType==="ORDER_QUANTITY"?(e.openBlock(),e.createBlock(E,{key:0},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:d.isSelected,"onUpdate:modelValue":D=>d.isSelected=D,label:"ORDER_QUANTITY"},{default:e.withCtx(()=>[t[42]||(t[42]=e.createTextVNode(" 每成功交易(已完成) ")),e.createVNode(n,{modelValue:d.orderQuantityAndAmount,"onUpdate:modelValue":D=>d.orderQuantityAndAmount=D,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[43]||(t[43]=e.createTextVNode(" 笔订单，奖励 ")),e.createVNode(n,{modelValue:d.presentedGrowthValue,"onUpdate:modelValue":D=>d.presentedGrowthValue=D,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[44]||(t[44]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):d.consumeGrowthValueType==="ORDER_AMOUNT"?(e.openBlock(),e.createBlock(E,{key:1},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:d.isSelected,"onUpdate:modelValue":D=>d.isSelected=D,label:"ORDER_AMOUNT"},{default:e.withCtx(()=>[t[45]||(t[45]=e.createTextVNode(" 实付金额(不含运费)，每满 ")),e.createVNode(n,{modelValue:d.orderQuantityAndAmount,"onUpdate:modelValue":D=>d.orderQuantityAndAmount=D,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[46]||(t[46]=e.createTextVNode(" 元，奖励 ")),e.createVNode(n,{modelValue:d.presentedGrowthValue,"onUpdate:modelValue":D=>d.presentedGrowthValue=D,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),t[47]||(t[47]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):e.createCommentVNode("",!0)],64))),128))]),_:1},8,["modelValue"]),e.createElementVNode("div",wl,[e.createVNode(u,{round:"",onClick:t[20]||(t[20]=d=>b(!0))},{default:e.withCtx(()=>t[48]||(t[48]=[e.createTextVNode("返回")])),_:1}),e.createVNode(u,{round:"",type:"primary",onClick:T},{default:e.withCtx(()=>t[49]||(t[49]=[e.createTextVNode("保存")])),_:1})])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(L=(p=(G=l.value)==null?void 0:G.integralGainRule)==null?void 0:p[0])!=null&&L.open?(e.openBlock(),e.createElementBlock("div",Sl," 每日首次分享获得 "+e.toDisplayString(((W=(Q=(z=(Y=l.value)==null?void 0:Y.integralGainRule)==null?void 0:z[0])==null?void 0:Q.rulesParameter)==null?void 0:W.basicsValue)??0)+" 点积分 ",1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",null," 每日首次登录获得 "+e.toDisplayString(((A=(V=(i=(m=l.value)==null?void 0:m.integralGainRule)==null?void 0:i[1])==null?void 0:V.rulesParameter)==null?void 0:A.basicsValue)??0)+" 点积分, 第 "+e.toDisplayString((X=r.value.LOGIN)==null?void 0:X[0].key)+" 天连续登录将额外获赠 "+e.toDisplayString((J=r.value.LOGIN)==null?void 0:J[0].value)+" 点积分； 第 "+e.toDisplayString((le=r.value.LOGIN)==null?void 0:le[1].key)+" 天连续登录将额外获得 "+e.toDisplayString((P=r.value.LOGIN)==null?void 0:P[1].value)+" 点积分。 ",513),[[e.vShow,(ne=(ae=(oe=l.value)==null?void 0:oe.integralGainRule)==null?void 0:ae[1])==null?void 0:ne.open]]),e.withDirectives(e.createElementVNode("div",null," 每日首次签到获得 "+e.toDisplayString(((K=(ee=(se=(re=l.value)==null?void 0:re.integralGainRule)==null?void 0:se[2])==null?void 0:ee.rulesParameter)==null?void 0:K.basicsValue)??0)+" 点积分, 第 "+e.toDisplayString((a=r.value.SING_IN)==null?void 0:a[0].key)+" 天连续签到将额外获赠 "+e.toDisplayString((M=r.value.SING_IN)==null?void 0:M[0].value)+" 点积分； 第 "+e.toDisplayString((ye=r.value.SING_IN)==null?void 0:ye[1].key)+" 天连续签到将额外获得 "+e.toDisplayString((_e=r.value.SING_IN)==null?void 0:_e[1].value)+" 点积分。 ",513),[[e.vShow,(he=(Ne=(xe=l.value)==null?void 0:xe.integralGainRule)==null?void 0:Ne[2])==null?void 0:he.open]]),e.withDirectives(e.createElementVNode("div",null,[(ke=x.value)!=null&&ke[0].isSelected?(e.openBlock(),e.createElementBlock("p",Tl," 每成功交易（已完成），"+e.toDisplayString((Ce=x.value)==null?void 0:Ce[0].orderQuantityAndAmount)+" 笔订单，奖励 "+e.toDisplayString((be=x.value)==null?void 0:be[0].presentedGrowthValue)+" 点积分 ",1)):(we=(Ee=x.value)==null?void 0:Ee[1])!=null&&we.isSelected?(e.openBlock(),e.createElementBlock("p",Il," 实付金额（不含运费），每满 "+e.toDisplayString((Te=(Se=x.value)==null?void 0:Se[1])==null?void 0:Te.orderQuantityAndAmount)+" 元，奖励 "+e.toDisplayString((Re=(Ie=x.value)==null?void 0:Ie[1])==null?void 0:Re.presentedGrowthValue)+" 点积分 ",1)):e.createCommentVNode("",!0)],512),[[e.vShow,(Oe=(Be=(De=l.value)==null?void 0:De.integralGainRule)==null?void 0:Be[3])==null?void 0:Oe.open]])],64))])])}}}),Pl="",Dl=Object.freeze(Object.defineProperty({__proto__:null,default:v(Rl,[["__scopeId","data-v-fbd3af3a"]])},Symbol.toStringTag,{value:"Module"}));return He});
