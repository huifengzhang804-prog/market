(function(e,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("vue"),require("@/components/q-editor/editor.vue"),require("@/apis/http"),require("element-plus")):typeof define=="function"&&define.amd?define(["vue","@/components/q-editor/editor.vue","@/apis/http","element-plus"],g):(e=typeof globalThis<"u"?globalThis:e||self,e.IntegralRules=g(e.IntegralRulesContext.Vue,e.IntegralRulesContext.Editor,e.IntegralRulesContext.Request,e.IntegralRulesContext.ElementPlus))})(this,function(e,g,x,V){"use strict";var R=document.createElement("style");R.textContent=`@charset "UTF-8";.title[data-v-fbd3af3a]{margin:15px 10px;display:flex;justify-content:center;align-items:center;justify-content:flex-start;font-size:14px;color:#555cfd;font-weight:700}.title[data-v-fbd3af3a]:before{content:"";display:inline-block;height:14px;width:2.5px;background:#555cfd;margin-right:9px}.use_rules[data-v-fbd3af3a]{font-size:14px;font-family:sans-serif,sans-serif-Normal;font-weight:400;text-align:LEFT;color:#333;line-height:30px}.use_rules__msg[data-v-fbd3af3a]{font-size:14px;text-align:LEFT;color:#d3d3d3}.save[data-v-fbd3af3a]{margin:30px 0;text-align:center}.get_rules[data-v-fbd3af3a]{text-indent:1em;padding:10px 0}.p20[data-v-fbd3af3a]{padding:0 0 0 20px}
`,document.head.appendChild(R);const I="addon-integral/integral/",fe=()=>x.get({url:I+"rules/info"}),Ne=N=>x.post({url:I+"rules/save",data:N}),ge=N=>x.post({url:I+"rules/update",data:N}),ye={style:{padding:"16px",overflow:"auto"}},ce={class:"use_rules p20"},xe={key:0,style:{border:"1px solid #ccc"}},Ie={key:1},Ge={class:"use_rules p20"},Re={key:1},ke={class:"use_rules p20"},Ee={key:0,style:{border:"1px solid #ccc"}},Te={key:1},we={class:"use_rules p20"},Se={class:"get_rules"},Ue={class:"get_rules"},be={class:"get_rules"},Oe={class:"save"},_e={key:0},Ae={key:0},ve={key:1},Ce=e.defineComponent({__name:"IntegralRules",setup(N){const m=e.ref(!1),f=e.ref(!1),o=e.ref({indate:0,useRule:"<div>（1）积分使用过程中不找零、不兑现、不开发票，不可转移至其他账户。</div><div>（2）使用积分进行兑换，兑换申请一经提交, 一律不能退货</div><div>（3）如因积分商品缺货等原因导致的退货退款，积分会原路返还</div><div>（4）兑换礼品涉及运费和配送费由用户自行承担。</div><div>（5）启山智软保留最终解释权。</div>",ruleInfo:"<div>月度滚动过期制。 每个自然月的第1天00：00分自动清零 已满一年的积分。 举例：2022年8月1日开始清除2023年7月31日</div>",integralGainRule:[{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SHARE",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"LOGIN",open:!1},{rulesParameter:{basicsValue:1,extendValue:{}},gainRuleType:"SING_IN",open:!1},{rulesParameter:{consumeJson:[{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]},gainRuleType:"CONSUME",open:!1}]}),r=e.ref({LOGIN:[{key:0,value:0},{key:0,value:0}],SING_IN:[{key:0,value:0},{key:0,value:0}],CONSUME:[{key:0,value:0},{key:0,value:0}]});G();const i=e.ref([{consumeGrowthValueType:"ORDER_QUANTITY",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""},{consumeGrowthValueType:"ORDER_AMOUNT",isSelected:!1,orderQuantityAndAmount:"",presentedGrowthValue:""}]),y=e.ref("ORDER_QUANTITY");async function G(){var n;const{code:a,data:l,msg:s}=await fe();if(a!==200){V.ElMessage.error(s||"积分规则获取失败");return}if(l&&l.useRule){Le(l),o.value=l,i.value=l.integralGainRule[3].rulesParameter.consumeJson,((n=l.integralGainRule[3].rulesParameter.consumeJson[0])==null?void 0:n.isSelected)===!0?y.value="ORDER_QUANTITY":y.value="ORDER_AMOUNT";return}f.value=!0}const k=(a=!1)=>{m.value=!m.value,a&&G()},De=async()=>{if(!Pe())return;const a=Me();if(a==="COMPLETE"){Be();const{code:l,msg:s}=await(f.value?Ne(o.value):ge(o.value));if(l!==200){V.ElMessage.error(s||`${f.value?"保存":"修改"}积分规则失败`);return}V.ElMessage.success(`${f.value?"保存":"修改"}积分规则成功`),G(),Fe()}else V.ElMessage.info(`连续${a==="LOGIN"?"登录":"签到"}天数输入重复，请修改`)};function Be(){o.value.integralGainRule.forEach(a=>{let l={};const s=r.value[a.gainRuleType];if(s){for(let n=0;n<s.length;n++){const d=s[n].key,p=s[n].value;l[d]=p}a.rulesParameter.extendValue=l}a.gainRuleType==="CONSUME"&&(a.open?i.value.forEach(n=>{n.isSelected=n.consumeGrowthValueType===y.value}):i.value.forEach(n=>{n.isSelected=!1}),a.rulesParameter.consumeJson=i.value)})}function Le(a){a.integralGainRule.forEach(l=>{let s=[];if(r.value[l.gainRuleType]){for(const d in l.rulesParameter.extendValue)s.push({key:d,value:l.rulesParameter.extendValue[d]});r.value[l.gainRuleType]=s}})}function Me(){const a=new Map;if(r.value.LOGIN.filter(n=>!a.has(n.key)&&a.set(n.key,n.value)).length!==r.value.LOGIN.length)return"LOGIN";a.clear();const s=r.value.SING_IN.filter(n=>!a.has(n.key)&&a.set(n.key,n.value)).length;return s!==r.value.SING_IN.length?(console.log("singInLen",s),"SING_IN"):"COMPLETE"}function Pe(){const{indate:a,useRule:l,ruleInfo:s,integralGainRule:n}=o.value;if(!a)return V.ElMessage.info("请输入积分有效期"),!1;if(!l.trim().length||l==="<p><br></p>")return V.ElMessage.info("请输入积分规则"),!1;if(!s.trim().length||s==="<p><br></p>")return V.ElMessage.info("请输入积分值信息"),!1;if(n.every(c=>!!c.rulesParameter.basicsValue))return V.ElMessage.info("请输入首次赠送积分值信息"),!1;const p=Qe();return console.log(p),p?(V.ElMessage.info(p),!1):!0}function Qe(){let a="";const l=r.value.LOGIN,s=r.value.SING_IN,n=r.value.SING_IN;if(l.forEach(d=>{if(!d.key)return a="请输入连续登录天数",a;if(!d.value)return a="请输入连续登录赠送积分值",a}),a||(s.forEach(d=>{if(!d.key)return a="请输入连续签到天数",a;if(!d.value)return a="请输入连续登签到赠送积分值",a}),a)||(n.forEach(d=>{if(!d.key)return a;if(!d.value)return a="请输入赠送的积分值",a}),a))return a}function Fe(){m.value=!1,f.value=!1}const qe=a=>{console.log(a),a==="ORDER_QUANTITY"&&(i.value[0].isSelected=!0,i.value[1].isSelected=!1),a==="ORDER_AMOUNT"&&(i.value[1].isSelected=!0,i.value[0].isSelected=!1)};return(a,l)=>{var w,S,U,b,O,_,A,v,C,D,B,L,M,P,Q,F,q,Y,$,j,J,z,h,H,K,W,X,Z,ee,le,te,ae,oe,ne,re,se,de,ie,ue,me,pe,Ve;const s=e.resolveComponent("el-button"),n=e.resolveComponent("el-input-number"),d=e.resolveComponent("el-checkbox"),p=e.resolveComponent("el-input"),c=e.resolveComponent("el-radio"),E=e.resolveComponent("el-form-item"),Ye=e.resolveComponent("el-radio-group"),T=e.resolveDirective("dompurify-html");return e.openBlock(),e.createElementBlock("div",ye,[e.withDirectives(e.createVNode(s,{round:"",type:"primary",onClick:l[0]||(l[0]=t=>k(!1))},{default:e.withCtx(()=>l[21]||(l[21]=[e.createTextVNode("编辑积分规则")])),_:1},512),[[e.vShow,!m.value]]),l[54]||(l[54]=e.createElementVNode("div",{class:"title"},"积分使用规则",-1)),e.createElementVNode("div",ce,[m.value?(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(g,{modelValue:o.value.useRule,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.useRule=t),height:200},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",Ie,null,512)),[[T,o.value.useRule]])]),l[55]||(l[55]=e.createElementVNode("div",{class:"title"},"积分有效期",-1)),e.createElementVNode("div",Ge,[e.createElementVNode("div",null,[l[22]||(l[22]=e.createTextVNode(" 积分有效期为 ")),m.value?(e.openBlock(),e.createBlock(n,{key:0,modelValue:o.value.indate,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.indate=t),controls:!1,min:1,max:12,style:{width:"50px"}},null,8,["modelValue"])):(e.openBlock(),e.createElementBlock("span",Re,e.toDisplayString(o.value.indate),1)),l[23]||(l[23]=e.createTextVNode(" 个月 "))])]),l[56]||(l[56]=e.createElementVNode("div",{class:"title"},"积分值规则",-1)),e.createElementVNode("div",ke,[m.value?(e.openBlock(),e.createElementBlock("div",Ee,[e.createVNode(g,{modelValue:o.value.ruleInfo,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.ruleInfo=t)},null,8,["modelValue"])])):e.withDirectives((e.openBlock(),e.createElementBlock("div",Te,null,512)),[[T,o.value.ruleInfo]])]),l[57]||(l[57]=e.createElementVNode("div",{class:"title"},"积分获取规则",-1)),e.createElementVNode("div",we,[m.value&&((w=o.value)!=null&&w.integralGainRule)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(d,{modelValue:o.value.integralGainRule[0].open,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.integralGainRule[0].open=t)},{default:e.withCtx(()=>l[24]||(l[24]=[e.createTextVNode("分享")])),_:1},8,["modelValue"]),l[50]||(l[50]=e.createElementVNode("span",{class:"use_rules__msg"},"（限制用户首次分享才可获得积分）",-1)),e.createElementVNode("div",Se,[l[25]||(l[25]=e.createTextVNode(" 每日首次分享获得 ")),e.createVNode(n,{modelValue:o.value.integralGainRule[0].rulesParameter.basicsValue,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.integralGainRule[0].rulesParameter.basicsValue=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[26]||(l[26]=e.createTextVNode(" 点积分 "))]),e.createVNode(d,{modelValue:o.value.integralGainRule[1].open,"onUpdate:modelValue":l[6]||(l[6]=t=>o.value.integralGainRule[1].open=t)},{default:e.withCtx(()=>l[27]||(l[27]=[e.createTextVNode("登录")])),_:1},8,["modelValue"]),l[51]||(l[51]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日首次登录获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",Ue,[l[28]||(l[28]=e.createTextVNode(" 每日首次登录获得 ")),e.createVNode(n,{modelValue:o.value.integralGainRule[1].rulesParameter.basicsValue,"onUpdate:modelValue":l[7]||(l[7]=t=>o.value.integralGainRule[1].rulesParameter.basicsValue=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[29]||(l[29]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(n,{modelValue:r.value.LOGIN[0].key,"onUpdate:modelValue":l[8]||(l[8]=t=>r.value.LOGIN[0].key=t),controls:!1,min:1,max:6,style:{width:"100px"}},null,8,["modelValue"]),l[30]||(l[30]=e.createTextVNode(" 天连续登录将额外获赠 ")),e.createVNode(n,{modelValue:r.value.LOGIN[0].value,"onUpdate:modelValue":l[9]||(l[9]=t=>r.value.LOGIN[0].value=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[31]||(l[31]=e.createTextVNode(" 点积分； 第 ")),e.createVNode(n,{modelValue:r.value.LOGIN[1].key,"onUpdate:modelValue":l[10]||(l[10]=t=>r.value.LOGIN[1].key=t),controls:!1,min:1,max:7,style:{width:"100px"}},null,8,["modelValue"]),l[32]||(l[32]=e.createTextVNode(" 天连续登录将额外获得 ")),e.createVNode(n,{modelValue:r.value.LOGIN[1].value,"onUpdate:modelValue":l[11]||(l[11]=t=>r.value.LOGIN[1].value=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[33]||(l[33]=e.createTextVNode(" 点积分。 "))]),e.createVNode(d,{modelValue:o.value.integralGainRule[2].open,"onUpdate:modelValue":l[12]||(l[12]=t=>o.value.integralGainRule[2].open=t),style:{"margin-right":"30px"}},{default:e.withCtx(()=>l[34]||(l[34]=[e.createTextVNode("签到")])),_:1},8,["modelValue"]),l[52]||(l[52]=e.createElementVNode("span",{class:"use_rules__msg"},"（每日签到获得积分，7天中有2个节点可以额外赠送积分，第8天00:00数据清空）",-1)),e.createElementVNode("div",be,[l[35]||(l[35]=e.createTextVNode(" 每日首次签到获得 ")),e.createVNode(n,{modelValue:o.value.integralGainRule[2].rulesParameter.basicsValue,"onUpdate:modelValue":l[13]||(l[13]=t=>o.value.integralGainRule[2].rulesParameter.basicsValue=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[36]||(l[36]=e.createTextVNode(" 点积分, 第 ")),e.createVNode(n,{modelValue:r.value.SING_IN[0].key,"onUpdate:modelValue":l[14]||(l[14]=t=>r.value.SING_IN[0].key=t),max:6,controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[37]||(l[37]=e.createTextVNode(" 天连续签到将额外获赠 ")),e.createVNode(n,{modelValue:r.value.SING_IN[0].value,"onUpdate:modelValue":l[15]||(l[15]=t=>r.value.SING_IN[0].value=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[38]||(l[38]=e.createTextVNode("点积分； 第 ")),e.createVNode(n,{modelValue:r.value.SING_IN[1].key,"onUpdate:modelValue":l[16]||(l[16]=t=>r.value.SING_IN[1].key=t),controls:!1,min:1,style:{width:"100px"},max:7},null,8,["modelValue"]),l[39]||(l[39]=e.createTextVNode(" 天连续签到将额外获得 ")),e.createVNode(n,{modelValue:r.value.SING_IN[1].value,"onUpdate:modelValue":l[17]||(l[17]=t=>r.value.SING_IN[1].value=t),controls:!1,min:1,style:{width:"100px"}},null,8,["modelValue"]),l[40]||(l[40]=e.createTextVNode(" 点积分。 "))]),e.createVNode(d,{modelValue:o.value.integralGainRule[3].open,"onUpdate:modelValue":l[18]||(l[18]=t=>o.value.integralGainRule[3].open=t),style:{"margin-right":"30px"}},{default:e.withCtx(()=>l[41]||(l[41]=[e.createTextVNode("消费获得")])),_:1},8,["modelValue"]),l[53]||(l[53]=e.createElementVNode("span",{class:"use_rules__msg"},"（成功交易笔数及实付金额只统计订单状态为【已完成】的数值，且将【已结算订单、积分订单、储值充值】剔除）",-1)),e.createVNode(Ye,{modelValue:y.value,"onUpdate:modelValue":l[19]||(l[19]=t=>y.value=t),class:"ml-4",style:{"margin-top":"5px",display:"flex","flex-direction":"column","align-items":"start","margin-left":"20px"},onChange:qe},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t,$e)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:$e},[t.consumeGrowthValueType==="ORDER_QUANTITY"?(e.openBlock(),e.createBlock(E,{key:0},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:t.isSelected,"onUpdate:modelValue":u=>t.isSelected=u,label:"ORDER_QUANTITY"},{default:e.withCtx(()=>[l[42]||(l[42]=e.createTextVNode(" 每成功交易(已完成) ")),e.createVNode(p,{modelValue:t.orderQuantityAndAmount,"onUpdate:modelValue":u=>t.orderQuantityAndAmount=u,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[43]||(l[43]=e.createTextVNode(" 笔订单，奖励 ")),e.createVNode(p,{modelValue:t.presentedGrowthValue,"onUpdate:modelValue":u=>t.presentedGrowthValue=u,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[44]||(l[44]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):t.consumeGrowthValueType==="ORDER_AMOUNT"?(e.openBlock(),e.createBlock(E,{key:1},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:t.isSelected,"onUpdate:modelValue":u=>t.isSelected=u,label:"ORDER_AMOUNT"},{default:e.withCtx(()=>[l[45]||(l[45]=e.createTextVNode(" 实付金额(不含运费)，每满 ")),e.createVNode(p,{modelValue:t.orderQuantityAndAmount,"onUpdate:modelValue":u=>t.orderQuantityAndAmount=u,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[46]||(l[46]=e.createTextVNode(" 元，奖励 ")),e.createVNode(p,{modelValue:t.presentedGrowthValue,"onUpdate:modelValue":u=>t.presentedGrowthValue=u,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[47]||(l[47]=e.createTextVNode(" 点积分 "))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)):e.createCommentVNode("",!0)],64))),128))]),_:1},8,["modelValue"]),e.createElementVNode("div",Oe,[e.createVNode(s,{round:"",onClick:l[20]||(l[20]=t=>k(!0))},{default:e.withCtx(()=>l[48]||(l[48]=[e.createTextVNode("返回")])),_:1}),e.createVNode(s,{round:"",type:"primary",onClick:De},{default:e.withCtx(()=>l[49]||(l[49]=[e.createTextVNode("保存")])),_:1})])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(b=(U=(S=o.value)==null?void 0:S.integralGainRule)==null?void 0:U[0])!=null&&b.open?(e.openBlock(),e.createElementBlock("div",_e," 每日首次分享获得 "+e.toDisplayString(((v=(A=(_=(O=o.value)==null?void 0:O.integralGainRule)==null?void 0:_[0])==null?void 0:A.rulesParameter)==null?void 0:v.basicsValue)??0)+" 点积分 ",1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",null," 每日首次登录获得 "+e.toDisplayString(((L=(B=(D=(C=o.value)==null?void 0:C.integralGainRule)==null?void 0:D[1])==null?void 0:B.rulesParameter)==null?void 0:L.basicsValue)??0)+" 点积分, 第 "+e.toDisplayString((M=r.value.LOGIN)==null?void 0:M[0].key)+" 天连续登录将额外获赠 "+e.toDisplayString((P=r.value.LOGIN)==null?void 0:P[0].value)+" 点积分； 第 "+e.toDisplayString((Q=r.value.LOGIN)==null?void 0:Q[1].key)+" 天连续登录将额外获得 "+e.toDisplayString((F=r.value.LOGIN)==null?void 0:F[1].value)+" 点积分。 ",513),[[e.vShow,($=(Y=(q=o.value)==null?void 0:q.integralGainRule)==null?void 0:Y[1])==null?void 0:$.open]]),e.withDirectives(e.createElementVNode("div",null," 每日首次签到获得 "+e.toDisplayString(((h=(z=(J=(j=o.value)==null?void 0:j.integralGainRule)==null?void 0:J[2])==null?void 0:z.rulesParameter)==null?void 0:h.basicsValue)??0)+" 点积分, 第 "+e.toDisplayString((H=r.value.SING_IN)==null?void 0:H[0].key)+" 天连续签到将额外获赠 "+e.toDisplayString((K=r.value.SING_IN)==null?void 0:K[0].value)+" 点积分； 第 "+e.toDisplayString((W=r.value.SING_IN)==null?void 0:W[1].key)+" 天连续签到将额外获得 "+e.toDisplayString((X=r.value.SING_IN)==null?void 0:X[1].value)+" 点积分。 ",513),[[e.vShow,(le=(ee=(Z=o.value)==null?void 0:Z.integralGainRule)==null?void 0:ee[2])==null?void 0:le.open]]),e.withDirectives(e.createElementVNode("div",null,[(te=i.value)!=null&&te[0].isSelected?(e.openBlock(),e.createElementBlock("p",Ae," 每成功交易（已完成），"+e.toDisplayString((ae=i.value)==null?void 0:ae[0].orderQuantityAndAmount)+" 笔订单，奖励 "+e.toDisplayString((oe=i.value)==null?void 0:oe[0].presentedGrowthValue)+" 点积分 ",1)):(re=(ne=i.value)==null?void 0:ne[1])!=null&&re.isSelected?(e.openBlock(),e.createElementBlock("p",ve," 实付金额（不含运费），每满 "+e.toDisplayString((de=(se=i.value)==null?void 0:se[1])==null?void 0:de.orderQuantityAndAmount)+" 元，奖励 "+e.toDisplayString((ue=(ie=i.value)==null?void 0:ie[1])==null?void 0:ue.presentedGrowthValue)+" 点积分 ",1)):e.createCommentVNode("",!0)],512),[[e.vShow,(Ve=(pe=(me=o.value)==null?void 0:me.integralGainRule)==null?void 0:pe[3])==null?void 0:Ve.open]])],64))])])}}}),je="";return((N,m)=>{const f=N.__vccOpts||N;for(const[o,r]of m)f[o]=r;return f})(Ce,[["__scopeId","data-v-fbd3af3a"]])});
