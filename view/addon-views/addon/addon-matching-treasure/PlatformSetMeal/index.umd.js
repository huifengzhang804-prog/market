(function(e,C){typeof exports=="object"&&typeof module<"u"?module.exports=C(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("vue-router"),require("@/components/PageManage.vue"),require("element-plus"),require("@/apis/http"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","vue-router","@/components/PageManage.vue","element-plus","@/apis/http","@/components/element-plus/el-table/ElTableEmpty/index.vue"],C):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformSetMeal=C(e.PlatformSetMealContext.Vue,e.PlatformSetMealContext.VueUse,e.PlatformSetMealContext.SchemaForm,e.PlatformSetMealContext.VueRouter,e.PlatformSetMealContext.PageManageTwo,e.PlatformSetMealContext.ElementPlus,e.PlatformSetMealContext.Request,e.PlatformSetMealContext.ElTableEmpty))})(this,function(e,C,w,M,T,V,y,k){"use strict";var b=document.createElement("style");b.textContent=`@charset "UTF-8";.name[data-v-5e5996ff]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.origin[data-v-5e5996ff]{display:flex;justify-content:start;align-items:center}.origin--name[data-v-5e5996ff]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}[data-v-5e5996ff] .el-dialog__body{padding-bottom:0!important}[data-v-5e5996ff] .el-button.is-link{padding:0}[data-v-5e5996ff] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(b);const L=e.defineComponent({__name:"head-operation-p",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(l,{emit:i}){const p=l,m=[{label:"活动名称",prop:"keyword",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"setMealStatus",valueType:"select",options:[{label:"全部状态",value:""},{label:"未开始",value:"NOT_STARTED"},{label:"进行中",value:"PROCESSING"},{label:"已结束",value:"OVER"},{label:"已下架",value:"MERCHANT_SELL_OFF"},{label:"违规下架",value:"ILLEGAL_SELL_OFF"}],fieldProps:{placeholder:"请选择"}}],r=i,d=C.useVModel(p,"modelValue",r),n=()=>{r("search")},N=()=>{Object.keys(d.value).forEach(c=>d.value[c]=""),r("search")};return(c,h)=>(e.openBlock(),e.createBlock(w,{modelValue:e.unref(d),"onUpdate:modelValue":h[0]||(h[0]=f=>e.isRef(d)?d.value=f:null),columns:m,onSearchHandle:n,onHandleReset:N},null,8,["modelValue"]))}});var S=(l=>(l.NOT_STARTED="未开始",l.PROCESSING="进行中",l.OVER="已结束",l.MERCHANT_SELL_OFF="已下架",l.ILLEGAL_SELL_OFF="违规下架",l))(S||{});const E="addon-matching-treasure/setMeal",R=l=>y.post({url:`${E}/${l.shopId}/${l.setMealId}?violationExplain=${l.violationExplain}`}),O=l=>y.get({url:E,params:l}),F=l=>y.del({url:E,data:l}),P={class:"table_container"},I={class:"name"},D={class:"origin"},B={class:"origin--name",style:{width:"180px","margin-left":"10px"}},q={class:"dialog-footer"},z=e.defineComponent({__name:"set-meal-list-p",props:{search:{type:Object,default:()=>({})},showOffShelfBtn:{type:Boolean,default:!0}},setup(l,{expose:i}){const p=M.useRouter(),m=l,r=e.ref([]),d=e.ref(),n=e.reactive({size:10,current:1,total:0}),N=e.ref([]),c=e.ref({shopId:"",setMealId:"",violationExplain:""}),h=e.ref(),f=e.ref(!1);e.watch(()=>m.search,a=>{_()},{deep:!0});async function _(){const{setMealStatus:a,keyword:o}=m.search,g={...n,...{setMealStatus:a,keyword:o}},{code:u,data:x}=await O(g);if(u!==200)return V.ElMessage.error("获取套餐列表失败");r.value=x.records,n.current=x.current,n.size=x.size,n.total=x.total}const G=(a,o)=>{p.push({name:"bundlePriceBaseinfo",query:{setMealId:a.id,shopId:a.shopId,isLookUp:o}})},U=async a=>{const{code:o}=await F(a);if(o!==200){V.ElMessage.error("删除失败");return}V.ElMessage.success("删除成功"),_()},j=a=>{n.current=1,n.size=a,_()},A=a=>{n.current=a,_()},J=a=>{f.value=!0,c.value.shopId=a.shopId,c.value.setMealId=a.id},K=()=>{h.value.resetFields()},Q=()=>{h.value.validate(async(a,o)=>{if(a){const{code:s,msg:g}=await R(c.value);if(s!==200){V.ElMessage.error(g);return}V.ElMessage.success("下架成功"),_(),f.value=!1}else console.log("error submit!",o)})};return _(),i({chooseList:N,handleDelBatch:U}),(a,o)=>{const s=e.resolveComponent("el-table-column"),g=e.resolveComponent("el-image"),u=e.resolveComponent("el-button"),x=e.resolveComponent("el-tooltip"),W=e.resolveComponent("el-table"),X=e.resolveComponent("el-input"),Y=e.resolveComponent("el-form-item"),Z=e.resolveComponent("el-form"),v=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",P,[e.createVNode(W,{ref_key:"multipleTableRef",ref:d,class:"table_container",data:r.value,"header-row-style":{color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{color:"#333333"}},{empty:e.withCtx(()=>[e.createVNode(k,{imageIndex:"7"})]),default:e.withCtx(()=>[e.createVNode(s,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",I,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(s,{label:"套餐名称",width:"230px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",D,[e.createVNode(g,{style:{width:"52px",height:"52px"},src:t.setMealMainPicture},null,8,["src"]),e.createElementVNode("div",B,e.toDisplayString(t.setMealName),1)])]),_:1}),e.createVNode(s,{label:"套餐类型",width:"150"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.setMealType==="OPTIONAL_PRODUCT"?"自选套餐":"固定套餐"),1)]),_:1}),e.createVNode(s,{label:"状态",width:"150"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:["ILLEGAL_SELL_OFF"].includes(t.setMealStatus)?"#F54319":["OVER","MERCHANT_SELL_OFF"].includes(t.setMealStatus)?"#999":"#333"})},e.toDisplayString(e.unref(S)[t.setMealStatus]),5)]),_:1}),e.createVNode(s,{label:"活动时间",width:"230px"},{default:e.withCtx(({row:t})=>[e.createElementVNode("p",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("p",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(s,{label:"活动商品",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.productCount),1)]),_:1}),e.createVNode(s,{label:"支付单数",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.orderCount),1)]),_:1}),e.createVNode(s,{label:"操作",fixed:"right",align:"right",width:"150"},{default:e.withCtx(({row:t})=>[e.createVNode(u,{link:"",type:"primary",onClick:ee=>G(t,"true")},{default:e.withCtx(()=>o[3]||(o[3]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),["NOT_STARTED","PROCESSING"].includes(t.setMealStatus)?(e.openBlock(),e.createBlock(u,{key:0,link:"",type:"danger",onClick:ee=>J(t)},{default:e.withCtx(()=>o[4]||(o[4]=[e.createTextVNode("违规下架")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.setMealStatus==="ILLEGAL_SELL_OFF"?(e.openBlock(),e.createBlock(x,{key:1,class:"box-item",effect:"dark",content:t.violationExplain,placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(u,{link:"",type:"primary"},{default:e.withCtx(()=>o[5]||(o[5]=[e.createTextVNode("违规原因")])),_:1})]),_:2},1032,["content"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(T,{class:"pagination","page-num":n.current,"load-init":!0,"page-size":n.size,total:n.total,onReload:_,onHandleSizeChange:j,onHandleCurrentChange:A},null,8,["page-num","page-size","total"]),e.createVNode(v,{modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=t=>f.value=t),title:"违规下架",width:"500",center:"",onClose:K},{footer:e.withCtx(()=>[e.createElementVNode("div",q,[e.createVNode(u,{onClick:o[1]||(o[1]=t=>f.value=!1)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode("取消")])),_:1}),e.createVNode(u,{type:"primary",onClick:Q},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(Z,{ref_key:"illegalReasonFormRef",ref:h,model:c.value,rules:{violationExplain:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(Y,{label:"",prop:"violationExplain"},{default:e.withCtx(()=>[e.createVNode(X,{modelValue:c.value.violationExplain,"onUpdate:modelValue":o[0]||(o[0]=t=>c.value.violationExplain=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),te="",$=((l,i)=>{const p=l.__vccOpts||l;for(const[m,r]of i)p[m]=r;return p})(z,[["__scopeId","data-v-5e5996ff"]]),H={class:"q_plugin_container"};return e.defineComponent({__name:"PlatformSetMeal",setup(l){const i=e.ref({setMealStatus:"",keyword:""}),p=e.ref();return(m,r)=>{const d=e.resolveComponent("el-config-provider");return e.openBlock(),e.createElementBlock("div",H,[e.createVNode(d,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(L,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=n=>i.value=n)},null,8,["modelValue"])]),_:1}),r[1]||(r[1]=e.createElementVNode("div",{class:"grey_bar"},null,-1)),e.createVNode($,{ref_key:"mealListRef",ref:p,search:i.value},null,8,["search"])])}}})});
