(function(e,C){typeof exports=="object"&&typeof module<"u"?module.exports=C(require("vue"),require("@vueuse/core"),require("@/composables/useConvert"),require("decimal.js"),require("@/utils/date"),require("element-plus"),require("@/apis/http")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/composables/useConvert","decimal.js","@/utils/date","element-plus","@/apis/http"],C):(e=typeof globalThis<"u"?globalThis:e||self,e.CouponGift=C(e.CouponGiftContext.Vue,e.CouponGiftContext.VueUse,e.CouponGiftContext.UseConvert,e.CouponGiftContext.Decimal,e.CouponGiftContext.DateUtil,e.CouponGiftContext.ElementPlus,e.CouponGiftContext.Request))})(this,function(e,C,M,Z,k,E,A){"use strict";var h=document.createElement("style");h.textContent=`@charset "UTF-8";.title[data-v-a6eca096]{font-size:14px;color:#606266;font-weight:700;margin-bottom:40px}.msg[data-v-a6eca096]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-a6eca096]{display:flex;margin-top:10px;height:50px}.period-validity[data-v-a6eca096]{width:300px;display:flex}.text[data-v-a6eca096]{font-size:14px;color:#333}.goodsData[data-v-a6eca096]{border:1px solid #ccc}.goods-list[data-v-a6eca096]{width:90%;margin-top:20px;height:300px;border:1px solid transparent}.goods-list__info[data-v-a6eca096]{display:flex}.goods-list__goods-list__info-name[data-v-a6eca096]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-a6eca096]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-a6eca096]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-a6eca096]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-a6eca096]{font-size:16px}.ruleform-date[data-v-a6eca096]{width:100%;display:flex;align-items:center}.flex[data-v-a6eca096]{height:70px}.flex-item[data-v-a6eca096]{width:40%}.coupon-rules[data-v-a6eca096]{height:70px;display:flex;justify-content:center;align-items:center}.nav-button[data-v-a6eca096]{margin-top:auto;width:100%;padding:15px 0;display:flex;justify-content:center;background-color:#fff;box-shadow:0 0 10px #0000000d}
`,document.head.appendChild(h);const{divTenThousand:v,mulTenThousand:Y}=M(),P={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var q=(n=>(n.PERIOD="PERIOD",n.IMMEDIATELY="IMMEDIATELY",n))(q||{});function I(n){return n?Y(n):""}const B=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:r}){const d=n,s=r,o=C.useVModel(d,"modelValue",s);return(p,u)=>{const m=e.resolveComponent("el-option"),b=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(b,{modelValue:e.unref(o),"onUpdate:modelValue":u[0]||(u[0]=g=>e.isRef(o)?o.value=g:null),placeholder:d.placeholder,style:{width:"150px"},onChange:u[1]||(u[1]=g=>s("change",g))},{default:e.withCtx(()=>[e.renderSlot(p.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(d.list).length?d.list:e.unref(P),(g,_)=>(e.openBlock(),e.createBlock(m,{key:_,label:g,value:_},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),O=n=>A.post({url:"addon-coupon/coupon/gifts",data:n}),S=(n,r,d)=>{if(n==="PRICE_REDUCE"){G(n,r);return}if(n==="PRICE_DISCOUNT"){U(n,r);return}if(n==="REQUIRED_PRICE_REDUCE"){U(n,r),F(n,r,d);return}if(n==="REQUIRED_PRICE_DISCOUNT"){const s=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(p,u,m)=>{Number(u)<=0?m(new Error("金额必须大于0")):m()},trigger:"blur"}],o=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(p,u,m)=>{Number(u)<=0&&Number(u)<100?m(new Error("0.1~99之间")):m()},trigger:"blur"}];r.requiredAmount=s,r.discount=o}},G=(n,r)=>{r.discount.length&&(r.discount[0].required=!1),r.requiredAmount.length&&(r.discount[0].required=!1);const d=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(s,o,p)=>{Number(o)<=0?p(new Error("金额必须大于0")):p()},trigger:"blur"}];r.amount=d},U=(n,r)=>{r.requiredAmount.length&&(r.discount[0].required=!1),r.amount.length&&(r.amount[0].required=!1);const d=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(s,o,p)=>{Number(o)<=0&&Number(o)<100?p(new Error("0.1~99之间")):p()},trigger:"blur"}];r.discount=d},F=(n,r,d)=>{r.discount.length&&(r.discount[0].required=!1);const s=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(p,u,m)=>{Number(u)<=0?m(new Error("金额必须大于0")):m()},trigger:"blur"}],o=[...s,{validator:(p,u,m)=>{Number(d.requiredAmount)-Number(u)<=0?m(new Error(`满减金额必须小于${Number(d.requiredAmount)}`)):m()},trigger:"blur"}];r.amount=o,r.requiredAmount=s},j={class:"content_container"},Q={key:0,class:"ruleform-date"},z={class:"period-validity text"},L={class:"coupon-rules"},$={key:2,class:"df"},H={key:3,class:"df"},J={class:"nav-button"},K=e.defineComponent({__name:"CouponGift",props:{properties:{type:Object,required:!0}},setup(n){const r=n,d=new k,s=e.ref(),o=e.ref({name:"",days:1,endDate:"",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:q.PERIOD,startDate:"",num:1,limit:1,productType:r.properties.productType}),p={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],effectType:[{required:!0,message:"请选择有效时间",trigger:["blur","change"]}],type:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],discount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],num:[{required:!0,message:"请输入每人发送数量",trigger:"blur"}],limit:[{required:!0,message:"请输入每人发送数量",trigger:"blur"}],requiredAmount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],amount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],days:[{required:!0,message:"请输入优惠券有效期",trigger:"blur"},{validator:(l,t,f)=>{Number(t)===0?f("最少1天"):f()},trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:["blur","change"]}],endDate:[{required:!0,message:"请选择结束日期",trigger:["blur","change"]}]},u=async()=>{var l,t;if(s.value)try{if(!await s.value.validate())return;b();const i=g();m(i);const{code:x}=await O({coupon:i,userIds:r.properties.userIds});if(x!==200){E.ElMessage.error("保存失败");return}E.ElMessage.success("保存成功"),r.properties.toBack&&r.properties.toBack()}catch(f){if((l=f.requiredAmount)!=null&&l.length){E.ElMessage.info(f.requiredAmount[0].message);return}if((t=f.amount)!=null&&t.length){E.ElMessage.info(f.amount[0].message);return}}};function m(l){l.effectType==="PERIOD"&&(l.days=null),l.effectType==="IMMEDIATELY"&&(l.startDate="",l.endDate=""),l.type==="PRICE_REDUCE"&&(l.requiredAmount=null,l.discount=null),l.type==="PRICE_DISCOUNT"&&(l.amount=null,l.requiredAmount=null),l.type==="REQUIRED_PRICE_REDUCE"&&(l.discount=null),l.type==="REQUIRED_PRICE_DISCOUNT"&&(l.amount=null)}const b=()=>{if(o.value.effectType==="PERIOD"){o.value.days=1;return}o.value.startDate="",o.value.endDate=""};function g(){const{name:l,days:t,endDate:f,productType:i,type:x,requiredAmount:R,discount:y,amount:D,effectType:c,startDate:V,num:N,limit:T,productIds:w}=o.value;return{name:l,days:t,endDate:f,productType:i,type:x,requiredAmount:I(R).toString(),discount:y,amount:I(D).toString(),effectType:c,startDate:V,num:N,limit:N,productIds:w}}const _=()=>{S(o.value.type,p,o.value),o.value.amount=1,o.value.requiredAmount=1,o.value.discount=1},W=l=>!!o.value.endDate?o.value.endDate<d.getYMDs(l)||d.getYMDs(l)<d.getYMDs(new Date):d.getYMDs(l)<d.getYMDs(new Date),X=l=>!!o.value.startDate?o.value.startDate>d.getYMDs(l)||d.getYMDs(l)<d.getYMDs(new Date):!1;return(l,t)=>{const f=e.resolveComponent("el-input"),i=e.resolveComponent("el-form-item"),x=e.resolveComponent("el-radio"),R=e.resolveComponent("el-radio-group"),y=e.resolveComponent("el-row"),D=e.resolveComponent("el-date-picker"),c=e.resolveComponent("el-input-number"),V=e.resolveComponent("el-table-column"),N=e.resolveComponent("el-table"),T=e.resolveComponent("el-form"),w=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",j,[t[28]||(t[28]=e.createElementVNode("h1",{class:"title"},"基本信息",-1)),e.createVNode(T,{ref_key:"ruleFormRef",ref:s,"inline-message":!1,model:o.value,rules:p,"label-width":"95px"},{default:e.withCtx(()=>[e.createVNode(i,{label:"优惠券名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(f,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.name=a),modelModifiers:{trim:!0},maxlength:"5",placeholder:"请输入优惠券名称",style:{width:"551px"}},null,8,["modelValue"]),t[14]||(t[14]=e.createElementVNode("span",{class:"msg"},"优惠券名称不超过5个字",-1))]),_:1}),e.createVNode(i,{label:"有效时间",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(y,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:o.value.effectType,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.effectType=a),class:"ml-4"},{default:e.withCtx(()=>[e.createVNode(x,{value:"PERIOD"},{default:e.withCtx(()=>t[15]||(t[15]=[e.createTextVNode("固定时间")])),_:1}),e.createVNode(x,{value:"IMMEDIATELY"},{default:e.withCtx(()=>t[16]||(t[16]=[e.createTextVNode("领券立即生效")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(y,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[o.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",Q,[e.createVNode(i,{"inline-message":!1,prop:"startDate"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.startDate,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.startDate=a),"disabled-date":W,format:"YYYY/MM/DD",placeholder:"请选择开始时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t[17]||(t[17]=e.createElementVNode("span",{style:{margin:"0 10px"}},"至",-1))]),_:1}),e.createVNode(i,{"inline-message":!1,prop:"endDate"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.endDate,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.endDate=a),"disabled-date":X,format:"YYYY/MM/DD",placeholder:"请选择结束时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})])):(e.openBlock(),e.createBlock(i,{key:1,prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",z,[t[18]||(t[18]=e.createTextVNode(" 领券当日起 ")),e.createVNode(c,{modelValue:o.value.days,"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.days=a),modelModifiers:{number:!0},controls:!1,max:99999,min:o.value.days?1:0,style:{width:"20%",margin:"0 5px"}},null,8,["modelValue","min"]),t[19]||(t[19]=e.createTextVNode(" 天内可用 "))])]),_:1}))]),_:1})]),_:1}),e.createVNode(i,{label:"活动规则"},{default:e.withCtx(()=>[e.createVNode(N,{"cell-style":{height:"60px"},data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(V,{label:"选择优惠券类型",width:"170"},{default:e.withCtx(()=>[e.createVNode(i,{prop:"type"},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:o.value.type,"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.type=a),placeholder:"全部类型",onChange:_},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(V,{label:"优惠券规则"},{default:e.withCtx(()=>[e.createElementVNode("div",L,[o.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(i,{key:0,prop:"discount"},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:o.value.discount,"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.discount=a),modelModifiers:{number:!0},controls:!1,max:9.9,min:.1,precision:1,style:{width:"100px"}},null,8,["modelValue"]),t[20]||(t[20]=e.createElementVNode("span",{style:{"margin-left":"10px"}},"折，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(i,{key:1,prop:"amount"},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:o.value.amount,"onUpdate:modelValue":t[7]||(t[7]=a=>o.value.amount=a),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"100px"}},null,8,["modelValue"]),t[21]||(t[21]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",$,[e.createVNode(i,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[22]||(t[22]=e.createElementVNode("span",null,"满",-1)),e.createVNode(c,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[8]||(t[8]=a=>o.value.requiredAmount=a),modelModifiers:{number:!0},controls:!1,max:99999,min:0,style:{width:"100px",margin:"0 5px"}},null,8,["modelValue"]),t[23]||(t[23]=e.createElementVNode("span",null,"元,打",-1))]),_:1}),e.createVNode(i,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:o.value.discount,"onUpdate:modelValue":t[9]||(t[9]=a=>o.value.discount=a),modelModifiers:{number:!0},controls:!1,max:9.9,min:.1,precision:1,style:{width:"100px","margin-left":"5px"}},null,8,["modelValue"]),t[24]||(t[24]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"折",-1))]),_:1})])):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",H,[e.createVNode(i,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[25]||(t[25]=e.createElementVNode("span",null,"满",-1)),e.createVNode(c,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[10]||(t[10]=a=>o.value.requiredAmount=a),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"100px","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(i,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[t[26]||(t[26]=e.createElementVNode("span",null,"元,减",-1)),e.createVNode(c,{modelValue:o.value.amount,"onUpdate:modelValue":t[11]||(t[11]=a=>o.value.amount=a),modelModifiers:{number:!0},controls:!1,max:999999,min:0,style:{width:"100px","margin-left":"5px"}},null,8,["modelValue"]),t[27]||(t[27]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元",-1))]),_:1})])):e.createCommentVNode("",!0)])]),_:1}),e.createVNode(V,{label:"每人发送（张）"},{default:e.withCtx(()=>[e.createVNode(i,{prop:"num"},{default:e.withCtx(()=>[e.createVNode(c,{modelValue:o.value.num,"onUpdate:modelValue":t[12]||(t[12]=a=>o.value.num=a),modelModifiers:{number:!0},controls:!1,max:99999,min:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),e.createElementVNode("div",J,[e.createVNode(w,{plain:"",round:"",onClick:t[13]||(t[13]=a=>r.properties.toBack&&r.properties.toBack())},{default:e.withCtx(()=>t[29]||(t[29]=[e.createTextVNode("返回")])),_:1}),e.createVNode(w,{round:"",type:"primary",onClick:u},{default:e.withCtx(()=>t[30]||(t[30]=[e.createTextVNode("保存")])),_:1})])],64)}}}),ee="";return((n,r)=>{const d=n.__vccOpts||n;for(const[s,o]of r)d[s]=o;return d})(K,[["__scopeId","data-v-a6eca096"]])});
