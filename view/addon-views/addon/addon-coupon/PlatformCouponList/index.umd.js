(function(e,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("vue-router"),require("@/composables/useConvert"),require("decimal.js"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","vue-router","@/composables/useConvert","decimal.js","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue"],b):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformCouponList=b(e.PlatformCouponListContext.Vue,e.PlatformCouponListContext.VueUse,e.PlatformCouponListContext.SchemaForm,e.PlatformCouponListContext.VueRouter,e.PlatformCouponListContext.UseConvert,e.PlatformCouponListContext.Decimal,e.PlatformCouponListContext.PageManage,e.PlatformCouponListContext.Request,e.PlatformCouponListContext.ElementPlus,e.PlatformCouponListContext.ElTableEmpty))})(this,function(e,b,S,T,k,Ce,U,x,_,L){"use strict";var R=document.createElement("style");R.textContent=`@charset "UTF-8";.flex[data-v-291440ed]{display:flex;align-items:center;margin-bottom:15px}[data-v-acb2b5c7]{font-size:14px}.name[data-v-acb2b5c7]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[data-v-acb2b5c7] .el-dialog__body{padding-bottom:0!important}*,:before,:after{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }::backdrop{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-pan-x: ;--un-pan-y: ;--un-pinch-zoom: ;--un-scroll-snap-strictness:proximity;--un-ordinal: ;--un-slashed-zero: ;--un-numeric-figure: ;--un-numeric-spacing: ;--un-numeric-fraction: ;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow-inset: ;--un-shadow:0 0 rgba(0,0,0,0);--un-ring-inset: ;--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5);--un-blur: ;--un-brightness: ;--un-contrast: ;--un-drop-shadow: ;--un-grayscale: ;--un-hue-rotate: ;--un-invert: ;--un-saturate: ;--un-sepia: ;--un-backdrop-blur: ;--un-backdrop-brightness: ;--un-backdrop-contrast: ;--un-backdrop-grayscale: ;--un-backdrop-hue-rotate: ;--un-backdrop-invert: ;--un-backdrop-opacity: ;--un-backdrop-saturate: ;--un-backdrop-sepia: }.fixed{position:fixed}.flex{display:flex}.resize{resize:both}[resize~=none]{resize:none}.underline{text-decoration-line:underline}.blur{--un-blur:blur(8px);filter:var(--un-blur) var(--un-brightness) var(--un-contrast) var(--un-drop-shadow) var(--un-grayscale) var(--un-hue-rotate) var(--un-invert) var(--un-saturate) var(--un-sepia)}.disabled{opacity:.5;cursor:not-allowed}
`,document.head.appendChild(R);const z=e.defineComponent({__name:"head-operation2",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchBtn:{type:Boolean,default:!0}},emits:["update:modelValue","delCoupon","search"],setup(o,{emit:u}){const i=o,f=[{label:"活动名称",labelWidth:75,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"优惠券状态",labelWidth:95,prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_OPEN",label:"未开始"},{value:"OPEN",label:"进行中"},{value:"CLOSED",label:"已结束"},{value:"SHOP_BANED",label:"已下架"},{value:"BANED",label:"违规下架"}],fieldProps:{placeholder:"请选择"}},{label:"优惠券类型",labelWidth:95,prop:"type",valueType:"select",options:[{value:"",label:"全部优惠券"},{value:"PRICE_DISCOUNT",label:"无门槛折扣券"},{value:"PRICE_REDUCE",label:"无门槛现金券"},{value:"REQUIRED_PRICE_DISCOUNT",label:"满折券"},{value:"REQUIRED_PRICE_REDUCE",label:"满减券"}],fieldProps:{placeholder:"请选择"}}],d=u,c=b.useVModel(i,"modelValue",d),g=()=>{Object.keys(c.value).forEach(l=>c.value[l]=""),d("search")};return(l,s)=>{const p=e.resolveComponent("el-button"),E=e.resolveComponent("el-config-provider");return e.openBlock(),e.createBlock(E,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(S,{modelValue:e.unref(c),"onUpdate:modelValue":s[1]||(s[1]=m=>e.isRef(c)?c.value=m:null),columns:f,onSearchHandle:s[2]||(s[2]=m=>d("search")),onHandleReset:g},{otherOperations:e.withCtx(()=>[o.showBatchBtn?(e.openBlock(),e.createBlock(p,{key:0,disabled:l.$props.batchDisabled,round:"",onClick:s[0]||(s[0]=m=>d("delCoupon"))},{default:e.withCtx(()=>s[3]||(s[3]=[e.createTextVNode("批量移除")])),_:1},8,["disabled"])):e.createCommentVNode("",!0)]),_:1},8,["modelValue"])]),_:1})}}}),be="",D=(o,u)=>{const i=o.__vccOpts||o;for(const[f,d]of u)i[f]=d;return i},O=D(z,[["__scopeId","data-v-291440ed"]]);k();const q={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var h=(o=>(o.PRICE_REDUCE="PRICE_REDUCE",o.PRICE_DISCOUNT="PRICE_DISCOUNT",o.REQUIRED_PRICE_REDUCE="REQUIRED_PRICE_REDUCE",o.REQUIRED_PRICE_DISCOUNT="REQUIRED_PRICE_DISCOUNT",o))(h||{});const M="addon-coupon/coupon/",A=o=>x.get({url:"addon-coupon/coupon",params:o}),$=o=>x.del({url:"addon-coupon/coupon/batch",data:o}),F=o=>x.put({url:"addon-coupon/coupon/ban/batch",data:o}),Q=o=>x.get({url:`${M}illegal/${o}/reason`}),H={class:"table_container"},j={class:"name"},W={class:"name"},G={key:0},J={key:1},K={key:2},X={key:3},Y={key:0},Z={key:1},v={class:"pagination"},ee={class:"dialog-footer"},te=e.defineComponent({__name:"coupon-list2",props:{search:{type:Object,default:()=>({})}},setup(o,{expose:u}){const i=T.useRouter(),f=o,{divTenThousand:d}=k(),c=e.ref([]),g=e.ref(),l=e.ref({size:10,current:1,total:0}),s=e.ref([]),p=e.ref({shopId:"",couponId:"",violationReason:""}),E=e.ref(),m=e.ref(!1);C();async function C(){const a={...l.value,...f.search},{code:n,data:r}=await A(a);if(n!==200)return _.ElMessage.error("获取优惠券列表失败");c.value=r.records,l.value.current=r.current,l.value.size=r.size,l.value.total=r.total}const ae=a=>{m.value=!0,p.value.shopId=a.shopId,p.value.couponId=a.id},le=()=>{E.value.resetFields()},re=async()=>{await E.value.validate(async(a,n)=>{if(a){const{code:r,msg:y}=await F(p.value);if(r!==200){_.ElMessage.error(y);return}_.ElMessage.success("下架成功");const V=c.value.find(N=>N.id===p.value.couponId);V&&(V.status="BANED"),m.value=!1,C()}else console.log("error submit!",n)})},se=a=>{i.push({name:"couponBaseInfo",query:{id:a.id,shopId:a.shopId}})},I=e.ref(""),w=e.ref(""),ie=async a=>{if(w.value!==a.id){w.value=a.id;const{data:n}=await Q(a.id);I.value=n||"暂无违规原因"}},de=async a=>{const{code:n,msg:r}=await $(a);if(n!==200){_.ElMessage.error(r||"删除失败");return}_.ElMessage.success("删除成功"),C()},ce=a=>{l.value.current=1,l.value.size=a,C()},ue=a=>{l.value.current=a,C()};return u({chooseList:s,handleDelBatch:de,initCouponList:C}),(a,n)=>{const r=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-link"),V=e.resolveComponent("el-tooltip"),N=e.resolveComponent("el-table"),pe=e.resolveComponent("el-input"),me=e.resolveComponent("el-form-item"),fe=e.resolveComponent("el-form"),B=e.resolveComponent("el-button"),_e=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",H,[e.createVNode(N,{ref_key:"multipleTableRef",ref:g,"cell-style":{fontSize:"12px",color:"#333333"},data:c.value,style:{width:"100%"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"header-row-style":{fontSize:"14px",color:"#000"}},{empty:e.withCtx(()=>[e.createVNode(L)]),default:e.withCtx(()=>[e.createVNode(r,{label:"店铺名称",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",j,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(r,{label:"活动名称",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",W,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(r,{label:"类型",width:"100"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(q)[t.type]),1)]),_:1}),e.createVNode(r,{label:"使用规则",width:"210"},{default:e.withCtx(({row:t})=>[t.type===e.unref(h).PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",G,[e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(d)(t.amount)),1),n[3]||(n[3]=e.createElementVNode("span",null,"元，无门槛使用",-1))])):e.createCommentVNode("",!0),t.type===e.unref(h).PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("span",null,e.toDisplayString(t.discount),1),n[4]||(n[4]=e.createElementVNode("span",null,"折，无门槛使用",-1))])):e.createCommentVNode("",!0),t.type===e.unref(h).REQUIRED_PRICE_DISCOUNT?(e.openBlock(),e.createElementBlock("div",K,[n[5]||(n[5]=e.createElementVNode("span",null,"满",-1)),e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(d)(t.requiredAmount)),1),n[6]||(n[6]=e.createElementVNode("span",null,"元，打",-1)),e.createElementVNode("span",null,e.toDisplayString(t.discount),1),n[7]||(n[7]=e.createElementVNode("span",null,"折",-1))])):e.createCommentVNode("",!0),t.type===e.unref(h).REQUIRED_PRICE_REDUCE?(e.openBlock(),e.createElementBlock("div",X,[n[8]||(n[8]=e.createElementVNode("span",null,"满",-1)),e.createElementVNode("span",null,e.toDisplayString(t.requiredAmount&&e.unref(d)(t.requiredAmount)),1),n[9]||(n[9]=e.createElementVNode("span",null,"元，减",-1)),e.createElementVNode("span",null,e.toDisplayString(t.amount&&e.unref(d)(t.amount)),1),n[10]||(n[10]=e.createElementVNode("span",null,"元",-1))])):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(t.rules),1)]),_:1}),e.createVNode(r,{label:"状态",prop:"address",width:"100"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:t.statusText==="违规下架"?"#F54319":["已下架","已结束"].includes(t.statusText)?"#999":"#333"})},e.toDisplayString(t.statusText),5)]),_:1}),e.createVNode(r,{label:"有效期",width:"200"},{default:e.withCtx(({row:t})=>[t.startDate?(e.openBlock(),e.createElementBlock("div",Y,[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startDate),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endDate),1)])):(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("div",null,"领券当日起"+e.toDisplayString(t.days)+"天内可用",1)]))]),_:1}),e.createVNode(r,{label:"已领取",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.num-t.stock),1)]),_:1}),e.createVNode(r,{label:"剩余",prop:"stock",width:"120"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.stock),1)]),_:1}),e.createVNode(r,{label:"已使用",prop:"usedCount",width:"120"}),e.createVNode(r,{align:"right",fixed:"right",class:"el-table__fixed",label:"操作",width:"200"},{default:e.withCtx(({row:t})=>[e.createVNode(y,{underline:!1,size:"small",style:{padding:"0 5px 0 0"},type:"primary",onClick:P=>se(t)},{default:e.withCtx(()=>n[11]||(n[11]=[e.createTextVNode(" 查看 ")])),_:2},1032,["onClick"]),["BANED"].includes(t.status)?(e.openBlock(),e.createBlock(V,{key:0,class:"box-item",effect:"dark",content:I.value,placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(y,{underline:!1,size:"small",style:{padding:"0 5px"},type:"primary",onMouseover:P=>ie(t)},{default:e.withCtx(()=>n[12]||(n[12]=[e.createTextVNode(" 违规原因 ")])),_:2},1032,["onMouseover"])]),_:2},1032,["content"])):e.createCommentVNode("",!0),["未开始","进行中"].includes(t.statusText)?(e.openBlock(),e.createBlock(y,{key:1,underline:!1,size:"small",style:{padding:"0 5px"},type:"danger",onClick:P=>ae(t)},{default:e.withCtx(()=>n[13]||(n[13]=[e.createTextVNode("违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createElementVNode("div",v,[e.createVNode(U,{"page-size":l.value.size,"page-num":l.value.current,total:l.value.total,"load-init":!0,onHandleSizeChange:ce,onHandleCurrentChange:ue},null,8,["page-size","page-num","total"])]),e.createVNode(_e,{modelValue:m.value,"onUpdate:modelValue":n[2]||(n[2]=t=>m.value=t),title:"违规下架",width:"500",center:"",onClose:le},{footer:e.withCtx(()=>[e.createElementVNode("div",ee,[e.createVNode(B,{onClick:n[1]||(n[1]=t=>m.value=!1)},{default:e.withCtx(()=>n[14]||(n[14]=[e.createTextVNode("取消")])),_:1}),e.createVNode(B,{type:"primary",onClick:re},{default:e.withCtx(()=>n[15]||(n[15]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(fe,{ref_key:"illegalReasonFormRef",ref:E,model:p.value,rules:{violationReason:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(me,{label:"",prop:"violationReason"},{default:e.withCtx(()=>[e.createVNode(pe,{modelValue:p.value.violationReason,"onUpdate:modelValue":n[0]||(n[0]=t=>p.value.violationReason=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),he="",ne=D(te,[["__scopeId","data-v-acb2b5c7"]]),ge="",oe={class:"q_plugin_container"};return e.defineComponent({__name:"PlatformCouponList",setup(o){const u=e.ref({status:"",type:"",keywords:""}),i=e.ref(),f=e.computed(()=>i.value?!i.value.chooseList.length:!0),d=()=>{i.value.initCouponList()},c=async()=>{if(!await _.ElMessageBox.confirm("确定删除这些优惠券吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const l=i.value.chooseList.map(s=>({couponId:s.id,shopId:s.shopId}));i.value.handleDelBatch(l)};return(g,l)=>(e.openBlock(),e.createElementBlock("div",oe,[e.createVNode(O,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=s=>u.value=s),showBatchBtn:!1,"batch-disabled":f.value,onSearch:d,onDelCoupon:c},null,8,["modelValue","batch-disabled"]),e.createVNode(ne,{ref_key:"couponListRef",ref:i,search:u.value},null,8,["search"])]))}})});
