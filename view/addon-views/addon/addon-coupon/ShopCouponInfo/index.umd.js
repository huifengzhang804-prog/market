(function(e,P){typeof exports=="object"&&typeof module<"u"?module.exports=P(require("vue"),require("vue-router"),require("@vueuse/core"),require("@/composables/useConvert"),require("decimal.js"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/store/modules/shopInfo"),require("element-plus"),require("@/apis/good"),require("@/apis/decoration"),require("@element-plus/icons-vue"),require("@/utils/date"),require("@/apis/http"),require("lodash-es"),require("@/components/QSafeBtn/QSafeBtn.vue")):typeof define=="function"&&define.amd?define(["vue","vue-router","@vueuse/core","@/composables/useConvert","decimal.js","@/components/BetterPageManage/BetterPageManage.vue","@/store/modules/shopInfo","element-plus","@/apis/good","@/apis/decoration","@element-plus/icons-vue","@/utils/date","@/apis/http","lodash-es","@/components/QSafeBtn/QSafeBtn.vue"],P):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopCouponInfo=P(e.ShopCouponInfoContext.Vue,e.ShopCouponInfoContext.VueRouter,e.ShopCouponInfoContext.VueUse,e.ShopCouponInfoContext.UseConvert,e.ShopCouponInfoContext.Decimal,e.ShopCouponInfoContext.PageManage,e.ShopCouponInfoContext.ShopInfoStore,e.ShopCouponInfoContext.ElementPlus,e.ShopCouponInfoContext.GoodAPI,e.ShopCouponInfoContext.DecorationAPI,e.ShopCouponInfoContext.ElementPlusIconsVue,e.ShopCouponInfoContext.DateUtil,e.ShopCouponInfoContext.Request,e.ShopCouponInfoContext.Lodash,e.ShopCouponInfoContext.QSafeBtn))})(this,function(e,P,re,z,tt,ie,se,I,ce,X,v,ee,L,pe,ue){"use strict";var te=document.createElement("style");te.textContent=`@charset "UTF-8";.title[data-v-bf8c65cb]{font-size:15px;font-weight:700;display:flex;margin-bottom:20px;margin-top:-20px}.digGoods[data-v-bf8c65cb]{border-top:1px solid #d7d7d7;padding-top:10px}.digGoods__box[data-v-bf8c65cb]{background-color:#f2f2f2;padding:10px}.digGoods__box--top[data-v-bf8c65cb]{display:flex;justify-content:space-between}.digGoods__box--content[data-v-bf8c65cb]{margin-top:10px;background-color:#fff;border-radius:5px;display:flex;flex-wrap:wrap;padding:5px}.digGoods__box--content--good[data-v-bf8c65cb]{width:33%;margin-left:2px;margin-bottom:4px;height:80px;border-radius:5px;padding:5px;display:flex}.digGoods__box--content--good--img[data-v-bf8c65cb]{width:65px;height:65px;position:relative}.digGoods__box--content--good--imgShadow[data-v-bf8c65cb]{width:65px;height:65px;position:absolute;background-color:#0009;display:flex;justify-content:center;align-items:center}.digGoods__box--content--good--shopName[data-v-bf8c65cb]{display:flex;justify-content:center;align-items:center;flex-direction:column;justify-content:space-between;align-items:flex-start;margin-left:10px;padding:5px;font-size:12px}.digGoods__box--content--good--shopName--name[data-v-bf8c65cb]{width:150px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.bottom[data-v-bf8c65cb]{display:flex;justify-content:space-between;align-items:flex-end}.bottom-container[data-v-bf8c65cb]{display:flex;justify-content:center;align-items:center;flex-direction:column}[data-v-bf8c65cb] .pagination{padding:8px}.coupon-info[data-v-fc0a0718]{padding:16px;position:relative;height:100%;overflow-y:scroll}.coupon-info__form[data-v-fc0a0718]{overflow-y:auto}.title[data-v-fc0a0718]{text-align:center;font-size:14px;color:#323233;font-weight:700;margin-bottom:30px;line-height:25px}.msg[data-v-fc0a0718]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-fc0a0718]{display:flex;margin-top:10px;height:70px}.period-validity[data-v-fc0a0718]{width:300px;display:flex}.text[data-v-fc0a0718]{font-size:14px;color:#333}.goodsData[data-v-fc0a0718]{border:1px solid #ccc}.goods-list[data-v-fc0a0718]{width:90%;margin-top:20px;border:1px solid transparent}.goods-list__info[data-v-fc0a0718]{display:flex}.goods-list__goods-list__info-name[data-v-fc0a0718]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-fc0a0718]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-fc0a0718]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-fc0a0718]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-fc0a0718]{font-size:16px}.ruleform-date[data-v-fc0a0718]{width:100%;display:flex;align-items:center}.flex[data-v-fc0a0718]{margin-top:10px;height:70px}.flex-item[data-v-fc0a0718]{width:40%}.coupon-rules[data-v-fc0a0718]{height:74px;display:flex;justify-content:center;align-items:center}.commodityForm__tool[data-v-fc0a0718]{margin-top:auto;align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:9}
`,document.head.appendChild(te);const{divTenThousand:me,mulTenThousand:fe}=z(),ge={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var F=(a=>(a.PERIOD="PERIOD",a.IMMEDIATELY="IMMEDIATELY",a))(F||{});function oe(a){return a?fe(a):""}function ne(a){return a?me(a).toString():""}function xe(a){const{name:d,days:p,type:_,endDate:u,productIds:f,productType:i,requiredAmount:c,discount:k,amount:V,effectType:N,startDate:h,num:o,limit:M,id:U,shopId:q}=a;return{shopId:q,id:U,name:d,days:p,endDate:u,productType:i,type:_,requiredAmount:ne(c).toString(),discount:k,amount:ne(V),effectType:N,startDate:h,num:o,limit:M,productIds:f}}const _e=a=>a.statusText,Ce=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(a,{emit:d}){const p=a,_=d,u=re.useVModel(p,"modelValue",_);return(f,i)=>{const c=e.resolveComponent("el-option"),k=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(k,{modelValue:e.unref(u),"onUpdate:modelValue":i[0]||(i[0]=V=>e.isRef(u)?u.value=V:null),placeholder:p.placeholder,style:{width:"150px"},onChange:i[1]||(i[1]=V=>_("change",V))},{default:e.withCtx(()=>[e.renderSlot(f.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(p.list).length?p.list:e.unref(ge),(V,N)=>(e.openBlock(),e.createBlock(c,{key:N,label:V,value:N},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),he={class:"digGoods"},ye={class:"digGoods__box"},Ve={class:"digGoods__box--top"},be={key:0,class:"digGoods__box--content"},Ee=["onClick"],Ne=["src"],we={key:0,class:"digGoods__box--content--good--imgShadow"},Ie={class:"digGoods__box--content--good--shopName"},ke={class:"digGoods__box--content--good--shopName--name"},De={key:1,class:"digGoods__box--content",style:{display:"flex","justify-content":"center","align-items":"center",height:"250px"}},Se={class:"bottom"},Te=e.defineComponent({__name:"choose-goods-popup",props:{pointGoodsList:{type:Array,default(){return[]}},goodsVisible:{type:Boolean,default:!1}},setup(a,{expose:d}){const p=a,{divTenThousand:_}=z(),u=e.reactive({size:10,current:1,total:0}),f=e.reactive({size:10,current:1,total:0}),i=e.ref([]),c=e.ref([]),k=e.ref([]),V=e.ref(""),N=e.ref(!1),h=e.shallowReactive({maxPrice:"",minPrice:"",salePrice:"",keyword:"",categoryFirstId:""});e.watch(p,s=>{if(c.value.length!==s.pointGoodsList.length){const l=c.value.filter(m=>{const C=m.id;return s.pointGoodsList.findIndex(w=>w.id===C)===-1});c.value.forEach(m=>{l.forEach(C=>{C.id===m.id&&(m.isCheck=!1)})}),c.value=c.value.filter(m=>m.isCheck)}},{deep:!0}),d({tempGoods:c,search:h,goodsList:i});const o={borderGet:"2px solid #2D8CF0",borderNoGet:"2px solid #f2f2f2"};e.onMounted(()=>{H()});const M=s=>{h.categoryFirstId=s.id,R()},U=()=>{R()},q=s=>{s.isCheck=!s.isCheck;const l=c.value;if(s.isCheck)l.push(s);else{const m=l.findIndex(C=>C.id===s.id);m!==-1&&l.splice(m,1)}},A=()=>{const s=i.value,l=c.value,m=N.value;s.map(C=>(m&&(l.find(w=>w.id===C.id)||l.push(C)),C.isCheck=m)),m||s.forEach(C=>{const w=l.findIndex(S=>S.id===C.id);w!==-1&&l.splice(w,1)})},j=s=>{u.size=s,R()},Q=s=>{u.current=s,N.value=!1,R()};async function H(){const{code:s,data:l}=await ce.doGetHighestCategoryLevel({size:1e3});s===200?(k.value=l.records,u.total=l.total):I.ElMessage.error("获取分类列表失败")}async function R(){const s=se.useShopInfoStore().shopInfo.id;(h.minPrice||h.maxPrice)&&(h.salePrice=`${h.minPrice}_${h.maxPrice}`);const{code:l,data:m}=await X.doGetRetrieveCommodity({...h,...f,searchTotalStockGtZero:!0,shopId:s});if(l===200){let C=!0;m.list.forEach(w=>{const S=Y(w.id);w.isCheck=S,C=C&&S}),N.value=C,i.value=m.list,f.total=m.total}else I.ElMessage.error("获取商品失败")}function Y(s){return c.value.findIndex(l=>l.id===s)!==-1}function W(s){const l=_(Math.max(...s)).toString(),m=_(Math.min(...s)).toString();return s.length>1?`${m}~${l}`:m}return R(),(s,l)=>{const m=e.resolveComponent("el-option"),C=e.resolveComponent("el-option-group"),w=e.resolveComponent("el-select"),S=e.resolveComponent("el-input"),Z=e.resolveComponent("el-button"),y=e.resolveComponent("el-icon"),n=e.resolveComponent("el-checkbox");return e.openBlock(),e.createElementBlock("div",null,[l[9]||(l[9]=e.createElementVNode("div",{class:"title"},"选择商品",-1)),e.createElementVNode("div",he,[e.createElementVNode("div",ye,[e.createElementVNode("div",Ve,[e.createVNode(w,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=t=>V.value=t),placeholder:"全部分类",style:{width:"120px"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,t=>(e.openBlock(),e.createBlock(C,{key:t.id},{default:e.withCtx(()=>[e.createVNode(m,{label:t.name,value:t.name,onClick:x=>M(t)},null,8,["label","value","onClick"])]),_:2},1024))),128))]),_:1},8,["modelValue"]),e.createElementVNode("div",null,[l[6]||(l[6]=e.createElementVNode("span",{style:{margin:"0px 10px 0px 25px",color:"#a1a1a1",width:"60px","line-height":"32px"}},"价格",-1)),e.createVNode(S,{modelValue:e.unref(h).minPrice,"onUpdate:modelValue":l[1]||(l[1]=t=>e.unref(h).minPrice=t),maxlength:"20",style:{width:"60px"}},null,8,["modelValue"]),l[7]||(l[7]=e.createElementVNode("span",{style:{margin:"0px 5px","line-height":"32px"}},"-",-1)),e.createVNode(S,{modelValue:e.unref(h).maxPrice,"onUpdate:modelValue":l[2]||(l[2]=t=>e.unref(h).maxPrice=t),maxlength:"20",style:{width:"60px"}},null,8,["modelValue"])]),e.createVNode(S,{modelValue:e.unref(h).keyword,"onUpdate:modelValue":l[3]||(l[3]=t=>e.unref(h).keyword=t),class:"input-with-select",maxlength:"20",placeholder:"请输入关键词",style:{width:"200px","margin-left":"10px"}},{append:e.withCtx(()=>[e.createVNode(Z,{icon:e.unref(v.Search),onClick:U},null,8,["icon"])]),_:1},8,["modelValue"])]),i.value.length>0?(e.openBlock(),e.createElementBlock("div",be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t,x)=>(e.openBlock(),e.createElementBlock("div",{key:x,style:e.normalizeStyle({border:t.isCheck?o.borderGet:o.borderNoGet}),class:"digGoods__box--content--good",onClick:g=>q(t)},[e.createElementVNode("img",{src:t.pic,class:"digGoods__box--content--good--img"},null,8,Ne),t.isCheck?(e.openBlock(),e.createElementBlock("div",we,[e.createVNode(y,{color:"#fff",size:"40px"},{default:e.withCtx(()=>[e.createVNode(e.unref(v.Check))]),_:1})])):e.createCommentVNode("",!0),e.createElementVNode("div",Ie,[e.createElementVNode("div",ke,e.toDisplayString(t.productName),1),e.createElementVNode("div",null," ￥"+e.toDisplayString(t.salePrices&&W(t.salePrices)),1)])],12,Ee))),128))])):e.createCommentVNode("",!0),i.value.length===0?(e.openBlock(),e.createElementBlock("div",De," 暂无相关商品信息，请选择其他分类 ")):e.createCommentVNode("",!0),e.createElementVNode("div",Se,[e.createVNode(n,{modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=t=>N.value=t),style:{height:"48px","background-color":"#fff","padding-left":"5px"},onChange:A},{default:e.withCtx(()=>l[8]||(l[8]=[e.createTextVNode("全选")])),_:1},8,["modelValue"]),e.createVNode(ie,{modelValue:f,"onUpdate:modelValue":l[5]||(l[5]=t=>f=t),"load-init":!0,total:f.total,background:"",onReload:R,onHandleSizeChange:j,onHandleCurrentChange:Q},null,8,["modelValue","total"])])])])])}}}),ot="",le=(a,d)=>{const p=a.__vccOpts||a;for(const[_,u]of d)p[_]=u;return p},qe=le(Te,[["__scopeId","data-v-bf8c65cb"]]),Re=a=>L.post({url:"addon-coupon/coupon",data:a}),Be=(a,d)=>L.get({url:`addon-coupon/coupon/shop/${a}/${d}`}),Pe=(a,d)=>L.put({url:`addon-coupon/coupon/${a}`,data:d}),Ue=(a,d)=>L.put({url:`addon-coupon/coupon/${a}/working`,data:d}),Ge=(a,d,p)=>{if(a==="PRICE_REDUCE"){Me(a,d);return}if(a==="PRICE_DISCOUNT"){ae(a,d);return}if(a==="REQUIRED_PRICE_REDUCE"){ae(a,d),Ae(a,d,p);return}if(a==="REQUIRED_PRICE_DISCOUNT"){const _=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(f,i,c)=>{Number(i)<=0?c(new Error("金额必须大于0")):c()},trigger:"blur"}],u=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(f,i,c)=>{Number(i)<=0&&Number(i)<100?c(new Error("0.1~99之间")):c()},trigger:"blur"}];d.requiredAmount=_,d.discount=u}},Me=(a,d)=>{d.discount.length&&(d.discount[0].required=!1),d.requiredAmount.length&&(d.discount[0].required=!1);const p=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(_,u,f)=>{Number(u)<=0?f(new Error("金额必须大于0")):f()},trigger:"blur"}];d.amount=p},ae=(a,d)=>{d.requiredAmount.length&&(d.discount[0].required=!1),d.amount.length&&(d.amount[0].required=!1);const p=[{required:!0,message:"请输入优惠券规则",trigger:"blur"},{validator:(_,u,f)=>{Number(u)<=0&&Number(u)<100?f(new Error("0.1~99之间")):f()},trigger:"blur"}];d.discount=p},Ae=(a,d,p)=>{d.discount.length&&(d.discount[0].required=!1);const _=[{required:!0,message:"请输入金额",trigger:"blur"},{validator:(f,i,c)=>{Number(i)<=0?c(new Error("金额必须大于0")):c()},trigger:"blur"}],u=[..._,{validator:(f,i,c)=>{Number(p.requiredAmount)-Number(i)<=0?c(new Error(`满减金额必须小于${Number(p.requiredAmount)}`)):c()},trigger:"blur"}];d.amount=u,d.requiredAmount=_},$e={class:"q_plugin_container overh"},Le={class:"coupon-info"},Oe={class:"title"},ze={key:0,class:"ruleform-date"},Fe={class:"period-validity text"},je={class:"coupon-rules"},Qe={key:2,class:"df",style:{width:"100%","flex-wrap":"nowrap"}},He={key:3,class:"df"},Ye={class:"goods-list__info"},We={class:"goods-list__goods-list__info-name"},Ze={class:"goods-list__goods-list__info-name--name"},Je={class:"goods-list__goods-list__info-name--price"},Ke={class:"dialog-footer"},Xe={class:"commodityForm__tool"},ve=e.defineComponent({__name:"ShopCouponInfo",setup(a){const d=P.useRouter(),p=P.useRoute(),_=new ee,u=e.ref(!1),f=e.ref(""),i=e.ref([]),c=e.ref(""),k=e.ref(),V=e.ref(!1),N=e.ref([]),h=e.ref(),o=e.ref({name:"",days:1,endDate:"",productType:"SHOP_ALL",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:F.PERIOD,startDate:"",num:1,limit:1,shopId:"",productIds:[],createTime:"",usedCount:""}),M=z(),U={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],effectType:[{required:!0,message:"请选择有效时间",trigger:["blur","change"]}],type:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],discount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],num:[{required:!0,message:"请输入发行量",trigger:"blur"}],limit:[{required:!0,message:"请输入每人发送数量",trigger:"blur"}],requiredAmount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],amount:[{required:!0,message:"请输入优惠券规则",trigger:"blur"}],productType:[{required:!0,message:"请选择优惠券类型",trigger:["blur","change"]}],days:[{required:!0,message:"请输入优惠券有效期",trigger:"blur"},{validator:(n,t,x)=>{Number(t)===0?x("最少1天"):x()},trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:["blur","change"]}],endDate:[{required:!0,message:"请选择结束日期",trigger:["blur","change"]}]},q=e.ref(!1),A=new ee,j=n=>{!n||!n[0]||!n[1]||(n[0].getTime()>=n[1].getTime()&&I.ElMessage.warning("结束时间大于开始时间"),o.value.startDate=A.getYMDHMSs(n[0]),o.value.endDate=A.getYMDHMSs(n[1]))};H(),e.watch(()=>p,async n=>{var g;if(q.value=!!n.query.isLookUp,!n.query.id||!n.query.shopId)return;const{code:t,data:x}=await Be(n.query.shopId.toString(),n.query.id.toString());if(t!==200){I.ElMessage.error("获取优惠券信息失败");return}if(o.value=xe(x),f.value=_e(x),c.value=x.endDate,u.value=!0,N.value=[x.startDate,x.endDate],(g=x.productIds)!=null&&g.length){const{code:E,data:b}=await X.doGetRetrieveCommodity({productId:x.productIds,searchTotalStockGtZero:!0});if(E!==200){I.ElMessage.error("获取商品信息失败");return}i.value=b.list.map(T=>({...T,isCheck:!0}))}},{immediate:!0});const Q=e.ref(!1);function H(){console.log("$route.query.isEdit",p.query.isEdit),p.query.isEdit&&(Q.value=p.query.isEdit==="true")}const R=async()=>{var x,g;if(!k.value)return;const{num:n,limit:t}=o.value;if(!n||!t){I.ElMessage.error("发行量或每人发送数量只能是正整数和数字");return}try{if(!await k.value.validate())return;if(["ASSIGNED","ASSIGNED_NOT"].includes(o.value.productType)&&!i.value.length){i.value.length,I.ElMessage.error("请选择指定商品");return}W();const b=s();o.value.productType==="SHOP_ALL"&&(b.productIds=null),Y(b);const T=o.value.id,{code:$}=await(T?f.value==="进行中"?Ue(T,{name:b.name,days:b.days,endDate:b.endDate,productType:b.productType,productIds:b.productIds}):Pe(T,b):Re(b));if($!==200){I.ElMessage.error("保存失败");return}I.ElMessage.success("保存成功"),w(),d.push({name:"coupons"})}catch(E){if((x=E.requiredAmount)!=null&&x.length){I.ElMessage.info(E.requiredAmount[0].message);return}if((g=E.amount)!=null&&g.length){I.ElMessage.info(E.amount[0].message);return}}};function Y(n){n.effectType==="PERIOD"&&(n.days=null),n.effectType==="IMMEDIATELY"&&(n.startDate="",n.endDate=""),n.type==="PRICE_REDUCE"&&(n.requiredAmount=null,n.discount=null),n.type==="PRICE_DISCOUNT"&&(n.amount=null,n.requiredAmount=null),n.type==="REQUIRED_PRICE_REDUCE"&&(n.discount=null),n.type==="REQUIRED_PRICE_DISCOUNT"&&(n.amount=null)}const W=()=>{if(o.value.effectType==="PERIOD"){o.value.days=1;return}o.value.startDate="",o.value.endDate=""};function s(){const{name:n,days:t,endDate:x,productType:g,type:E,requiredAmount:b,discount:T,amount:$,effectType:D,startDate:B,num:O,limit:J,shopId:G}=o.value;return{name:n,days:t,endDate:x,productType:g,type:E,requiredAmount:oe(b).toString(),discount:T,amount:oe($).toString(),effectType:D,startDate:B,num:O,shopId:G,limit:J,productIds:i.value.length?i.value.map(K=>K.productId):null}}const l=()=>{V.value=!1},m=()=>{i.value=pe.cloneDeep(h.value.tempGoods),V.value=!1},C=async n=>{await I.ElMessageBox.confirm("确定移除该商品?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})&&(i.value=i.value.filter(x=>x.productId!==n))};function w(){k.value&&(k.value.resetFields(),o.value={name:"",days:1,endDate:"",productType:"SHOP_ALL",type:"PRICE_DISCOUNT",requiredAmount:1,discount:1,amount:1,effectType:F.PERIOD,startDate:"",num:1,shopId:"",limit:1,productIds:[],createTime:"",usedCount:""},i.value=[])}const S=()=>{Ge(o.value.type,U,o.value),o.value.amount=1,o.value.requiredAmount=1,o.value.discount=1},Z=n=>u.value?c.value>_.getYMDs(n):!!o.value.startDate?o.value.startDate>_.getYMDs(n)||_.getYMDs(n)<_.getYMDs(new Date):!1,y=n=>q.value?!0:u.value&&!n.includes(f.value);return(n,t)=>{const x=e.resolveComponent("el-input"),g=e.resolveComponent("el-form-item"),E=e.resolveComponent("el-radio"),b=e.resolveComponent("el-radio-group"),T=e.resolveComponent("el-row"),$=e.resolveComponent("el-date-picker"),D=e.resolveComponent("el-input-number"),B=e.resolveComponent("el-table-column"),O=e.resolveComponent("el-table"),J=e.resolveComponent("el-image"),G=e.resolveComponent("el-button"),de=e.resolveComponent("el-link"),K=e.resolveComponent("el-form"),et=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$e,[e.createElementVNode("div",Le,[e.createElementVNode("h1",Oe,e.toDisplayString(q.value?"基本信息":"新增优惠券"),1),e.createVNode(K,{ref_key:"ruleFormRef",ref:k,"inline-message":!1,model:o.value,rules:U,"label-width":"auto",class:"coupon-info__form"},{default:e.withCtx(()=>[e.createVNode(g,{label:"优惠券名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(x,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),modelModifiers:{trim:!0},disabled:y(["未开始","进行中"]),maxlength:"10",placeholder:"请输入优惠券名称",style:{width:"551px"}},null,8,["modelValue","disabled"]),t[18]||(t[18]=e.createElementVNode("span",{class:"msg"},"优惠券名称不超过10个字",-1))]),_:1}),e.createVNode(g,{label:"有效时间",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(T,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(b,{modelValue:o.value.effectType,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.effectType=r),disabled:y(["未开始"]),class:"ml-4"},{default:e.withCtx(()=>[e.createVNode(E,{value:"PERIOD"},{default:e.withCtx(()=>t[19]||(t[19]=[e.createTextVNode("固定时间")])),_:1}),e.createVNode(E,{value:"IMMEDIATELY"},{default:e.withCtx(()=>t[20]||(t[20]=[e.createTextVNode("领券立即生效")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),e.createVNode(T,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[o.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",ze,[e.createVNode($,{modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=r=>N.value=r),style:{width:"550px"},type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",disabled:y(["未开始","进行中"]),"disabled-date":Z,onChange:j},null,8,["modelValue","disabled"])])):(e.openBlock(),e.createBlock(g,{key:1,prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",Fe,[t[21]||(t[21]=e.createTextVNode(" 领券当日起 ")),e.createVNode(D,{modelValue:o.value.days,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.days=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始","进行中"]),max:99999,min:o.value.days?1:0,style:{width:"20%",margin:"0 5px"}},null,8,["modelValue","disabled","min"]),t[22]||(t[22]=e.createTextVNode(" 天内可用 "))])]),_:1}))]),_:1})]),_:1}),e.createVNode(g,{label:"活动规则"},{default:e.withCtx(()=>[e.createVNode(O,{"cell-style":{height:"60px"},data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(B,{label:"选择优惠券类型",width:"170"},{default:e.withCtx(()=>[e.createVNode(g,{prop:"type"},{default:e.withCtx(()=>[e.createVNode(Ce,{modelValue:o.value.type,"onUpdate:modelValue":t[4]||(t[4]=r=>o.value.type=r),disabled:y(["未开始"]),placeholder:"全部类型",onChange:S},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e.createVNode(B,{label:"优惠券规则",width:"350"},{default:e.withCtx(()=>[e.createElementVNode("div",je,[o.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(g,{key:0,prop:"discount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.discount,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.discount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:9.9,min:.1,precision:1,style:{width:"40%"}},null,8,["modelValue","disabled"]),t[23]||(t[23]=e.createElementVNode("span",{style:{"margin-left":"10px"}},"折，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(g,{key:1,prop:"amount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.amount,"onUpdate:modelValue":t[6]||(t[6]=r=>o.value.amount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:999999,min:0,style:{width:"40%"}},null,8,["modelValue","disabled"]),t[24]||(t[24]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元，无门槛使用",-1))]),_:1})):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",Qe,[e.createVNode(g,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[25]||(t[25]=e.createElementVNode("span",null,"满",-1)),e.createVNode(D,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[7]||(t[7]=r=>o.value.requiredAmount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:99999,min:0,style:{width:"120px",margin:"0 5px"}},null,8,["modelValue","disabled"]),t[26]||(t[26]=e.createElementVNode("span",null,"元,打",-1))]),_:1}),e.createVNode(g,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.discount,"onUpdate:modelValue":t[8]||(t[8]=r=>o.value.discount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:9.9,min:.1,precision:1,style:{width:"60px","margin-left":"5px"}},null,8,["modelValue","disabled"]),t[27]||(t[27]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"折",-1))]),_:1})])):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",He,[e.createVNode(g,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[28]||(t[28]=e.createElementVNode("span",null,"满",-1)),e.createVNode(D,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[9]||(t[9]=r=>o.value.requiredAmount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:999999,min:0,style:{width:"80%","margin-left":"5px"}},null,8,["modelValue","disabled"])]),_:1}),e.createVNode(g,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[t[29]||(t[29]=e.createElementVNode("span",null,"元,减",-1)),e.createVNode(D,{modelValue:o.value.amount,"onUpdate:modelValue":t[10]||(t[10]=r=>o.value.amount=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:999999,min:0,style:{width:"60%","margin-left":"5px"}},null,8,["modelValue","disabled"]),t[30]||(t[30]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元",-1))]),_:1})])):e.createCommentVNode("",!0)])]),_:1}),e.createVNode(B,{label:"发行量（张）"},{default:e.withCtx(()=>[e.createVNode(g,{prop:"num"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.num,"onUpdate:modelValue":t[11]||(t[11]=r=>o.value.num=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:99999,min:1},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e.createVNode(B,{label:"每人发送（张）"},{default:e.withCtx(()=>[e.createVNode(g,{prop:"limit"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:o.value.limit,"onUpdate:modelValue":t[12]||(t[12]=r=>o.value.limit=r),modelModifiers:{number:!0},controls:!1,disabled:y(["未开始"]),max:99999,min:1},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(g,{label:"商品选择",prop:"productType"},{default:e.withCtx(()=>[e.createVNode(b,{modelValue:o.value.productType,"onUpdate:modelValue":t[13]||(t[13]=r=>o.value.productType=r),disabled:y(["未开始","进行中"])},{default:e.withCtx(()=>[e.createVNode(E,{value:"SHOP_ALL"},{default:e.withCtx(()=>t[31]||(t[31]=[e.createTextVNode("全部商品参与")])),_:1}),e.createVNode(E,{value:"ASSIGNED"},{default:e.withCtx(()=>t[32]||(t[32]=[e.createTextVNode("指定商品参与")])),_:1}),e.createVNode(E,{value:"ASSIGNED_NOT"},{default:e.withCtx(()=>t[33]||(t[33]=[e.createTextVNode("指定商品不参与")])),_:1})]),_:1},8,["modelValue","disabled"]),o.value.productType!=="SHOP_ALL"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([i.value.length&&"goodsData","goods-list"])},[e.createVNode(O,{data:i.value,"header-cell-style":{fontSize:"14px",color:"#606266",background:"#f2f2f2",height:"54px",fontWeight:"normal"},height:"400px",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(B,{label:`商品信息${i.value.length?`(已选择${i.value.length}款商品)`:""}`},{default:e.withCtx(({row:r})=>[e.createElementVNode("div",Ye,[e.createVNode(J,{"preview-src-list":[r.pic],"preview-teleported":!0,src:r.pic,fit:"",style:{width:"60px",height:"60px"}},null,8,["preview-src-list","src"]),e.createElementVNode("div",We,[e.createElementVNode("div",Ze,e.toDisplayString(r.productName),1),e.createElementVNode("div",Je,e.toDisplayString(e.unref(M).divTenThousand(r.salePrices[0])),1)])])]),_:1},8,["label"]),e.createVNode(B,{width:"100px"},{header:e.withCtx(()=>[e.createVNode(G,{disabled:y(["未开始","进行中"]),plain:"",round:"",type:"primary",size:"small",onClick:t[14]||(t[14]=r=>V.value=!0)},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("添加商品 ")])),_:1},8,["disabled"])]),default:e.withCtx(({row:r})=>[e.createVNode(de,{disabled:y(["未开始"]),underline:!1,type:"primary",onClick:at=>C(r.productId)},{default:e.withCtx(()=>t[35]||(t[35]=[e.createTextVNode("删除 ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])],2)):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["model"])]),e.createVNode(et,{modelValue:V.value,"onUpdate:modelValue":t[16]||(t[16]=r=>V.value=r),"before-close":l,width:"800px"},{footer:e.withCtx(()=>[e.createElementVNode("span",Ke,[e.createVNode(G,{onClick:t[15]||(t[15]=r=>V.value=!1)},{default:e.withCtx(()=>t[36]||(t[36]=[e.createTextVNode("取消")])),_:1}),e.createVNode(G,{type:"primary",onClick:m},{default:e.withCtx(()=>t[37]||(t[37]=[e.createTextVNode(" 确认 ")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(qe,{ref_key:"chooseGoodsPopupRef",ref:h,pointGoodsList:i.value},null,8,["pointGoodsList"])]),_:1},8,["modelValue"])]),e.createElementVNode("div",Xe,[e.createVNode(G,{plain:"",round:"",onClick:t[17]||(t[17]=r=>e.unref(d).back())},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(q.value?"返回":"取消"),1)]),_:1}),q.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(ue,{key:0,style:{"margin-left":"40px"},disabled:y(["","未开始","进行中"]),round:"",type:"primary",onClick:R},{default:e.withCtx(()=>t[38]||(t[38]=[e.createTextVNode("确定")])),_:1},8,["disabled"]))])],64)}}}),nt="";return le(ve,[["__scopeId","data-v-fc0a0718"]])});
