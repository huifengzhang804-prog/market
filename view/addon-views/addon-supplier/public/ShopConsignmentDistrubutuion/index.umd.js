(function(e,C){typeof exports=="object"&&typeof module<"u"?module.exports=C(require("vue"),require("@/apis/http"),require("element-plus"),require("decimal.js"),require("vue-router"),require("@/composables/useConvert")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","element-plus","decimal.js","vue-router","@/composables/useConvert"],C):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopConsignmentDistrubutuion=C(e.ShopConsignmentDistrubutuionContext.Vue,e.ShopConsignmentDistrubutuionContext.Request,e.ShopConsignmentDistrubutuionContext.ElementPlus,e.ShopConsignmentDistrubutuionContext.Decimal,e.ShopConsignmentDistrubutuionContext.VueRouter,e.ShopConsignmentDistrubutuionContext.UseConvert))})(this,function(e,C,D,N,A,W){"use strict";var G=document.createElement("style");G.textContent=`@charset "UTF-8";.distribution[data-v-f4da5933]{overflow-y:scroll;padding-bottom:60px}.distribution .distribution_form[data-v-f4da5933]{padding-left:16px;padding-right:16px}.distribution__title[data-v-f4da5933]{font-weight:700;padding:15px 0}.distribution__container[data-v-f4da5933]{padding:0 20px}.distribution__btns[data-v-f4da5933]{display:flex;justify-content:center;align-items:center;position:absolute;width:100%;bottom:0;z-index:9;background-color:#fff;box-shadow:0 0 10px #d5d5d5;padding-top:10px;padding-bottom:10px}.distribution__btns .el-button[data-v-f4da5933]{width:75px;height:40px}
`,document.head.appendChild(G);var L=(o=>(o.UNLIMITED="不限购",o.PRODUCT_LIMITED="商品限购",o.SKU_LIMITED="规格限购",o))(L||{});const z=(o,n,i=!1)=>C.get({url:`gruul-mall-storage/storage/shop/${o}/product/${n}?isSupplier=${i}`}),K=()=>C.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),H=o=>C.get({url:"gruul-mall-goods/goods/product/category",params:o}),J=()=>C.get({url:"gruul-mall-goods/consignment/config"}),O=(o,n)=>C.get({url:`addon-supplier/supplier/manager/product/get/${n}/${o}`}),Q=o=>C.post({url:"gruul-mall-goods/consignment/single/pave/goods",data:o}),{divTenThousand:w,mulTenThousand:U}=W(),X={name:"",saleDescribe:"",platformCategoryId:[],categoryId:"",providerId:"",widePic:"",distributionMode:[],videoUrl:"",albumPics:"",productType:"REAL_PRODUCT",specGroups:[],platformCategory:{one:null,two:null,three:null},shopCategory:{one:null,two:null,three:null},skus:[{id:"",image:"",initSalesVolume:0,limitNum:0,limitType:"UNLIMITED",price:0,productId:"",initStock:0,salePrice:0,shopId:"",stockType:"UNLIMITED",weight:0,specs:[]}],productParameters:[],productAttributes:[],serviceIds:[],detail:"",freightTemplateId:"0",status:"SELL_ON",brandId:""},Z=()=>{const o=A.useRoute(),n=A.useRouter(),i=e.ref(),a=e.ref([]),c=e.ref([]),s=e.reactive({name:"",shopCategory:"",saleDescribe:"",consignmentPriceSetting:{type:"UNIFY",sale:0,scribe:0},unifyPriceSetting:{type:"",sale:"",scribe:""}}),u={name:{required:!0,message:"请输入商品名称",trigger:"blur"},shopCategory:{required:!0,message:"请选择店铺类目",trigger:"change",type:"array"}},k={expandTrigger:"hover",label:"name",value:"id"},S=e.ref(X),_=e.ref([]),h=e.ref([]);async function T(){const{code:p,data:f,success:d}=await K();if(p!==200){D.ElMessage.error("获取平台分类失败");return}_.value=F(1,f==null?void 0:f.map(y=>({...y,id:y.categoryId})))}async function Y(){const{code:p,data:f}=await H({current:1,size:500});if(p!==200){D.ElMessage.error("获取店铺分类失败");return}h.value=F(1,f.records)}const t=async()=>{var y,m,g,P,b,l;const p=o.query.shopId,f=o.query.id,{data:d}=await O(f,p);s.name=d==null?void 0:d.name,S.value.platformCategoryId=[(m=(y=d==null?void 0:d.extra)==null?void 0:y.platformCategory)==null?void 0:m.one,(P=(g=d==null?void 0:d.extra)==null?void 0:g.platformCategory)==null?void 0:P.two,(l=(b=d==null?void 0:d.extra)==null?void 0:b.platformCategory)==null?void 0:l.three]},R=async()=>{const{data:p,code:f}=await J();f===200&&(p?(s.unifyPriceSetting.sale=w(p==null?void 0:p.sale).toString(),s.unifyPriceSetting.scribe=w(p==null?void 0:p.scribe).toString(),s.unifyPriceSetting.type=p==null?void 0:p.type):s.consignmentPriceSetting.type="RATE")};e.watch(()=>s.consignmentPriceSetting,()=>$(s,a),{deep:!0});const x=async()=>{var y,m;const p=o.query.shopId,f=o.query.id,{data:d}=await z(p,f);a.value=(m=(y=d==null?void 0:d.skus)==null?void 0:y.map(g=>{var P,b;return{...g,salePrice:(P=w(g.salePrice))==null?void 0:P.toString(),price:(b=w(g.price))==null?void 0:b.toString()}}))==null?void 0:m.filter(g=>!((g==null?void 0:g.stockType)!=="UNLIMITED"&&Number(g==null?void 0:g.stock)===0)),c.value=(d==null?void 0:d.specGroups)||[],$(s,a)},B=async()=>{t(),T(),Y();try{await R()}finally{x()}},I=()=>{n.back()},q=()=>{var p;(p=i.value)==null||p.validate(async f=>{var d,y,m,g,P;if(f){const b={shopCategory:{one:(d=s==null?void 0:s.shopCategory)==null?void 0:d[0],two:(y=s==null?void 0:s.shopCategory)==null?void 0:y[1],three:(m=s==null?void 0:s.shopCategory)==null?void 0:m[2]},shopProductKey:{shopId:(g=o.query)==null?void 0:g.shopId,productId:(P=o.query)==null?void 0:P.id},name:s.name,saleDescribe:s.saleDescribe},l={};s.consignmentPriceSetting.type==="UNIFY"?(l.type=s.unifyPriceSetting.type,l.sale=U(s.unifyPriceSetting.sale||0).toString(),l.scribe=U(s.unifyPriceSetting.scribe||0).toString()):(l.type=s.consignmentPriceSetting.type,l.sale=U(s.consignmentPriceSetting.sale||0).toString(),l.scribe=U(s.consignmentPriceSetting.scribe||0).toString()),b.consignmentPriceSetting=l;const{code:r,success:E,msg:V}=await Q(b);r===200&&E?(D.ElMessage.success({message:V||"铺货完成"}),I()):D.ElMessage.error({message:V})}})};return B(),{formRef:i,distributionFormModel:s,distributionFormRules:u,platformCategoryList:_,currentComodityInfo:S,shopCascaderProps:k,shopCategoryList:h,distributionSkus:a,divTenThousand:w,specGroups:c,cancelDistribution:I,handleConfirmDistribution:q}},M={UNIFY:(o,n)=>{var a;const i=(a=o==null?void 0:o.unifyPriceSetting)==null?void 0:a.type;return M[i](o,n)},RATE:(o,n)=>{var a,c;const i=((a=o==null?void 0:o.consignmentPriceSetting)==null?void 0:a.type)==="UNIFY"?"unifyPriceSetting":"consignmentPriceSetting";return(c=n.value)==null?void 0:c.map(s=>{var S,_,h,T;const u=(_=new N(s.salePrice))==null?void 0:_.mul(new N(1).add(new N(((S=o[i])==null?void 0:S.sale)||0).div(100))).toFixed(2),k=(T=new N(u))==null?void 0:T.mul(new N(1).add(new N(((h=o[i])==null?void 0:h.scribe)||0).div(100)));return{...s,actualSalePrice:u,actualPrice:k}})},REGULAR:(o,n)=>{var a,c;const i=((a=o==null?void 0:o.consignmentPriceSetting)==null?void 0:a.type)==="UNIFY"?"unifyPriceSetting":"consignmentPriceSetting";return(c=n.value)==null?void 0:c.map(s=>{var S,_,h,T;const u=(_=new N(s.salePrice))==null?void 0:_.add(new N(((S=o[i])==null?void 0:S.sale)||0)).toFixed(2),k=(T=new N(u))==null?void 0:T.add(new N(((h=o[i])==null?void 0:h.scribe)||0)).toFixed(2);return{...s,actualSalePrice:u,actualPrice:k}})},undefined:()=>[]};function $(o,n){var a;const i=(a=o==null?void 0:o.consignmentPriceSetting)==null?void 0:a.type;n.value=M[i](o,n)}function F(o,n){const i=o===3;for(let a=0;a<n.length;){const c=n[a];if(i){c.disabled=!1,a++;continue}const s=c.children||c.secondCategoryVos||c.categoryThirdlyVos;delete c.secondCategoryVos,delete c.categoryThirdlyVos;const u=!s||s.length===0;if(c.disabled=u,u){n.splice(a,1);continue}if(F(o+1,s),s.length===0){n.splice(a,1);continue}c.children=s,a++}return n}const v=e.defineComponent({__name:"batch-unify-settings",props:{type:{default:""},sale:{default:0},scribe:{default:0}},setup(o){return(n,i)=>{const a=e.resolveComponent("el-input-number"),c=e.resolveComponent("el-form-item");return n.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(c,{prop:"sale"},{default:e.withCtx(()=>[i[0]||(i[0]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(a,{"model-value":n.sale,controls:!1,precision:2,disabled:""},null,8,["model-value"]),i[1]||(i[1]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(c,{prop:"scribe"},{default:e.withCtx(()=>[i[2]||(i[2]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(a,{"model-value":n.scribe,controls:!1,precision:2,disabled:""},null,8,["model-value"]),i[3]||(i[3]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):n.type==="REGULAR"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(c,{prop:"sale"},{default:e.withCtx(()=>[i[4]||(i[4]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(a,{"model-value":n.sale,controls:!1,precision:2,disabled:""},null,8,["model-value"]),i[5]||(i[5]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(c,{prop:"scribe"},{default:e.withCtx(()=>[i[6]||(i[6]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(a,{"model-value":n.scribe,controls:!1,precision:2,disabled:""},null,8,["model-value"]),i[7]||(i[7]=e.createElementVNode("span",null," 元",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[],64))}}}),ee={class:"distribution"},te={class:"distribution__container"},ne={class:"distribution__container"},oe={class:"distribution__container fdc1 overh"},re={class:"price-settings"},ie={class:"distribution__btns"},le=e.defineComponent({__name:"ShopConsignmentDistrubutuion",setup(o){const{distributionFormModel:n,distributionSkus:i,distributionFormRules:a,platformCategoryList:c,shopCascaderProps:s,currentComodityInfo:u,shopCategoryList:k,specGroups:S,formRef:_,cancelDistribution:h,handleConfirmDistribution:T}=Z();return(Y,t)=>{const R=e.resolveComponent("el-input"),x=e.resolveComponent("el-form-item"),B=e.resolveComponent("el-cascader"),I=e.resolveComponent("el-col"),q=e.resolveComponent("el-row"),p=e.resolveComponent("el-radio"),f=e.resolveComponent("el-radio-group"),d=e.resolveComponent("el-input-number"),y=e.resolveComponent("el-image"),m=e.resolveComponent("el-table-column"),g=e.resolveComponent("el-table"),P=e.resolveComponent("el-form"),b=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",ee,[e.createVNode(P,{ref_key:"formRef",ref:_,class:"distribution_form fdc1 overh",model:e.unref(n),rules:e.unref(a)},{default:e.withCtx(()=>[t[22]||(t[22]=e.createElementVNode("div",{class:"distribution__title"},"基础信息",-1)),e.createElementVNode("div",te,[e.createVNode(x,{label:"商品名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:e.unref(n).name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.unref(n).name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),e.createVNode(x,{label:"平台类目"},{default:e.withCtx(()=>[e.createVNode(B,{ref:"platformCategoryRef",modelValue:e.unref(u).platformCategoryId,"onUpdate:modelValue":t[1]||(t[1]=l=>e.unref(u).platformCategoryId=l),clearable:"",class:"inputWidth",style:{width:"100%"},options:e.unref(c),props:e.unref(s),placeholder:"请选择平台类目","show-all-levels":"",disabled:""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(x,{label:"店铺类目",prop:"shopCategory"},{default:e.withCtx(()=>[e.createVNode(B,{ref:"shopCategoryRef",modelValue:e.unref(n).shopCategory,"onUpdate:modelValue":t[2]||(t[2]=l=>e.unref(n).shopCategory=l),clearable:"",style:{width:"100%"},class:"inputWidth",options:e.unref(k),props:e.unref(s),placeholder:"请选择店铺类目","show-all-levels":""},null,8,["modelValue","options","props"])]),_:1}),e.createVNode(x,{label:"卖点描述",prop:"saleDescribe"},{default:e.withCtx(()=>[e.createVNode(R,{modelValue:e.unref(n).saleDescribe,"onUpdate:modelValue":t[3]||(t[3]=l=>e.unref(n).saleDescribe=l),class:"inputWidth",placeholder:"请填写卖点描述",maxlength:"60"},null,8,["modelValue"])]),_:1})]),e.unref(i).length===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[10]||(t[10]=e.createElementVNode("div",{class:"distribution__title"},"单规格信息",-1)),e.createElementVNode("div",ne,[e.createVNode(q,{gutter:8},{default:e.withCtx(()=>[e.createVNode(I,{span:6},{default:e.withCtx(()=>t[9]||(t[9]=[e.createTextVNode("规格类型：单规格")])),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var l,r;return[e.createTextVNode("供货价："+e.toDisplayString((r=(l=e.unref(i))==null?void 0:l[0])==null?void 0:r.salePrice),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var l,r,E,V;return[e.createTextVNode("销量（注水）："+e.toDisplayString(Number(((r=(l=e.unref(i))==null?void 0:l[0])==null?void 0:r.initSalesVolume)||0)+Number(((V=(E=e.unref(i))==null?void 0:E[0])==null?void 0:V.salesVolume)||0)),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var l,r;return[e.createTextVNode("重量："+e.toDisplayString((r=(l=e.unref(i))==null?void 0:l[0])==null?void 0:r.weight),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var l,r,E,V;return[e.createTextVNode("库存数："+e.toDisplayString(((r=(l=e.unref(i))==null?void 0:l[0])==null?void 0:r.stockType)==="UNLIMITED"?"无限库存":(V=(E=e.unref(i))==null?void 0:E[0])==null?void 0:V.stock),1)]}),_:1}),e.createVNode(I,{span:6},{default:e.withCtx(()=>{var l,r;return[e.createTextVNode("限购类型："+e.toDisplayString(e.unref(L)[(r=(l=e.unref(i))==null?void 0:l[0])==null?void 0:r.limitType]),1)]}),_:1})]),_:1})])],64)):e.createCommentVNode("",!0),t[23]||(t[23]=e.createElementVNode("div",{class:"distribution__title"},"价格设置",-1)),e.createElementVNode("div",oe,[e.createElementVNode("div",re,[e.createVNode(f,{modelValue:e.unref(n).consignmentPriceSetting.type,"onUpdate:modelValue":t[4]||(t[4]=l=>e.unref(n).consignmentPriceSetting.type=l)},{default:e.withCtx(()=>[e.createVNode(p,{disabled:e.unref(n).unifyPriceSetting.type,value:"UNIFY"},{default:e.withCtx(()=>t[11]||(t[11]=[e.createTextVNode("统一设价")])),_:1},8,["disabled"]),e.createVNode(p,{value:"RATE"},{default:e.withCtx(()=>t[12]||(t[12]=[e.createTextVNode("按比例设价")])),_:1}),e.createVNode(p,{value:"REGULAR"},{default:e.withCtx(()=>t[13]||(t[13]=[e.createTextVNode("固定金额设价")])),_:1})]),_:1},8,["modelValue"]),e.unref(n).consignmentPriceSetting.type==="UNIFY"?(e.openBlock(),e.createBlock(v,{key:0,sale:+e.unref(n).unifyPriceSetting.sale,scribe:+e.unref(n).unifyPriceSetting.scribe,type:e.unref(n).unifyPriceSetting.type},null,8,["sale","scribe","type"])):e.unref(n).consignmentPriceSetting.type==="RATE"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(x,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[t[14]||(t[14]=e.createElementVNode("span",null,"销售价 = 供货价 + （供货价 *  ",-1)),e.createVNode(d,{modelValue:e.unref(n).consignmentPriceSetting.sale,"onUpdate:modelValue":t[5]||(t[5]=l=>e.unref(n).consignmentPriceSetting.sale=l),controls:!1,precision:2,min:0},null,8,["modelValue"]),t[15]||(t[15]=e.createElementVNode("span",null," % ）",-1))]),_:1}),e.createVNode(x,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[t[16]||(t[16]=e.createElementVNode("span",null,"划线价 = 销售价 + （销售价 *  ",-1)),e.createVNode(d,{modelValue:e.unref(n).consignmentPriceSetting.scribe,"onUpdate:modelValue":t[6]||(t[6]=l=>e.unref(n).consignmentPriceSetting.scribe=l),controls:!1,precision:2,min:0},null,8,["modelValue"]),t[17]||(t[17]=e.createElementVNode("span",null," % ）",-1))]),_:1})],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createVNode(x,{prop:"consignmentPriceSetting.sale"},{default:e.withCtx(()=>[t[18]||(t[18]=e.createElementVNode("span",null,"销售价 = 供货价 +  ",-1)),e.createVNode(d,{modelValue:e.unref(n).consignmentPriceSetting.sale,"onUpdate:modelValue":t[7]||(t[7]=l=>e.unref(n).consignmentPriceSetting.sale=l),controls:!1,precision:2,min:0},null,8,["modelValue"]),t[19]||(t[19]=e.createElementVNode("span",null," 元",-1))]),_:1}),e.createVNode(x,{prop:"consignmentPriceSetting.scribe"},{default:e.withCtx(()=>[t[20]||(t[20]=e.createElementVNode("span",null,"划线价 = 销售价 +  ",-1)),e.createVNode(d,{modelValue:e.unref(n).consignmentPriceSetting.scribe,"onUpdate:modelValue":t[8]||(t[8]=l=>e.unref(n).consignmentPriceSetting.scribe=l),controls:!1,precision:2,min:0},null,8,["modelValue"]),t[21]||(t[21]=e.createElementVNode("span",null," 元",-1))]),_:1})],64))]),e.createVNode(g,{data:e.unref(i),"max-height":500,class:"f1"},{default:e.withCtx(()=>{var l;return[(l=e.unref(i)[0])!=null&&l.image?(e.openBlock(),e.createBlock(m,{key:0,fixed:"left",width:"150",label:"规格图"},{default:e.withCtx(({row:r})=>[e.createVNode(y,{src:r==null?void 0:r.image,style:{width:"50px",height:"50px"}},null,8,["src"])]),_:1})):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(S),(r,E)=>(e.openBlock(),e.createBlock(m,{key:E,width:"150",label:r==null?void 0:r.name},{default:e.withCtx(({row:V})=>{var j;return[e.createTextVNode(e.toDisplayString(Array.isArray(V.specs)?(j=V.specs)==null?void 0:j[E]:V.specs.name),1)]}),_:2},1032,["label"]))),128)),e.createVNode(m,{width:"150",label:"供货价",prop:"salePrice"}),e.createVNode(m,{width:"150",label:"划线价",prop:"actualPrice"}),e.createVNode(m,{width:"150",label:"销售价",prop:"actualSalePrice"}),e.createVNode(m,{width:"150",label:"库存"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString((r==null?void 0:r.stockType)==="UNLIMITED"?"无限库存":r==null?void 0:r.stock),1)]),_:1}),e.createVNode(m,{width:"150",label:"销量（注水）"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(Number((r==null?void 0:r.initSalesVolume)||0)+Number((r==null?void 0:r.salesVolume)||0)),1)]),_:1}),e.createVNode(m,{width:"150",label:"限购类型"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString(e.unref(L)[r==null?void 0:r.limitType]),1)]),_:1}),e.createVNode(m,{width:"150",label:"规格限购"},{default:e.withCtx(({row:r})=>[e.createTextVNode(e.toDisplayString((r==null?void 0:r.limitType)!=="UNLIMITED"&&(r==null?void 0:r.limitNum)||"/"),1)]),_:1}),e.createVNode(m,{width:"150",label:"重量",prop:"weight"})]}),_:1},8,["data"])])]),_:1},8,["model","rules"]),e.createElementVNode("div",ie,[e.createVNode(b,{onClick:e.unref(h)},{default:e.withCtx(()=>t[24]||(t[24]=[e.createTextVNode("取消")])),_:1},8,["onClick"]),e.createVNode(b,{style:{"margin-left":"40px"},type:"primary",onClick:e.unref(T)},{default:e.withCtx(()=>t[25]||(t[25]=[e.createTextVNode("确认")])),_:1},8,["onClick"])])])}}}),ce="";return((o,n)=>{const i=o.__vccOpts||o;for(const[a,c]of n)i[a]=c;return i})(le,[["__scopeId","data-v-f4da5933"]])});
