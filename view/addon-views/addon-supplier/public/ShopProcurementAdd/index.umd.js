(function(e,B){typeof exports=="object"&&typeof module<"u"?module.exports=B(require("vue"),require("@/apis/http"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue"),require("lodash-es"),require("@/components/SchemaForm.vue"),require("@/components/PageManage.vue"),require("element-plus"),require("@/composables/useConvert"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@/apis/http","@/components/element-plus/el-table/ElTableEmpty/index.vue","lodash-es","@/components/SchemaForm.vue","@/components/PageManage.vue","element-plus","@/composables/useConvert","vue-router"],B):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopProcurementAdd=B(e.ShopProcurementAddContext.Vue,e.ShopProcurementAddContext.Request,e.ShopProcurementAddContext.ElTableEmpty,e.ShopProcurementAddContext.Lodash,e.ShopProcurementAddContext.SchemaForm,e.ShopProcurementAddContext.PageManageTwo,e.ShopProcurementAddContext.ElementPlus,e.ShopProcurementAddContext.UseConvert,e.ShopProcurementAddContext.VueRouter))})(this,function(e,B,te,oe,ae,le,U,se,ne){"use strict";var K=document.createElement("style");K.textContent=`@charset "UTF-8";.commodity-info[data-v-46e75c8d]{display:flex;align-items:center;cursor:pointer}.commodity-info img[data-v-46e75c8d]{width:65px;height:65px}.commodity-info__right[data-v-46e75c8d]{height:65px;width:244px;margin-left:10px;display:flex;flex-direction:column;justify-content:space-between}.commodity-info__right p[data-v-46e75c8d]{overflow:hidden;text-overflow:ellipsis;display:box;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.details__img[data-v-6772700b]{width:80px;height:80px;vertical-align:top}.addPurchase[data-v-5d68561d]{padding:30px 16px 65px;overflow-y:auto}.addPurchase .purchase__batch[data-v-5d68561d]{height:63px;display:flex;align-items:center;background-color:#f4f4f4;margin-bottom:10px;padding:0 12px}.addPurchase .purchase__batch[data-v-5d68561d] .el-form--inline .el-form-item{margin-bottom:0}.addPurchase .purchase__total[data-v-5d68561d]{width:200px;color:#666;display:flex;justify-content:space-between;align-items:center;font-size:16px;line-height:32px}.addPurchase .purchase__total--title[data-v-5d68561d]{width:80px;text-align:right}.addPurchase .purchase__total--value[data-v-5d68561d]{width:120px;text-align:right}.purchaseSku_specs[data-v-5d68561d]{width:260px;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}.purchase__footer[data-v-5d68561d]{display:flex;justify-content:center;align-items:center;position:absolute;bottom:0;width:100%;height:52px;background-color:#fff;box-shadow:0 0 10px #0000001a;z-index:100}
`,document.head.appendChild(K);const re=m=>B.get({url:"addon-supplier/supplier/manager/product/getSupplyList",params:{...m}}),de=m=>B.post({url:"gruul-mall-order/order/distribution/cost",data:m,showLoading:!1}),ce=(m={})=>B.post({url:"addon-supplier/supplier/order",data:m}),ie=m=>B.get({url:`addon-supplier/supplier/order/creation/${m}`}),pe=(m={})=>B.get({url:"gruul-mall-shop/shop/info/getSupplierInfo",params:m}),me=()=>B.get({url:"gruul-mall-addon-platform/platform/shop/signing/category/choosable/list"}),ue=()=>B.get({url:"gruul-mall-shop/shop/logistics/address/list",params:{current:1,size:1e3}}),he={style:{border:"1px solid #f9f9f9","border-radius":"10px"}},fe={class:"commodity-info"},_e=["src"],ge={class:"commodity-info__right"},Ne={key:0,class:"virtual_product"},xe={key:1},ye={key:0,class:"virtual_product"},Ve={style:{color:"#f54319"}},ke={class:"customer"},be={class:"customer__name"},Se={key:1},Ce={style:{color:"#f54319"}},Pe={style:{display:"flex","align-items":"center","justify-content":"end"}},Ee=1e4,Te=e.defineComponent({__name:"purchasingGoodsTable",props:{height:{type:String,default:"auto"},tableList:{type:Array,default:()=>[]},isShowPurchase:{type:Boolean,default:!1},defaultSelected:{type:Array,default:()=>[]}},emits:["preview-details","remove-purchase-goods","set-purchase-num","selection-change"],setup(m,{expose:I,emit:r}){const y=m,p=r,_=e.ref(),T=e.computed(()=>{var a,d;return((d=(a=_.value)==null?void 0:a.getSelectionRows)==null?void 0:d.call(a))||[]}),S=a=>{p("selection-change",a)},k=e.computed(()=>a=>{const d=Math.min(...a.storageSkus.map(N=>Number(N.salePrice))),h=Math.max(...a.storageSkus.map(N=>Number(N.salePrice)));return d===h?h/1e4:`${d/1e4}~￥${h/1e4}`}),g=e.computed(()=>a=>{var d;return((d=a==null?void 0:a[0])==null?void 0:d.stockType)==="UNLIMITED"?"无限库存":a==null?void 0:a.reduce((h,N)=>h+=Number(N.stock),0)}),L=(a,d)=>{if(!a)return 0;if(a==="UNLIMITED")return"无限库存";if(a==="STOCK")return g.value(d==null?void 0:d.storageSkus)},i=(a,d)=>a.storageSkus?a.storageSkus.find(w=>w.stockType==="UNLIMITED")?"UNLIMITED":a.storageSkus.some(w=>Number(w.stock)>0)?"STOCK":!1:!1,u=()=>{var a;(a=_.value)==null||a.clearSelection(),y.defaultSelected.length!==0&&y.tableList.forEach(d=>{y.defaultSelected.some(N=>N.id===d.id)&&e.nextTick(()=>{_.value.toggleRowSelection(d,!0)})})};e.watch(()=>y.tableList,()=>{u()});const C=a=>{p("preview-details",a)},P=a=>{p("remove-purchase-goods",a)},$=(a,d)=>{p("set-purchase-num",a,d)};return I({multiSelect:T,tableRef:_}),(a,d)=>{const h=e.resolveComponent("el-table-column"),N=e.resolveComponent("el-tooltip"),w=e.resolveComponent("el-input-number"),M=e.resolveComponent("el-button"),O=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",he,[e.createVNode(O,{ref_key:"tableRef",ref:_,data:m.tableList,"row-key":"id","header-cell-style":{background:"#F7F8FA",height:"48px",color:"#333"},"cell-style":{color:"#333333",height:"90px"},style:e.normalizeStyle({height:y.height,width:"100%"}),onSelectionChange:S},{empty:e.withCtx(()=>[e.createVNode(te)]),default:e.withCtx(()=>[m.isShowPurchase?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(h,{key:0,type:"selection",width:"40",selectable:i,fixed:"left"})),e.createVNode(h,{label:"商品",width:"370"},{default:e.withCtx(({row:s})=>{var b,x;return[e.createElementVNode("div",fe,[e.createElementVNode("img",{src:(x=(b=s.albumPics)==null?void 0:b.split(","))==null?void 0:x.shift()},null,8,_e),e.createElementVNode("div",ge,[(s==null?void 0:s.productName.length)>=35?(e.openBlock(),e.createBlock(N,{key:0,class:"box-item",effect:"dark",content:s==null?void 0:s.productName,placement:"top"},{default:e.withCtx(()=>[e.createElementVNode("p",null,[s.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("text",Ne,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(e.toDisplayString(s==null?void 0:s.productName),1)])]),_:2},1032,["content"])):(e.openBlock(),e.createElementBlock("p",xe,[s.productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("text",ye,"虚拟")):e.createCommentVNode("",!0),e.createTextVNode(e.toDisplayString(s.productName),1)])),e.createElementVNode("span",Ve," ￥"+e.toDisplayString(k.value(s)),1)])])]}),_:1}),e.createVNode(h,{label:"供应商",prop:"supplierName"},{default:e.withCtx(({row:s})=>[e.createElementVNode("div",ke,[e.createElementVNode("div",null,[e.createElementVNode("span",be,e.toDisplayString(s.supplierName),1)]),e.createElementVNode("span",null,e.toDisplayString(s.supplierContractNumber),1)])]),_:1}),e.createVNode(h,{label:"供应商库存",width:"120"},{default:e.withCtx(({row:s})=>[e.createTextVNode(e.toDisplayString(L(i(s),s)),1)]),_:1}),e.createVNode(h,{label:"自有库存",prop:"shopOwnProductStockNum",width:"100"},{default:e.withCtx(({row:s})=>{var b;return[e.createTextVNode(e.toDisplayString((b=s==null?void 0:s.storageSkus)==null?void 0:b.reduce((x,j)=>x+Number((j==null?void 0:j.shopOwnProductStockNum)||0),0)),1)]}),_:1}),m.isShowPurchase?(e.openBlock(),e.createBlock(h,{key:1,align:"center",label:"采购数",width:"180"},{default:e.withCtx(({row:s})=>[s.storageSkus.length===1?(e.openBlock(),e.createBlock(w,{key:0,modelValue:s.purchaseNum,"onUpdate:modelValue":b=>s.purchaseNum=b,max:(s==null?void 0:s.stockType)==="UNLIMITED"?+Ee:+s.stock,min:1,placeholder:"请输入",precision:0},null,8,["modelValue","onUpdate:modelValue","max"])):(e.openBlock(),e.createElementBlock("span",Se,e.toDisplayString(s.storageSkus.reduce((b,x)=>b+Number((x==null?void 0:x.purchaseNum)||0),0)),1))]),_:1})):e.createCommentVNode("",!0),m.isShowPurchase?(e.openBlock(),e.createBlock(h,{key:2,label:"小计",width:"120"},{default:e.withCtx(({row:s})=>[e.createElementVNode("span",Ce,"￥"+e.toDisplayString(s.storageSkus.length>1?s.storageSkus.reduce((b,x)=>b+(x==null?void 0:x.purchaseNum)*(x==null?void 0:x.salePrice),0)/1e4:s.purchaseNum*Math.max(...s.salePrices)/1e4),1)]),_:1})):e.createCommentVNode("",!0),e.createVNode(h,{label:"操作",fixed:"right",align:"right",width:m.isShowPurchase?180:120},{default:e.withCtx(({row:s,$index:b})=>[e.createElementVNode("div",Pe,[s.storageSkus.length>1&&m.isShowPurchase?(e.openBlock(),e.createBlock(M,{key:0,type:"primary",link:"",onClick:x=>$(s,b)},{default:e.withCtx(()=>d[0]||(d[0]=[e.createTextVNode("添加采购")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(M,{link:"",type:"primary",onClick:x=>C(s)},{default:e.withCtx(()=>d[1]||(d[1]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),m.isShowPurchase?(e.openBlock(),e.createBlock(M,{key:1,type:"danger",link:"",onClick:x=>P(b)},{default:e.withCtx(()=>d[2]||(d[2]=[e.createTextVNode("移除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)])]),_:1},8,["width"])]),_:1},8,["data","style"])])}}}),pt="",z=(m,I)=>{const r=m.__vccOpts||m;for(const[y,p]of I)r[y]=p;return r},X=z(Te,[["__scopeId","data-v-46e75c8d"]]),Ie=e.defineComponent({__name:"search",emits:["search"],setup(m,{emit:I}){const r=e.ref([]),y=e.ref([]),p=e.reactive({supplierId:"",platformCategoryParentId:"",supplierGoodsName:""}),_=I,T=[{label:"商品名称",prop:"supplierGoodsName",valueType:"copy",fieldProps:{placeholder:"请输入商品名称"}},{label:"供应商名称",labelWidth:85,prop:"supplierId",valueType:"select",options:r,fieldProps:{placeholder:"请输入店铺名称",props:{expandTrigger:"hover"},filterable:!0,remote:!0,reserveKeyword:!0,remoteMethod:i=>{g(i)}}},{label:"平台类目",valueType:"cascader",options:y,fieldProps:{placeholder:"请选择平台类目",props:{expandTrigger:"hover",label:"name",value:"id",children:"secondCategoryVos"},onChange:i=>{(i==null?void 0:i.length)>1?p.platformCategoryParentId=i[i.length-1]:p.platformCategoryParentId=""}}}],S=async()=>{const{data:i,code:u}=await me();y.value=i};e.onMounted(()=>S());const k=()=>{const i=oe.cloneDeep(p);delete i.undefined,_("search",i)},g=async(i="")=>{var C;const u=await pe({supplierName:i});u.data&&((C=u.data)!=null&&C.length)&&(r.value=u.data.map(P=>({label:P.name,value:P.id})))},L=()=>{Object.keys(p).forEach(i=>p[i]=""),k()};return(i,u)=>(e.openBlock(),e.createBlock(ae,{modelValue:p,"onUpdate:modelValue":u[0]||(u[0]=C=>p=C),columns:T,"show-number":3,onSearchHandle:k,onHandleReset:L},null,8,["modelValue"]))}}),Le=e.defineComponent({__name:"purchasingGoods",props:{defaultSelected:{type:Array,default:()=>[]}},emits:["preview-details"],setup(m,{expose:I,emit:r}){const y=r,p=e.reactive({page:{current:1,size:10},total:0}),_=e.ref([]),T=e.ref([]),S=e.ref(!0),k=e.ref(),g=a=>{S.value||(T.value=a)},L=a=>{p.page.current=1,i(a)},i=async a=>{const d=await re({...p.page,sellType:"PURCHASE",...a});d.data&&(p.total=Number(d.data.total),_.value=d.data.records.map(h=>{var N;return{...h,disabled:!u(h),purchaseNum:((N=h.storageSkus)==null?void 0:N.length)||1}}),e.nextTick(()=>{var h;(h=k.value)!=null&&h.tableRef&&(_.value.forEach(N=>{var M,O;T.value.some(s=>s.id===N.id)&&((O=(M=k.value)==null?void 0:M.tableRef)==null||O.toggleRowSelection(N,!0))}),S.value=!1)}))};e.onMounted(()=>{S.value=!0,i()});const u=(a,d)=>a.storageSkus?a.storageSkus.find(w=>w.stockType==="UNLIMITED")?"UNLIMITED":a.storageSkus.some(w=>Number(w.stock)>0)?"STOCK":!1:!1,C=a=>{p.page.size=a,S.value=!0,i()},P=a=>{p.page.current=a,S.value=!0,i()},$=a=>{y("preview-details",a)};return I({purchasingGoodsTableRef:k}),(a,d)=>(e.openBlock(),e.createElementBlock("div",null,[e.createVNode(Ie,{onSearch:L}),e.createVNode(X,{ref_key:"purchasingGoodsTableRef",ref:k,"table-list":_.value,"default-selected":m.defaultSelected,height:"550px",onPreviewDetails:$,onSelectionChange:g},null,8,["table-list","default-selected"]),e.createVNode(le,{"page-size":p.page.size,"page-num":p.page.current,total:p.total,onHandleSizeChange:C,onHandleCurrentChange:P},null,8,["page-size","page-num","total"])]))}}),we={class:"details"},Be={class:"details__line"},De=["src"],Me={class:"details__line"},Re=e.defineComponent({__name:"details",props:{detailsInfo:{type:Object,default:()=>({})}},setup(m){const{divTenThousand:I}=se(),r=m;return(y,p)=>{var S,k,g,L,i;const _=e.resolveComponent("el-table-column"),T=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",we,[e.createElementVNode("div",Be,[p[0]||(p[0]=e.createElementVNode("span",{class:"details__line--label"},"商品图片：",-1)),e.createElementVNode("img",{src:(g=(k=(S=r.detailsInfo)==null?void 0:S.albumPics)==null?void 0:k.split(","))==null?void 0:g.shift(),class:"details__img"},null,8,De)]),e.createElementVNode("div",Me,"商品名称："+e.toDisplayString((L=r.detailsInfo)==null?void 0:L.productName),1),e.createVNode(T,{data:((i=r.detailsInfo)==null?void 0:i.storageSkus)||[]},{default:e.withCtx(()=>[e.createVNode(_,{label:"商品规格"},{default:e.withCtx(({row:u})=>{var C,P;return[e.createTextVNode(e.toDisplayString((C=u==null?void 0:u.specs)!=null&&C.length?(P=u==null?void 0:u.specs)==null?void 0:P.join(","):"单规格"),1)]}),_:1}),e.createVNode(_,{align:"center",label:"供货价",width:"150"},{default:e.withCtx(({row:u})=>[e.createTextVNode(" ￥"+e.toDisplayString(e.unref(I)(u==null?void 0:u.salePrice)),1)]),_:1}),e.createVNode(_,{align:"center",label:"起批数",width:"150",prop:"minimumPurchase"}),e.createVNode(_,{align:"center",label:"供应商库存",width:"150",prop:"stock"}),e.createVNode(_,{align:"center",label:"自有库存",width:"150",prop:"shopOwnProductStockNum"})]),_:1},8,["data"])])}}}),mt="",Ue=z(Re,[["__scopeId","data-v-6772700b"]]),$e={class:"addPurchase"},Fe={style:{"padding-left":"30px"}},Ae={style:{display:"flex","justify-content":"center"}},Ge={key:0,class:"purchase__batch"},Oe={style:{display:"flex","align-items":"center"}},je={class:"purchaseSku_specs"},ze={style:{color:"#f54319"}},qe={style:{color:"#f54319"}},He={style:{display:"flex","justify-content":"center"}},Ke={key:0,style:{float:"right","margin-top":"10px"}},Xe={class:"purchase__total"},We={class:"purchase__total--value"},Ye={class:"purchase__total"},Je={class:"purchase__total--value"},Qe={class:"purchase__total"},Ze={class:"purchase__total--value"},ve={class:"purchase__total"},et={class:"purchase__total--value",style:{color:"#f54319","font-size":"24px"}},tt={class:"purchase__footer"},W=1e5,ot=e.defineComponent({__name:"ShopProcurementAdd",setup(m){const I=ne.useRouter(),r=e.reactive({purchaseFormModel:{receiveId:"",remark:""},tableList:[]}),y=e.ref(!1),p=e.ref(),_=e.ref(!1),T=e.ref([]),S=e.ref(),k=e.ref(!1),g=e.ref(),L=e.ref(0),i=e.ref(-1),u=e.ref(1),C=e.ref(0),P=e.ref(!1),$=e.computed(()=>r.tableList.reduce((l,t)=>{var o;return t.storageSkus.length===1?l+=t.purchaseNum:l+=(o=t.storageSkus)==null?void 0:o.reduce((n,V)=>n+=V.purchaseNum||0,0)},0)),a=e.computed(()=>r.tableList.reduce((l,t)=>{var o;return t.storageSkus.length===1?l+=t.storageSkus.length===1?Math.max(...t.salePrices)/1e4*t.purchaseNum:0:l+=(o=t.storageSkus)==null?void 0:o.reduce((n,V)=>n+=V.purchaseNum?+V.salePrice/1e4*V.purchaseNum:0,0)},0)),d=e.computed(()=>a.value+C.value);e.watch(()=>$.value,()=>lt()),(async()=>{var o;const{data:l,code:t}=await ue();t===200&&l&&l.records&&(T.value=l.records,r.purchaseFormModel.receiveId=((o=l.records.find(n=>(n==null?void 0:n.defReceive)==="YES"))==null?void 0:o.id)||"")})();const N=l=>{p.value=l,_.value=!0},w=l=>{r.tableList.splice(Number(l),1)},M=(l,t)=>{k.value=!0,g.value={...l,storageSkus:l.storageSkus.map(o=>({...o,purchaseNum:1}))},L.value=t},O=l=>{var t,o;(o=(t=g.value)==null?void 0:t.storageSkus)==null||o.splice(l,1),i.value=l},s=()=>{var l,t,o;i.value!==-1&&(l=g.value)!=null&&l.storageSkus&&(r.tableList[L.value].storageSkus=[...g.value.storageSkus]),(o=(t=r.tableList[L.value])==null?void 0:t.storageSkus)==null||o.forEach((n,V)=>{var E,D;(D=(E=g.value)==null?void 0:E.storageSkus)!=null&&D[V]&&(n.purchaseNum=g.value.storageSkus[V].purchaseNum)}),k.value=!1},b=()=>{if(!r.purchaseFormModel.receiveId){U.ElMessage.warning("请选择收货人信息");return}y.value=!0},x=()=>{var t,o;const l=(o=(t=S.value)==null?void 0:t.purchasingGoodsTableRef)==null?void 0:o.multiSelect;r.tableList=l.map(n=>({...n,purchaseNum:n.storageSkus.length===1&&n.storageSkus[0].minimumPurchase||1,storageSkus:n.storageSkus.length>1?n.storageSkus.map(V=>({...V,purchaseNum:1})):n.storageSkus})),u.value=1,y.value=!1},j=e.computed(()=>{var t,o;const l=((o=(t=g.value)==null?void 0:t.storageSkus)==null?void 0:o.map(n=>(n==null?void 0:n.stockType)==="UNLIMITED"?W:Number((n==null?void 0:n.stock)||0)))||[];return Math.min(...l)}),at=l=>{var t,o;(o=(t=g.value)==null?void 0:t.storageSkus)==null||o.forEach(n=>n.purchaseNum=+l)},lt=async()=>{var o;const l=T.value.find(n=>n.id===r.purchaseFormModel.receiveId);if(console.log(r.tableList,"receiveInfo"),!l&&r.tableList.length===0)return;let t=0;try{const n=await de({area:l==null?void 0:l.area,freeRight:!1,distributionMode:["EXPRESS"],address:l==null?void 0:l.address,shopFreights:r.tableList.map(E=>{var D;return{shopId:E.shopId,freights:[{templateId:E.freightTemplateId,skuInfos:(D=E.storageSkus)==null?void 0:D.map(F=>({price:F.salePrice,skuId:F.id,num:F.purchaseNum||0,weight:F.weight}))}]}})});t=Object.values(((o=n==null?void 0:n.data)==null?void 0:o.EXPRESS)||{}).reduce((E,D)=>E+=D,0)}finally{C.value=t}},st=(l,t="")=>{const o=l.find(n=>n.id===t);return o?{name:o.contactName,mobile:o.contactPhone,area:o.area,address:o==null?void 0:o.address}:{name:"",mobile:"",area:[],address:""}},nt=()=>{const l=st(T.value,r.purchaseFormModel.receiveId),t="PURCHASE",o=r.purchaseFormModel.remark,n=rt(r.tableList);return{receiver:l,sellType:t,remark:o,suppliers:n}},rt=l=>{const t=[];return l.forEach(o=>{var V;let n=t.findIndex(E=>E.supplierId===o.shopId);n===-1&&(n=t.push({supplierId:o.shopId,productSkus:{}})-1),(V=o.storageSkus)==null||V.forEach(E=>{t[n].productSkus[o.id],t[n].productSkus[o.id]||(t[n].productSkus[o.id]=[]),t[n].productSkus[o.id].push({skuId:E.id,num:E.purchaseNum||o.purchaseNum||1})})}),t.filter(o=>Object.keys(o==null?void 0:o.productSkus).length>0)};let q=0;const dt=async()=>{var t,o;if($.value===0){U.ElMessage.warning("请选择采购商品");return}P.value=!0,q=0;const l=await ce(nt());l.code===200?(t=l.data)!=null&&t.mainNo&&Y((o=l.data)==null?void 0:o.mainNo):l.code===210004?U.ElMessage.error(l.msg):(P.value=!1,U.ElMessage.error(l.msg||"采购失败"))},ct=()=>{U.ElMessageBox.confirm("取消采购数据不可恢复，确定取消吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I.push("/goods/purchase")})},Y=async l=>{if(q++,q===20){P.value=!1,U.ElMessage.error("创建失败，请稍后重试");return}(await ie(l)).data?(P.value=!1,U.ElMessage.success("订单提交成功，请在采购订单中支付货款")):setTimeout(()=>{Y(l)},1e3),I.push("/goods/purchase")};return(l,t)=>{const o=e.resolveComponent("el-option"),n=e.resolveComponent("el-select"),V=e.resolveComponent("el-form-item"),E=e.resolveComponent("el-input"),D=e.resolveComponent("el-link"),F=e.resolveComponent("el-form"),A=e.resolveComponent("el-button"),H=e.resolveComponent("el-dialog"),J=e.resolveComponent("el-input-number"),R=e.resolveComponent("el-table-column"),it=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$e,[e.createVNode(F,{modelValue:r.purchaseFormModel,"onUpdate:modelValue":t[2]||(t[2]=f=>r.purchaseFormModel=f),style:{width:"65%"},"label-width":"100px"},{default:e.withCtx(()=>[e.createVNode(V,{label:"收货人信息:",rules:{required:!0,message:"请选择收货人信息"}},{default:e.withCtx(()=>[e.createVNode(n,{modelValue:r.purchaseFormModel.receiveId,"onUpdate:modelValue":t[0]||(t[0]=f=>r.purchaseFormModel.receiveId=f),style:{width:"100%"}},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.value,f=>(e.openBlock(),e.createBlock(o,{key:f.id,label:f.contactName+"  "+f.contactPhone+"   "+f.area.join("")+"   "+f.address,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.createVNode(V,{label:"采购备注:"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:r.purchaseFormModel.remark,"onUpdate:modelValue":t[1]||(t[1]=f=>r.purchaseFormModel.remark=f),placeholder:"请输入采购备注(100字以内)",rows:3,maxlength:"100","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1}),e.createVNode(V,{label:"采购商品:"},{default:e.withCtx(()=>[e.createVNode(D,{type:"primary",underline:!1,onClick:b},{default:e.withCtx(()=>t[10]||(t[10]=[e.createTextVNode("添加商品")])),_:1})]),_:1})]),_:1},8,["modelValue"]),e.createElementVNode("div",Fe,[e.createVNode(X,{"table-list":r.tableList,"is-show-purchase":!0,onPreviewDetails:N,onRemovePurchaseGoods:w,onSetPurchaseNum:M},null,8,["table-list"])]),e.createVNode(H,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=f=>y.value=f),"close-on-click-modal":!1,"destroy-on-close":"",title:"添加商品",width:"1100px",top:"6vh"},{footer:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createElementVNode("div",null,[e.createVNode(A,{onClick:t[3]||(t[3]=f=>y.value=!1)},{default:e.withCtx(()=>t[11]||(t[11]=[e.createTextVNode("取消")])),_:1}),e.createVNode(A,{type:"primary",onClick:x},{default:e.withCtx(()=>t[12]||(t[12]=[e.createTextVNode("确定")])),_:1})])])]),default:e.withCtx(()=>[e.createVNode(Le,{ref_key:"purchasingGoodsRef",ref:S,"default-selected":r.tableList,onPreviewDetails:N},null,8,["default-selected"])]),_:1},8,["modelValue"]),e.createVNode(H,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=f=>_.value=f),"close-on-click-modal":!1,"destroy-on-close":"",title:"商品详情",width:"1000px"},{default:e.withCtx(()=>[e.createVNode(Ue,{"details-info":p.value},null,8,["details-info"])]),_:1},8,["modelValue"]),e.createVNode(H,{modelValue:k.value,"onUpdate:modelValue":t[9]||(t[9]=f=>k.value=f),"close-on-click-modal":!1,"destroy-on-close":"",title:"设置采购数",width:"1100px"},{footer:e.withCtx(()=>[e.createElementVNode("div",He,[e.createVNode(A,{onClick:t[8]||(t[8]=f=>k.value=!1)},{default:e.withCtx(()=>t[15]||(t[15]=[e.createTextVNode("取消")])),_:1}),e.createVNode(A,{type:"primary",onClick:s},{default:e.withCtx(()=>t[16]||(t[16]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>{var f,Q,Z,v;return[(f=g.value)!=null&&f.storageSkus&&((Z=(Q=g.value)==null?void 0:Q.storageSkus)==null?void 0:Z.length)>1?(e.openBlock(),e.createElementBlock("div",Ge,[e.createVNode(F,{"show-message":!1,inline:""},{default:e.withCtx(()=>[e.createVNode(V,{label:"批量设置："},{default:e.withCtx(()=>[e.createElementVNode("div",Oe,[e.createVNode(J,{modelValue:u.value,"onUpdate:modelValue":t[6]||(t[6]=c=>u.value=c),controls:!1,max:+j.value,min:1,style:{width:"80px"},placeholder:"采购数"},null,8,["modelValue","max"]),e.createVNode(D,{style:{width:"50px"},type:"primary",underline:!1,onClick:t[7]||(t[7]=c=>at(u.value))},{default:e.withCtx(()=>t[13]||(t[13]=[e.createTextVNode("填入")])),_:1})])]),_:1})]),_:1})])):e.createCommentVNode("",!0),e.createVNode(it,{data:(v=g.value)==null?void 0:v.storageSkus,"max-height":350,style:{border:"1px solid #f9f9f9","border-radius":"10px 10px 0 0"}},{default:e.withCtx(()=>[e.createVNode(R,{label:"商品规格","min-width":"230"},{default:e.withCtx(({row:c})=>{var G;return[e.createElementVNode("div",je,e.toDisplayString(((G=c==null?void 0:c.specs)==null?void 0:G.join(","))||"单规格"),1)]}),_:1}),e.createVNode(R,{label:"供货价"},{default:e.withCtx(({row:c})=>[e.createElementVNode("span",ze,"￥"+e.toDisplayString(((c==null?void 0:c.salePrice)/1e4).toFixed(2)),1)]),_:1}),e.createVNode(R,{label:"供应商库存"},{default:e.withCtx(({row:c})=>[e.createTextVNode(e.toDisplayString((c==null?void 0:c.stockType)==="UNLIMITED"?"无限库存":c.stock),1)]),_:1}),e.createVNode(R,{label:"自有库存",prop:"shopOwnProductStockNum"}),e.createVNode(R,{label:"起批数",prop:"minimumPurchase"}),e.createVNode(R,{label:"采购数",width:"140"},{default:e.withCtx(({row:c})=>[e.createVNode(J,{modelValue:c.purchaseNum,"onUpdate:modelValue":G=>c.purchaseNum=G,max:(c==null?void 0:c.stockType)==="UNLIMITED"?+W:+c.stock,min:+c.minimumPurchase,controls:!1,precision:0,style:{width:"80px"},placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue","max","min"])]),_:1}),e.createVNode(R,{label:"小计"},{default:e.withCtx(({row:c})=>[e.createElementVNode("span",qe,"￥"+e.toDisplayString((c==null?void 0:c.purchaseNum)*(c==null?void 0:c.salePrice)/1e4),1)]),_:1}),e.createVNode(R,{fixed:"right",label:"操作",align:"center",width:"80"},{default:e.withCtx(({$index:c})=>{var G,ee;return[e.createVNode(A,{link:"",type:"danger",disabled:((ee=(G=g.value)==null?void 0:G.storageSkus)==null?void 0:ee.length)===1,onClick:ft=>O(c)},{default:e.withCtx(()=>t[14]||(t[14]=[e.createTextVNode("移除")])),_:2},1032,["disabled","onClick"])]}),_:1})]),_:1},8,["data"])]}),_:1},8,["modelValue"]),r.tableList.length>0?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("div",null,[e.createElementVNode("div",Xe,[t[17]||(t[17]=e.createElementVNode("span",{class:"purchase__total--title"},"采购数量：",-1)),e.createElementVNode("span",We,e.toDisplayString($.value),1)]),e.createElementVNode("div",Ye,[t[18]||(t[18]=e.createElementVNode("span",{class:"purchase__total--title"},"商品总价：",-1)),e.createElementVNode("span",Je,"￥"+e.toDisplayString(a.value.toFixed(2)),1)]),e.createElementVNode("div",Qe,[t[19]||(t[19]=e.createElementVNode("span",{class:"purchase__total--title"},"运费：",-1)),e.createElementVNode("span",Ze,"￥"+e.toDisplayString(C.value),1)]),e.createElementVNode("div",ve,[t[21]||(t[21]=e.createElementVNode("span",{class:"purchase__total--title"},"实收金额：",-1)),e.createElementVNode("span",et,[t[20]||(t[20]=e.createElementVNode("text",{style:{"font-size":"14px"}},"￥",-1)),e.createTextVNode(e.toDisplayString(d.value.toFixed(2)),1)])])])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",tt,[e.createVNode(A,{onClick:ct},{default:e.withCtx(()=>t[22]||(t[22]=[e.createTextVNode("取消")])),_:1}),e.createVNode(A,{loading:P.value,type:"primary",onClick:dt},{default:e.withCtx(()=>t[23]||(t[23]=[e.createTextVNode("提交订单")])),_:1},8,["loading"])])],64)}}}),ut="";return z(ot,[["__scopeId","data-v-5d68561d"]])});
