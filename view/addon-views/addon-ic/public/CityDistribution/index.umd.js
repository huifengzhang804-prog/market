(function(e,D){typeof exports=="object"&&typeof module<"u"?module.exports=D(require("vue"),require("@/components/ChromeTab.vue"),require("@/q-plugin/components/printer.vue"),require("@/q-plugin/components/printTemplate.vue"),require("@/q-plugin/components/printingTask.vue"),require("@/components/q-mapcity/q-mapcity.vue"),require("@/store/modules/shopInfo"),require("element-plus"),require("@/components/q-input-number/q-input-number.vue"),require("@/components/TitleBar/TitleBar.vue"),require("@/composables/useConvert"),require("@/components/q-icon/q-icon.vue"),require("@/views/set/components/DescStep.vue"),require("@/apis/http"),require("@/libs/validate"),require("lodash-es")):typeof define=="function"&&define.amd?define(["vue","@/components/ChromeTab.vue","@/q-plugin/components/printer.vue","@/q-plugin/components/printTemplate.vue","@/q-plugin/components/printingTask.vue","@/components/q-mapcity/q-mapcity.vue","@/store/modules/shopInfo","element-plus","@/components/q-input-number/q-input-number.vue","@/components/TitleBar/TitleBar.vue","@/composables/useConvert","@/components/q-icon/q-icon.vue","@/views/set/components/DescStep.vue","@/apis/http","@/libs/validate","lodash-es"],D):(e=typeof globalThis<"u"?globalThis:e||self,e.CityDistribution=D(e.CityDistributionContext.Vue,e.CityDistributionContext.ChromeTabs,e.CityDistributionContext.SetPinter,e.CityDistributionContext.SetPrintTemplate,e.CityDistributionContext.SetPrintingTask,e.CityDistributionContext.QMapcity,e.CityDistributionContext.ShopInfoStore,e.CityDistributionContext.ElementPlus,e.CityDistributionContext.QInputNumber,e.CityDistributionContext.TitleBar,e.CityDistributionContext.UseConvert,e.CityDistributionContext.QIcon,e.CityDistributionContext.DescStep,e.CityDistributionContext.Request,e.CityDistributionContext.LibsValidate,e.CityDistributionContext.Lodash))})(this,function(e,D,Y,K,Z,Q,ee,h,N,q,G,O,te,w,oe,H){"use strict";var W=document.createElement("style");W.textContent=`@charset "UTF-8";.main[data-v-e3b34c54]{padding:0 16px;overflow-y:auto}.main .two_side_container .left_form_container[data-v-e3b34c54]{width:350px}.main .two_side_container .right_form_container[data-v-e3b34c54]{margin-left:auto}.main .two_side_container .right_form_container .tips_text[data-v-e3b34c54]{color:#666;font-size:14px;font-weight:500;margin-top:34px}.save[data-v-e3b34c54]{background-color:#fff;height:60px;box-shadow:0 0 2px #00000012;display:flex;justify-content:center;align-items:center}.save__btn[data-v-e3b34c54]{height:32px;font-size:14px;color:#fff}.red-text[data-v-e3b34c54]{color:red;font-size:14px;font-weight:700}.form-area[data-v-e3b34c54]{width:50px;height:20px;border:1px solid #e2e2e2;border-radius:4px;text-align:center;line-height:20px}.form-control[data-v-e3b34c54]{display:flex;align-items:center}.form-count[data-v-e3b34c54]{width:20px;height:20px;border:1px solid #e2e2e2;border-radius:4px;text-align:center;line-height:20px;margin:0 5px;cursor:pointer;-webkit-user-select:none;user-select:none}.ruleForm__name[data-v-e3b34c54]{width:466px}.ruleForm__desc[data-v-e3b34c54]{width:667px}.ruleForm__center[data-v-e3b34c54]{width:1007px;height:31px;line-height:31px;background:#fcf8f8;font-size:13px;font-family:-apple-system,-apple-system-Bold;font-weight:700;text-align:LEFT;color:#0c0b0b;margin-bottom:22px}.ruleForm__item[data-v-e3b34c54]{width:141px;height:30px;line-height:30px;display:flex;padding-right:0}.ruleForm__item[data-v-e3b34c54] .el-input__wrapper{padding-right:0}.ruleForm__item--span[data-v-e3b34c54]{display:block;width:38px;line-height:30px;color:#333;background:#f7f7f7;border-radius:0 4px 4px 0}.ruleForm__tip[data-v-e3b34c54]{width:390px;height:20px;font-size:14px;color:#d0caca;line-height:20px;margin-left:25px}.rates[data-v-e3b34c54]{display:flex;align-items:center;justify-content:start;margin-left:-10px}.rates__span[data-v-e3b34c54]{padding:5px}.radio_box[data-v-e3b34c54]{flex-direction:column}.radio_box>div[data-v-e3b34c54]{display:flex;align-items:center}.explain[data-v-e3b34c54]{display:flex;flex-direction:column;padding-left:100px;font-size:13px;color:#bcbbbb;line-height:25px;margin-bottom:20px}.explain__span[data-v-e3b34c54]{margin-left:20px}[data-v-e3b34c54] .mo-input--number{border:none}[data-v-e3b34c54] .ruleForm__rates .el-form-item__content{flex-direction:column;align-items:start}.block_checkbox[data-v-e3b34c54]{width:100%}.tips_label[data-v-e3b34c54]{color:#bebebe;margin-left:10px}.describe_bar[data-v-2fa7d99a]{background:rgba(85,92,253,.05);padding:20px 16px 13px}.describe_bar .top[data-v-2fa7d99a]{display:flex;flex-wrap:wrap}.describe_bar .bottom[data-v-2fa7d99a]{margin-top:11px;color:#333;font-size:13px;font-weight:400}.describe_bar .bottom .danger[data-v-2fa7d99a]{color:#f54319;font-size:13px;font-weight:500}.right_text[data-v-2fa7d99a]{color:#999;font-size:14px;font-weight:400}.error_msg[data-v-2fa7d99a]{color:#f54319;font-size:14px;font-weight:500}.success_msg .descriptions[data-v-2fa7d99a]{margin-bottom:15px}.success_msg .descriptions .descriptions_label[data-v-2fa7d99a]{text-align:right;margin-right:18px;color:#666;font-size:14px;font-weight:500}.success_msg .descriptions .descriptions_content[data-v-2fa7d99a]{display:flex;align-items:center}.success_msg .descriptions .descriptions_content .money[data-v-2fa7d99a]{margin-right:12px}.success_msg .descriptions .descriptions_content .red[data-v-2fa7d99a]{color:#f54319}.success_msg .open_status[data-v-2fa7d99a]{font-size:14px;font-weight:500;color:#00bb2c}
`,document.head.appendChild(W);const ae={class:"q_plugin_container"},le=e.defineComponent({__name:"CityDistribution",setup(c){const u=e.ref("basicSettings"),s={basicSettings:e.defineAsyncComponent(()=>Promise.resolve().then(()=>Ne)),thirdPartyDelivery:e.defineAsyncComponent(()=>Promise.resolve().then(()=>je)),printer:Y,printTemplate:K,printingTask:Z},V=[{name:"basicSettings",label:"基础设置"},{name:"thirdPartyDelivery",label:"第三方配送"},{name:"printer",label:"打印机"},{name:"printTemplate",label:"打印模板"},{name:"printingTask",label:"打印任务"}],_=x=>{x&&(u.value=x)};return(x,o)=>(e.openBlock(),e.createElementBlock("div",ae,[e.createVNode(D,{style:{"margin-bottom":"20px"},tabList:V,value:u.value,onHandleTabs:_},null,8,["value"]),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(s[u.value]),{mode:"INTRA_CITY"}))]))}}),ne=c=>w.post({url:"addon-ic/ic/shop/config",data:c}),re=()=>w.post({url:"addon-ic/ic/shop/config/get"}),ie=c=>w.get({url:`gruul-mall-shop/shop/info/${c}`}),J=()=>w.post({url:"addon-ic/ic/uupt/shop/status"}),se=c=>w.post({url:"addon-ic/ic/uupt/shop/sms",data:c}),de=c=>w.post({url:"addon-ic/ic/uupt/shop/auth",data:c}),ce=()=>w.post({url:"addon-ic/ic/uupt/shop/recharge"});var A=(c=>(c.DISTANCE="DISTANCE",c.WEIGHT="WEIGHT",c))(A||{});const pe={class:"overh fdc1"},me={class:"main"},fe={class:"two_side_container df"},ue={class:"left_form_container"},_e={class:"form-control"},be={style:{"margin-left":"10px"}},ge={key:0,class:"rates"},xe={key:1,class:"rates"},he={class:"fdc"},Ve={key:1,style:{height:"50px"}},ye={class:"save"},Ce=e.defineComponent({__name:"basicSettings",setup(c){const{mulTenThousand:u,divTenThousand:s}=G(),V=ee.useShopInfoStore(),_=e.ref({address:"",location:[]}),x=e.ref(!1),o=e.ref({deliveryRange:20,description:"",minLimit:0,baseDelivery:0,billMethod:{type:A.DISTANCE,free:0,step:0,stepPrice:1},freeLimit:0,enableSelf:!1,enableOpen:!1,defaultType:void 0,warmBox:!0,location:{coordinates:[121.583336,29.990282],type:"Point"},address:"",icStatus:!1}),F=()=>{U.defaultType[0].required=o.value.enableSelf&&o.value.enableOpen},L=(n,t,m)=>{o.value.enableSelf&&o.value.enableOpen?t?m():m(new Error("请选择默认的配送方")):m()},R=(n,t,m)=>{!o.value.enableSelf&&!o.value.enableOpen?m(new Error("请选择至少一个配送方")):m()},U=e.reactive({defaultType:[{required:!1,message:"请选择默认配送方",trigger:"change"},{validator:L}],deliveryParty:[{required:!0,message:"请配置配送方",trigger:"blur"},{validator:R,trigger:"blur"}],deliveryRange:[{required:!0,message:"请输入配送范围",trigger:"change"}],minLimit:[{required:!0,message:"请输入起送金额",trigger:"blur"}],baseDelivery:[{required:!0,message:"请输入基础配送费用",trigger:"blur"}],"billMethod.type":[{required:!0}]});e.onMounted(async()=>{f(),await $(),await T()});const k=e.ref(!0),f=async()=>{const{data:n}=await J();k.value=!(n!=null&&n.activated)},$=async()=>{const n=V.shopInfo.shopId,t=await ie(n);t.code===200&&(_.value.address=t.data.address,_.value.location=t.data.location.coordinates)},y=n=>{if(n<1){h.ElMessage.warning("配送范围不能小于1km");return}if(n>50){h.ElMessage.warning("限50km(含)以内");return}},E=e.ref(),j=async n=>{n&&await n.validate(async(t,m)=>{if(t){const p=JSON.parse(JSON.stringify(o.value));p.billMethod.stepPrice=u(p.billMethod.stepPrice).toNumber(),p.freeLimit=u(p.freeLimit).toNumber(),p.minLimit=u(p.minLimit).toNumber(),p.baseDelivery=u(p.baseDelivery).toNumber(),x.value||Reflect.deleteProperty(p,"freeLimit"),await C(p),T()}else console.log("error submit!",m),Object.keys(m).forEach(p=>{h.ElMessage.error(m[p][0].message)})})},C=async n=>{if((await ne(n)).code===200)return h.ElMessage.success("保存成功");h.ElMessage.error(n.msg||"保存失败")},T=async()=>{const n=await re();n.code===200&&(n.data.deliveryRange===void 0&&(n.data.deliveryRange=20),n.data.billMethod||(n.data.billMethod={type:A.DISTANCE,free:0,step:0,stepPrice:1}),x.value=!!n.data.freeLimit,n.data.billMethod.stepPrice=s(n.data.billMethod.stepPrice).toNumber(),n.data.freeLimit=s(n.data.freeLimit).toNumber(),n.data.minLimit=s(n.data.minLimit).toNumber(),n.data.baseDelivery=s(n.data.baseDelivery).toNumber(),o.value={...o.value,...n.data})},S=[{value:"SELF",label:"商家自行配送"},{value:"UUPT",label:"UU跑腿配送"}],v={intraCity:["1. 谨慎关闭同城配送，关闭后同城配送商品无法提交订单","2. 商家自行配送的配送员请在【权限设置--管理员列表】中添加用户，已添加的用户可登录商家移动端配送同城订单","3. 如需开启第三方配送，请在【第三方配送】中授权开通配送服务"],deliveryFee:["1. 起送金额是指订单金额大于等于该数值时才能提交同城配送订单","2. 配送计费可按距离或计重收费，选择计重收费请确保商品重量已设置","距离收费说明：","     1. 配送费 = 基础配送费 + 超距收费 （小于配送费减免金额）","     2. 以店铺定位地址为中心，因考虑实际送货路况，配送费计算按骑行距离，非地图直线距离","     3. 不足 1 km 按1 km计算","计重收费说明：","     1. 配送费 = 基础配送费 + 续重收费 （小于配送费减免金额）","     2. 计重收费需设置商品重量","     3. 不足 1 kg 按1 kg计算"]},P=e.ref();return e.watch(()=>o.value.icStatus,n=>n&&e.nextTick(()=>P.value.initMap())),(n,t)=>{const m=e.resolveComponent("el-tooltip"),p=e.resolveComponent("el-switch"),r=e.resolveComponent("el-form-item"),a=e.resolveComponent("el-checkbox"),d=e.resolveComponent("el-option"),b=e.resolveComponent("el-select"),i=e.resolveComponent("el-radio"),B=e.resolveComponent("el-radio-group"),I=e.resolveComponent("el-input-number"),M=e.resolveComponent("el-input"),z=e.resolveComponent("el-form"),g=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",pe,[e.createElementVNode("div",me,[e.createVNode(z,{ref_key:"ruleFormRef",ref:E,model:o.value,rules:U,class:"ruleForm","label-position":"right","label-width":"120px",size:"default"},{default:e.withCtx(()=>[e.createVNode(q,{name:"同城配送"},{right:e.withCtx(()=>[e.createVNode(m,{effect:"dark",placement:"top-end"},{content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.intraCity,l=>(e.openBlock(),e.createElementBlock("div",{key:l},e.toDisplayString(l),1))),128))]),default:e.withCtx(()=>[e.createVNode(O,{class:"cup",name:"icon-wenhao"})]),_:1})]),_:1}),e.createVNode(r,{label:"是否开启",prop:"icStatus"},{default:e.withCtx(()=>[e.createVNode(p,{modelValue:o.value.icStatus,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.icStatus=l)},null,8,["modelValue"])]),_:1}),o.value.icStatus?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",fe,[e.createElementVNode("div",ue,[e.createVNode(r,{label:"配送方",prop:"enableSelf",rules:U.deliveryParty},{default:e.withCtx(()=>[e.createVNode(a,{modelValue:o.value.enableSelf,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.enableSelf=l),class:"block_checkbox",label:"商家自行配送",size:"large",onChange:F},null,8,["modelValue"]),e.createVNode(a,{modelValue:o.value.enableOpen,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.enableOpen=l),disabled:k.value,class:"block_checkbox",label:"第三方配送",size:"large",onChange:F},null,8,["modelValue","disabled"])]),_:1},8,["rules"]),e.createVNode(r,{label:"默认配送方",prop:"defaultType"},{default:e.withCtx(()=>[e.createVNode(b,{modelValue:o.value.defaultType,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.defaultType=l),placeholder:"请选择默认配送方",style:{width:"210px"}},{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(S,l=>e.createVNode(d,{key:l.value,label:l.label,value:l.value,disabled:l.value==="UUPT"&&k.value},null,8,["label","value","disabled"])),64))]),_:1},8,["modelValue"])]),_:1}),o.value.enableOpen?(e.openBlock(),e.createBlock(r,{key:0,label:"保温箱",prop:"warmBox"},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:o.value.warmBox,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.warmBox=l)},{default:e.withCtx(()=>[e.createVNode(i,{value:!0},{default:e.withCtx(()=>t[19]||(t[19]=[e.createTextVNode("需要")])),_:1}),e.createVNode(i,{value:!1},{default:e.withCtx(()=>t[20]||(t[20]=[e.createTextVNode("不需要")])),_:1})]),_:1},8,["modelValue"])]),_:1})):e.createCommentVNode("",!0)])]),e.createVNode(q,{name:"配送范围"}),e.createVNode(r,{label:"配送范围(km)",prop:"deliveryRange"},{default:e.withCtx(()=>[e.createElementVNode("div",_e,[e.createVNode(I,{modelValue:o.value.deliveryRange,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.deliveryRange=l),size:"small",style:{width:"110px"},min:1,max:50,onChange:y},null,8,["modelValue"]),t[21]||(t[21]=e.createElementVNode("span",{class:"tips_label"},"以店铺为中心，配送 50 km(含)以内",-1))])]),_:1}),e.createVNode(r,{label:"店铺定位地址"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.address),1)]),_:1}),e.createVNode(r,null,{default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(Q,{ref_key:"refShopLocation",ref:P,zoom:14.19+-1.43*Math.log(o.value.deliveryRange),area:o.value.deliveryRange,coordinates:o.value.location.coordinates},null,8,["zoom","area","coordinates"])])]),_:1}),e.createVNode(r,{label:"配送说明",prop:"description"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:o.value.description,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.description=l),placeholder:"限100字以内",rows:4,class:"ruleForm__desc",maxlength:"100",resize:"none",type:"textarea"},null,8,["modelValue"])]),_:1}),e.createVNode(q,{name:"配送费用"},{right:e.withCtx(()=>[e.createVNode(m,{effect:"dark",placement:"top-end"},{content:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.deliveryFee,l=>(e.openBlock(),e.createElementBlock("div",{key:l},e.toDisplayString(l.replaceAll(" "," ")),1))),128))]),default:e.withCtx(()=>[e.createVNode(O,{class:"cup",name:"icon-wenhao"})]),_:1})]),_:1}),e.createVNode(r,{label:"起送金额(元)",prop:"minLimit"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:o.value.minLimit,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.minLimit=l),modelModifiers:{number:!0},class:"ruleForm__item",maxlength:"6"},null,8,["modelValue"])]),_:1}),e.createVNode(r,{label:"基础配送费(元)",prop:"baseDelivery"},{default:e.withCtx(()=>[e.createVNode(M,{modelValue:o.value.baseDelivery,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.baseDelivery=l),modelModifiers:{number:!0},class:"ruleForm__item",maxlength:"6"},null,8,["modelValue"])]),_:1}),o.value.billMethod?(e.openBlock(),e.createBlock(r,{key:0,label:"计费方式",prop:"billMethod.type",class:"ruleForm__rates"},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:o.value.billMethod.type,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.billMethod.type=l)},{default:e.withCtx(()=>[e.createVNode(i,{value:"DISTANCE",label:"按距离收费"}),e.createVNode(i,{value:"WEIGHT",label:"按重量收费"})]),_:1},8,["modelValue"]),e.createElementVNode("div",be,[o.value.billMethod.type==="DISTANCE"?(e.openBlock(),e.createElementBlock("div",ge,[e.createVNode(N,{modelValue:o.value.billMethod.free,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.billMethod.free=l),controls:!1,min:1,class:"ruleForm__item",maxlength:"6"},{append:e.withCtx(()=>t[22]||(t[22]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"km",-1)])),_:1},8,["modelValue"]),t[25]||(t[25]=e.createElementVNode("span",{class:"rates__span"},"内不额外收费，每超出",-1)),e.createVNode(N,{modelValue:o.value.billMethod.step,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.billMethod.step=l),controls:!1,min:1,class:"ruleForm__item"},{append:e.withCtx(()=>t[23]||(t[23]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"km",-1)])),_:1},8,["modelValue"]),t[26]||(t[26]=e.createElementVNode("span",{class:"rates__span"},"，增加",-1)),e.createVNode(N,{modelValue:o.value.billMethod.stepPrice,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.billMethod.stepPrice=l),controls:!1,min:1,class:"ruleForm__item",maxlength:"6"},{append:e.withCtx(()=>t[24]||(t[24]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"])])):(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(N,{modelValue:o.value.billMethod.free,"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.billMethod.free=l),controls:!1,class:"ruleForm__item",min:1,maxlength:"6"},{append:e.withCtx(()=>t[27]||(t[27]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"kg",-1)])),_:1},8,["modelValue"]),t[30]||(t[30]=e.createElementVNode("p",{class:"rates__span"},"内不额外收费，每超出",-1)),e.createVNode(N,{modelValue:o.value.billMethod.step,"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.billMethod.step=l),controls:!1,min:1,class:"ruleForm__item"},{append:e.withCtx(()=>t[28]||(t[28]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"kg",-1)])),_:1},8,["modelValue"]),t[31]||(t[31]=e.createElementVNode("p",{class:"rates__span"},"，增加",-1)),e.createVNode(N,{modelValue:o.value.billMethod.stepPrice,"onUpdate:modelValue":t[15]||(t[15]=l=>o.value.billMethod.stepPrice=l),min:1,controls:!1,class:"ruleForm__item",maxlength:"6"},{append:e.withCtx(()=>t[29]||(t[29]=[e.createElementVNode("p",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"])]))])]),_:1})):e.createCommentVNode("",!0),e.createVNode(r,{label:"配送费减免",prop:"freeLimit"},{default:e.withCtx(()=>[e.createElementVNode("div",he,[e.createVNode(p,{modelValue:x.value,"onUpdate:modelValue":t[16]||(t[16]=l=>x.value=l),style:{width:"48px"},"inline-prompt":"","active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),x.value?(e.openBlock(),e.createBlock(r,{key:0,prop:"freeLimit"},{default:e.withCtx(()=>[t[33]||(t[33]=e.createElementVNode("span",{class:"rates__span"},"订单实付金额大于等于",-1)),e.createVNode(N,{modelValue:o.value.freeLimit,"onUpdate:modelValue":t[17]||(t[17]=l=>o.value.freeLimit=l),controls:!1,max:999999,min:0,class:"ruleForm__item"},{append:e.withCtx(()=>t[32]||(t[32]=[e.createElementVNode("span",{class:"ruleForm__item--span"},"元",-1)])),_:1},8,["modelValue"]),t[34]||(t[34]=e.createElementVNode("span",{class:"rates__span"},"时，",-1)),t[35]||(t[35]=e.createElementVNode("span",{class:"red-text"},"减免全部配送费",-1))]),_:1})):(e.openBlock(),e.createElementBlock("div",Ve))])]),_:1})],64)):e.createCommentVNode("",!0)]),_:1},8,["model","rules"])]),e.createElementVNode("div",ye,[e.createVNode(g,{class:"save__btn",type:"primary",onClick:t[18]||(t[18]=()=>j(E.value))},{default:e.withCtx(()=>t[36]||(t[36]=[e.createTextVNode("保存")])),_:1})])])}}}),Ge="",X=(c,u)=>{const s=c.__vccOpts||c;for(const[V,_]of u)s[V]=_;return s},Ne=Object.freeze(Object.defineProperty({__proto__:null,default:X(Ce,[["__scopeId","data-v-e3b34c54"]])},Symbol.toStringTag,{value:"Module"})),we={class:"tab_container fdc1"},ke={class:"describe_bar"},Ee={class:"top"},Te={key:0,class:"right_text"},Se={key:1,class:"right_text"},ve={key:0,class:"error_msg"},Be={key:1,class:"error_msg"},De={key:2,class:"error_msg"},Ue={key:3,class:"success_msg"},Me={class:"descriptions fcenter"},qe={class:"descriptions_content"},Fe={class:"money red"},Le={class:"descriptions fcenter"},Pe={class:"descriptions_label",style:{width:"120px"}},Ie={class:"descriptions_content"},ze={class:"money"},Oe={class:"img_captcha_container fcenter"},Ae={class:"sms_captcha_container fcenter"},Re={class:"ccenter fdc"},$e=e.defineComponent({__name:"ThirdPartyDelivery",setup(c){const{divTenThousand:u}=G();e.onMounted(()=>{V()});const s=e.ref({platformActivated:!1,cityOpen:!1,activated:!1,balance:0,frozen:0}),V=async()=>{try{const{data:r,code:a}=await J();if(a!==200){h.ElMessage.error("获取第三方配送信息失败");return}s.value=r}catch(r){console.log(r),h.ElMessage.error("获取第三方配送信息失败")}},_=e.ref(!1),x=()=>{_.value=!0},o=e.ref(!1),F=async()=>{const{data:r}=await ce();L.value=r.h5Qrcode,o.value=!0},L=e.ref(""),R=e.computed(()=>!s.value.platformActivated),U=e.computed(()=>s.value.platformActivated&&!s.value.cityOpen),k=e.computed(()=>s.value.platformActivated&&s.value.cityOpen&&!s.value.activated),f=e.ref({mobile:"",captcha:"",smsCode:""}),$=(r,a,d)=>{a===""?(y.value.base64Captcha="",d(new Error("请输入手机号"))):oe.REGEX_MOBILE(a)?d():(y.value.base64Captcha="",d(new Error("手机号格式有误")))},y=e.ref({needCaptcha:!1,base64Captcha:""}),E=async(r=!0)=>{var a,d,b;r&&(f.value.captcha="");try{await n();const i=await se({...f.value});if(i!=null&&i.msg)return(a=i==null?void 0:i.data)!=null&&a.msg?h.ElMessage.error((d=i==null?void 0:i.data)==null?void 0:d.msg):h.ElMessage.error(i.msg),Promise.reject(i.msg);if(i!=null&&i.data)return y.value.needCaptcha=((b=i==null?void 0:i.data)==null?void 0:b.needCaptcha)||!1,i.data.needCaptcha?y.value.base64Captcha=i.data.base64Captcha:y.value.base64Captcha="",i.data.needCaptcha}catch(i){return console.log("sss",i),Promise.reject(i)}},j={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:$,trigger:"change"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}],smsCode:[{required:!0,message:"请输入短信验证码",trigger:"blur"}]},C=e.ref(60),T=e.ref(),S=e.ref(),v=e.ref(!1),P=async()=>{C.value=60,v.value=!0,setTimeout(()=>{v.value=!1},1e3);const r=await E(!1);f.value.captcha="",r||(S.value=setInterval(()=>{C.value>0?C.value--:(clearInterval(S.value),C.value=60)},1e3))};e.onBeforeUnmount(()=>{S.value&&clearInterval(S.value)});const n=async()=>{try{const r=await T.value.validateField("mobile");if(console.log(r),r)return r}catch(r){return console.log("校验手机号失败",r),Promise.reject(r)}};H.debounce(E,200);const t=H.debounce(E,5e3,{leading:!0,trailing:!1}),m=()=>{T.value.validate(async(r,a)=>{var d;if(r){const b=await de({mobile:f.value.mobile,smsCode:f.value.smsCode});b.success?(_.value=!1,V()):h.ElMessage.error(((d=b==null?void 0:b.data)==null?void 0:d.msg)||b.msg)}else console.log("error submit!",a)})},p=()=>{V(),o.value=!1};return(r,a)=>{const d=e.resolveComponent("el-button"),b=e.resolveComponent("el-tooltip"),i=e.resolveComponent("el-input"),B=e.resolveComponent("el-form-item"),I=e.resolveComponent("el-image"),M=e.resolveComponent("el-form"),z=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",we,[e.createElementVNode("div",ke,[e.createElementVNode("div",Ee,[a[7]||(a[7]=e.createTextVNode(" 开通流程： ")),e.createVNode(te,{steps:["① 授权开通","② 充值","③勾选第三方配送"]})]),a[8]||(a[8]=e.createElementVNode("div",{class:"bottom"},[e.createTextVNode("免责声明："),e.createElementVNode("span",{class:"danger"},"因开通第三方配送服务产生的一切费用由您自行承担，本平台不加收任何费用。")],-1))]),e.createVNode(q,{name:"UU跑腿"},{right:e.withCtx(()=>[s.value.activated?(e.openBlock(),e.createElementBlock("div",Te,"UU跑腿配送费从账户余额扣，配送中金额冻结")):k.value?(e.openBlock(),e.createElementBlock("div",Se,[e.createVNode(d,{type:"primary",text:"",onClick:x},{default:e.withCtx(()=>a[9]||(a[9]=[e.createTextVNode("授权开通")])),_:1})])):e.createCommentVNode("",!0)]),_:1}),R.value?(e.openBlock(),e.createElementBlock("div",ve,"平台运营商未注册UU跑腿开发者账号，请通知平台运营商设置【第三方配送】！")):U.value?(e.openBlock(),e.createElementBlock("div",Be,"店铺所在(地区)区域，UU跑腿暂不支持配送，无法授权开通 ，或联系平台运营人员调整店铺地址！")):k.value?(e.openBlock(),e.createElementBlock("div",De,"您还未开通UU跑腿配送服务，请授权开通UU跑腿！")):(e.openBlock(),e.createElementBlock("div",Ue,[a[14]||(a[14]=e.createElementVNode("div",{class:"descriptions fcenter"},[e.createElementVNode("div",{class:"descriptions_label",style:{width:"120px"}},"开通状态："),e.createElementVNode("div",{class:"descriptions_content"},[e.createElementVNode("span",{class:"open_status"},"已开通")])],-1)),e.createElementVNode("div",Me,[a[11]||(a[11]=e.createElementVNode("div",{class:"descriptions_label",style:{width:"120px"}},"账户金额(元)：",-1)),e.createElementVNode("div",qe,[e.createElementVNode("span",Fe,e.toDisplayString(e.unref(u)(s.value.balance)),1),e.createVNode(d,{type:"primary",text:"",onClick:F},{default:e.withCtx(()=>a[10]||(a[10]=[e.createTextVNode("充值")])),_:1})])]),e.createElementVNode("div",Le,[e.createElementVNode("div",Pe,[a[12]||(a[12]=e.createTextVNode(" 冻结金额(元) ")),e.createVNode(b,{effect:"dark",content:"配送中金额冻结",placement:"bottom"},{default:e.withCtx(()=>[e.createVNode(O,{class:"cup",name:"icon-wenhao"})]),_:1}),a[13]||(a[13]=e.createTextVNode(" ： "))]),e.createElementVNode("div",Ie,[e.createElementVNode("span",ze,e.toDisplayString(e.unref(u)(s.value.frozen)),1)])])])),e.createVNode(z,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=g=>_.value=g),title:"授权开通UU跑腿",width:"500px"},{footer:e.withCtx(()=>[e.createVNode(d,{onClick:a[4]||(a[4]=g=>_.value=!1)},{default:e.withCtx(()=>a[17]||(a[17]=[e.createTextVNode("取 消")])),_:1}),e.createVNode(d,{type:"primary",onClick:m},{default:e.withCtx(()=>a[18]||(a[18]=[e.createTextVNode("确 定")])),_:1})]),default:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(M,{ref_key:"formRef",ref:T,rules:j,model:f.value,"label-width":"150px","label-position":"left"},{default:e.withCtx(()=>[e.createVNode(B,{label:"手机号（账户名）",prop:"mobile"},{default:e.withCtx(()=>[e.createVNode(i,{modelValue:f.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=g=>f.value.mobile=g),maxlength:"11",placeholder:"请输入手机号码",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),y.value.needCaptcha?(e.openBlock(),e.createBlock(B,{key:0,label:"图形验证码",prop:"captcha"},{default:e.withCtx(()=>[e.createElementVNode("div",Oe,[e.createVNode(i,{modelValue:f.value.captcha,"onUpdate:modelValue":a[1]||(a[1]=g=>f.value.captcha=g),maxlength:"6",placeholder:"请输入验证码",style:{width:"140px"}},null,8,["modelValue"]),e.createVNode(I,{src:y.value.base64Captcha,alt:"",style:{"margin-left":"25px",width:"85px",height:"40px"},class:"cup",onClick:a[2]||(a[2]=()=>e.unref(t)())},{error:e.withCtx(()=>a[15]||(a[15]=[e.createElementVNode("div",{style:{color:"#b6b6b6"}},"稍后重试",-1)])),_:1},8,["src"])])]),_:1})):e.createCommentVNode("",!0),e.createVNode(B,{label:"短信验证码",prop:"smsCode"},{default:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createVNode(i,{modelValue:f.value.smsCode,"onUpdate:modelValue":a[3]||(a[3]=g=>f.value.smsCode=g),maxlength:"6",placeholder:"请输入短信验证码",style:{width:"140px"}},null,8,["modelValue"]),C.value===60?(e.openBlock(),e.createBlock(d,{key:0,style:{"margin-left":"25px"},plain:"",loading:v.value,onClick:P},{default:e.withCtx(()=>a[16]||(a[16]=[e.createTextVNode("获取")])),_:1},8,["loading"])):(e.openBlock(),e.createBlock(d,{key:1,style:{"margin-left":"25px"},plain:"",disabled:""},{default:e.withCtx(()=>[e.createTextVNode("重新发送 "+e.toDisplayString(C.value)+"s",1)]),_:1}))])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),e.createVNode(z,{modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=g=>o.value=g),title:"充值UU跑腿",width:"500px"},{default:e.withCtx(()=>[e.createElementVNode("div",Re,[a[20]||(a[20]=e.createElementVNode("div",null,"请使用微信或支付宝的【扫一扫】功能扫码充值",-1)),e.createVNode(I,{style:{width:"300px",height:"300px"},src:L.value,fit:"cover"},null,8,["src"]),e.createVNode(d,{type:"link",onClick:p},{default:e.withCtx(()=>a[19]||(a[19]=[e.createTextVNode("已充值返回并刷新")])),_:1})])]),_:1},8,["modelValue"])])}}}),We="",je=Object.freeze(Object.defineProperty({__proto__:null,default:X($e,[["__scopeId","data-v-2fa7d99a"]])},Symbol.toStringTag,{value:"Module"}));return le});
