(function(e,f){typeof exports=="object"&&typeof module<"u"?module.exports=f(require("vue"),require("vue-router"),require("@/components/BetterPageManage/BetterPageManage.vue"),require("@/apis/http"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue"),require("@/components/SchemaForm.vue")):typeof define=="function"&&define.amd?define(["vue","vue-router","@/components/BetterPageManage/BetterPageManage.vue","@/apis/http","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue","@/components/SchemaForm.vue"],f):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformAppluDiscount=f(e.PlatformAppluDiscountContext.Vue,e.PlatformAppluDiscountContext.VueRouter,e.PlatformAppluDiscountContext.PageManage,e.PlatformAppluDiscountContext.Request,e.PlatformAppluDiscountContext.ElementPlus,e.PlatformAppluDiscountContext.ElTableEmpty,e.PlatformAppluDiscountContext.SchemaForm))})(this,function(e,f,O,x,g,I,D){"use strict";var b=document.createElement("style");b.textContent=`@charset "UTF-8";.name[data-v-4abbc962]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.flex_link_container[data-v-4abbc962]{display:flex;align-items:center}[data-v-4abbc962].el-link+.el-link{margin-left:10px}[data-v-4abbc962] .el-dialog__body{padding-bottom:0!important}
`,document.head.appendChild(b);const S="addon-full-reduction/full/reduction",R=o=>x.post({url:`${S}/page`,data:o}),k=o=>x.post({url:`${S}/shelf`,data:o});var r=(o=>(o.NOT_STARTED="NOT_STARTED",o.IN_PROGRESS="IN_PROGRESS",o.FINISHED="FINISHED",o.OFF_SHELF="OFF_SHELF",o.VIOLATION_OFF_SHELF="VIOLATION_OFF_SHELF",o))(r||{});const L={NOT_STARTED:{value:"NOT_STARTED",label:"未开始",style:"nots"},IN_PROGRESS:{value:"IN_PROGRESS",label:"进行中",style:"ongoing"},FINISHED:{value:"FINISHED",label:"已结束",style:"hasEnded"},OFF_SHELF:{value:"OFF_SHELF",label:"已下架",style:"off"},VIOLATION_OFF_SHELF:{value:"VIOLATION_OFF_SHELF",label:"违规下架",style:"off"}},w={style:{padding:"0 16px"},class:"table_container"},A={class:"name"},P={class:"name"},H={class:"name"},B={key:0},z={key:1},q={class:"name"},$={class:"name"},M={class:"name"},U={class:"pagination"},G={class:"dialog-footer"},j=e.defineComponent({__name:"discountList",props:{search:{type:Object,default:()=>({})}},setup(o,{expose:i}){const p=f.useRouter(),m=o,d=e.ref([]),y=e.ref(),s=e.reactive({size:10,current:1,total:0}),u=e.ref(0),C=e.ref([]),h=e.ref(null),c=e.ref({shopId:null,id:"",violation:null}),N=e.ref(!1);async function E(){const a={...s,...m.search},{code:l,data:n}=await R(a);if(l!==200)return g.ElMessage.error("获取满减列表失败");d.value=n.records,s.current=n.current,s.size=n.size,u.value=n.total}const K=a=>{c.value.shopId=a.shopId,c.value.id=a.id,N.value=!0},Q=()=>{h.value.resetFields()},X=async()=>{if(!await h.value.validate())return;const{code:l,msg:n}=await k(c.value);if(l!==200){g.ElMessage.error(n);return}g.ElMessage.success("下架成功");const _=d.value.find(F=>F.id===c.value.id);_&&(_.status=r.VIOLATION_OFF_SHELF),N.value=!1},Y=a=>{p.push({name:"applyDiscountBaseinfo",query:{id:a.id,shopId:a.shopId}})},Z=a=>{s.size=a,E()},v=a=>{s.current=a,E()};return e.onBeforeMount(()=>{E()}),i({chooseList:C,initDiscountActiveList:E}),(a,l)=>{const n=e.resolveComponent("el-table-column"),_=e.resolveComponent("el-link"),F=e.resolveComponent("el-tooltip"),ee=e.resolveComponent("el-table"),te=e.resolveComponent("el-input"),le=e.resolveComponent("el-form-item"),oe=e.resolveComponent("el-form"),T=e.resolveComponent("el-button"),ne=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",w,[e.createVNode(ee,{ref_key:"multipleTableRef",ref:y,"cell-style":{color:"#333333"},data:d.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#000"},onSelectionChange:l[0]||(l[0]=t=>C.value=t)},{empty:e.withCtx(()=>[e.createVNode(I,{imageIndex:"7"})]),default:e.withCtx(()=>[e.createVNode(n,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",A,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(n,{label:"活动名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",P,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(n,{label:"类型",width:"100"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",H,[t.firstRuleType==="FULL_REDUCTION"?(e.openBlock(),e.createElementBlock("span",B,"满减")):(e.openBlock(),e.createElementBlock("span",z,"满折"))])]),_:1}),e.createVNode(n,{label:"使用规则",width:"210"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",q,e.toDisplayString(t.firstRuleDesc),1)]),_:1}),e.createVNode(n,{label:"状态",prop:"status",width:"120"},{default:e.withCtx(({row:t})=>{var V;return[e.createElementVNode("span",{style:e.normalizeStyle({color:[e.unref(r).VIOLATION_OFF_SHELF].includes(t.status)?"#F54319":[e.unref(r).FINISHED,e.unref(r).OFF_SHELF].includes(t.status)?"#999":"#333"})},e.toDisplayString((V=e.unref(L)[t.status])==null?void 0:V.label),5)]}),_:1}),e.createVNode(n,{label:"活动时间",width:"250"},{default:e.withCtx(({row:t})=>[e.createElementVNode("p",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("p",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(n,{label:"活动商品",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",$,e.toDisplayString(t.productType==="ALL_PRODUCT"?"全部":`${t.product}${t.productType==="SPECIFIED_PRODUCT_NOT_PARTICIPATE"?"(除外)":""}`),1)]),_:1}),e.createVNode(n,{label:"支付单数",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",M,e.toDisplayString(t.order),1)]),_:1}),e.createVNode(n,{fixed:"right",label:"操作",align:"right",width:"170"},{default:e.withCtx(({row:t})=>[e.unref(r).VIOLATION_OFF_SHELF===t.status?(e.openBlock(),e.createBlock(F,{key:0,class:"box-item",effect:"dark",content:t.violation||"暂无违规原因",placement:"bottom-end"},{default:e.withCtx(()=>[e.createVNode(_,{underline:!1,size:"small",type:"primary"},{default:e.withCtx(()=>l[4]||(l[4]=[e.createTextVNode(" 违规原因 ")])),_:1})]),_:2},1032,["content"])):e.createCommentVNode("",!0),[e.unref(r).NOT_STARTED,e.unref(r).IN_PROGRESS].includes(t.status)?(e.openBlock(),e.createBlock(_,{key:1,underline:!1,size:"small",type:"danger",onClick:V=>K(t)},{default:e.withCtx(()=>l[5]||(l[5]=[e.createTextVNode(" 违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(_,{underline:!1,size:"small",type:"primary",onClick:V=>Y(t)},{default:e.withCtx(()=>l[6]||(l[6]=[e.createTextVNode("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createElementVNode("div",U,[e.createVNode(O,{"load-init":!0,"page-num":s.current,"page-size":s.size,total:u.value,onHandleCurrentChange:v,onHandleSizeChange:Z},null,8,["page-num","page-size","total"])]),e.createVNode(ne,{modelValue:N.value,"onUpdate:modelValue":l[3]||(l[3]=t=>N.value=t),center:"",title:"违规下架",width:"500",onClose:Q},{footer:e.withCtx(()=>[e.createElementVNode("div",G,[e.createVNode(T,{onClick:l[2]||(l[2]=t=>N.value=!1)},{default:e.withCtx(()=>l[7]||(l[7]=[e.createTextVNode("取消")])),_:1}),e.createVNode(T,{type:"primary",onClick:X},{default:e.withCtx(()=>l[8]||(l[8]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(oe,{ref_key:"illegalReasonFormRef",ref:h,model:c.value,rules:{violation:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(le,{label:"",prop:"violation"},{default:e.withCtx(()=>[e.createVNode(te,{modelValue:c.value.violation,"onUpdate:modelValue":l[1]||(l[1]=t=>c.value.violation=t),maxlength:"50",placeholder:"请输入违规原因，必填",resize:"none","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ae="",W=((o,i)=>{const p=o.__vccOpts||o;for(const[m,d]of i)p[m]=d;return p})(j,[["__scopeId","data-v-4abbc962"]]),J={class:"q_plugin_container"};return e.defineComponent({__name:"PlatformAppluDiscount",setup(o){const i=e.reactive({name:null,status:""}),p=[{label:"活动名称",prop:"name",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",labelWidth:75,prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"IN_PROGRESS",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"OFF_SHELF",label:"已下架"},{value:"VIOLATION_OFF_SHELF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],m=e.ref(),d=()=>{m.value.initDiscountActiveList()},y=()=>{Object.keys(i).forEach(s=>i[s]=""),d()};return(s,u)=>{const C=e.resolveComponent("el-config-provider");return e.openBlock(),e.createElementBlock("div",J,[e.createVNode(C,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:i,"onUpdate:modelValue":u[0]||(u[0]=h=>i=h),columns:p,onSearchHandle:d,onHandleReset:y},null,8,["modelValue"])]),_:1}),e.createVNode(W,{ref_key:"listRef",ref:m,search:i},null,8,["search"])])}}})});
