(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/apis/http"),require("@/components/PageManage.vue"),require("element-plus"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","@/apis/http","@/components/PageManage.vue","element-plus","vue-router"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopApplyDiscount=h(e.ShopApplyDiscountContext.Vue,e.ShopApplyDiscountContext.VueUse,e.ShopApplyDiscountContext.SchemaForm,e.ShopApplyDiscountContext.Request,e.ShopApplyDiscountContext.PageManageTwo,e.ShopApplyDiscountContext.ElementPlus,e.ShopApplyDiscountContext.VueRouter))})(this,function(e,h,R,x,k,i,A){"use strict";var F=document.createElement("style");F.textContent=`@charset "UTF-8";.col-last[data-v-f9e98979]{display:flex;justify-content:flex-end}.m-l-20[data-v-f9e98979]{margin-left:20px}.container[data-v-8551d947]{overflow-y:scroll}.reason[data-v-8551d947]{padding:10px 10px 20px}.status[data-v-8551d947]{color:#f54319}.grey[data-v-8551d947]{color:#999}[data-v-8551d947] .el-button.is-link{padding:0}[data-v-8551d947] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(F);const w=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(n,{emit:y}){const c=n,u=[{label:"活动名称",prop:"name",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"IN_PROGRESS",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"OFF_SHELF",label:"已下架"},{value:"VIOLATION_OFF_SHELF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],a=y,_=h.useVModel(c,"modelValue",a),d=()=>{Object.keys(_.value).forEach(S=>{_.value[S]=""}),a("search")};return(S,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(R,{modelValue:e.unref(_),"onUpdate:modelValue":f[0]||(f[0]=V=>e.isRef(_)?_.value=V:null),columns:u,onSearchHandle:f[1]||(f[1]=V=>a("search")),onHandleReset:d},null,8,["modelValue"]),f[2]||(f[2]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}}),Z="",O=(n,y)=>{const c=n.__vccOpts||n;for(const[u,a]of y)c[u]=a;return c},H=O(w,[["__scopeId","data-v-f9e98979"]]),g="addon-full-reduction/full/reduction",B=n=>x.post({url:`${g}/page`,data:n}),L=n=>x.post({url:`${g}/shelf`,data:n}),D=n=>x.del({url:`${g}/batch/delete`,data:n});var m=(n=>(n.NOT_STARTED="NOT_STARTED",n.IN_PROGRESS="IN_PROGRESS",n.FINISHED="FINISHED",n.OFF_SHELF="OFF_SHELF",n.VIOLATION_OFF_SHELF="VIOLATION_OFF_SHELF",n))(m||{});const I={NOT_STARTED:{value:"NOT_STARTED",label:"未开始",style:"nots"},IN_PROGRESS:{value:"IN_PROGRESS",label:"进行中",style:"ongoing"},FINISHED:{value:"FINISHED",label:"已结束",style:"hasEnded"},OFF_SHELF:{value:"OFF_SHELF",label:"已下架",style:"off"},VIOLATION_OFF_SHELF:{value:"VIOLATION_OFF_SHELF",label:"违规下架",style:"off"}};var b=(n=>(n[""]="未选择满减条件",n.FULL_REDUCTION="满减",n.FULL_DISCOUNT="满折",n))(b||{});const M={class:"q_plugin_container pt15"},P={class:"search_container"},$={class:"handle_container",style:{"padding-top":"16px"}},q={class:"table_container"},z={class:"reason"},G=e.defineComponent({__name:"ShopApplyDiscount",setup(n){const y=A.useRouter(),c=e.ref([]),u=e.ref({name:"",status:""}),a=e.reactive({size:10,current:1,total:0}),_=e.ref();d();async function d(){console.log(u.value,"searchParam");const l={...a,...u.value},{code:o,data:s}=await B(l);if(o!==200)return i.ElMessage.error("获取活动列表失败");c.value=s.records,a.current=s.current,a.size=s.size,a.total=s.total}const S=async l=>{try{if(!await i.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{code:s}=await D([l]);if(s!==200){i.ElMessage.error("删除失败");return}i.ElMessage.success("删除成功"),c.value=c.value.filter(r=>r.id!==l),a.total--}catch(o){console.error("isValidate",o)}},f=l=>{a.size=l,d()},V=l=>{a.current=l,d()},C=e.ref([]),N=e.ref(!1),E=e.ref("违规原因"),U=l=>{E.value=l,N.value=!0},j=async l=>{if(!await i.ElMessageBox.confirm("确定删除该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{msg:s,code:r}=await L({id:l});if(r!==200)return i.ElMessage.error(s??"下架失败！");i.ElMessage.success("下架成功！"),d()},J=(l,o)=>{y.push({name:"applyDiscountBaseinfo",query:{id:l,isLookUp:o}})},K=()=>{i.ElMessageBox.confirm("确定删除选中活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:async l=>{if(l==="cancel")return;const o=C.value.filter(r=>r.status!==m.IN_PROGRESS).map(r=>r.id),{code:s}=await D(o);if(s!==200){i.ElMessage.error("删除失败");return}i.ElMessage.success("删除成功"),d()}})},Q=l=>{C.value=l},W=()=>{E.value="",N.value=!1};return(l,o)=>{const s=e.resolveComponent("el-config-provider"),r=e.resolveComponent("el-button"),p=e.resolveComponent("el-table-column"),X=e.resolveComponent("el-table"),Y=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("div",P,[e.createVNode(s,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(H,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=t=>u.value=t),onSearch:d},null,8,["modelValue"])]),_:1})]),e.createElementVNode("div",$,[e.createVNode(r,{round:"",type:"primary",onClick:o[1]||(o[1]=t=>e.unref(y).push({name:"applyDiscountBaseinfo"}))},{default:e.withCtx(()=>o[3]||(o[3]=[e.createTextVNode(" 新增满减 ")])),_:1}),e.createVNode(r,{disabled:!C.value.length,round:"",onClick:K},{default:e.withCtx(()=>o[4]||(o[4]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",q,[e.createVNode(X,{ref_key:"multipleTableRef",ref:_,data:c.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:Q},{default:e.withCtx(()=>[e.createVNode(p,{selectable:t=>t.status!==e.unref(m).IN_PROGRESS,fixed:"",type:"selection",width:"30"},null,8,["selectable"]),e.createVNode(p,{label:"活动名称",width:"180"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.name),1)]),_:1}),e.createVNode(p,{label:"类型",width:"80"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(e.unref(b)[t.firstRuleType]),1)]),_:1}),e.createVNode(p,{label:"使用规则",width:"180"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,e.toDisplayString(t.firstRuleDesc),1)]),_:1}),e.createVNode(p,{label:"状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",{style:e.normalizeStyle({color:["VIOLATION_OFF_SHELF"].includes(t.status)?"#F54319":["OFF_SHELF","FINISHED"].includes(t.status)?"#999":"#333"})},e.toDisplayString(e.unref(I)[t.status]&&e.unref(I)[t.status].label),5)]),_:1}),e.createVNode(p,{label:"活动时间",width:"220"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(p,{label:"活动商品"},{default:e.withCtx(({row:t})=>[e.createTextVNode(e.toDisplayString(t.productType==="ALL_PRODUCT"?"全部":`${t.product}${t.productType==="SPECIFIED_PRODUCT_NOT_PARTICIPATE"?"(除外)":""}`),1)]),_:1}),e.createVNode(p,{label:"支付单数"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.order||0),1)]),_:1}),e.createVNode(p,{fixed:"right",label:"操作",width:"200",align:"right"},{default:e.withCtx(({row:t})=>[e.createVNode(r,{link:"",type:"primary",onClick:T=>J(t.id,"true")},{default:e.withCtx(()=>o[5]||(o[5]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),t.status===e.unref(m).IN_PROGRESS?(e.openBlock(),e.createBlock(r,{key:0,link:"",type:"primary",onClick:T=>j(t.id)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode(" 下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status===e.unref(m).VIOLATION_OFF_SHELF?(e.openBlock(),e.createBlock(r,{key:1,link:"",type:"primary",onClick:T=>U(t.violation)},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode("违规原因 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),t.status!==e.unref(m).IN_PROGRESS?(e.openBlock(),e.createBlock(r,{key:2,link:"",type:"danger",onClick:T=>S(t.id)},{default:e.withCtx(()=>o[8]||(o[8]=[e.createTextVNode(" 删除 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(k,{"load-init":!0,"page-num":a.current,"page-size":a.size,total:a.total,onReload:d,onHandleSizeChange:f,onHandleCurrentChange:V},null,8,["page-num","page-size","total"]),e.createVNode(Y,{modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=t=>N.value=t),center:"",title:"违规原因",width:"600px",onClose:W},{default:e.withCtx(()=>[e.createElementVNode("div",z,e.toDisplayString(E.value),1)]),_:1},8,["modelValue"])])}}}),v="";return O(G,[["__scopeId","data-v-8551d947"]])});
