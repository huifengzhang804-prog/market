(function(e,f){typeof exports=="object"&&typeof module<"u"?module.exports=f(require("vue"),require("vue-router"),require("element-plus"),require("@vueuse/core"),require("@/composables/useConvert"),require("decimal.js"),require("@/apis/http"),require("@/apis/good")):typeof define=="function"&&define.amd?define(["vue","vue-router","element-plus","@vueuse/core","@/composables/useConvert","decimal.js","@/apis/http","@/apis/good"],f):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformCouponInfo=f(e.PlatformCouponInfoContext.Vue,e.PlatformCouponInfoContext.VueRouter,e.PlatformCouponInfoContext.ElementPlus,e.PlatformCouponInfoContext.VueUse,e.PlatformCouponInfoContext.UseConvert,e.PlatformCouponInfoContext.Decimal,e.PlatformCouponInfoContext.Request,e.PlatformCouponInfoContext.GoodAPI))})(this,function(e,f,g,k,w,v,P,U){"use strict";var E=document.createElement("style");E.textContent=`@charset "UTF-8";.scroll[data-v-5d558cdd]{overflow:scroll;padding-left:16px;padding-right:16px;margin-top:30px}.tool[data-v-5d558cdd]{margin-top:auto;align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:9}.title[data-v-5d558cdd]{font-size:14px;color:#606266;font-weight:700;margin-bottom:30px}.msg[data-v-5d558cdd]{font-size:12px;margin-left:12px;color:#c4c4c4}.rules[data-v-5d558cdd]{display:flex;justify-content:space-between}.rules__input[data-v-5d558cdd]{width:50%}.period-validity[data-v-5d558cdd]{width:300px;display:flex}.text[data-v-5d558cdd]{font-size:14px;color:#333}.goodsData[data-v-5d558cdd]{border:1px solid #ccc}.goods-list[data-v-5d558cdd]{width:90%;margin-top:40px;height:360px;border:1px solid transparent}.goods-list__info[data-v-5d558cdd]{display:flex}.goods-list__goods-list__info-name[data-v-5d558cdd]{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;padding:0 16px}.goods-list__goods-list__info-name--name[data-v-5d558cdd]{width:462px;font-size:14px;color:#2e99f3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.goods-list__goods-list__info-name--price[data-v-5d558cdd]{font-size:14px;text-align:LEFT;color:#f12f22}.goods-list__goods-list__info-name--price[data-v-5d558cdd]:before{content:"￥";font-size:12px;text-align:LEFT;color:#f12f22}.my-header[data-v-5d558cdd]{font-size:16px}.ruleform-date[data-v-5d558cdd]{width:100%;display:flex}.nav-button[data-v-5d558cdd]{position:fixed;bottom:50px;left:50%}
`,document.head.appendChild(E);const{divTenThousand:R,mulTenThousand:ee}=w(),I={PRICE_DISCOUNT:"无门槛折扣券",PRICE_REDUCE:"无门槛现金券",REQUIRED_PRICE_DISCOUNT:"满折券",REQUIRED_PRICE_REDUCE:"满减券"};var h=(a=>(a.PERIOD="PERIOD",a.IMMEDIATELY="IMMEDIATELY",a))(h||{}),b=(a=>(a.ALL="ALL",a.SHOP_ALL="SHOP_ALL",a.ALL_PRODUCT="ALL_PRODUCT",a.ASSIGNED="ASSIGNED",a.ASSIGNED_NOT="ASSIGNED_NOT",a))(b||{});function D(a){return a?R(a).toString():""}function S(a){const{name:m,days:s,type:p,endDate:i,productIds:o,productType:c,requiredAmount:x,discount:_,amount:n,effectType:t,startDate:r,num:d,limit:u,id:C,shopId:N}=a;return{shopId:N,id:C,name:m,days:s,endDate:i,productType:c,type:p,requiredAmount:D(x).toString(),discount:_,amount:D(n),effectType:t,startDate:r,num:d,limit:u,productIds:o}}const A=e.defineComponent({__name:"select-couppon-type",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},list:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(a,{emit:m}){const s=a,p=m,i=k.useVModel(s,"modelValue",p);return(o,c)=>{const x=e.resolveComponent("el-option"),_=e.resolveComponent("el-select");return e.openBlock(),e.createBlock(_,{modelValue:e.unref(i),"onUpdate:modelValue":c[0]||(c[0]=n=>e.isRef(i)?i.value=n:null),placeholder:s.placeholder,style:{width:"150px"},onChange:c[1]||(c[1]=n=>p("change",n))},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.values(s.list).length?s.list:e.unref(I),(n,t)=>(e.openBlock(),e.createBlock(x,{key:t,label:n,value:t},null,8,["label","value"]))),128))]),_:3},8,["modelValue","placeholder"])}}}),B=(a,m)=>P.get({url:`addon-coupon/coupon/shop/${a}/${m}`}),L={class:"q_plugin_container"},q={class:"scroll"},O={key:0,class:"ruleform-date"},M={class:"period-validity text"},Y={class:"rules"},z={class:"rules"},G={key:2,class:"rules",style:{"justify-content":"center"}},j={key:3,class:"rules",style:{"justify-content":"center"}},$={class:"goods-list__info"},F={class:"goods-list__goods-list__info-name"},H={class:"goods-list__goods-list__info-name--name"},Q={class:"goods-list__goods-list__info-name--price"},W={class:"tool"},J=e.defineComponent({__name:"PlatformCouponInfo",setup(a){const{divTenThousand:m}=w(),s=f.useRouter(),p=f.useRoute(),i=e.ref([]),o=e.ref({name:"",days:"",endDate:"",productType:b.ALL,type:"PRICE_DISCOUNT",requiredAmount:"",discount:"",amount:"",effectType:h.PERIOD,startDate:"",num:"",limit:"",shopId:"",productIds:[]});c();async function c(){if(p.query.id&&p.query.shopId){const{code:n,data:t}=await B(p.query.shopId.toString(),p.query.id.toString());if(n!==200){g.ElMessage.error("获取优惠券信息失败");return}o.value=S(t),_(t);return}}function x(n){const t=Math.max(...n.map(d=>Number(d))),r=Math.min(...n.map(d=>Number(d)));return`${m(r)}~${m(t)}`}async function _(n){if(n.productIds&&n.productIds.length){const{code:t,data:r}=await U.doGetRetrieveProduct({productId:n.productIds});if(t!==200){g.ElMessage.error("获取商品信息失败");return}i.value=r.list.map(d=>({...d,name:d.productName,salePrice:x(d.salePrices||[]),isCheck:!0})),console.log("goodsData.value",i.value)}}return(n,t)=>{const r=e.resolveComponent("el-input"),d=e.resolveComponent("el-form-item"),u=e.resolveComponent("el-radio"),C=e.resolveComponent("el-radio-group"),N=e.resolveComponent("el-row"),y=e.resolveComponent("el-date-picker"),V=e.resolveComponent("el-table-column"),T=e.resolveComponent("el-table"),K=e.resolveComponent("el-image"),X=e.resolveComponent("el-form"),Z=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",L,[e.createElementVNode("div",q,[t[33]||(t[33]=e.createElementVNode("h1",{class:"title"},"基本信息",-1)),e.createVNode(X,{"inline-message":!1,model:o.value,"validate-on-rule-change":!1,"label-width":"auto"},{default:e.withCtx(()=>[e.createVNode(d,{label:"优惠券名称",prop:"name"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.name=l),modelModifiers:{trim:!0},disabled:"",maxlength:"10",placeholder:"请输入优惠券名称",style:{width:"551px"}},null,8,["modelValue"]),t[16]||(t[16]=e.createElementVNode("span",{class:"msg"},"优惠券名称不超过10个字",-1))]),_:1}),e.createVNode(d,{label:"有效时间",prop:"effectType"},{default:e.withCtx(()=>[e.createVNode(N,{style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(C,{modelValue:o.value.effectType,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.effectType=l),class:"ml-4",disabled:""},{default:e.withCtx(()=>[e.createVNode(u,{value:"PERIOD"},{default:e.withCtx(()=>t[17]||(t[17]=[e.createTextVNode("固定时间")])),_:1}),e.createVNode(u,{value:"IMMEDIATELY"},{default:e.withCtx(()=>t[18]||(t[18]=[e.createTextVNode("领券立即生效")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.createVNode(N,{style:{"margin-top":"20px"}},{default:e.withCtx(()=>[o.value.effectType==="PERIOD"?(e.openBlock(),e.createElementBlock("div",O,[e.createVNode(d,{"inline-message":!1,"label-width":"0",prop:"startDate"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:o.value.startDate,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.startDate=l),disabled:"",format:"YYYY/MM/DD",placeholder:"请选择开始时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t[19]||(t[19]=e.createElementVNode("span",{style:{margin:"0 10px"}},"至",-1))]),_:1}),e.createVNode(d,{"inline-message":!1,"label-width":"0",prop:"endDate"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:o.value.endDate,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.endDate=l),disabled:"",format:"YYYY/MM/DD",placeholder:"请选择结束时间",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})])):(e.openBlock(),e.createBlock(d,{key:1,"label-width":"0",prop:"days"},{default:e.withCtx(()=>[e.createElementVNode("div",M,[t[20]||(t[20]=e.createTextVNode(" 领券当日起 ")),e.createVNode(r,{modelValue:o.value.days,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.days=l),disabled:"",style:{width:"20%",margin:"0 5px"}},null,8,["modelValue"]),t[21]||(t[21]=e.createTextVNode(" 天内可用 "))])]),_:1}))]),_:1})]),_:1}),e.createVNode(d,{label:"活动规则",prop:"type"},{default:e.withCtx(()=>[e.createVNode(T,{data:[{}],"header-cell-style":{textAlign:"center",fontSize:"14px",color:"#606266"},border:"",style:{width:"90%"}},{default:e.withCtx(()=>[e.createVNode(V,{label:"选择优惠券类型"},{default:e.withCtx(()=>[e.createVNode(d,{"label-width":"0",prop:"type"},{default:e.withCtx(()=>[e.createVNode(A,{modelValue:o.value.type,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.type=l),list:e.unref(I),disabled:"",placeholder:"全部类型"},null,8,["modelValue","list"])]),_:1})]),_:1}),e.createVNode(V,{label:"优惠券规则",width:"240"},{default:e.withCtx(()=>[o.value.type==="PRICE_DISCOUNT"?(e.openBlock(),e.createBlock(d,{key:0,"label-width":"0",prop:"discount"},{default:e.withCtx(()=>[e.createElementVNode("div",Y,[e.createVNode(r,{modelValue:o.value.discount,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.discount=l),disabled:"",style:{flex:"1"}},null,8,["modelValue"]),t[22]||(t[22]=e.createElementVNode("span",{style:{"margin-left":"10px"}},"折，无门槛使用",-1))])]),_:1})):e.createCommentVNode("",!0),o.value.type==="PRICE_REDUCE"?(e.openBlock(),e.createBlock(d,{key:1,"label-width":"0",prop:"amount"},{default:e.withCtx(()=>[e.createElementVNode("div",z,[e.createVNode(r,{modelValue:o.value.amount,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.amount=l),disabled:"",style:{flex:"1"}},null,8,["modelValue"]),t[23]||(t[23]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元，无门槛使用",-1))])]),_:1})):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_DISCOUNT"?(e.openBlock(),e.createElementBlock("div",G,[e.createVNode(d,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[24]||(t[24]=e.createElementVNode("span",null,"满",-1)),e.createVNode(r,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.requiredAmount=l),disabled:"",style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(d,{"label-width":"0%",prop:"discount"},{default:e.withCtx(()=>[t[25]||(t[25]=e.createElementVNode("span",null,"元,打",-1)),e.createVNode(r,{modelValue:o.value.discount,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.discount=l),disabled:"",style:{width:"50%","margin-left":"5px"}},null,8,["modelValue"]),t[26]||(t[26]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"折",-1))]),_:1})])):e.createCommentVNode("",!0),o.value.type==="REQUIRED_PRICE_REDUCE"?(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(d,{"label-width":"0%",prop:"requiredAmount"},{default:e.withCtx(()=>[t[27]||(t[27]=e.createElementVNode("span",null,"满",-1)),e.createVNode(r,{modelValue:o.value.requiredAmount,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.requiredAmount=l),disabled:"",style:{width:"60%","margin-left":"5px"}},null,8,["modelValue"])]),_:1}),e.createVNode(d,{"label-width":"0%",prop:"amount"},{default:e.withCtx(()=>[t[28]||(t[28]=e.createElementVNode("span",null,"元,减",-1)),e.createVNode(r,{modelValue:o.value.amount,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.amount=l),disabled:"",style:{width:"50%","margin-left":"5px"}},null,8,["modelValue"]),t[29]||(t[29]=e.createElementVNode("span",{style:{"margin-left":"5px"}},"元",-1))]),_:1})])):e.createCommentVNode("",!0)]),_:1}),e.createVNode(V,{label:"发行量（张）"},{default:e.withCtx(()=>[e.createVNode(d,{"label-width":"0",prop:"num"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.num,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.num=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(V,{label:"限领（张）"},{default:e.withCtx(()=>[e.createVNode(d,{"label-width":"0",prop:"num"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:o.value.limit,"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.limit=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(d,{label:"商品选择",prop:"productType"},{default:e.withCtx(()=>[e.createVNode(C,{modelValue:o.value.productType,"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.productType=l),disabled:""},{default:e.withCtx(()=>[e.createVNode(u,{value:"SHOP_ALL"},{default:e.withCtx(()=>t[30]||(t[30]=[e.createTextVNode("全部商品参与")])),_:1}),e.createVNode(u,{value:"ASSIGNED"},{default:e.withCtx(()=>t[31]||(t[31]=[e.createTextVNode("指定商品参与")])),_:1}),e.createVNode(u,{value:"ASSIGNED_NOT"},{default:e.withCtx(()=>t[32]||(t[32]=[e.createTextVNode("指定商品不参与")])),_:1})]),_:1},8,["modelValue"]),e.createElementVNode("div",{class:e.normalizeClass([i.value.length&&"goodsData","goods-list"])},[o.value.productType!=="SHOP_ALL"?(e.openBlock(),e.createBlock(T,{key:0,data:i.value,"header-cell-style":{fontSize:"14px",color:"#606266",background:"#f2f2f2",height:"54px",fontWeight:"normal"},height:"360px",style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(V,{label:"商品信息"},{default:e.withCtx(({row:l})=>[e.createElementVNode("div",$,[e.createVNode(K,{"preview-src-list":[l.pic],"preview-teleported":!0,src:l.pic,fit:"fit",style:{width:"60px",height:"60px"}},null,8,["preview-src-list","src"]),e.createElementVNode("div",F,[e.createElementVNode("div",H,e.toDisplayString(l.name),1),e.createElementVNode("div",Q,e.toDisplayString(l.salePrice),1)])])]),_:1}),e.createVNode(V,{label:"操作",width:"80px"})]),_:1},8,["data"])):e.createCommentVNode("",!0)],2)]),_:1})]),_:1},8,["model"])]),e.createElementVNode("div",W,[e.createVNode(Z,{plain:"",round:"",onClick:t[15]||(t[15]=l=>e.unref(s).back())},{default:e.withCtx(()=>t[34]||(t[34]=[e.createTextVNode("返回")])),_:1})])])}}}),te="";return((a,m)=>{const s=a.__vccOpts||a;for(const[p,i]of m)s[p]=i;return s})(J,[["__scopeId","data-v-5d558cdd"]])});
