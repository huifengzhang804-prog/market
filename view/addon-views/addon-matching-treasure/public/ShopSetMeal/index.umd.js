(function(e,S){typeof exports=="object"&&typeof module<"u"?module.exports=S(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("vue-router"),require("@/components/PageManage.vue"),require("element-plus"),require("@/apis/http"),require("@/utils/Storage")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","vue-router","@/components/PageManage.vue","element-plus","@/apis/http","@/utils/Storage"],S):(e=typeof globalThis<"u"?globalThis:e||self,e.ShopSetMeal=S(e.ShopSetMealContext.Vue,e.ShopSetMealContext.VueUse,e.ShopSetMealContext.SchemaForm,e.ShopSetMealContext.VueRouter,e.ShopSetMealContext.PageManageTwo,e.ShopSetMealContext.ElementPlus,e.ShopSetMealContext.Request,e.ShopSetMealContext.Storage))})(this,function(e,S,w,M,L,r,y,O){"use strict";var N=document.createElement("style");N.textContent=`@charset "UTF-8";.origin[data-v-994335c0]{display:flex;justify-content:start;align-items:center}.origin--name[data-v-994335c0]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}[data-v-994335c0] .el-button.is-link{padding:0}[data-v-994335c0] .el-button+.el-button{margin-left:10px}
`,document.head.appendChild(N);const B=e.defineComponent({__name:"head-operation",props:{modelValue:{type:Object,default(){return{}}}},emits:["update:modelValue","search"],setup(o,{emit:u}){const d=o,h=[{label:"活动名称",prop:"keyword",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"setMealStatus",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"PROCESSING",label:"进行中"},{value:"OVER",label:"已结束"},{value:"MERCHANT_SELL_OFF",label:"已下架"},{value:"ILLEGAL_SELL_OFF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],f=u,i=S.useVModel(d,"modelValue",f),g=()=>{Object.keys(i.value).forEach(s=>i.value[s]=""),f("search")};return(s,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(w,{modelValue:e.unref(i),"onUpdate:modelValue":c[0]||(c[0]=C=>e.isRef(i)?i.value=C:null),columns:h,onSearchHandle:c[1]||(c[1]=C=>f("search")),onHandleReset:g},null,8,["modelValue"]),c[2]||(c[2]=e.createElementVNode("div",{class:"grey_bar"},null,-1))],64))}});var k=(o=>(o.NOT_STARTED="未开始",o.PROCESSING="进行中",o.OVER="已结束",o.MERCHANT_SELL_OFF="已下架",o.ILLEGAL_SELL_OFF="违规下架",o))(k||{});const x="addon-matching-treasure/setMeal",I=o=>y.post({url:`${x}/${o.shopId}/${o.setMealId}`}),R=o=>y.get({url:x,params:o}),b=o=>y.del({url:x,data:o}),F={class:"handle_container",style:{"margin-top":"16px"}},D={class:"table_container"},G={class:"origin"},q={class:"origin--name",style:{width:"154px","margin-left":"5px"}},$=e.defineComponent({__name:"set-meal-list",props:{search:{type:Object,default:()=>({})},showOffShelfBtn:{type:Boolean,default:!0}},setup(o,{expose:u}){const d=M.useRouter(),h=M.useRoute(),f=o,i=e.ref([]),g=e.ref(),s=e.reactive({size:10,current:1,total:0});e.computed(()=>i.value.some(t=>t.setMealStatus!=="PROCESSING")),e.watch(()=>h.query.flag,t=>{t&&m()});const c=e.ref([]),C=t=>{c.value=t},P=async()=>{try{if(!await r.ElMessageBox.confirm("确定批量删除套餐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=c.value.filter(l=>l.setMealStatus!=="PROCESSING").map(l=>({shopId:l.shopId,setMealId:l.id}));n.length?T(n):r.ElMessage.warning("进行中的活动不能被删除")}catch(t){return t}},j=()=>{var n;if(((n=new O().getItem("shopStore"))==null?void 0:n.shopMode)==="O2O"){r.ElMessage.warning("O2O店铺暂不支持该活动");return}d.push({name:"bundlePriceBaseinfo"})};async function m(){const{setMealStatus:t,keyword:n}=f.search,p={...s,...{setMealStatus:t,keyword:n}},{code:V,data:_}=await R(p);if(V!==200)return r.ElMessage.error("获取套餐列表失败");i.value=_.records,s.current=_.current,s.size=_.size,s.total=_.total}const A=(t,n)=>{d.push({name:"bundlePriceBaseinfo",query:{setMealId:t.id,shopId:t.shopId,isLookUp:n}})},U=async t=>{if(t.setMealStatus==="PROCESSING"){r.ElMessage.warning("进行中的活动不能被删除");return}try{if(!await r.ElMessageBox.confirm("确定删除该套餐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const{code:l}=await b([{setMealId:t.id,shopId:t.shopId}]);if(l!==200){r.ElMessage.error("删除失败");return}r.ElMessage.success("删除成功"),m()}catch{return}},T=async t=>{const{code:n}=await b(t);if(n!==200){r.ElMessage.error("删除失败");return}r.ElMessage.success("删除成功"),m()},J=t=>{s.current=1,s.size=t,m()},K=t=>{s.current=t,m()},Q=async t=>{r.ElMessageBox.confirm("确定下架该活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{code:n,msg:l}=await I({shopId:t.shopId,setMealId:t.id});if(n!==200){r.ElMessage.error(l);return}r.ElMessage.success("下架成功"),m()})},W=async t=>{r.ElMessageBox.alert(t.violationExplain||"暂无违规原因","违规原因",{center:!0,showConfirmButton:!1})};return e.onBeforeMount(()=>{m()}),u({chooseList:c,handleDelBatch:T,initactiveList:m}),(t,n)=>{const l=e.resolveComponent("el-button"),p=e.resolveComponent("el-table-column"),V=e.resolveComponent("el-image"),_=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",F,[e.createVNode(l,{type:"primary",round:"",onClick:j},{default:e.withCtx(()=>n[0]||(n[0]=[e.createTextVNode("新增套餐")])),_:1}),e.createVNode(l,{round:"",disabled:c.value.length===0,onClick:P},{default:e.withCtx(()=>n[1]||(n[1]=[e.createTextVNode("批量删除")])),_:1},8,["disabled"])]),e.createElementVNode("div",D,[e.createVNode(_,{ref_key:"multipleTableRef",ref:g,data:i.value,"header-cell-style":{background:"#f6f8fa",height:"48px"},"header-row-style":{color:"#333"},onSelectionChange:C},{default:e.withCtx(()=>[e.createVNode(p,{type:"selection",width:"30",selectable:a=>a.setMealStatus!=="PROCESSING"},null,8,["selectable"]),e.createVNode(p,{label:"套餐信息",width:"260px"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",G,[e.createVNode(V,{style:{width:"40px",height:"40px"},src:a.setMealMainPicture},null,8,["src"]),e.createElementVNode("div",q,e.toDisplayString(a.setMealName),1)])]),_:1}),e.createVNode(p,{label:"套餐类型",width:"140"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(a.setMealType==="OPTIONAL_PRODUCT"?"自选套餐":"固定套餐"),1)]),_:1}),e.createVNode(p,{label:"状态",width:"140"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:["ILLEGAL_SELL_OFF"].includes(a.setMealStatus)?"#F54319":["OVER","MERCHANT_SELL_OFF"].includes(a.setMealStatus)?"#999":"#333"})},e.toDisplayString(e.unref(k)[a.setMealStatus]),5)]),_:1}),e.createVNode(p,{label:"活动时间",width:"200"},{default:e.withCtx(({row:a})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(a.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(a.endTime),1)]),_:1}),e.createVNode(p,{label:"活动商品"},{default:e.withCtx(({row:a})=>[e.createTextVNode(e.toDisplayString(a.productCount),1)]),_:1}),e.createVNode(p,{label:"支付单数",width:"140"},{default:e.withCtx(({row:a})=>[e.createElementVNode("span",null,e.toDisplayString(a.orderCount||0),1)]),_:1}),e.createVNode(p,{label:"操作",fixed:"right",align:"right",width:"170"},{default:e.withCtx(({row:a})=>[e.createVNode(l,{link:"",type:"primary",onClick:E=>A(a,"true")},{default:e.withCtx(()=>n[2]||(n[2]=[e.createTextVNode("查看")])),_:2},1032,["onClick"]),["PROCESSING"].includes(a.setMealStatus)?(e.openBlock(),e.createBlock(l,{key:0,link:"",type:"primary",onClick:E=>Q(a)},{default:e.withCtx(()=>n[3]||(n[3]=[e.createTextVNode("下架")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.setMealStatus==="ILLEGAL_SELL_OFF"?(e.openBlock(),e.createBlock(l,{key:1,link:"",type:"primary",onClick:E=>W(a)},{default:e.withCtx(()=>n[4]||(n[4]=[e.createTextVNode("违规原因")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),a.setMealStatus!=="PROCESSING"?(e.openBlock(),e.createBlock(l,{key:2,link:"",type:"danger",onClick:E=>U(a)},{default:e.withCtx(()=>n[5]||(n[5]=[e.createTextVNode("删除")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),e.createVNode(L,{"page-num":s.current,"load-init":!0,"page-size":s.size,total:s.total,onReload:m,onHandleSizeChange:J,onHandleCurrentChange:K},null,8,["page-num","page-size","total"])],64)}}}),X="",z=((o,u)=>{const d=o.__vccOpts||o;for(const[h,f]of u)d[h]=f;return d})($,[["__scopeId","data-v-994335c0"]]),H={class:"q_plugin_container"};return e.defineComponent({__name:"ShopSetMeal",setup(o){const u=e.reactive({setMealStatus:"",keyword:""}),d=e.ref(),h=()=>{d.value.initactiveList()};return(f,i)=>{const g=e.resolveComponent("el-config-provider");return e.openBlock(),e.createElementBlock("div",H,[e.createVNode(g,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(B,{modelValue:u,"onUpdate:modelValue":i[0]||(i[0]=s=>u=s),onSearch:h},null,8,["modelValue"])]),_:1}),e.createVNode(z,{ref_key:"mealListRef",ref:d,search:u},null,8,["search"])])}}})});
