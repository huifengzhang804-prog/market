(function(e,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("vue"),require("element-plus"),require("@/composables/useConvert"),require("@/apis/http"),require("vue-router"),require("@element-plus/icons-vue"),require("vue-draggable-next"),require("@/views/material/selectMaterial.vue"),require("@/assets/image/ex_img.png"),require("@/components/q-edit/q-edit.vue")):typeof define=="function"&&define.amd?define(["vue","element-plus","@/composables/useConvert","@/apis/http","vue-router","@element-plus/icons-vue","vue-draggable-next","@/views/material/selectMaterial.vue","@/assets/image/ex_img.png","@/components/q-edit/q-edit.vue"],b):(e=typeof globalThis<"u"?globalThis:e||self,e.AddIntegralGoods=b(e.AddIntegralGoodsContext.Vue,e.AddIntegralGoodsContext.ElementPlus,e.AddIntegralGoodsContext.UseConvert,e.AddIntegralGoodsContext.Request,e.AddIntegralGoodsContext.VueRouter,e.AddIntegralGoodsContext.ElementPlusIconsVue,e.AddIntegralGoodsContext.VueDraggableNext,e.AddIntegralGoodsContext.selectMaterial,e.AddIntegralGoodsContext.ExampleImg,e.AddIntegralGoodsContext.QEdit))})(this,function(e,b,L,T,E,M,$,G,z,D){"use strict";var q=document.createElement("style");q.textContent=`@charset "UTF-8";.commodityForm[data-v-19718c53]{box-sizing:border-box;overflow-y:scroll}.commodityForm__tool[data-v-19718c53]{width:100%;align-items:center;position:sticky;bottom:0;padding:15px 0;display:flex;justify-content:center;box-shadow:0 0 10px #d5d5d5;background-color:#fff;z-index:100;margin-top:auto}.commodityForm .commodityForm__steps[data-v-19718c53]{position:sticky;top:0;z-index:100}.navLine[data-v-eb9b78dd]{margin:25px 0;height:40px;line-height:40px;background-color:#f8f8f8;padding-left:15px;font-weight:700}.serveMsg_hours[data-v-eb9b78dd]{display:flex;justify-content:center;align-items:center}.inputWidth[data-v-eb9b78dd]{width:550px}.serveMsg[data-v-eb9b78dd]{width:400px;display:flex}.com__attr[data-v-eb9b78dd]{margin-top:10px;width:620px;padding:20px;border:1px solid #d7d7d7}.com__attr-header[data-v-eb9b78dd]{display:flex;justify-content:space-between;align-items:center}.com__attr-content[data-v-eb9b78dd]{display:flex;justify-content:space-between;align-items:center;margin:10px 0}.com__attr-input[data-v-eb9b78dd]{width:230px}.com__attr-del[data-v-eb9b78dd]{color:red}.com__imgText[data-v-eb9b78dd]{position:absolute;right:0;bottom:0;font-size:12px;text-align:center;width:100%;background-color:#0000004d;border-radius:0 0 6px 6px;color:#fff}.avatar-uploader .el-upload{border:1px dashed var(--el-border-color);border-radius:6px;cursor:pointer;position:relative;overflow:hidden;transition:var(--el-transition-duration-fast)}.main-uploader .el-upload{border:1px dashed var(--el-border-color);border-radius:6px;cursor:pointer;position:relative;overflow:hidden;width:100px;height:100px;transition:var(--el-transition-duration-fast)}.avatar-uploader .el-upload:hover,.main-uploader .el-upload:hover{border-color:var(--el-color-primary)}.el-icon.avatar-uploader-icon{font-size:28px;color:#8c939d;width:250px;height:120px;text-align:center}.el-icon.main-uploader-icon{font-size:28px;color:#8c939d;width:100px;height:100px;text-align:center}.input_number .el-input__inner{text-align:left}.selectMaterialStyle{width:60px;height:60px;border-radius:5px;overflow:hidden;border:1px dashed #ccc;cursor:pointer;display:flex;justify-content:center;align-items:center}.selectMaterialStyle__span{color:#999;font-size:20px}.shopType{display:block!important}.shopType__tag{color:#8c939d}.shopType__select{display:flex}.shopType__select--type{padding:15px;text-align:center;border:1px solid #ccc;margin-right:20px;width:150px}.border{border:1px solid #fd0505!important}.info[data-v-47b515e2]{display:flex}.info__edit[data-v-47b515e2]{border:1px solid #ccc;margin-top:18px;z-index:99}.info__edit[data-v-47b515e2] ::-webkit-scrollbar{display:none}
`,document.head.appendChild(q);const A="addon-integral/integral/"+"product/",O=p=>T.post({url:A+"issue",data:p}),j=p=>T.get({url:A+"info",params:{id:p}}),W=p=>T.put({url:A+"update",data:p}),H={class:"commodityForm fdc1"},K={class:"commodityForm__tool"},Q=e.defineComponent({__name:"AddIntegralGoods",setup(p){const C={NewBasicInfo:{prev:"",next:"NewProductInfo",stepIndex:0},NewProductInfo:{prev:"NewBasicInfo",next:"",stepIndex:1}},s=E.useRouter(),x=E.useRoute(),{mulTenThousand:f,divTenThousand:y}=L(),_=e.ref(),h=[],F={NewBasicInfo:e.defineAsyncComponent(()=>Promise.resolve().then(()=>ne)),NewProductInfo:e.defineAsyncComponent(()=>Promise.resolve().then(()=>se))},V=e.ref("NewBasicInfo"),k=e.computed(()=>o.value.stepIndex),m=e.ref({id:"",name:"",price:1,integralPrice:0,stock:0,virtualSalesVolume:0,detail:"",pic:"",albumPics:"",freightPrice:0,integralProductAttributes:[{attributeName:"",attributeValue:""}],salePrice:0,productType:"REAL_PRODUCT"}),N=e.ref([]),o=e.computed(()=>C[V.value]),n=e.computed(()=>o.value.prev),I=e.computed(()=>o.value.next);e.onBeforeMount(S);async function S(){if(x.query.id){const{code:a,msg:i,data:u}=await j(x.query.id);if(a!==200){b.ElMessage.error(i||"获取积分商品信息失败");return}u.salePrice=y(u.salePrice),m.value=u,d()}}const w=()=>{P(_.value),V.value=n.value},P=a=>{h[k.value]||h.push(_.value)},B=()=>h[k.value]?h[k.value]:_.value,l=async()=>{let a=!0;I.value==="NewProductInfo"&&(a=t()),a&&B().currentFormRef&&B().currentFormRef.validate(i=>{i&&(P(_.value),V.value=I.value)})};function t(){return!0}const U=async()=>{const{id:a}=m.value;m.value.salePrice=+f(m.value.salePrice);const i={...m.value},{code:u,data:r,msg:c}=await(a?W(i):O(i));if(u!==200){b.ElMessage.error(c||`${a?"更新":"提交"}失败`);return}N.value=[],b.ElMessage.success(`${a?"更新":"提交"}成功`),s.push({name:"integralMall"})};function d(){let a=[];m.value.albumPics&&(a=m.value.albumPics.split(",")),N.value=a}const g=()=>{s.back()};return e.provide("form",{submitForm:m,commodityImgList:N}),(a,i)=>{const u=e.resolveComponent("el-step"),r=e.resolveComponent("el-steps"),c=e.resolveComponent("el-button");return e.openBlock(),e.createElementBlock("div",H,[e.createVNode(r,{active:k.value,simple:"",class:"commodityForm__steps"},{default:e.withCtx(()=>[e.createVNode(u,{title:"1.编辑基本信息",icon:"none"}),e.createVNode(u,{title:"2.编辑商品信息",icon:"none"})]),_:1},8,["active"]),(e.openBlock(),e.createBlock(e.KeepAlive,{exclude:["NewProductInfo"]},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(F[V.value]),{ref_key:"componentRef",ref:_,class:"f1"},null,512))],1024)),e.createElementVNode("div",K,[n.value!==""?(e.openBlock(),e.createBlock(c,{key:0,type:"primary",round:"",onClick:w},{default:e.withCtx(()=>i[0]||(i[0]=[e.createTextVNode("上一步")])),_:1})):e.createCommentVNode("",!0),I.value!==""?(e.openBlock(),e.createBlock(c,{key:1,type:"primary",round:"",onClick:l},{default:e.withCtx(()=>i[1]||(i[1]=[e.createTextVNode("下一步")])),_:1})):e.createCommentVNode("",!0),n.value!==""?(e.openBlock(),e.createBlock(c,{key:2,type:"primary",round:"",onClick:U},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(x).query.id?"更新":"上架"),1)]),_:1})):e.createCommentVNode("",!0),n.value!==""?(e.openBlock(),e.createBlock(c,{key:3,type:"",round:"",onClick:g},{default:e.withCtx(()=>i[2]||(i[2]=[e.createTextVNode(" 取消 ")])),_:1})):e.createCommentVNode("",!0)])])}}}),pe="",R=(p,C)=>{const s=p.__vccOpts||p;for(const[x,f]of C)s[x]=f;return s},Y=R(Q,[["__scopeId","data-v-19718c53"]]),J={key:0},X={key:1},Z={key:1,class:"shopType"},v={class:"shopType__select"},ee=["src","onClick"],te={key:1,class:"com__imgText"},oe=e.defineComponent({__name:"NewBasicInfo",setup(p,{expose:C}){const s=e.ref(!1),x=l=>{s.value=l},f=E.useRoute(),y=e.ref();let _=0;const h=l=>{s.value=!0,y.value=l,_++},F=l=>{_===1?n.value=l:n.value[y.value]=l,o.value.albumPics=w(n)},V=l=>{_===1?n.value=l:n.value[y.value]=l,o.value.albumPics=w(n)},k=()=>{o.value.albumPics=w(n)},m=e.ref(),N=e.inject("form"),o=N.submitForm,n=N.commodityImgList,I=e.reactive({name:[{required:!0,message:"请填写商品名称",trigger:"blur"}],stock:[{required:!0,message:"请填写商品库存",trigger:"blur"}],integralPrice:[{required:!0,message:"请填写积分价",trigger:"blur"}],albumPics:[{required:!0,message:"请选择商品主图",trigger:"change"}],productType:[{required:!0,message:"请选择商品类型",trigger:"change"}]});e.ref([{name:"7天退换",state:!1,text:"商家承诺7天无理由退换货",enum:"SEVEN_END_BACK"},{name:"小时发货",state:!1,text:"商家承诺订单发货时间",enum:"DAY_SEND"},{name:"假一赔十",state:!1,text:"若收到商品是假冒品牌，可获得十倍赔偿",enum:"FAKE_COMPENSATE"},{name:"正品保证",state:!1,text:"商家承诺商品正品质量",enum:"ALL_ENSURE"}]),e.onMounted(()=>{P()}),e.watch(o.value,l=>{P()},{immediate:!0});const S=l=>{n.value.splice(l,1),o.value.albumPics=w(n)};function w(l){return l.value.join(",")}function P(){let l=[];o.value.albumPics&&(l=o.value.albumPics.split(",")),n.value=l}const B=l=>{var t;((t=o.value)==null?void 0:t.id)===""&&(o.value.productType=l)};return C({currentFormRef:m}),(l,t)=>{const U=e.resolveComponent("el-input"),d=e.resolveComponent("el-form-item"),g=e.resolveComponent("el-input-number"),a=e.resolveComponent("el-icon"),i=e.resolveComponent("el-row"),u=e.resolveComponent("el-form");return e.openBlock(),e.createElementBlock(e.Fragment,null,[t[16]||(t[16]=e.createElementVNode("div",{class:"navLine"},"基本信息",-1)),e.createVNode(u,{ref_key:"currentFormRef",ref:m,model:e.unref(o),rules:I},{default:e.withCtx(()=>[e.createVNode(d,{label:"商品名称",prop:"name","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(U,{modelValue:e.unref(o).name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.unref(o).name=r),class:"inputWidth",placeholder:"请填写商品名称",maxlength:"35"},null,8,["modelValue"])]),_:1}),e.createVNode(d,{label:"商品类型"+(e.unref(f).query.id?"(单选)":""),prop:"productType","label-width":"120px"},{default:e.withCtx(()=>[e.unref(f).query.id?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(o).productType==="REAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",J,"实物商品(快递配送)")):e.unref(o).productType==="VIRTUAL_PRODUCT"?(e.openBlock(),e.createElementBlock("span",X,"虚拟商品(无需物流)")):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("div",Z,[t[13]||(t[13]=e.createElementVNode("div",{class:"shopType__tag"},"不同的商品类型可编辑的字段内容不同，商品类型一旦发布后将不可更改",-1)),e.createElementVNode("div",v,[e.createElementVNode("div",{class:e.normalizeClass(["shopType__select--type",e.unref(o).productType==="REAL_PRODUCT"?"border":""]),onClick:t[1]||(t[1]=r=>B("REAL_PRODUCT"))},t[11]||(t[11]=[e.createElementVNode("p",{style:{"font-size":"16px"}},"实物商品",-1),e.createElementVNode("p",{style:{color:"#8c939d"}},"快递配送",-1)]),2),e.createElementVNode("div",{class:e.normalizeClass(["shopType__select--type",e.unref(o).productType==="VIRTUAL_PRODUCT"?"border":""]),onClick:t[2]||(t[2]=r=>B("VIRTUAL_PRODUCT"))},t[12]||(t[12]=[e.createElementVNode("p",{style:{"font-size":"16px"}},"虚拟商品",-1),e.createElementVNode("p",{style:{color:"#8c939d"}},"无需物流",-1)]),2)])]))]),_:1},8,["label"]),e.createVNode(d,{label:"划线价",prop:"price","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{modelValue:e.unref(o).price,"onUpdate:modelValue":t[3]||(t[3]=r=>e.unref(o).price=r),class:"input_number inputWidth",placeholder:"请填写划线价",min:0,max:999999,precision:2,controls:!1},null,8,["modelValue"])]),_:1}),e.createVNode(d,{label:"积分价",prop:"integralPrice","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{"model-value":+e.unref(o).integralPrice,class:"inputWidth input_number",max:999999,min:1,placeholder:"请填写积分价",controls:!1,"onUpdate:modelValue":t[4]||(t[4]=r=>e.unref(o).integralPrice=r)},null,8,["model-value"])]),_:1}),e.createVNode(d,{label:"销售价",prop:"salePrice","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{"model-value":+e.unref(o).salePrice,max:999999,min:0,class:"inputWidth input_number",precision:2,controls:!1,"onUpdate:modelValue":t[5]||(t[5]=r=>e.unref(o).salePrice=r)},null,8,["model-value"])]),_:1}),e.createVNode(d,{label:"库存",prop:"stock","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{modelValue:e.unref(o).stock,"onUpdate:modelValue":t[6]||(t[6]=r=>e.unref(o).stock=r),class:"input_number inputWidth",max:999999,placeholder:"请填写库存",min:0,precision:0,controls:!1},null,8,["modelValue"])]),_:1}),e.createVNode(d,{label:"销量(注水)",prop:"initSalesVolume","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{modelValue:e.unref(o).virtualSalesVolume,"onUpdate:modelValue":t[7]||(t[7]=r=>e.unref(o).virtualSalesVolume=r),max:999999,min:0,class:"inputWidth input_number",placeholder:"请填写销量(注水)",precision:0,controls:!1},null,8,["modelValue"])]),_:1}),e.unref(o).productType!=="VIRTUAL_PRODUCT"?(e.openBlock(),e.createBlock(d,{key:0,label:"运费",prop:"freightPrice","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(g,{modelValue:e.unref(o).freightPrice,"onUpdate:modelValue":t[8]||(t[8]=r=>e.unref(o).freightPrice=r),class:"inputWidth input_number",placeholder:"请填写重量（KG）",max:999999,min:0,precision:0,controls:!1},null,8,["modelValue"])]),_:1})):e.createCommentVNode("",!0),e.createVNode(d,{"label-width":"120px"}),e.createVNode(d,{label:"商品主图",prop:"albumPics","label-width":"120px"},{default:e.withCtx(()=>[e.createVNode(i,{style:{width:"100%"}},{default:e.withCtx(()=>[e.unref(n).length?(e.openBlock(),e.createBlock(e.unref($.VueDraggableNext),{key:0,modelValue:e.unref(n),"onUpdate:modelValue":t[9]||(t[9]=r=>e.isRef(n)?n.value=r:null),style:{display:"flex"},onSort:k},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(r,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,style:{position:"relative","margin-right":"20px"}},[e.createElementVNode("img",{src:e.unref(n)[c],alt:"",class:"selectMaterialStyle",style:{width:"105px",height:"105px"},onClick:de=>h(c)},null,8,ee),r?(e.openBlock(),e.createBlock(a,{key:0,color:"#7f7f7f",size:"20px",style:{position:"absolute",right:"-5px",top:"-5px",background:"#fff","border-radius":"50%",cursor:"pointer"},onClick:de=>S(c)},{default:e.withCtx(()=>[e.createVNode(e.unref(M.CircleClose))]),_:2},1032,["onClick"])):e.createCommentVNode("",!0),c===0?(e.openBlock(),e.createElementBlock("div",te,"封面图")):e.createCommentVNode("",!0)]))),128))]),_:1},8,["modelValue"])):e.createCommentVNode("",!0),e.unref(n).length!==6?(e.openBlock(),e.createElementBlock("div",{key:1,class:"selectMaterialStyle",style:{width:"100px",height:"100px"},onClick:t[10]||(t[10]=r=>h(e.unref(n).length))},t[14]||(t[14]=[e.createElementVNode("span",{class:"selectMaterialStyle__span"},"+",-1)]))):e.createCommentVNode("",!0)]),_:1}),t[15]||(t[15]=e.createElementVNode("div",{style:{color:"rgba(69, 64, 60, 0.6)","font-size":"12px"}},"尺寸建议 750x750、750x1125 像素以上，大小1M以下，最多6张 (可拖拽图片调整顺序)1",-1))]),_:1})]),_:1},8,["model","rules"]),e.createVNode(G,{"dialog-visible":s.value,"upload-files":6-e.unref(n).length,onSelectMaterialFn:x,onCroppedFileChange:F,onCheckedFileLists:V},null,8,["dialog-visible","upload-files"])],64)}}}),me="",ue="",ne=Object.freeze(Object.defineProperty({__proto__:null,default:R(oe,[["__scopeId","data-v-eb9b78dd"]])},Symbol.toStringTag,{value:"Module"})),re={class:"info"},le=["src"],ae={class:"info__edit"},ie=e.defineComponent({__name:"NewProductInfo",setup(p){const s=e.inject("form").submitForm;return(x,f)=>(e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("img",{class:"info__img",src:e.unref(z)},null,8,le),e.createElementVNode("div",ae,[e.createVNode(D,{content:e.unref(s).detail,"onUpdate:content":f[0]||(f[0]=y=>e.unref(s).detail=y),height:"711px"},null,8,["content"])])]))}}),_e="",se=Object.freeze(Object.defineProperty({__proto__:null,default:R(ie,[["__scopeId","data-v-47b515e2"]])},Symbol.toStringTag,{value:"Module"}));return Y});
