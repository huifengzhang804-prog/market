(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue"),require("@vueuse/core"),require("@/components/SchemaForm.vue"),require("@/apis/http"),require("@/components/PageManage.vue"),require("vue-router"),require("element-plus"),require("@/components/element-plus/el-table/ElTableEmpty/index.vue")):typeof define=="function"&&define.amd?define(["vue","@vueuse/core","@/components/SchemaForm.vue","@/apis/http","@/components/PageManage.vue","vue-router","element-plus","@/components/element-plus/el-table/ElTableEmpty/index.vue"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.PlatformBargain=h(e.PlatformBargainContext.Vue,e.PlatformBargainContext.VueUse,e.PlatformBargainContext.SchemaForm,e.PlatformBargainContext.Request,e.PlatformBargainContext.PageManageTwo,e.PlatformBargainContext.VueRouter,e.PlatformBargainContext.ElementPlus,e.PlatformBargainContext.ElTableEmpty))})(this,function(e,h,O,x,R,T,u,F){"use strict";var w=document.createElement("style");w.textContent=`@charset "UTF-8";.goods[data-v-96eb1d6d]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[data-v-96eb1d6d] .el-dialog__body{padding-bottom:0!important}[data-v-96eb1d6d] .el-link+.el-link{margin-left:10px}
`,document.head.appendChild(w);const I=e.defineComponent({__name:"head-search",props:{modelValue:{type:Object,default(){return{}}},batchDisabled:{type:Boolean,default:!0},showBatchDelBtn:{type:Boolean,default:!0},selectOptions:{type:Object,default(){return{}}}},emits:["update:modelValue","batchDel","search"],setup(l,{emit:f}){const r=l,V=[{label:"活动名称",labelWidth:75,prop:"keywords",valueType:"copy",fieldProps:{placeholder:"请输入活动名称"}},{label:"活动状态",prop:"status",valueType:"select",options:[{value:"",label:"全部状态"},{value:"NOT_STARTED",label:"未开始"},{value:"PROCESSING",label:"进行中"},{value:"OVER",label:"已结束"},{value:"SHOP_SELL_OFF",label:"已下架"},{value:"ILLEGAL_SELL_OFF",label:"违规下架"}],fieldProps:{placeholder:"请选择"}}],p=f,c=h.useVModel(r,"modelValue",p),E=()=>{Object.keys(c.value).forEach(d=>c.value[d]=""),p("search")};return(d,s)=>{const _=e.resolveComponent("el-button"),N=e.resolveComponent("el-config-provider");return e.openBlock(),e.createBlock(N,{"empty-values":[void 0,null]},{default:e.withCtx(()=>[e.createVNode(O,{modelValue:e.unref(c),"onUpdate:modelValue":s[1]||(s[1]=y=>e.isRef(c)?c.value=y:null),columns:V,onSearchHandle:s[2]||(s[2]=y=>p("search")),onHandleReset:E},{otherOperations:e.withCtx(()=>[l.showBatchDelBtn?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(_,{key:0,disabled:l.batchDisabled,round:"",plain:"",onClick:s[0]||(s[0]=y=>p("batchDel"))},{default:e.withCtx(()=>s[3]||(s[3]=[e.createTextVNode("批量移除")])),_:1},8,["disabled"]))]),_:1},8,["modelValue"])]),_:1})}}}),b="addon-bargain/bargain",P=l=>x.get({url:b,params:l}),D=l=>x.get({url:`${b}/illegal/reason/${l}`}),M=l=>x.del({url:b,data:l}),z=l=>x.put({url:`${b}/platform/sellOf`,data:l}),q={class:"q_plugin_container"},A={class:"table_container"},G={class:"goods"},$={class:"goods"},H={class:"dialog-footer"},U=e.defineComponent({__name:"PlatformBargain",setup(l){const f=e.ref({keywords:"",status:""}),r=e.ref({size:10,current:1}),C=e.ref(0),V=T.useRouter(),p=e.ref([]),c=e.ref([]),E={NOT_STARTED:"未开始",PROCESSING:"进行中",OVER:"已结束",ILLEGAL_SELL_OFF:"违规下架",SHOP_SELL_OFF:"已下架"},d=e.ref({shopId:"",bargainId:"",violationReason:""}),s=e.ref(),_=e.ref(!1),N=a=>{_.value=!0,d.value.shopId=a.shopId,d.value.bargainId=a.id},y=()=>{s.value.resetFields()},j=()=>{s.value.validate(async(a,o)=>{if(a){const{code:n,msg:m}=await z(d.value);if(n!==200){u.ElMessage.error(m);return}u.ElMessage.success("下架成功");const i=p.value.find(S=>S.id===d.value.bargainId);i&&(i.status="ILLEGAL_SELL_OFF"),_.value=!1}else console.log("error submit!",o)})},v=async()=>{if(!c.value.length){u.ElMessage.info("请选择需要删除的活动");return}if(!await u.ElMessageBox.confirm("确定删除活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const o=c.value.map(i=>({shopId:i.shopId,activityId:i.id})),{code:n,data:m}=await M(o);if(n!==200){u.ElMessage.error("删除失败");return}u.ElMessage.success("删除成功"),g()},W=a=>{V.push({name:"bargainBaseinfo",query:{activityId:a.id,shopId:a.shopId}})},B=e.ref(""),J=async a=>{const{data:o}=await D(a.id);B.value=o||"暂无违规原因"},K=()=>{g()};async function g(){const{status:a,keywords:o}=f.value,n={...r.value,status:a,keyword:o},{code:m,data:i}=await P(n);if(m!==200)return u.ElMessage.error("获取活动列表失败");p.value=i.records,r.value.current=i.current,r.value.size=i.size,C.value=i.total}const Q=a=>{r.value.size=a,g()},X=a=>{r.value.current=a,g()};return e.onBeforeMount(()=>{g()}),(a,o)=>{const n=e.resolveComponent("el-table-column"),m=e.resolveComponent("el-link"),i=e.resolveComponent("el-tooltip"),S=e.resolveComponent("el-table"),Y=e.resolveComponent("el-input"),Z=e.resolveComponent("el-form-item"),ee=e.resolveComponent("el-form"),L=e.resolveComponent("el-button"),te=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",q,[e.createVNode(I,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),onBatchDel:v,onSearch:K},null,8,["modelValue"]),e.createElementVNode("div",A,[e.createVNode(S,{ref:"multipleTableRef",data:p.value,"header-row-style":{fontSize:"14px",color:"#333"},"header-cell-style":{background:"#f6f8fa",height:"50px"},"cell-style":{fontSize:"14px",color:"#333333"},onSelectionChange:o[1]||(o[1]=t=>c.value=t)},{empty:e.withCtx(()=>[e.createVNode(F)]),default:e.withCtx(()=>[e.createVNode(n,{label:"店铺名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",G,e.toDisplayString(t.shopName),1)]),_:1}),e.createVNode(n,{label:"活动名称",width:"200"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",$,e.toDisplayString(t.name),1)]),_:1}),e.createVNode(n,{label:"活动状态",width:"120"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",{style:e.normalizeStyle({color:["ILLEGAL_SELL_OFF"].includes(t.status)?"#F54319":["OVER","SHOP_SELL_OFF"].includes(t.status)?"#999":"#333"})},e.toDisplayString(E[t.status]),5)]),_:1}),e.createVNode(n,{label:"活动时间"},{default:e.withCtx(({row:t})=>[e.createElementVNode("div",null,"起："+e.toDisplayString(t.startTime),1),e.createElementVNode("div",null,"止："+e.toDisplayString(t.endTime),1)]),_:1}),e.createVNode(n,{label:"活动商品",width:"140"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.productNum),1)]),_:1}),e.createVNode(n,{label:"支付单数",width:"140"},{default:e.withCtx(({row:t})=>[e.createElementVNode("span",null,e.toDisplayString(t.payOrder),1)]),_:1}),e.createVNode(n,{label:"操作",align:"right",fixed:"right"},{default:e.withCtx(({row:t})=>[["ILLEGAL_SELL_OFF"].includes(t.status)?(e.openBlock(),e.createBlock(i,{key:0,class:"box-item",effect:"dark",content:B.value,placement:"bottom-start"},{default:e.withCtx(()=>[e.createVNode(m,{underline:!1,type:"primary",size:"small",onMouseenterOnce:k=>J(t)},{default:e.withCtx(()=>o[6]||(o[6]=[e.createTextVNode(" 违规原因 ")])),_:2},1032,["onMouseenterOnce"])]),_:2},1032,["content"])):e.createCommentVNode("",!0),["NOT_STARTED","PROCESSING"].includes(t.status)?(e.openBlock(),e.createBlock(m,{key:1,underline:!1,type:"danger",size:"small",onClick:k=>N(t)},{default:e.withCtx(()=>o[7]||(o[7]=[e.createTextVNode(" 违规下架 ")])),_:2},1032,["onClick"])):e.createCommentVNode("",!0),e.createVNode(m,{underline:!1,type:"primary",size:"small",onClick:k=>W(t)},{default:e.withCtx(()=>o[8]||(o[8]=[e.createTextVNode(" 查看 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e.createVNode(R,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=t=>r.value=t),"load-init":!0,total:C.value,onHandleSizeChange:Q,onHandleCurrentChange:X,onReload:g},null,8,["modelValue","total"]),e.createVNode(te,{modelValue:_.value,"onUpdate:modelValue":o[5]||(o[5]=t=>_.value=t),title:"违规下架",width:"500",center:"",onClose:y},{footer:e.withCtx(()=>[e.createElementVNode("div",H,[e.createVNode(L,{onClick:o[4]||(o[4]=t=>_.value=!1)},{default:e.withCtx(()=>o[9]||(o[9]=[e.createTextVNode("取消")])),_:1}),e.createVNode(L,{type:"primary",onClick:j},{default:e.withCtx(()=>o[10]||(o[10]=[e.createTextVNode("确定")])),_:1})])]),default:e.withCtx(()=>[e.createVNode(ee,{ref_key:"illegalReasonFormRef",ref:s,model:d.value,rules:{violationReason:[{required:!0,message:"请输入违规原因",trigger:"blur"}]},"status-icon":""},{default:e.withCtx(()=>[e.createVNode(Z,{label:"",prop:"violationReason"},{default:e.withCtx(()=>[e.createVNode(Y,{modelValue:d.value.violationReason,"onUpdate:modelValue":o[3]||(o[3]=t=>d.value.violationReason=t),placeholder:"请输入违规原因，必填",type:"textarea",maxlength:"50","show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),oe="";return((l,f)=>{const r=l.__vccOpts||l;for(const[C,V]of f)r[C]=V;return r})(U,[["__scopeId","data-v-96eb1d6d"]])});
